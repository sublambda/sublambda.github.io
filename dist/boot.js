import{a as Xm,b as _m,c as ca,d as Im,e as Gm,f as M2}from"./chunk-TIV7WBGP.js";import{$a as Cn,Ea as Cm,Fa as la,H as fm,I as ti,J as Ye,Ja as Lm,Ma as Tm,P as nr,Q as q,R as pm,T as mm,U as Lt,W as gm,Xa as sr,Y as ym,Za as Mm,_ as bm,ab as ha,b as xn,c as ei,ca as Sn,d as am,da as wm,e as lm,eb as Pm,f as hm,fa as vm,g as cm,ga as aa,ha as xm,i as dm,ia as Sm,ib as Rm,jb as rr,l as um,lb as uc,mb as fc,nb as Zm,ob as Em,pb as pc,ra as km,za as kn}from"./chunk-IY3G7QRH.js";import{b as Ct,c as T2,d as Ci}from"./chunk-FSRPMVAS.js";var mc=Ct(Wm=>{Object.observe||function(i,e,t,n){"use strict";var s,r,o=["add","update","delete","reconfigure","setPrototype","preventExtensions"],a=e.isArray||function(m){return function(w){return m.call(w)==="[object Array]"}}(i.prototype.toString),l=e.prototype.indexOf?e.indexOf||function(m,w,v){return e.prototype.indexOf.call(m,w,v)}:function(m,w,v){for(var S=v||0;S<m.length;S++)if(m[S]===w)return S;return-1},h=t.Map===n||!Map.prototype.forEach?function(){var m=[],w=[];return{size:0,has:function(v){return l(m,v)>-1},get:function(v){return w[l(m,v)]},set:function(v,S){var P=l(m,v);P===-1?(m.push(v),w.push(S),this.size++):w[P]=S},delete:function(v){var S=l(m,v);S>-1&&(m.splice(S,1),w.splice(S,1),this.size--)},forEach:function(v){for(var S=0;S<m.length;S++)v.call(arguments[1],w[S],m[S],this)}}}:function(){return new Map},c=i.getOwnPropertyNames?function(){var m=i.getOwnPropertyNames;try{arguments.callee}catch{var w=(m(l).join(" ")+" ").replace(/prototype |length |name /g,"").slice(0,-1).split(" ");w.length&&(m=function(S){var P=i.getOwnPropertyNames(S);if(typeof S=="function")for(var Z=0,E;Z<w.length;)(E=l(P,w[Z++]))>-1&&P.splice(E,1);return P})}return m}():function(m){var w=[],v,S;if("hasOwnProperty"in m)for(v in m)m.hasOwnProperty(v)&&w.push(v);else{S=i.hasOwnProperty;for(v in m)S.call(m,v)&&w.push(v)}return a(m)&&w.push("length"),w},d=i.getPrototypeOf,u=i.defineProperties&&i.getOwnPropertyDescriptor,f=t.requestAnimationFrame||t.webkitRequestAnimationFrame||function(){var m=+new Date,w=m;return function(v){return setTimeout(function(){v((w=+new Date)-m)},17)}}(),g=function(m,w,v){var S=s.get(m);S?(p(S,m),L(m,S,w,v)):(S=C(m),L(m,S,w,v),s.size===1&&f(k))},C=function(m,E){var v=c(m),S=[],P,Z=0,E={handlers:h(),frozen:i.isFrozen?i.isFrozen(m):!1,extensible:i.isExtensible?i.isExtensible(m):!0,proto:d&&d(m),properties:v,values:S,notifier:M(m,E)};if(u)for(P=E.descriptors=[];Z<v.length;)P[Z]=u(m,v[Z]),S[Z]=m[v[Z++]];else for(;Z<v.length;)S[Z]=m[v[Z++]];return s.set(m,E),E},p=function(){var m=u?function(v,S,P,Z,E){var D=S.properties[P],A=v[D],O=S.values[P],j=S.descriptors[P];"value"in E&&(O===A?O===0&&1/O!==1/A:O===O||A===A)&&(b(v,S,{name:D,type:"update",object:v,oldValue:O},Z),S.values[P]=A),j.configurable&&(!E.configurable||E.writable!==j.writable||E.enumerable!==j.enumerable||E.get!==j.get||E.set!==j.set)&&(b(v,S,{name:D,type:"reconfigure",object:v,oldValue:O},Z),S.descriptors[P]=E)}:function(v,S,P,Z){var E=S.properties[P],D=v[E],A=S.values[P];(A===D?A===0&&1/A!==1/D:A===A||D===D)&&(b(v,S,{name:E,type:"update",object:v,oldValue:A},Z),S.values[P]=D)},w=u?function(v,S,P,Z,E){for(var D=S.length,A;P&&D--;)S[D]!==null&&(A=u(v,S[D]),P--,A?m(v,Z,D,E,A):(b(v,Z,{name:S[D],type:"delete",object:v,oldValue:Z.values[D]},E),Z.properties.splice(D,1),Z.values.splice(D,1),Z.descriptors.splice(D,1)))}:function(v,S,P,Z,E){for(var D=S.length;P&&D--;)S[D]!==null&&(b(v,Z,{name:S[D],type:"delete",object:v,oldValue:Z.values[D]},E),Z.properties.splice(D,1),Z.values.splice(D,1),P--)};return function(v,S,P){if(!(!v.handlers.size||v.frozen)){var Z,E,D,A=v.values,O=v.descriptors,j=0,U,W,R,X,I;if(v.extensible)if(Z=v.properties.slice(),E=Z.length,D=c(S),O){for(;j<D.length;)W=D[j++],U=l(Z,W),I=u(S,W),U===-1?(b(S,v,{name:W,type:"add",object:S},P),v.properties.push(W),A.push(S[W]),O.push(I)):(Z[U]=null,E--,m(S,v,U,P,I));w(S,Z,E,v,P),i.isExtensible(S)||(v.extensible=!1,b(S,v,{type:"preventExtensions",object:S},P),v.frozen=i.isFrozen(S))}else{for(;j<D.length;)W=D[j++],U=l(Z,W),R=S[W],U===-1?(b(S,v,{name:W,type:"add",object:S},P),v.properties.push(W),A.push(R)):(Z[U]=null,E--,m(S,v,U,P));w(S,Z,E,v,P)}else if(!v.frozen){for(;j<Z.length;j++)W=Z[j],m(S,v,j,P,u(S,W));i.isFrozen(S)&&(v.frozen=!0)}d&&(X=d(S),X!==v.proto&&(b(S,v,{type:"setPrototype",name:"__proto__",object:S,oldValue:v.proto}),v.proto=X))}}}(),k=function(){s.size&&(s.forEach(p),r.forEach(T),f(k))},T=function(m,w){var v=m.changeRecords;v.length&&(m.changeRecords=[],w(v))},M=function(m,w){return arguments.length<2&&(w=s.get(m)),w&&w.notifier||{notify:function(v){v.type;var S=s.get(m);if(S){var P={object:m},Z;for(Z in v)Z!=="object"&&(P[Z]=v[Z]);b(m,S,P)}},performChange:function(v,S){if(typeof v!="string")throw new TypeError("Invalid non-string changeType");if(typeof S!="function")throw new TypeError("Cannot perform non-function");var P=s.get(m),Z,E,D=arguments[2],A=D===n?S():S.call(D);if(P&&p(P,m,v),P&&A&&typeof A=="object"){E={object:m,type:v};for(Z in A)Z!=="object"&&Z!=="type"&&(E[Z]=A[Z]);b(m,P,E)}}}},L=function(m,w,v,S){var P=r.get(v);P||r.set(v,P={observed:h(),changeRecords:[]}),P.observed.set(m,{acceptList:S.slice(),data:w}),w.handlers.set(v,P)},b=function(m,w,v,S){w.handlers.forEach(function(P){var Z=P.observed.get(m).acceptList;(typeof S!="string"||l(Z,S)===-1)&&l(Z,v.type)>-1&&P.changeRecords.push(v)})};s=h(),r=h(),i.observe=function(w,v,S){if(!w||typeof w!="object"&&typeof w!="function")throw new TypeError("Object.observe cannot observe non-object");if(typeof v!="function")throw new TypeError("Object.observe cannot deliver to non-function");if(i.isFrozen&&i.isFrozen(v))throw new TypeError("Object.observe cannot deliver to a frozen function object");if(S===n)S=o;else if(!S||typeof S!="object")throw new TypeError("Third argument to Object.observe must be an array of strings.");return g(w,v,S),w},i.unobserve=function(w,v){if(w===null||typeof w!="object"&&typeof w!="function")throw new TypeError("Object.unobserve cannot unobserve non-object");if(typeof v!="function")throw new TypeError("Object.unobserve cannot deliver to non-function");var S=r.get(v),P;return S&&(P=S.observed.get(w))&&(S.observed.forEach(function(Z,E){p(Z.data,E)}),f(function(){T(S,v)}),S.observed.size===1&&S.observed.has(w)?r.delete(v):S.observed.delete(w),P.data.handlers.size===1?s.delete(w):P.data.handlers.delete(v)),w},i.getNotifier=function(w){if(w===null||typeof w!="object"&&typeof w!="function")throw new TypeError("Object.getNotifier cannot getNotifier non-object");return i.isFrozen&&i.isFrozen(w)?null:M(w)},i.deliverChangeRecords=function(w){if(typeof w!="function")throw new TypeError("Object.deliverChangeRecords cannot deliver to non-function");var v=r.get(w);v&&(v.observed.forEach(function(S,P){p(S.data,P)}),T(v,w))}}(Object,Array,Wm)});var da=Ct((gc,Dm)=>{(function(i,e){typeof gc=="object"?Dm.exports=e():typeof define=="function"&&define.amd?define(e):i.Happens=e()})(gc,function(){"use strict";function i(t){var n=this instanceof i;if(t){if(n)throw new Error("You can't pass a target when instantiating with the `new` keyword");for(var s in i.prototype)t[s]=i.prototype[s]}else if(!n)return new i}i.prototype.__init=function(t){var n=this.__listeners||(this.__listeners=[]);return n[t]||(n[t]=[])},i.prototype.on=function(t,n){e(n),this.__init(t).push(n)},i.prototype.off=function(t,n){var s=this.__init(t);s.splice(s.indexOf(n),1)},i.prototype.once=function(t,n){e(n);var s=this,r=function(){s.off(t,r),n.apply(this,arguments)};this.on(t,r)},i.prototype.emit=function(t){var n,s=this.__init(t).slice(0);for(n in s)s[n].apply(this,[].slice.call(arguments,1))};function e(t){if(!(t&&t instanceof Function))throw new Error(t+" is not a Function")}return i})});var Hm=Ct((Nm,Am)=>{Am.exports=Nm=P2;function P2(i,e){this.path=i,this.name=e.name,this.type=e.type,this.object=e.object,this.value=e.object[e.name],this.oldValue=e.oldValue}});var Qm=Ct((SR,yc)=>{"use strict";var os=typeof Reflect=="object"?Reflect:null,Om=os&&typeof os.apply=="function"?os.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ua;os&&typeof os.ownKeys=="function"?ua=os.ownKeys:Object.getOwnPropertySymbols?ua=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ua=function(e){return Object.getOwnPropertyNames(e)};function R2(i){console&&console.warn&&console.warn(i)}var zm=Number.isNaN||function(e){return e!==e};function re(){re.init.call(this)}yc.exports=re;yc.exports.once=_2;re.EventEmitter=re;re.prototype._events=void 0;re.prototype._eventsCount=0;re.prototype._maxListeners=void 0;var Vm=10;function fa(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(re,"defaultMaxListeners",{enumerable:!0,get:function(){return Vm},set:function(i){if(typeof i!="number"||i<0||zm(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Vm=i}});re.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};re.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||zm(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Fm(i){return i._maxListeners===void 0?re.defaultMaxListeners:i._maxListeners}re.prototype.getMaxListeners=function(){return Fm(this)};re.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[e];if(l===void 0)return!1;if(typeof l=="function")Om(l,this,t);else for(var h=l.length,c=Um(l,h),n=0;n<h;++n)Om(c[n],this,t);return!0};function Km(i,e,t,n){var s,r,o;if(fa(t),r=i._events,r===void 0?(r=i._events=Object.create(null),i._eventsCount=0):(r.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),r=i._events),o=r[e]),o===void 0)o=r[e]=t,++i._eventsCount;else if(typeof o=="function"?o=r[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),s=Fm(i),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=e,a.count=o.length,R2(a)}return i}re.prototype.addListener=function(e,t){return Km(this,e,t,!1)};re.prototype.on=re.prototype.addListener;re.prototype.prependListener=function(e,t){return Km(this,e,t,!0)};function Z2(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ym(i,e,t){var n={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},s=Z2.bind(n);return s.listener=t,n.wrapFn=s,s}re.prototype.once=function(e,t){return fa(t),this.on(e,Ym(this,e,t)),this};re.prototype.prependOnceListener=function(e,t){return fa(t),this.prependListener(e,Ym(this,e,t)),this};re.prototype.removeListener=function(e,t){var n,s,r,o,a;if(fa(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;r===0?n.shift():E2(n,r),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};re.prototype.off=re.prototype.removeListener;re.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var r=Object.keys(n),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function Bm(i,e,t){var n=i._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?X2(s):Um(s,s.length)}re.prototype.listeners=function(e){return Bm(this,e,!0)};re.prototype.rawListeners=function(e){return Bm(this,e,!1)};re.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):jm.call(i,e)};re.prototype.listenerCount=jm;function jm(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}re.prototype.eventNames=function(){return this._eventsCount>0?ua(this._events):[]};function Um(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i[n];return t}function E2(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function X2(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function _2(i,e){return new Promise(function(t,n){function s(o){i.removeListener(e,r),n(o)}function r(){typeof i.removeListener=="function"&&i.removeListener("error",s),t([].slice.call(arguments))}Jm(i,e,r,{once:!0}),e!=="error"&&I2(i,s,{once:!0})})}function I2(i,e,t){typeof i.on=="function"&&Jm(i,"error",e,t)}function Jm(i,e,t,n){if(typeof i.on=="function")n.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function s(r){n.once&&i.removeEventListener(e,s),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}});var qm=Ct((kR,$m)=>{var or=1e3,ar=or*60,lr=ar*60,hr=lr*24,G2=hr*365.25;$m.exports=function(i,e){return e=e||{},typeof i=="string"?W2(i):e.long?N2(i):D2(i)};function W2(i){var e=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(i);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"y":return t*G2;case"days":case"day":case"d":return t*hr;case"hours":case"hour":case"h":return t*lr;case"minutes":case"minute":case"m":return t*ar;case"seconds":case"second":case"s":return t*or;case"ms":return t}}}function D2(i){return i>=hr?Math.round(i/hr)+"d":i>=lr?Math.round(i/lr)+"h":i>=ar?Math.round(i/ar)+"m":i>=or?Math.round(i/or)+"s":i+"ms"}function N2(i){return pa(i,hr,"day")||pa(i,lr,"hour")||pa(i,ar,"minute")||pa(i,or,"second")||i+" ms"}function pa(i,e,t){if(!(i<e))return i<e*1.5?Math.floor(i/e)+" "+t:Math.ceil(i/e)+" "+t+"s"}});var tg=Ct((he,eg)=>{he=eg.exports=O2;he.coerce=K2;he.disable=z2;he.enable=V2;he.enabled=F2;he.humanize=qm();he.names=[];he.skips=[];he.formatters={};var A2=0,bc;function H2(){return he.colors[A2++%he.colors.length]}function O2(i){function e(){}e.enabled=!1;function t(){var s=t,r=+new Date,o=r-(bc||r);s.diff=o,s.prev=bc,s.curr=r,bc=r,s.useColors==null&&(s.useColors=he.useColors()),s.color==null&&s.useColors&&(s.color=H2());var a=Array.prototype.slice.call(arguments);a[0]=he.coerce(a[0]),typeof a[0]!="string"&&(a=["%o"].concat(a));var l=0;a[0]=a[0].replace(/%([a-z%])/g,function(c,d){if(c==="%%")return c;l++;var u=he.formatters[d];if(typeof u=="function"){var f=a[l];c=u.call(s,f),a.splice(l,1),l--}return c}),typeof he.formatArgs=="function"&&(a=he.formatArgs.apply(s,a));var h=t.log||he.log||console.log.bind(console);h.apply(s,a)}t.enabled=!0;var n=he.enabled(i)?t:e;return n.namespace=i,n}function V2(i){he.save(i);for(var e=(i||"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(i=e[n].replace(/\*/g,".*?"),i[0]==="-"?he.skips.push(new RegExp("^"+i.substr(1)+"$")):he.names.push(new RegExp("^"+i+"$")))}function z2(){he.enable("")}function F2(i){var e,t;for(e=0,t=he.skips.length;e<t;e++)if(he.skips[e].test(i))return!1;for(e=0,t=he.names.length;e<t;e++)if(he.names[e].test(i))return!0;return!1}function K2(i){return i instanceof Error?i.stack||i.message:i}});var sg=Ct((Dt,ng)=>{Dt=ng.exports=tg();Dt.log=j2;Dt.formatArgs=B2;Dt.save=U2;Dt.load=ig;Dt.useColors=Y2;var cr;typeof chrome<"u"&&typeof chrome.storage<"u"?cr=chrome.storage.local:cr=window.localStorage;Dt.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Y2(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}Dt.formatters.j=function(i){return JSON.stringify(i)};function B2(){var i=arguments,e=this.useColors;if(i[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+i[0]+(e?"%c ":" ")+"+"+Dt.humanize(this.diff),!e)return i;var t="color: "+this.color;i=[i[0],t,"color: inherit"].concat(Array.prototype.slice.call(i,1));var n=0,s=0;return i[0].replace(/%[a-z%]/g,function(r){r!=="%%"&&(n++,r==="%c"&&(s=n))}),i.splice(s,0,t),i}function j2(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function U2(i){try{i==null?cr.removeItem("debug"):cr.debug=i}catch{}}function ig(){var i;try{i=cr.debug}catch{}return i}Dt.enable(ig())});var xc=Ct((rg,og)=>{var J2=Hm(),vc=Qm().EventEmitter,Ln=sg()("observed");og.exports=rg=Be;function Be(i,e,t){if(typeof i!="object")throw new TypeError("object expected. got: "+typeof i);if(!(this instanceof Be))return new Be(i,e,t);Ln("new",i,!!e,t),vc.call(this),this._bind(i,e,t)}for(wc in vc.prototype)Be.prototype[wc]=vc.prototype[wc];var wc;Be.prototype.observers=void 0;Be.prototype.onchange=void 0;Be.prototype.subject=void 0;Be.prototype._bind=function(i,e,t){if(this.subject)throw new Error("already bound!");if(i==null)throw new TypeError("subject cannot be null");Ln("_bind",i),this.subject=i,e?e.observers.push(this):this.observers=[this],this.onchange=Q2(e||this,t),Object.observe(this.subject,this.onchange),this._walk(e||this,t)};Be.prototype.deliverChanges=function(){Ln("deliverChanges"),this.observers.forEach(function(i){Object.deliverChangeRecords(i.onchange)})};Be.prototype._walk=function(i,e){Ln("_walk");var t=this.subject;Object.keys(t).forEach(function(n){var s=t[n];if(typeof s=="object"&&s!=null){var r=e?e+"."+n:n;new Be(s,i,r)}})};Be.prototype.stop=function(){Ln("stop"),this.observers.forEach(function(i){Object.unobserve(i.subject,i.onchange)})};Be.prototype._remove=function(i){Ln("_remove",i),this.observers=this.observers.filter(function(e){return i==e.subject?(Object.unobserve(e.subject,e.onchange),!1):!0})};function Q2(i,e){return function(t){Ln("onchange",e),t.forEach(function(n){var s=n.object,r=n.type,o=n.name,a=s[o],l=e?e+"."+o:o;r=="add"&&a!=null&&typeof a=="object"?new Be(a,i,l):r=="delete"&&typeof n.oldValue=="object"?i._remove(n.oldValue):r=="update"&&n.oldValue!=a&&(typeof n.oldValue=="object"&&i._remove(n.oldValue),typeof a=="object"&&new Be(a,i,l)),n=new J2(l,n),i.emit(r,n),i.emit(r+" "+l,n),i.emit("change",n),i.emit("change "+l,n)})}}});var ew=Ct((q1,mh)=>{(function(i,e){typeof mh=="object"&&mh.exports?mh.exports=e():i.Toastify=e()})(q1,function(i){var e=function(r){return new e.lib.init(r)},t="1.12.0";e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:t,constructor:e,init:function(r){return r||(r={}),this.options={},this.toastElement=null,this.options.text=r.text||e.defaults.text,this.options.node=r.node||e.defaults.node,this.options.duration=r.duration===0?0:r.duration||e.defaults.duration,this.options.selector=r.selector||e.defaults.selector,this.options.callback=r.callback||e.defaults.callback,this.options.destination=r.destination||e.defaults.destination,this.options.newWindow=r.newWindow||e.defaults.newWindow,this.options.close=r.close||e.defaults.close,this.options.gravity=r.gravity==="bottom"?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=r.positionLeft||e.defaults.positionLeft,this.options.position=r.position||e.defaults.position,this.options.backgroundColor=r.backgroundColor||e.defaults.backgroundColor,this.options.avatar=r.avatar||e.defaults.avatar,this.options.className=r.className||e.defaults.className,this.options.stopOnFocus=r.stopOnFocus===void 0?e.defaults.stopOnFocus:r.stopOnFocus,this.options.onClick=r.onClick||e.defaults.onClick,this.options.offset=r.offset||e.defaults.offset,this.options.escapeMarkup=r.escapeMarkup!==void 0?r.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=r.ariaLive||e.defaults.ariaLive,this.options.style=r.style||e.defaults.style,r.backgroundColor&&(this.options.style.background=r.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var r=document.createElement("div");r.className="toastify on "+this.options.className,this.options.position?r.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(r.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):r.className+=" toastify-right",r.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var o in this.options.style)r.style[o]=this.options.style[o];if(this.options.ariaLive&&r.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)r.appendChild(this.options.node);else if(this.options.escapeMarkup?r.innerText=this.options.text:r.innerHTML=this.options.text,this.options.avatar!==""){var a=document.createElement("img");a.src=this.options.avatar,a.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?r.appendChild(a):r.insertAdjacentElement("afterbegin",a)}if(this.options.close===!0){var l=document.createElement("button");l.type="button",l.setAttribute("aria-label","Close"),l.className="toast-close",l.innerHTML="&#10006;",l.addEventListener("click",function(C){C.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var h=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&h>360?r.insertAdjacentElement("afterbegin",l):r.appendChild(l)}if(this.options.stopOnFocus&&this.options.duration>0){var c=this;r.addEventListener("mouseover",function(C){window.clearTimeout(r.timeOutValue)}),r.addEventListener("mouseleave",function(){r.timeOutValue=window.setTimeout(function(){c.removeElement(r)},c.options.duration)})}if(typeof this.options.destination<"u"&&r.addEventListener("click",function(C){C.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&r.addEventListener("click",function(C){C.stopPropagation(),this.options.onClick()}.bind(this)),typeof this.options.offset=="object"){var d=n("x",this.options),u=n("y",this.options),f=this.options.position=="left"?d:"-"+d,g=this.options.gravity=="toastify-top"?u:"-"+u;r.style.transform="translate("+f+","+g+")"}return r},showToast:function(){this.toastElement=this.buildToast();var r;if(typeof this.options.selector=="string"?r=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?r=this.options.selector:r=document.body,!r)throw"Root element is not defined";var o=e.defaults.oldestFirst?r.firstChild:r.lastChild;return r.insertBefore(this.toastElement,o),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(r){r.className=r.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),r.parentNode&&r.parentNode.removeChild(r),this.options.callback.call(r),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var r={top:15,bottom:15},o={top:15,bottom:15},a={top:15,bottom:15},l=document.getElementsByClassName("toastify"),h,c=0;c<l.length;c++){s(l[c],"toastify-top")===!0?h="toastify-top":h="toastify-bottom";var d=l[c].offsetHeight;h=h.substr(9,h.length-1);var u=15,f=window.innerWidth>0?window.innerWidth:screen.width;f<=360?(l[c].style[h]=a[h]+"px",a[h]+=d+u):s(l[c],"toastify-left")===!0?(l[c].style[h]=r[h]+"px",r[h]+=d+u):(l[c].style[h]=o[h]+"px",o[h]+=d+u)}return this};function n(r,o){return o.offset[r]?isNaN(o.offset[r])?o.offset[r]:o.offset[r]+"px":"0px"}function s(r,o){return!r||typeof o!="string"?!1:!!(r.className&&r.className.trim().split(/\s+/gi).indexOf(o)>-1)}return e.lib.init.prototype=e.lib,e})});var iw=Ct((t_,tw)=>{"use strict";tw.exports=function(i,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(r){return function(o){return function(a,l){var h={key:a,value:o[a]},c={key:l,value:o[l]};return r(h,c)}}}(e.cmp),s=[];return function r(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,l;if(Array.isArray(o)){for(l="[",a=0;a<o.length;a++)a&&(l+=","),l+=r(o[a])||"null";return l+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var h=s.push(o)-1,c=Object.keys(o).sort(n&&n(o));for(l="",a=0;a<c.length;a++){var d=c[a],u=r(o[d]);u&&(l&&(l+=","),l+=JSON.stringify(d)+":"+u)}return s.splice(h,1),"{"+l+"}"}}(i)}});var sw=Ct((i_,nw)=>{"use strict";var jT=function(i,e){return i<e};function Ce(i){if(!(this instanceof Ce))return new Ce(i);this.array=[],this.size=0,this.compare=i||jT}Ce.prototype.clone=function(){var i=new Ce(this.compare);return i.size=this.size,i.array=this.array.slice(0,this.size),i};Ce.prototype.add=function(i){var e=this.size;this.array[this.size]=i,this.size+=1;for(var t,n;e>0&&(t=e-1>>1,n=this.array[t],!!this.compare(i,n));)this.array[e]=n,e=t;this.array[e]=i};Ce.prototype.heapify=function(i){this.array=i,this.size=i.length;var e;for(e=this.size>>1;e>=0;e--)this._percolateDown(e)};Ce.prototype._percolateUp=function(i,e){for(var t=this.array[i],n,s;i>0&&(n=i-1>>1,s=this.array[n],!(!e&&!this.compare(t,s)));)this.array[i]=s,i=n;this.array[i]=t};Ce.prototype._percolateDown=function(i){for(var e=this.size,t=this.size>>>1,n=this.array[i],s,r,o;i<t&&(s=(i<<1)+1,r=s+1,o=this.array[s],r<e&&this.compare(this.array[r],o)&&(s=r,o=this.array[r]),!!this.compare(o,n));)this.array[i]=o,i=s;this.array[i]=n};Ce.prototype._removeAt=function(i){if(!(i>this.size-1||i<0))return this._percolateUp(i,!0),this.poll()};Ce.prototype.remove=function(i){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],i)&&!this.compare(i,this.array[e]))return this._removeAt(e),!0;return!1};Ce.prototype.removeOne=function(i){if(typeof i=="function"){for(var e=0;e<this.size;e++)if(i(this.array[e]))return this._removeAt(e)}};Ce.prototype.removeMany=function(i,e){if(typeof i!="function"||this.size<1)return[];e=e?Math.min(e,this.size):this.size;for(var t=0,n=new Array(e),s=0,r=new Array(this.size);t<e&&!this.isEmpty();){var o=this.poll();i(o)?n[t++]=o:r[s++]=o}n.length=t;for(var a=0;a<s;)this.add(r[a++]);return n};Ce.prototype.peek=function(){if(this.size!=0)return this.array[0]};Ce.prototype.poll=function(){if(this.size!=0){var i=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,i}};Ce.prototype.replaceTop=function(i){if(this.size!=0){var e=this.array[0];return this.array[0]=i,this._percolateDown(0),e}};Ce.prototype.trim=function(){this.array=this.array.slice(0,this.size)};Ce.prototype.isEmpty=function(){return this.size===0};Ce.prototype.forEach=function(i){if(!(this.isEmpty()||typeof i!="function"))for(var e=0,t=this.clone();!t.isEmpty();)i(t.poll(),e++)};Ce.prototype.kSmallest=function(i){if(this.size==0||i<=0)return[];i=Math.min(this.size,i);let e=Math.min(this.size,2**(i-1)+1);if(e<2)return[this.peek()];let t=new Ce(this.compare);t.size=e,t.array=this.array.slice(0,e);let n=new Array(i);for(let s=0;s<i;s++)n[s]=t.poll();return n};nw.exports=Ce});var l2=Ct(Wi=>{"use strict";var UT=ew(),qn=iw(),JT=sw(),Cf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ss(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function QT(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var rw,$T={exports:{}};rw||(rw=1,function(i){var e=function(t){var n,s=Object.prototype,r=s.hasOwnProperty,o=Object.defineProperty||function(W,R,X){W[R]=X.value},a=typeof Symbol=="function"?Symbol:{},l=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function d(W,R,X){return Object.defineProperty(W,R,{value:X,enumerable:!0,configurable:!0,writable:!0}),W[R]}try{d({},"")}catch{d=function(R,X,I){return R[X]=I}}function u(W,R,X,I){var _=R&&R.prototype instanceof M?R:M,$=Object.create(_.prototype),le=new j(I||[]);return o($,"_invoke",{value:E(W,X,le)}),$}function f(W,R,X){try{return{type:"normal",arg:W.call(R,X)}}catch(I){return{type:"throw",arg:I}}}t.wrap=u;var g="suspendedStart",C="suspendedYield",p="executing",k="completed",T={};function M(){}function L(){}function b(){}var m={};d(m,l,function(){return this});var w=Object.getPrototypeOf,v=w&&w(w(U([])));v&&v!==s&&r.call(v,l)&&(m=v);var S=b.prototype=M.prototype=Object.create(m);function P(W){["next","throw","return"].forEach(function(R){d(W,R,function(X){return this._invoke(R,X)})})}function Z(W,R){function X(_,$,le,Le){var Ee=f(W[_],W,$);if(Ee.type!=="throw"){var ki=Ee.arg,ir=ki.value;return ir&&typeof ir=="object"&&r.call(ir,"__await")?R.resolve(ir.__await).then(function(vn){X("next",vn,le,Le)},function(vn){X("throw",vn,le,Le)}):R.resolve(ir).then(function(vn){ki.value=vn,le(ki)},function(vn){return X("throw",vn,le,Le)})}Le(Ee.arg)}var I;o(this,"_invoke",{value:function(_,$){function le(){return new R(function(Le,Ee){X(_,$,Le,Ee)})}return I=I?I.then(le,le):le()}})}function E(W,R,X){var I=g;return function(_,$){if(I===p)throw new Error("Generator is already running");if(I===k){if(_==="throw")throw $;return{value:n,done:!0}}for(X.method=_,X.arg=$;;){var le=X.delegate;if(le){var Le=D(le,X);if(Le){if(Le===T)continue;return Le}}if(X.method==="next")X.sent=X._sent=X.arg;else if(X.method==="throw"){if(I===g)throw I=k,X.arg;X.dispatchException(X.arg)}else X.method==="return"&&X.abrupt("return",X.arg);I=p;var Ee=f(W,R,X);if(Ee.type==="normal"){if(I=X.done?k:C,Ee.arg===T)continue;return{value:Ee.arg,done:X.done}}Ee.type==="throw"&&(I=k,X.method="throw",X.arg=Ee.arg)}}}function D(W,R){var X=R.method,I=W.iterator[X];if(I===n)return R.delegate=null,X==="throw"&&W.iterator.return&&(R.method="return",R.arg=n,D(W,R),R.method==="throw")||X!=="return"&&(R.method="throw",R.arg=new TypeError("The iterator does not provide a '"+X+"' method")),T;var _=f(I,W.iterator,R.arg);if(_.type==="throw")return R.method="throw",R.arg=_.arg,R.delegate=null,T;var $=_.arg;return $?$.done?(R[W.resultName]=$.value,R.next=W.nextLoc,R.method!=="return"&&(R.method="next",R.arg=n),R.delegate=null,T):$:(R.method="throw",R.arg=new TypeError("iterator result is not an object"),R.delegate=null,T)}function A(W){var R={tryLoc:W[0]};1 in W&&(R.catchLoc=W[1]),2 in W&&(R.finallyLoc=W[2],R.afterLoc=W[3]),this.tryEntries.push(R)}function O(W){var R=W.completion||{};R.type="normal",delete R.arg,W.completion=R}function j(W){this.tryEntries=[{tryLoc:"root"}],W.forEach(A,this),this.reset(!0)}function U(W){if(W!=null){var R=W[l];if(R)return R.call(W);if(typeof W.next=="function")return W;if(!isNaN(W.length)){var X=-1,I=function _(){for(;++X<W.length;)if(r.call(W,X))return _.value=W[X],_.done=!1,_;return _.value=n,_.done=!0,_};return I.next=I}}throw new TypeError(typeof W+" is not iterable")}return L.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:L,configurable:!0}),L.displayName=d(b,c,"GeneratorFunction"),t.isGeneratorFunction=function(W){var R=typeof W=="function"&&W.constructor;return!!R&&(R===L||(R.displayName||R.name)==="GeneratorFunction")},t.mark=function(W){return Object.setPrototypeOf?Object.setPrototypeOf(W,b):(W.__proto__=b,d(W,c,"GeneratorFunction")),W.prototype=Object.create(S),W},t.awrap=function(W){return{__await:W}},P(Z.prototype),d(Z.prototype,h,function(){return this}),t.AsyncIterator=Z,t.async=function(W,R,X,I,_){_===void 0&&(_=Promise);var $=new Z(u(W,R,X,I),_);return t.isGeneratorFunction(R)?$:$.next().then(function(le){return le.done?le.value:$.next()})},P(S),d(S,c,"Generator"),d(S,l,function(){return this}),d(S,"toString",function(){return"[object Generator]"}),t.keys=function(W){var R=Object(W),X=[];for(var I in R)X.push(I);return X.reverse(),function _(){for(;X.length;){var $=X.pop();if($ in R)return _.value=$,_.done=!1,_}return _.done=!0,_}},t.values=U,j.prototype={constructor:j,reset:function(W){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!W)for(var R in this)R.charAt(0)==="t"&&r.call(this,R)&&!isNaN(+R.slice(1))&&(this[R]=n)},stop:function(){this.done=!0;var W=this.tryEntries[0].completion;if(W.type==="throw")throw W.arg;return this.rval},dispatchException:function(W){if(this.done)throw W;var R=this;function X(Ee,ki){return $.type="throw",$.arg=W,R.next=Ee,ki&&(R.method="next",R.arg=n),!!ki}for(var I=this.tryEntries.length-1;I>=0;--I){var _=this.tryEntries[I],$=_.completion;if(_.tryLoc==="root")return X("end");if(_.tryLoc<=this.prev){var le=r.call(_,"catchLoc"),Le=r.call(_,"finallyLoc");if(le&&Le){if(this.prev<_.catchLoc)return X(_.catchLoc,!0);if(this.prev<_.finallyLoc)return X(_.finallyLoc)}else if(le){if(this.prev<_.catchLoc)return X(_.catchLoc,!0)}else{if(!Le)throw new Error("try statement without catch or finally");if(this.prev<_.finallyLoc)return X(_.finallyLoc)}}}},abrupt:function(W,R){for(var X=this.tryEntries.length-1;X>=0;--X){var I=this.tryEntries[X];if(I.tryLoc<=this.prev&&r.call(I,"finallyLoc")&&this.prev<I.finallyLoc){var _=I;break}}_&&(W==="break"||W==="continue")&&_.tryLoc<=R&&R<=_.finallyLoc&&(_=null);var $=_?_.completion:{};return $.type=W,$.arg=R,_?(this.method="next",this.next=_.finallyLoc,T):this.complete($)},complete:function(W,R){if(W.type==="throw")throw W.arg;return W.type==="break"||W.type==="continue"?this.next=W.arg:W.type==="return"?(this.rval=this.arg=W.arg,this.method="return",this.next="end"):W.type==="normal"&&R&&(this.next=R),T},finish:function(W){for(var R=this.tryEntries.length-1;R>=0;--R){var X=this.tryEntries[R];if(X.finallyLoc===W)return this.complete(X.completion,X.afterLoc),O(X),T}},catch:function(W){for(var R=this.tryEntries.length-1;R>=0;--R){var X=this.tryEntries[R];if(X.tryLoc===W){var I=X.completion;if(I.type==="throw"){var _=I.arg;O(X)}return _}}throw new Error("illegal catch attempt")},delegateYield:function(W,R,X){return this.delegate={iterator:U(W),resultName:R,nextLoc:X},this.method==="next"&&(this.arg=n),T}},t}(i.exports);try{globalThis.regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}($T));var qh={CROQUET_VERSION:"2.0.4"},gh=window&&window.location.hostname.endsWith("croquet.studio"),ow="",Gs="";function aw(i,e){if(e)for(let t of e.split("&")){let n=t.split("="),s=n[0],r=!0;if(n.length>1&&(r=decodeURIComponent(n.slice(1).join("=")),r.match(/^(true|false|null|[0-9.]*|["[{].*)$/)))try{r=JSON.parse(r)}catch{r[0]==="["&&(r=r.slice(1,-1).split(","))}i[s]=r}}var K=new class{constructor(){this.getSession(),aw(this,window.location.search.slice(1)),aw(this,gh?window.location.hash.slice(1):Gs),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(i,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];typeof t=="string"&&(t=this.isHost(t));let n=this[i];if(typeof n!="string")return t;let s=n.split(",");return t===!0&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),s.includes(e)||s.includes(`${e}s`)?!t:t}getSession(){if(gh){let i=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(i);if(e)return ow=e[1],e[2]}else{let i=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(i);if(e)return e[1].includes("=")?(Gs=`${e[1]}&${e[2]}`,""):(Gs=e[2],e[1])}return typeof this.session=="string"?(Gs=window.location.hash.slice(1),this.session):""}setSession(i){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];gh==null&&this.getSession();let{search:t,hash:n}=window.location,s=gh?`/${ow}/${i}${t}${n}`:`#${i}${Gs?"&"+Gs:""}`;e?window.history.replaceState({},"",s):window.history.pushState({},"",s)}isHost(i){let e=window.location.hostname;return e===i?!0:i!=="localhost"?!1:e.endsWith(".ngrok.io")||e==="croquet.io"&&window.location.pathname.match(/^\/(dev|files)\//)?!0:window.location.protocol==="file:"||["127.0.0.1","[::1]"].includes(e)}isLocalhost(){return this.isHost("localhost")}},Ns,Yn=256,qT=Math.pow(Yn,6),ix=Math.pow(2,52),eM=2*ix,Bn=255;function Hh(i,e){var t=[];if((e=e||{}).entropy)throw new Error("this version of seedrandom does not support entropy");if(i==null&&!e.state)throw new Error("this version of seedrandom requires a seed");(function(r,o){for(var a,l=r+"",h=0;h<l.length;)o[Bn&h]=Bn&(a^=19*o[Bn&h])+l.charCodeAt(h++);return c=o,String.fromCharCode.apply(0,c);var c})(nx(i,3),t);var n=new tM(t),s=function(){for(var r=n.g(6),o=qT,a=0;r<ix;)r=(r+a)*Yn,o*=Yn,a=n.g(1);for(;r>=eM;)r/=2,o/=2,a>>>=1;return(r+a)/o};return s.int32=function(){return 0|n.g(4)},s.quick=function(){return n.g(4)/4294967296},s.double=s,(e.pass||function(r,o){return o&&(o.S&&lw(o,n),r.state=function(){return lw(n,{})}),r})(s,e.state)}function tM(i){var e,t=i.length,n=this,s=0,r=n.i=n.j=0,o=n.S=[];for(t||(i=[t++]);s<Yn;)o[s]=s++;for(s=0;s<Yn;s++)o[s]=o[r=Bn&r+i[s%t]+(e=o[s])],o[r]=e;(n.g=function(a){for(var l,h=0,c=n.i,d=n.j,u=n.S;a--;)l=u[c=Bn&c+1],h=h*Yn+u[Bn&(u[c]=u[d=Bn&d+l])+(u[d]=l)];return n.i=c,n.j=d,h})(Yn)}function lw(i,e){return e.i=i.i,e.j=i.j,e.S=i.S.slice(),e}function nx(i,e){var t,n=[],s=typeof i;if(e&&s=="object")for(t in i)try{n.push(nx(i[t],e-1))}catch{}return n.length?n:s=="string"?i:i+"\0"}(function(){function i(b){this.mode=t.MODE_8BIT_BYTE,this.data=b,this.parsedData=[];for(var m=0,w=this.data.length;m<w;m++){var v=[],S=this.data.charCodeAt(m);S>65536?(v[0]=240|(1835008&S)>>>18,v[1]=128|(258048&S)>>>12,v[2]=128|(4032&S)>>>6,v[3]=128|63&S):S>2048?(v[0]=224|(61440&S)>>>12,v[1]=128|(4032&S)>>>6,v[2]=128|63&S):S>128?(v[0]=192|(1984&S)>>>6,v[1]=128|63&S):v[0]=S,this.parsedData.push(v)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(b,m){this.typeNumber=b,this.errorCorrectLevel=m,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}i.prototype={getLength:function(b){return this.parsedData.length},write:function(b){for(var m=0,w=this.parsedData.length;m<w;m++)b.put(this.parsedData[m],8)}},e.prototype={addData:function(b){var m=new i(b);this.dataList.push(m),this.dataCache=null},isDark:function(b,m){if(b<0||this.moduleCount<=b||m<0||this.moduleCount<=m)throw new Error(b+","+m);return this.modules[b][m]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(b,m){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var w=0;w<this.moduleCount;w++){this.modules[w]=new Array(this.moduleCount);for(var v=0;v<this.moduleCount;v++)this.modules[w][v]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(b,m),this.typeNumber>=7&&this.setupTypeNumber(b),this.dataCache==null&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,m)},setupPositionProbePattern:function(b,m){for(var w=-1;w<=7;w++)if(!(b+w<=-1||this.moduleCount<=b+w))for(var v=-1;v<=7;v++)m+v<=-1||this.moduleCount<=m+v||(this.modules[b+w][m+v]=0<=w&&w<=6&&(v==0||v==6)||0<=v&&v<=6&&(w==0||w==6)||2<=w&&w<=4&&2<=v&&v<=4)},getBestMaskPattern:function(){for(var b=0,m=0,w=0;w<8;w++){this.makeImpl(!0,w);var v=u.getLostPoint(this);(w==0||b>v)&&(b=v,m=w)}return m},createMovieClip:function(b,m,w){var v=b.createEmptyMovieClip(m,w);this.make();for(var S=0;S<this.modules.length;S++)for(var P=1*S,Z=0;Z<this.modules[S].length;Z++){var E=1*Z;this.modules[S][Z]&&(v.beginFill(0,100),v.moveTo(E,P),v.lineTo(E+1,P),v.lineTo(E+1,P+1),v.lineTo(E,P+1),v.endFill())}return v},setupTimingPattern:function(){for(var b=8;b<this.moduleCount-8;b++)this.modules[b][6]==null&&(this.modules[b][6]=b%2==0);for(var m=8;m<this.moduleCount-8;m++)this.modules[6][m]==null&&(this.modules[6][m]=m%2==0)},setupPositionAdjustPattern:function(){for(var b=u.getPatternPosition(this.typeNumber),m=0;m<b.length;m++)for(var w=0;w<b.length;w++){var v=b[m],S=b[w];if(this.modules[v][S]==null)for(var P=-2;P<=2;P++)for(var Z=-2;Z<=2;Z++)this.modules[v+P][S+Z]=P==-2||P==2||Z==-2||Z==2||P==0&&Z==0}},setupTypeNumber:function(b){for(var m=u.getBCHTypeNumber(this.typeNumber),w=0;w<18;w++){var v=!b&&(m>>w&1)==1;this.modules[Math.floor(w/3)][w%3+this.moduleCount-8-3]=v}for(w=0;w<18;w++)v=!b&&(m>>w&1)==1,this.modules[w%3+this.moduleCount-8-3][Math.floor(w/3)]=v},setupTypeInfo:function(b,m){for(var w=this.errorCorrectLevel<<3|m,v=u.getBCHTypeInfo(w),S=0;S<15;S++){var P=!b&&(v>>S&1)==1;S<6?this.modules[S][8]=P:S<8?this.modules[S+1][8]=P:this.modules[this.moduleCount-15+S][8]=P}for(S=0;S<15;S++)P=!b&&(v>>S&1)==1,S<8?this.modules[8][this.moduleCount-S-1]=P:S<9?this.modules[8][15-S-1+1]=P:this.modules[8][15-S-1]=P;this.modules[this.moduleCount-8][8]=!b},mapData:function(b,m){for(var w=-1,v=this.moduleCount-1,S=7,P=0,Z=this.moduleCount-1;Z>0;Z-=2)for(Z==6&&Z--;;){for(var E=0;E<2;E++)if(this.modules[v][Z-E]==null){var D=!1;P<b.length&&(D=(b[P]>>>S&1)==1),u.getMask(m,v,Z-E)&&(D=!D),this.modules[v][Z-E]=D,--S==-1&&(P++,S=7)}if((v+=w)<0||this.moduleCount<=v){v-=w,w=-w;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(b,m,w){for(var v=p.getRSBlocks(b,m),S=new k,P=0;P<w.length;P++){var Z=w[P];S.put(Z.mode,4),S.put(Z.getLength(),u.getLengthInBits(Z.mode,b)),Z.write(S)}var E=0;for(P=0;P<v.length;P++)E+=v[P].dataCount;if(S.getLengthInBits()>8*E)throw new Error("code length overflow. ("+S.getLengthInBits()+">"+8*E+")");for(S.getLengthInBits()+4<=8*E&&S.put(0,4);S.getLengthInBits()%8!=0;)S.putBit(!1);for(;!(S.getLengthInBits()>=8*E||(S.put(e.PAD0,8),S.getLengthInBits()>=8*E));)S.put(e.PAD1,8);return e.createBytes(S,v)},e.createBytes=function(b,m){for(var w=0,v=0,S=0,P=new Array(m.length),Z=new Array(m.length),E=0;E<m.length;E++){var D=m[E].dataCount,A=m[E].totalCount-D;v=Math.max(v,D),S=Math.max(S,A),P[E]=new Array(D);for(var O=0;O<P[E].length;O++)P[E][O]=255&b.buffer[O+w];w+=D;var j=u.getErrorCorrectPolynomial(A),U=new C(P[E],j.getLength()-1).mod(j);for(Z[E]=new Array(j.getLength()-1),O=0;O<Z[E].length;O++){var W=O+U.getLength()-Z[E].length;Z[E][O]=W>=0?U.get(W):0}}var R=0;for(O=0;O<m.length;O++)R+=m[O].totalCount;var X=new Array(R),I=0;for(O=0;O<v;O++)for(E=0;E<m.length;E++)O<P[E].length&&(X[I++]=P[E][O]);for(O=0;O<S;O++)for(E=0;E<m.length;E++)O<Z[E].length&&(X[I++]=Z[E][O]);return X};for(var t={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},s=0,r=1,o=2,a=3,l=4,h=5,c=6,d=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(b){for(var m=b<<10;u.getBCHDigit(m)-u.getBCHDigit(u.G15)>=0;)m^=u.G15<<u.getBCHDigit(m)-u.getBCHDigit(u.G15);return(b<<10|m)^u.G15_MASK},getBCHTypeNumber:function(b){for(var m=b<<12;u.getBCHDigit(m)-u.getBCHDigit(u.G18)>=0;)m^=u.G18<<u.getBCHDigit(m)-u.getBCHDigit(u.G18);return b<<12|m},getBCHDigit:function(b){for(var m=0;b!=0;)m++,b>>>=1;return m},getPatternPosition:function(b){return u.PATTERN_POSITION_TABLE[b-1]},getMask:function(b,m,w){switch(b){case s:return(m+w)%2==0;case r:return m%2==0;case o:return w%3==0;case a:return(m+w)%3==0;case l:return(Math.floor(m/2)+Math.floor(w/3))%2==0;case h:return m*w%2+m*w%3==0;case c:return(m*w%2+m*w%3)%2==0;case d:return(m*w%3+(m+w)%2)%2==0;default:throw new Error("bad maskPattern:"+b)}},getErrorCorrectPolynomial:function(b){for(var m=new C([1],0),w=0;w<b;w++)m=m.multiply(new C([1,f.gexp(w)],0));return m},getLengthInBits:function(b,m){if(1<=m&&m<10)switch(b){case t.MODE_NUMBER:return 10;case t.MODE_ALPHA_NUM:return 9;case t.MODE_8BIT_BYTE:case t.MODE_KANJI:return 8;default:throw new Error("mode:"+b)}else if(m<27)switch(b){case t.MODE_NUMBER:return 12;case t.MODE_ALPHA_NUM:return 11;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 10;default:throw new Error("mode:"+b)}else{if(!(m<41))throw new Error("type:"+m);switch(b){case t.MODE_NUMBER:return 14;case t.MODE_ALPHA_NUM:return 13;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 12;default:throw new Error("mode:"+b)}}},getLostPoint:function(b){for(var m=b.getModuleCount(),w=0,v=0;v<m;v++)for(var S=0;S<m;S++){for(var P=0,Z=b.isDark(v,S),E=-1;E<=1;E++)if(!(v+E<0||m<=v+E))for(var D=-1;D<=1;D++)S+D<0||m<=S+D||E==0&&D==0||Z==b.isDark(v+E,S+D)&&P++;P>5&&(w+=3+P-5)}for(v=0;v<m-1;v++)for(S=0;S<m-1;S++){var A=0;b.isDark(v,S)&&A++,b.isDark(v+1,S)&&A++,b.isDark(v,S+1)&&A++,b.isDark(v+1,S+1)&&A++,A!=0&&A!=4||(w+=3)}for(v=0;v<m;v++)for(S=0;S<m-6;S++)b.isDark(v,S)&&!b.isDark(v,S+1)&&b.isDark(v,S+2)&&b.isDark(v,S+3)&&b.isDark(v,S+4)&&!b.isDark(v,S+5)&&b.isDark(v,S+6)&&(w+=40);for(S=0;S<m;S++)for(v=0;v<m-6;v++)b.isDark(v,S)&&!b.isDark(v+1,S)&&b.isDark(v+2,S)&&b.isDark(v+3,S)&&b.isDark(v+4,S)&&!b.isDark(v+5,S)&&b.isDark(v+6,S)&&(w+=40);var O=0;for(S=0;S<m;S++)for(v=0;v<m;v++)b.isDark(v,S)&&O++;return w+=10*(Math.abs(100*O/m/m-50)/5)}},f={glog:function(b){if(b<1)throw new Error("glog("+b+")");return f.LOG_TABLE[b]},gexp:function(b){for(;b<0;)b+=255;for(;b>=256;)b-=255;return f.EXP_TABLE[b]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},g=0;g<8;g++)f.EXP_TABLE[g]=1<<g;for(g=8;g<256;g++)f.EXP_TABLE[g]=f.EXP_TABLE[g-4]^f.EXP_TABLE[g-5]^f.EXP_TABLE[g-6]^f.EXP_TABLE[g-8];for(g=0;g<255;g++)f.LOG_TABLE[f.EXP_TABLE[g]]=g;function C(b,m){if(b.length==null)throw new Error(b.length+"/"+m);for(var w=0;w<b.length&&b[w]==0;)w++;this.num=new Array(b.length-w+m);for(var v=0;v<b.length-w;v++)this.num[v]=b[v+w]}function p(b,m){this.totalCount=b,this.dataCount=m}function k(){this.buffer=[],this.length=0}C.prototype={get:function(b){return this.num[b]},getLength:function(){return this.num.length},multiply:function(b){for(var m=new Array(this.getLength()+b.getLength()-1),w=0;w<this.getLength();w++)for(var v=0;v<b.getLength();v++)m[w+v]^=f.gexp(f.glog(this.get(w))+f.glog(b.get(v)));return new C(m,0)},mod:function(b){if(this.getLength()-b.getLength()<0)return this;for(var m=f.glog(this.get(0))-f.glog(b.get(0)),w=new Array(this.getLength()),v=0;v<this.getLength();v++)w[v]=this.get(v);for(v=0;v<b.getLength();v++)w[v]^=f.gexp(f.glog(b.get(v))+m);return new C(w,0).mod(b)}},p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],p.getRSBlocks=function(b,m){var w=p.getRsBlockTable(b,m);if(w==null)throw new Error("bad rs block @ typeNumber:"+b+"/errorCorrectLevel:"+m);for(var v=w.length/3,S=[],P=0;P<v;P++)for(var Z=w[3*P+0],E=w[3*P+1],D=w[3*P+2],A=0;A<Z;A++)S.push(new p(E,D));return S},p.getRsBlockTable=function(b,m){switch(m){case n.L:return p.RS_BLOCK_TABLE[4*(b-1)+0];case n.M:return p.RS_BLOCK_TABLE[4*(b-1)+1];case n.Q:return p.RS_BLOCK_TABLE[4*(b-1)+2];case n.H:return p.RS_BLOCK_TABLE[4*(b-1)+3];default:return}},k.prototype={get:function(b){var m=Math.floor(b/8);return(this.buffer[m]>>>7-b%8&1)==1},put:function(b,m){for(var w=0;w<m;w++)this.putBit((b>>>m-w-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(b){var m=Math.floor(this.length/8);this.buffer.length<=m&&this.buffer.push(0),b&&(this.buffer[m]|=128>>>this.length%8),this.length++}};var T=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],M=function(){var b=function(m,w){this._bIsPainted=!1,this._htOption=w,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=w.width,this._elCanvas.height=w.height,m.appendChild(this._elCanvas),this._el=m,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return b.prototype.draw=function(m){var w=this._oContext,v=this._htOption,S=m.getModuleCount(),P=v.width/S,Z=v.height/S,E=Math.round(P),D=Math.round(Z);this.clear();for(var A=0;A<S;A++)for(var O=0;O<S;O++){var j=m.isDark(A,O),U=O*P,W=A*Z;w.strokeStyle=j?v.colorDark:v.colorLight,w.lineWidth=1,w.fillStyle=j?v.colorDark:v.colorLight,w.fillRect(U,W,P,Z),w.strokeRect(Math.floor(U)+.5,Math.floor(W)+.5,E,D),w.strokeRect(Math.ceil(U)-.5,Math.ceil(W)-.5,E,D)}this._bIsPainted=!0},b.prototype.isPainted=function(){return this._bIsPainted},b.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},b.prototype.round=function(m){return m&&Math.floor(1e3*m)/1e3},b}();function L(b,m){for(var w=1,v=function(E){var D=encodeURI(E).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return D.length+(D.length!=E?3:0)}(b),S=0,P=T.length;S<=P;S++){var Z=0;switch(m){case n.L:Z=T[S][0];break;case n.M:Z=T[S][1];break;case n.Q:Z=T[S][2];break;case n.H:Z=T[S][3]}if(v<=Z)break;w++}if(w>T.length)throw new Error("Too long data");return w}Ns=function(b,m){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},typeof m=="string"&&(m={text:m}),m)for(var w in m)this._htOption[w]=m[w];typeof b=="string"&&(b=document.getElementById(b)),this._htOption.useSVG&&(M=svgDrawer),this._el=b,this._oQRCode=null,this._oDrawing=new M(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},Ns.prototype.makeCode=function(b){this._oQRCode=new e(L(b,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(b),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},Ns.prototype.clear=function(){this._oDrawing.clear()},Ns.prototype.getCanvas=function(){for(let b=0;b<this._el.children.length;b++){let m=this._el.children[b];if(m.tagName==="CANVAS")return m}return null},Ns.CorrectLevel=n})();var hw=Ns,cw={exports:{}},dw,uw={exports:{}},iM=QT(Object.freeze({__proto__:null,default:{}}));function kt(){return dw||(dw=1,uw.exports=(i=i||function(e,t){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&Cf!==void 0&&Cf.crypto&&(n=Cf.crypto),!n)try{n=iM}catch{}var s=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function p(){}return function(k){var T;return p.prototype=k,T=new p,p.prototype=null,T}}(),o={},a=o.lib={},l=a.Base={extend:function(p){var k=r(this);return p&&k.mixIn(p),k.hasOwnProperty("init")&&this.init!==k.init||(k.init=function(){k.$super.init.apply(this,arguments)}),k.init.prototype=k,k.$super=this,k},create:function(){var p=this.extend();return p.init.apply(p,arguments),p},init:function(){},mixIn:function(p){for(var k in p)p.hasOwnProperty(k)&&(this[k]=p[k]);p.hasOwnProperty("toString")&&(this.toString=p.toString)},clone:function(){return this.init.prototype.extend(this)}},h=a.WordArray=l.extend({init:function(p,k){p=this.words=p||[],this.sigBytes=k!=t?k:4*p.length},toString:function(p){return(p||d).stringify(this)},concat:function(p){var k=this.words,T=p.words,M=this.sigBytes,L=p.sigBytes;if(this.clamp(),M%4)for(var b=0;b<L;b++){var m=T[b>>>2]>>>24-b%4*8&255;k[M+b>>>2]|=m<<24-(M+b)%4*8}else for(var w=0;w<L;w+=4)k[M+w>>>2]=T[w>>>2];return this.sigBytes+=L,this},clamp:function(){var p=this.words,k=this.sigBytes;p[k>>>2]&=4294967295<<32-k%4*8,p.length=e.ceil(k/4)},clone:function(){var p=l.clone.call(this);return p.words=this.words.slice(0),p},random:function(p){for(var k=[],T=0;T<p;T+=4)k.push(s());return new h.init(k,p)}}),c=o.enc={},d=c.Hex={stringify:function(p){for(var k=p.words,T=p.sigBytes,M=[],L=0;L<T;L++){var b=k[L>>>2]>>>24-L%4*8&255;M.push((b>>>4).toString(16)),M.push((15&b).toString(16))}return M.join("")},parse:function(p){for(var k=p.length,T=[],M=0;M<k;M+=2)T[M>>>3]|=parseInt(p.substr(M,2),16)<<24-M%8*4;return new h.init(T,k/2)}},u=c.Latin1={stringify:function(p){for(var k=p.words,T=p.sigBytes,M=[],L=0;L<T;L++){var b=k[L>>>2]>>>24-L%4*8&255;M.push(String.fromCharCode(b))}return M.join("")},parse:function(p){for(var k=p.length,T=[],M=0;M<k;M++)T[M>>>2]|=(255&p.charCodeAt(M))<<24-M%4*8;return new h.init(T,k)}},f=c.Utf8={stringify:function(p){try{return decodeURIComponent(escape(u.stringify(p)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(p){return u.parse(unescape(encodeURIComponent(p)))}},g=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(p){typeof p=="string"&&(p=f.parse(p)),this._data.concat(p),this._nDataBytes+=p.sigBytes},_process:function(p){var k,T=this._data,M=T.words,L=T.sigBytes,b=this.blockSize,m=L/(4*b),w=(m=p?e.ceil(m):e.max((0|m)-this._minBufferSize,0))*b,v=e.min(4*w,L);if(w){for(var S=0;S<w;S+=b)this._doProcessBlock(M,S);k=M.splice(0,w),T.sigBytes-=v}return new h.init(k,v)},clone:function(){var p=l.clone.call(this);return p._data=this._data.clone(),p},_minBufferSize:0});a.Hasher=g.extend({cfg:l.extend(),init:function(p){this.cfg=this.cfg.extend(p),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(p){return this._append(p),this._process(),this},finalize:function(p){return p&&this._append(p),this._doFinalize()},blockSize:16,_createHelper:function(p){return function(k,T){return new p.init(T).finalize(k)}},_createHmacHelper:function(p){return function(k,T){return new C.HMAC.init(p,T).finalize(k)}}});var C=o.algo={};return o}(Math),i)),uw.exports;var i}var fw,Lf,pw,nM=(fw||(fw=1,cw.exports=(Lf=kt(),function(){if(typeof ArrayBuffer=="function"){var i=Lf.lib.WordArray,e=i.init,t=i.init=function(n){if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),(n instanceof Int8Array||typeof Uint8ClampedArray<"u"&&n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array)&&(n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),n instanceof Uint8Array){for(var s=n.byteLength,r=[],o=0;o<s;o++)r[o>>>2]|=n[o]<<24-o%4*8;e.call(this,r,s)}else e.apply(this,arguments)};t.prototype=i}}(),Lf.lib.WordArray)),cw.exports),jn=ss(nM),mw={exports:{}};function Dp(){return pw||(pw=1,mw.exports=function(i){return function(e){var t=i,n=t.lib,s=n.WordArray,r=n.Hasher,o=t.algo,a=[],l=[];(function(){function d(C){for(var p=e.sqrt(C),k=2;k<=p;k++)if(!(C%k))return!1;return!0}function u(C){return 4294967296*(C-(0|C))|0}for(var f=2,g=0;g<64;)d(f)&&(g<8&&(a[g]=u(e.pow(f,.5))),l[g]=u(e.pow(f,1/3)),g++),f++})();var h=[],c=o.SHA256=r.extend({_doReset:function(){this._hash=new s.init(a.slice(0))},_doProcessBlock:function(d,u){for(var f=this._hash.words,g=f[0],C=f[1],p=f[2],k=f[3],T=f[4],M=f[5],L=f[6],b=f[7],m=0;m<64;m++){if(m<16)h[m]=0|d[u+m];else{var w=h[m-15],v=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,S=h[m-2],P=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;h[m]=v+h[m-7]+P+h[m-16]}var Z=g&C^g&p^C&p,E=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),D=b+((T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25))+(T&M^~T&L)+l[m]+h[m];b=L,L=M,M=T,T=k+D|0,k=p,p=C,C=g,g=D+(E+Z)|0}f[0]=f[0]+g|0,f[1]=f[1]+C|0,f[2]=f[2]+p|0,f[3]=f[3]+k|0,f[4]=f[4]+T|0,f[5]=f[5]+M|0,f[6]=f[6]+L|0,f[7]=f[7]+b|0},_doFinalize:function(){var d=this._data,u=d.words,f=8*this._nDataBytes,g=8*d.sigBytes;return u[g>>>5]|=128<<24-g%32,u[14+(g+64>>>9<<4)]=e.floor(f/4294967296),u[15+(g+64>>>9<<4)]=f,d.sigBytes=4*u.length,this._process(),this._hash},clone:function(){var d=r.clone.call(this);return d._hash=this._hash.clone(),d}});t.SHA256=r._createHelper(c),t.HmacSHA256=r._createHmacHelper(c)}(Math),i.SHA256}(kt())),mw.exports}var sx=ss(Dp()),sM=qh.CROQUET_PLATFORM==="node",rx;function ox(i){let e=i.sigBytes,t=i.words,n=new Uint8Array(e),s=0,r=0;for(;s<e;){let o=t[r++];if(n[s++]=(4278190080&o)>>>24,s===e||(n[s++]=(16711680&o)>>>16,s===e)||(n[s++]=(65280&o)>>>8,s===e))break;n[s++]=255&o}return n}function ax(i){function e(n){let s=n.indexOf("{"),r=n.lastIndexOf("}");if(s===-1||r===-1||r<s)return n;let o=n.slice(0,s).replace(/\s+/g," ").replace(/\s\(/,"("),a=n.slice(s+1,r);return`${o.trim()}{${a.trim()}}`}let t=e(""+i);if(!t.startsWith("class")){let n=i.prototype;n&&(t+=Object.getOwnPropertyNames(n).map(s=>`${s}:${e(""+n[s])}`).join(""))}return t}function lx(i){return btoa(String.fromCharCode(...new Uint8Array(i))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function gw(){return K.has("debug","hashing",!1)}rx=globalThis.crypto&&globalThis.crypto.subtle&&typeof globalThis.crypto.subtle.digest=="function"?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(i,e)=>{if(i!=="SHA-256")throw Error(`${N.libName}: only SHA-256 available`);let t=jn.create(e);return ox(sx(t)).buffer};var bi={},rM=new TextEncoder;async function Vs(i){let e=rM.encode(i),t=await async function(n){return n.length===0?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":lx(await rx("SHA-256",n))}(e);return bi[t]={string:i,buffer:e},t}var Np=[],yw={},bw=new Set,oM=Date.now();typeof performance>"u"&&(window.performance={now:()=>Date.now()-oM});var aM=["simulate","update","render","snapshot"],Wh={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"},zs,As,Oh=null,et=null,xe=null,Tf=0,_t=null,Di=null;function lM(i){for(Oh=i;i.firstChild;)i.removeChild(i.firstChild);i.style.background="#faf0dc",_t=document.createElement("canvas"),Di=_t.getContext("2d"),_t.id="text_stats",_t.width=Math.min(140,window.innerWidth),_t.height=36,_t.style.width=_t.width,_t.style.height=_t.height,Di.font="9.5pt sans-serif",i.appendChild(_t),i.title=Object.entries(Wh).map(t=>{let[n,s]=t;return`${s}: ${n}`}).join(`
`),et=document.createElement("canvas"),et.width=Math.min(125,window.innerWidth),et.height=125,et.style.width="100%";let e=document.createElement("div");e.id="innerDiv",i.appendChild(e),e.appendChild(et),xe=et.getContext("2d")}var Ii=[],ww=0,Dh=!1,ke=hx(0),Ap=1e3/60;function Hs(i){return 20*(1-i/Ap)+60}function hM(i){zs=function(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.width="100%",t.style.position="absolute",t.style.left="0px",Oh.querySelector("#innerDiv").appendChild(t),t}(i),As=zs.getContext("2d"),As.strokeStyle="rgba(255, 255, 255, 0.5)";for(let e=0;e<60;e+=Ap){let t=Hs(e);As.moveTo(0,t),As.lineTo(zs.width,t),As.stroke()}}function hx(i){return{start:i,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:Dh}}function cM(i){ke.total=i-ke.start;let e=Math.min(120,window.innerWidth);if(Ii.length>=e&&Ii.splice(0,Ii.length-e+1),Ii.push(ke),Ii.length<=1||!Oh||Oh.offsetHeight===0)return;let t=Ii.slice(1).filter(o=>o.total),n=t.map(o=>o.total).reduce((o,a)=>o+a,0)/t.length,s=Math.max(...t.map(o=>o.total));Math.max(...t.map(o=>Math.max(o.backlog,o.network))),ww=1e3,function(o,a){Di.globalCompositeOperation="copy",Di.fillStyle="rgb(255, 255, 255, 0)",Di.fillRect(0,0,_t.width,_t.height),Di.fillStyle="rgb(0, 0, 0, 1)",Di.globalCompositeOperation="source-over";let l=`${ke.users} users, ${Math.round(1e3/o)} fps`;a>70&&(l+=` ${Math.ceil(a).toLocaleString()}ms`),Di.fillText(l,2,15),l=ke.backlog<100&&ke.activity<1e3?`latency: ${ke.latency} ms`:`backlog: ${ke.backlog<100?"0.0":(ke.backlog/1e3).toFixed(1)} s`,Di.fillText(l,2,33)}(n,s),zs||hM(et),Tf===et.width?(xe.globalCompositeOperation="copy",xe.drawImage(et,1,0,et.width-1,et.height,0,0,et.width-1,et.height),xe.globalCompositeOperation="source-over",xe.fillStyle="transparent",xe.fillRect(et.width-1,0,1,et.height)):Tf++;let r=o=>Hs(o/ww*-2*Ap)+5;{let o=Ii[Ii.length-1],a=Tf-.5,l=Hs(0);xe.beginPath(),xe.moveTo(a,l),xe.lineTo(a,Hs(o.total)),xe.strokeStyle=Wh[o.connected?"total":"network"],xe.stroke(),xe.beginPath(),xe.moveTo(a,l),l=Hs(o.total);let h=0;for(let c of aM)o.items[c]&&(h+=o.items[c],l=Hs(h),xe.lineTo(a,l),xe.strokeStyle=Wh[c],xe.stroke(),xe.beginPath(),xe.moveTo(a,l));o.network&&(xe.beginPath(),xe.moveTo(a,r(0)),xe.lineTo(a,r(o.network)),xe.strokeStyle=Wh.network,xe.stroke())}}var Ws=[],zn={},gi={},te={frames:Ii,animationFrame(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};cM(i),ke=hx(i);for(let[t,n]of Object.entries(e))this[t](n)},begin(i){let e=performance.now();ke.items[i]=(ke.items[i]||0)-e;let t=Ws[Ws.length-1];return t&&(ke.items[t]+=e),Ws.push(i),e},end(i){let e=performance.now();ke.items[i]+=e;let t=Ws.pop();if(t!==i)throw Error(`Unmatched stats calls: expected end("${t}"), got end("${i}")`);let n=Ws[Ws.length-1];return n&&(ke.items[n]-=e),e},backlog(i){ke.backlog=Math.max(i,ke.backlog)},starvation(i){ke.network=i},latency(i){ke.latency=i},activity(i){ke.activity=i},users(i){ke.users=i},connected(i){let e=Dh;ke.connected=Dh=i,e&&!Dh&&zs&&(zs.remove(),As=null)},networkTraffic:zn,addNetworkTraffic(i,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];zn[i]=(zn[i]||0)+e,t&&(zn[`audit_${i}`]=(zn[`audit_${i}`]||0)+e)},resetAuditStats(){for(let i in zn)i.startsWith("audit_")&&(zn[i]=0)},perSecondTally(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(window.logMessageStats)for(let[e,t]of Object.entries(i))gi[e]=(gi[e]||0)+t},stepSession(i){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=Math.floor(Date.now()/1e3);if(!window.logMessageStats)return gi={second:t},null;let n=null;if(t!==gi.second){if(gi.second&&e&&(gi.requestedMessages||gi.sentMessagesTotal)){n={...gi};let s=t-gi.second;s!==1&&(n.sampleSeconds=s),n.sentBundles&&(n.averageDelay=Math.round(10*n.sendDelay/n.sentMessagesTotal)/10,n.averageBundlePayload=Math.round(n.sentBundlePayload/n.sentBundles)),delete n.second,delete n.sendDelay,delete n.sentBundlePayload}gi={second:t}}return n}};globalThis.CROQUETSTATS=te;var Ks="ontouchstart"in document.documentElement,cx=window&&window.parent!==window,dp=Ks?20:12,vw=Ks?0:15,xw=!1,Sw=!1,Oi,kw=!1;function un(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i&&N.showMessage(i,{...e,level:"warning"})}function dx(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i&&N.showMessage(i,{...e,level:"status"})}function Ke(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"error";console.error(`Error during ${i}`,e);let n=(e.stack||"").split(`
`).filter(s=>!s.match(/croquet-.*\.min.js/)).join(`
`);N.showMessage(`Error during ${i}: ${e.message}

${n}`,{level:t,duration:t==="error"?1e4:void 0,stopOnFocus:!0})}try{if(Oi=window.localStorage,Oi["croquet-debug-persist-allowed"]="true",Oi["croquet-debug-persist-allowed"]!=="true")throw Error("localStorage not persisted");delete Oi["croquet-debug-persist-allowed"]}catch{console.warn("localStorage not allowed"),Oi={}}var Xt={get pinned(){return Oi[window.location.pathname+"/croquet-debug-ui-pinned"]==="true"},set pinned(i){Oi[window.location.pathname+"/croquet-debug-ui-pinned"]=!!i},get activePage(){return Oi[window.location.pathname+"/croquet-debug-ui-activePage"]},set activePage(i){Oi[window.location.pathname+"/croquet-debug-ui-activePage"]=i}},hn=i=>{i.preventDefault(),i.stopPropagation()};function Mf(i,e,t){let n=document.createElement("canvas"),s=n.width=40*dp/12,r=n.height=60,o=n.getContext("2d");o.font="36px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="black",o.fillText(i,s/2,.55*r);let a=document.createElement("button");a.id=e,a.className="croquet_dock_button";let l=h=>{h.preventDefault(),h.stopPropagation(),t()};return Ks?(a.ontouchstart=l,a.ontouchend=hn,a.onpointerdown=hn,a.onpointerup=hn):(a.onclick=l,a.onpointerdown=hn,a.onpointerup=hn),a.appendChild(n),a}function dM(i,e){if(N.badge===!1)return;let t=function(l){let h=new Hh(l),c=["bcdfghjklmnpqrstvwxyz","aeiou"],d="";for(let u=0;u<5;u++)d+=c[u%2][h.quick()*c[u%2].length|0];return d}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+t;i.firstChild;)i.removeChild(i.firstChild);let n=document.createElement("canvas"),s=n.width=120,r=n.height=40;n.style.width="100%",i.appendChild(n);let o=n.getContext("2d"),a=function(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,c=new Hh(l),d=[];for(let u=0;u<h;u++)d.push(`hsl(${360*c.quick()}, 50%, 70%)`);return d}(e,2);o.fillStyle=a[0],o.beginPath(),o.moveTo(0,0),o.lineTo(0,r),o.lineTo(s,0),o.closePath(),o.fill(),o.fillStyle=a[1],o.beginPath(),o.moveTo(s,r),o.lineTo(s,0),o.lineTo(0,r),o.closePath(),o.fill(),o.font="30px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="black",o.fillText(t,s/2,r/2)}function ux(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(;i.firstChild;)i.removeChild(i.firstChild);return new hw(i,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:hw.CorrectLevel.L,...t})}function Cw(){if(N.root===!1||N.qrcode===!1||K.noqr)return;let i=N.sessionURL;if(!i)return void console.warn("App.sessionURL is not set");let e=Os(N.qrcode);e&&(Ks||(e.onclick=t=>{t.preventDefault(),t.stopPropagation(),t.shiftKey?function(){let n=document.getElementById("croquet_dock");n&&n.classList.toggle("debug")}():window.open(i)}),ux(e,i).getCanvas().style.width="100%")}var jt,Fn,yh=0;function uM(){(function(){if(Sw)return;Sw=!0;let t=`
        ${cx?"body { min-height: 100vh }":""}
        #croquet_spinnerOverlay {
            z-index: 1000;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color:#333;
            opacity:0.9;
            display:flex;
            align-items:center;
            justify-content:center;
            transition: opacity 1.0s ease-out;
        }
        /* https://github.com/lukehaas/css-loaders */
        @keyframes croquet_dots {
            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }
            40% { box-shadow: 0 2.5em 0 0; }
        }
        #croquet_loader,
        #croquet_loader::before,
        #croquet_loader::after {
          border-radius: 50%;
          width: 2.5em;
          height: 2.5em;
          animation: croquet_dots 1.8s infinite ease-in-out;
        }
        #croquet_loader {
          color: #fff;
          font-size: 10px;
          margin: 80px auto;
          position: relative;
          text-indent: -9999em;
          animation-delay: -0.16s;
        }
        #croquet_loader::before,
        #croquet_loader::after {
          content: '';
          position: absolute;
          top: 0;
        }
        #croquet_loader::before { left: -3.5em; animation-delay: -0.32s; }
        #croquet_loader::after { left: 3.5em; }
        #croquet_spinnerOverlay.croquet_error>*,
        #croquet_spinnerOverlay.croquet_error>*::before,
        #croquet_spinnerOverlay.croquet_error>*::after {
            color: #f00;
        }
        #croquet_spinnerOverlay.croquet_fatal>*,
        #croquet_spinnerOverlay.croquet_fatal>*::before,
        #croquet_spinnerOverlay.croquet_fatal>*::after {
            color: #f00;
            box-shadow: 0 2.5em 0 0 !important;
            animation: none !important;
        }
`,n=document.createElement("style");n.innerHTML=t,document.head.insertBefore(n,document.head.querySelector("style,link[rel=stylesheet]"))})();let i=document.createElement("div");i.id="croquet_spinnerOverlay";let e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",i.appendChild(e),i}function Os(i,e){if(i===!1)return!1;if(i instanceof Element)return i;if(typeof i=="string"){let t=document.getElementById(i);if(t)return t}return e?e():null}function Lw(){let i=new Uint8Array(arguments.length>0&&arguments[0]!==void 0?arguments[0]:16);return window.crypto.getRandomValues(i),lx(i.buffer)}var Tw=new Set,Mw=function(){let i=null,e=document.getElementsByTagName("link");for(let t of e)if(t.getAttribute("rel")==="canonical"){i=t.getAttribute("href");break}return i||window.location.href}(),N={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},get sessionURL(){return Mw},set sessionURL(i){Mw=i,Cw()},root:null,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(K.nodock)return;let e=i.debug||K.debug,t=document.getElementById("croquet_dock");t&&t.parentElement.removeChild(t);let n=Os(N.root,()=>document.body);if(!n)return;(function(){if(xw)return;xw=!0;let C=`
        #croquet_dock { position: fixed; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 36px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all 0.3s ease; }
        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }
        #croquet_dock.debug { width: 84px; }
        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }

        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }
        #croquet_dock.active #croquet_badge { left: 2%; }
        #croquet_dock:not(.debug) #croquet_badge { display: none; }

        .croquet_dock_button { position: absolute; width: ${dp}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }
        .croquet_dock_button:focus { outline: 0; }
        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }
        #croquet_dock:not(.active) .croquet_dock_button { display: none; }
        #croquet_dock_left { right: ${2+vw+dp+2}% }
        #croquet_dock:not(.debug) #croquet_dock_left { display: none; }
        #croquet_dock_right { right: ${2+vw}%; }
        #croquet_dock:not(.debug) #croquet_dock_right { display: none; }
        #croquet_dock_pin { right: 2%; }
        #croquet_dock_pin.pinned { background: #cce6ff; }

        #croquet_dock_content { position: absolute; left: 2px; top: 2px; right: 2px; bottom: 2px; background: white; overflow: hidden; }
        #croquet_dock.debug:not(.active) #croquet_dock_content { display: none; }
        #croquet_dock.debug:not(.active) #croquet_dock_content div { display: none; }

        #croquet_qrcode { position: absolute; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }
        #croquet_dock.active #croquet_qrcode { border: 6px solid white; }
        #croquet_dock.debug #croquet_qrcode:not(.active) { display: none; }
        #croquet_qrcode canvas { image-rendering: pixelated; }

        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }
        #croquet_stats:not(.active) { display: none; }
`,p=document.createElement("style");p.innerHTML=C,document.head.insertBefore(p,document.head.querySelector("style,link[rel=stylesheet]"))})();let s=document.createElement("div");s.id="croquet_dock",e&&s.classList.add("debug"),cx&&i.iframe===!1&&(s.style.display="none"),n.appendChild(s);let r=document.createElement("div"),o;r.id="croquet_dock_bar",s.appendChild(r),i.badge!==!1&&(o=document.createElement("div"),o.id="croquet_badge",r.appendChild(o),N.badge=o);let a=document.createElement("div");a.id="croquet_dock_content",s.appendChild(a);let l=[],h,c;if(i.qrcode!==!1&&N.sessionURL&&(h=document.createElement("div"),h.id="croquet_qrcode",a.appendChild(h),l.push(h.id),N.qrcode=h,e||(Xt.activePage=h.id)),i.stats!==!1&&(c=document.createElement("div"),c.id="croquet_stats",a.appendChild(c),l.push(c.id),N.stats=c),l.length){let C=function(p){let k=l.length,T,M=0;if(Xt.activePage){let m=l.indexOf(Xt.activePage);m>=0?(M=m,T=document.getElementById(Xt.activePage)):Xt.activePage=null}let L=l[(M+k+p)%k],b;L===Xt.activePage?b=T:(T&&T.classList.remove("active"),b=document.getElementById(L)),b&&b.classList.add("active"),Xt.activePage=L};l.length>1&&(r.appendChild(Mf("<","croquet_dock_left",()=>C(-1))),r.appendChild(Mf(">","croquet_dock_right",()=>C(1)))),C(0)}if(!Ks&&!i.alwaysPinned){let C=Mf("\u{1F4CC}","croquet_dock_pin",()=>{Xt.pinned=!Xt.pinned,p()}),p=()=>{Xt.pinned?C.classList.add("pinned"):C.classList.remove("pinned")};p(),r.appendChild(C)}let d=C=>{s.style.width=`${C}px`;let p=1.18*C;s.style.height=`${p}px`;let k=18*C/100;r.style.height=`${k}px`,a.style.top=`${k+2}px`,o&&(o.style.height=.9*k+"px",o.style.width=.9*k*3+"px"),h&&(h.style.border=8*C/200+"px solid white")},u=i.fixedSize||200,f=()=>{s.classList.add("active"),d(u),setTimeout(()=>s.style.transition="none",300)},g=()=>{s.style.transition="",s.classList.remove("active"),s.style.width=s.style.height="",r.style.height="",a.style.top="",o&&(o.style.height=o.style.width=""),h&&(h.style.border="")};if(Ks)g(),s.ontouchstart=C=>{C.preventDefault(),C.stopPropagation(),s.classList.contains("active")?g():f()},s.ontouchend=hn,s.onpointerdown=hn,s.onpointerup=hn;else if(i.alwaysPinned?f():(Xt.pinned?f():g(),s.onmouseenter=f,s.onmouseleave=()=>{Xt.pinned||g()}),!i.fixedSize){let C=0;s.addEventListener("wheel",p=>{p.stopPropagation();let k=Date.now();if(k-C<100)return;C=k;let{deltaY:T}=p;T=Math.sign(T)*Math.min(5,Math.abs(T));let M=.8*Math.min(window.innerWidth,window.innerHeight);u=Math.max(166,Math.min(M,s.offsetWidth/1.05**T)),d(u)},{passive:!0})}},makeSessionWidgets:function(i){(function(e){if(!e||N.root===!1)return;let t=Os(N.badge);t&&dM(t,e)})(i),Cw(),function(){if(N.root===!1||K.nostats)return;let e=Os(N.stats);e&&lM(e)}()},makeQRCanvas(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!N.sessionURL)return null;let e=ux(document.createElement("div"),N.sessionURL,i);return e&&e.getCanvas()},clearSessionMoniker:function(){N.badge!==!1&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(i){N.root===!1?i=!1:jt||(jt=uM()),function(e){if(Fn!==e&&(typeof Fn!="string"||e!==!0))if(N.sync===!1&&(e=!1),Fn=e,e)clearTimeout(yh),yh=setTimeout(()=>{Fn&&(Os(N.root,()=>document.body).appendChild(jt),jt.style.opacity=.9,jt.className=Fn==="error"?"croquet_error":Fn==="fatal"?"croquet_fatal":"")},500);else{if(!jt)return;clearTimeout(yh),jt.style.opacity=0,jt.className="",yh=setTimeout(()=>{Fn||jt.parentElement&&jt.parentElement.removeChild(jt)},500)}}(i)},messageFunction:function(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.level,n;return t==="error"?(n="orangered,red",console.error(i)):t==="warning"?(n="gold,orange",console.warn(i)):n="silver,gray",function(s,r){let o=Os(N.root,()=>document.body);if(o===!1)return null;(function(){if(kw)return;kw=!0;let h=`/*!
        * Toastify js 1.5.0
        * https://github.com/apvarun/toastify-js
        * @license MIT licensed
        *
        * Copyright (C) 2018 Varun A P
        */
        .toastify {
            padding: 12px 20px;
            color: #ffffff;
            display: inline-block;
            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);
            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);
            background: linear-gradient(135deg, #73a5ff, #5477f5);
            position: fixed;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            border-radius: 2px;
            cursor: pointer;
            text-decoration: none;
            max-width: calc(50% - 20px);
            z-index: 2147483647;
        }
        .toastify.on {
            opacity: 1;
        }
        .toast-close {
            opacity: 0.4;
            padding: 0 5px;
        }
        .toastify-right {
            right: 15px;
        }
        .toastify-left {
            left: 15px;
        }
        .toastify-top {
            top: -150px;
        }
        .toastify-bottom {
            bottom: -150px;
        }
        .toastify-rounded {
            border-radius: 25px;
        }
        .toastify-avatar {
            width: 1.5em;
            height: 1.5em;
            margin: 0 5px;
            border-radius: 2px;
        }
        @media only screen and (max-width: 360px) {
            .toastify-right, .toastify-left {
                margin-left: auto;
                margin-right: auto;
                left: 0;
                right: 0;
                max-width: fit-content;
            }
        }
`;h+=`
        .toastify {
            font-family: sans-serif;
            border-radius: 8px;
        }

        .toastify-center {
            margin-left: auto;
            margin-right: auto;
            left: 0;
            right: 0;
            max-width: fit-content;
            max-width: -moz-fit-content;
        }
`;let c=document.createElement("style");c.innerHTML=`/*!
        * Toastify js 1.5.0
        * https://github.com/apvarun/toastify-js
        * @license MIT licensed
        *
        * Copyright (C) 2018 Varun A P
        */
        .toastify {
            padding: 12px 20px;
            color: #ffffff;
            display: inline-block;
            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);
            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);
            background: linear-gradient(135deg, #73a5ff, #5477f5);
            position: fixed;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            border-radius: 2px;
            cursor: pointer;
            text-decoration: none;
            max-width: calc(50% - 20px);
            z-index: 2147483647;
        }
        .toastify.on {
            opacity: 1;
        }
        .toast-close {
            opacity: 0.4;
            padding: 0 5px;
        }
        .toastify-right {
            right: 15px;
        }
        .toastify-left {
            left: 15px;
        }
        .toastify-top {
            top: -150px;
        }
        .toastify-bottom {
            bottom: -150px;
        }
        .toastify-rounded {
            border-radius: 25px;
        }
        .toastify-avatar {
            width: 1.5em;
            height: 1.5em;
            margin: 0 5px;
            border-radius: 2px;
        }
        @media only screen and (max-width: 360px) {
            .toastify-right, .toastify-left {
                margin-left: auto;
                margin-right: auto;
                left: 0;
                right: 0;
                max-width: fit-content;
            }
        }

        .toastify {
            font-family: sans-serif;
            border-radius: 8px;
        }

        .toastify-center {
            margin-left: auto;
            margin-right: auto;
            left: 0;
            right: 0;
            max-width: fit-content;
            max-width: -moz-fit-content;
        }
`,document.head.insertBefore(c,document.head.querySelector("style,link[rel=stylesheet]"))})();let a={text:s,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,...r},l;return o instanceof Element&&o!==document.body?(l=o.id,l||(o.id=l="_croquetToastParent")):typeof o=="string"&&(l=o),l&&(a.selector=l),UT(a).showToast()}(i,{style:{background:`linear-gradient(90deg,${n})`},...e})},showMessage(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.only==="once"){if(Tw.has(i))return null;Tw.add(i)}return e.level==="fatal"&&(e.level="error",e.showSyncWait="fatal"),e.showSyncWait&&(e.showSyncWait!=="fatal"||e.duration||(e.duration=-1),N.showSyncWait(e.showSyncWait)),K.nomessages||N.root===!1||N.messages===!1||!N.messageFunction?(e.level==="warning"&&console.warn(i),e.level==="error"&&console.error(i),null):N.messageFunction(i,e)},isCroquetHost:i=>i.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(i)||i.endsWith("ngrok.io"),referrerURL(){let i=new URL(N.sessionURL),e=this.isCroquetHost(i.hostname);return`${i.protocol}//${i.host}${i.pathname}${e?i.search:""}`},autoSession(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{key:"q",force:!1,default:"",keyless:!1};typeof i=="string"&&(i={key:i}),i||(i={});let e=i.key||"q",t=new URL(N.sessionURL),n="";if(!i.force){let r=t.search.slice(1).split("&"),o=r.find(a=>a.split("=")[0]===e);o?n=o.replace(/[^=]*=/,""):i.keyless&&(n=r.find(a=>!a.includes("=")),n||(n=t.hash.slice(1),n&&(t.hash="",t.search?t.searchParams.set(e,n):t.search=n)))}if(n)try{n=decodeURIComponent(n)}catch{}else n=i.default?i.default:this.randomSession(),t.searchParams.set(e,n);if(N.sessionURL=t.href,window.location.href!==t.href)try{window.history.replaceState({},"",t.href)}catch(r){N.showMessage(`Setting address bar to ${t.href}`,{only:"once"}),N.showMessage(`Failed to change address bar: ${r.message}`,{level:"warning",only:"once"})}K.has("debug","session")&&console.log(`${N.libName}.App.autoSession: "${n}"`);let s=Promise.resolve(n);return s[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${N.libName}.App.autoSession() return value used directly. It returns a promise now!`),n),s},autoPassword(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{key:"pw",default:"",force:!1,scrub:!1,keyless:!1};typeof i=="string"&&(i={key:i});let e=i.key||"pw",t=i.scrub&&!K.has("debug","password"),n=i.keyless,s=new URL(N.sessionURL),r="",o=i.force?"":s.hash.slice(1);if(o){let l=o.split("&"),h=l.find(c=>c.split("=")[0]===e);h?(r=h.replace(/[^=]*=/,""),r&&t&&(s.hash=l.filter(c=>c.split("=")[0]!==e).join("&"))):n&&(r=l.find(c=>!c.includes("=")),r&&t&&(s.hash=l.filter(c=>c!==r).join("&")))}if(r||(r=i.default?i.default:this.randomPassword(),s.hash=o?`${o}&${e}=${r}`:n?r:`${e}=${r}`,N.sessionURL=s.href,t&&(s.hash=n?"":o)),K.has("debug","session")&&console.log(`${N.libName}.App.sessionUrl: ${N.sessionURL}`),window.location.href!==s.href)try{window.history.replaceState({},"",s.href)}catch(l){N.showMessage(`Setting address bar to ${s.href}`,{only:"once"}),N.showMessage(`Failed to change address bar: ${l.message}`,{level:"warning",only:"once"})}if(r)try{r=decodeURIComponent(r)}catch{}K.has("debug","session")&&console.log(`${N.libName}.App.autoPassword: "${r}"`);let a=Promise.resolve(r);return a[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${N.libName}.App.autoPassword() return value used directly. It returns a promise now!`),r),a},randomSession(){return Lw(arguments.length>0&&arguments[0]!==void 0?arguments[0]:10)},randomPassword(){return Lw(arguments.length>0&&arguments[0]!==void 0?arguments[0]:16)}},Pf="#__vote";function Pw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n="none";for(let s of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(let r of i[s])r.for===e?t===null||r.unbound===t?i[s].delete(r):n="subscriber":n==="none"&&(n="others");return n}var Oe=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(i){return"V"+ ++this.subscriberIds}deregister(i){}addSubscription(i,e,t,n,s){if(i.includes(":"))throw Error(`Invalid subscription scope "${i}" (must not contain ':')`);if(s==="vote")return void this.addSubscription(i,e+Pf,t,n,"immediate");i!=="*"&&e!=="*"||(this.genericSubscriptions=!0);let r=i+":"+e,o=n;o.for=t;let a=this.subscriptions[r];if(a||(a=this.subscriptions[r]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[s])throw Error(`Unknown subscribe() option: handling="${s}"`);a[s].add(o);let l=this.subscribers.get(t);l||this.subscribers.set(t,l=new Set),l.add(r)}removeSubscription(i,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=i+":"+e,r=this.subscriptions[s];if(r){let o=Pw(r,t,n);if(o==="none"&&delete this.subscriptions[s],o!=="subscriber"){let a=this.subscribers.get(t);a&&(a.delete(s),a.size===0&&this.subscribers.delete(t))}}e.endsWith(Pf)||this.removeSubscription(i,e+Pf,t)}removeAllSubscriptionsFor(i){let e=this.subscribers.get(i);if(e){for(let t of e){let n=this.subscriptions[t];n?Pw(n,i)==="none"&&delete this.subscriptions[t]:console.error(`${N.libName}: topic ${t} not found in subscriptions table for ${i} during removeAllSubscriptionsFor()`)}this.subscribers.delete(i)}}subscriptionsFor(i){let e=this.subscriptions[i];if(!e&&!this.genericSubscriptions)return null;let t=[],n=!!e;if(this.genericSubscriptions){let[s,r]=i.split(":");if(!(s.startsWith("__")&&s.endsWith("__")||r.startsWith("__")&&r.endsWith("__")))for(let a of["*:*",s+":*","*:"+r]){let l=this.subscriptions[a];l&&(t.push([l,a]),!n&&this.hasUserSubcription(l)&&(n=!0))}let o=!n;if(o)for(let a of t)a.push(o)}return e&&t.push([e,i]),t.length===0?null:t}hasUserSubcription(i){for(let e of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(let t of i[e])if(!t.unbound.__CROQUET__)return!0;return!1}handleEvent(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=this.subscriptionsFor(i);if(!n)return;let s=!!t,r=0,o=0,a=0;for(let[l,h,c]of n)r+=l.queued.size,o+=l.oncePerFrame.size,a+=l.oncePerFrameWhileSynced.size,l.immediate.size>0&&(t||(t=d=>d()),t(()=>{for(let d of l.immediate){let u=this.currentEvent,f=this.currentEventFromModel,g=this.currentEventOnlyGeneric;this.currentEvent=i,this.currentEventFromModel=s,this.currentEventOnlyGeneric=c;try{d(e)}catch(C){console.error(C),console.warn(`${N.libName}: error "${C.message}" in "immediate" subscription ${h}`)}this.currentEvent=u,this.currentEventFromModel=f,this.currentEventOnlyGeneric=g}}));r>0&&this.queuedEvents.push({topic:i,data:e,fromModel:s}),o>0&&this.perFrameEvents.set(i,{data:e,fromModel:s}),a>0&&this.perSyncedFrameEvents.set(i,{data:e,fromModel:s})}processFrameEvents(i,e){let t=0,n=(s,r,o,a)=>{let l=this.subscriptionsFor(r);if(!l)return;let h=this.currentEvent,c=this.currentEventFromModel;this.currentEvent=r,this.currentEventFromModel=a;for(let[d,u,f]of l){let g=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=f;for(let C of d[s]){try{C(o)}catch(p){console.error(p),console.warn(`${N.libName}: error "${p.message}" in "${s}" subscription ${r}`)}t++}this.currentEventOnlyGeneric=g}this.currentEvent=h,this.currentEventFromModel=c};for(let{topic:s,data:r,fromModel:o}of this.queuedEvents)n("queued",s,r,o);if(this.queuedEvents.length=0,i){for(let[s,{data:r,fromModel:o}]of this.perFrameEvents)n("oncePerFrame",s,r,o);if(this.perFrameEvents.clear(),e){for(let[s,{data:r,fromModel:o}]of this.perSyncedFrameEvents)n("oncePerFrameWhileSynced",s,r,o);this.perSyncedFrameEvents.clear()}for(let{topic:s,data:r,fromModel:o}of this.queuedEvents)n("queued",s,r,o);this.queuedEvents.length=0}return t}},fn={get subscribe(){return fn={subscribe:K.has("debug","subscribe",!1)},fn.subscribe}},up=class i{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,n){this.vm.publishFromModel(n,e,t)}subscribe(e,t,n,s){return fn.subscribe&&console.log(`Model.subscribe("${t}:${n}", ${e} ${(""+s).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(e,t,n,s)}unsubscribe(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*";fn.subscribe&&console.log(`Model.unsubscribe(${t}:${n}", ${e} ${(""+s).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(e,t,n,s)}unsubscribeAll(e){fn.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,n,s){if(St&&St.equal(this))return this.vm.future(e,t,n,s);throw Error(`Model.future() called from outside: ${e}`)}cancelFuture(e,t){if(St&&St.equal(this))return this.vm.cancelFuture(e,t);throw Error(`Model.cancelFuture() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof i&&e.vm===this.vm}isViewRealm(){return!1}},fp=class i{constructor(e){this.vd=Oe,this.vm=e,this.controller=e.controller}valid(){return this.vm===this.controller.vm}register(e){return Oe.register(e)}deregister(e){Oe.deregister(e)}publish(e,t,n){this.vm.publishFromView(n,e,t)}subscribe(e,t,n,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"queued";fn.subscribe&&console.log(`View[${t}].subscribe("${s}:${e}" ${n?n.name||(""+n).replace(/\([\s\S]*/,""):""+n} [${r}])`),Oe.addSubscription(s,e,t,n,r)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;fn.subscribe&&console.log(`View[${t}].unsubscribe("${s}:${e}" ${n?n.name||(""+n).replace(/\([\s\S]*/,""):"*"})`),Oe.removeSubscription(s,e,t,n)}unsubscribeAll(e){fn.subscribe&&console.log(`View[${e}].unsubscribeAll()`),Oe.removeAllSubscriptionsFor(e)}future(e,t){let n=this.vm;return new Proxy(e,{get(s,r){if(typeof e[r]=="function")return new Proxy(e[r],{apply(o,a,l){setTimeout(()=>{e.id&&Yo(n,()=>e[r](...l),!0)},t)}});throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(e){return e instanceof i&&e.vm===this.vm}isViewRealm(){return!0}},St=null;function Ai(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Tried to execute code that requires realm outside of realm.";if(!St&&i)throw Error(i);return St}function fx(i,e){if(St!==null)throw Error("Can't switch realms from inside realm");try{return St=new up(i),e()}finally{St=null}}function Yo(i,e){if(St!==null&&!(arguments.length>2&&arguments[2]!==void 0&&arguments[2]))throw Error("Can't switch realms from inside realm");let t=St;try{return St=new fp(i),e()}finally{St=t}}var We=function(i){return i!=i},Ys=Math.sqrt,Bo=.7853981633974483,fM=function(i){var e,t;return i===0?.16666666666666713:((i<0?-i:i)<=1?(e=i*(19.562619833175948+i*(i*(5.444622390564711+i*(.004253011369004428*i-.6019598008014124))-16.262479672107002))-8.198089802484825,t=i*(139.51056146574857+i*(i*(70.49610280856842+i*(1*i-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(i=1/i)*(i*(5.444622390564711+i*(i*(19.562619833175948+-8.198089802484825*i)-16.262479672107002))-.6019598008014124),t=1+i*(i*(70.49610280856842+i*(i*(139.51056146574857+-49.18853881490881*i)-147.1791292232726))-14.740913729888538)),e/t)},pM=function(i){var e,t;return i===0?.08333333333333809:((i<0?-i:i)<=1?(e=28.536655482610616+i*(i*(6.968710824104713+i*(.002967721961301243*i-.5634242780008963))-25.56901049652825),t=342.43986579130785+i*(i*(147.0656354026815+i*(1*i-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(i=1/i)*(i*(6.968710824104713+i*(28.536655482610616*i-25.56901049652825))-.5634242780008963),t=1+i*(i*(147.0656354026815+i*(342.43986579130785*i-383.8770957603691))-21.947795316429207)),e/t)},pp=function(i){var e,t,n,s,r;if(We(i))return NaN;if(i>0?n=i:(e=!0,n=-i),n>1)return NaN;if(n>.625)s=(t=1-n)*pM(t),t=Ys(t+t),r=Bo-t,r-=t=t*s-6123233995736766e-32,r+=Bo;else{if(n<1e-8)return i;r=n*(r=(t=n*n)*fM(t))+n}return e?-r:r},mM=function(i){var e;return We(i)||i<-1||i>1?NaN:i>.5?2*pp(Ys(.5-.5*i)):(e=Bo-pp(i),e+=6123233995736766e-32,e+=Bo)},gM=function(){return typeof Symbol=="function"&&typeof Symbol("foo")=="symbol"}(),yM=function(){return gM&&typeof Symbol.toStringTag=="symbol"},Nh=Object.prototype.toString,bM=function(i){return Nh.call(i)},wM=Object.prototype.hasOwnProperty,vM=function(i,e){return i!=null&&wM.call(i,e)},bo=typeof Symbol=="function"?Symbol.toStringTag:"",xM=function(i){var e,t,n;if(i==null)return Nh.call(i);t=i[bo],e=vM(i,bo);try{i[bo]=void 0}catch{return Nh.call(i)}return n=Nh.call(i),e?i[bo]=t:delete i[bo],n},ec=yM()?xM:bM,SM=typeof Uint32Array=="function",kM=function(i){return SM&&i instanceof Uint32Array||ec(i)==="[object Uint32Array]"},Rf=4294967295,Rw=typeof Uint32Array=="function"?Uint32Array:null,CM=function(){var i,e;if(typeof Rw!="function")return!1;try{e=new Rw(e=[1,3.14,-3.14,Rf+1,Rf+2]),i=kM(e)&&e[0]===1&&e[1]===3&&e[2]===Rf-2&&e[3]===0&&e[4]===1}catch{i=!1}return i},LM=typeof Uint32Array=="function"?Uint32Array:null,TM=function(){throw new Error("not implemented")},Qs=CM()?LM:TM,MM=typeof Float64Array=="function",PM=function(i){return MM&&i instanceof Float64Array||ec(i)==="[object Float64Array]"},Zw=typeof Float64Array=="function"?Float64Array:null,RM=function(){var i,e;if(typeof Zw!="function")return!1;try{e=new Zw([1,3.14,-3.14,NaN]),i=PM(e)&&e[0]===1&&e[1]===3.14&&e[2]===-3.14&&e[3]!=e[3]}catch{i=!1}return i},ZM=typeof Float64Array=="function"?Float64Array:null,EM=function(){throw new Error("not implemented")},$s=RM()?ZM:EM,XM=typeof Uint8Array=="function",_M=function(i){return XM&&i instanceof Uint8Array||ec(i)==="[object Uint8Array]"},Ew=typeof Uint8Array=="function"?Uint8Array:null,IM=function(){var i,e;if(typeof Ew!="function")return!1;try{e=new Ew(e=[1,3.14,-3.14,256,257]),i=_M(e)&&e[0]===1&&e[1]===3&&e[2]===253&&e[3]===0&&e[4]===1}catch{i=!1}return i},GM=typeof Uint8Array=="function"?Uint8Array:null,WM=function(){throw new Error("not implemented")},DM=IM()?GM:WM,NM=typeof Uint16Array=="function",AM=function(i){return NM&&i instanceof Uint16Array||ec(i)==="[object Uint16Array]"},Xw=typeof Uint16Array=="function"?Uint16Array:null,HM=function(){var i,e;if(typeof Xw!="function")return!1;try{e=new Xw(e=[1,3.14,-3.14,65536,65537]),i=AM(e)&&e[0]===1&&e[1]===3&&e[2]===65533&&e[3]===0&&e[4]===1}catch{i=!1}return i},OM=typeof Uint16Array=="function"?Uint16Array:null,px,VM=function(){throw new Error("not implemented")},mx={uint16:HM()?OM:VM,uint8:DM};(px=new mx.uint16(1))[0]=4660;var qs=new mx.uint8(px.buffer)[0]===52,zM=qs===!0?1:0,gx=new $s(1),FM=new Qs(gx.buffer),ye=function(i){return gx[0]=i,FM[zM]},KM=qs===!0?1:0,mp=new $s(1),YM=new Qs(mp.buffer),BM=function(i,e){return mp[0]=i,YM[KM]=e>>>0,mp[0]},vi=BM,Qt=Number.POSITIVE_INFINITY,$t=Number.NEGATIVE_INFINITY,wn=1023,jM=function(i){return i===0?.6666666666666735:.6666666666666735+i*(.3999999999940942+i*(.2857142874366239+i*(.22222198432149784+i*(.1818357216161805+i*(.15313837699209373+.14798198605116586*i)))))},Zf=.6931471803691238,Ef=19082149292705877e-26,jo=function(i){var e,t,n,s,r,o,a,l,h,c;if(i<-1||We(i))return NaN;if(i===-1)return $t;if(i===Qt||i===0)return i;if(c=1,(n=i<0?-i:i)<.41421356237309503){if(n<1862645149230957e-24)return n<5551115123125783e-32?i:i-i*i*.5;i>-.2928932188134525&&(c=0,s=i,t=1)}return c!==0&&(n<9007199254740992?(r=(c=((t=ye(h=1+i))>>20)-wn)>0?1-(h-i):i-(h-1),r/=h):(c=((t=ye(h=i))>>20)-wn,r=0),(t&=1048575)<434334?h=vi(h,1072693248|t):(c+=1,h=vi(h,1071644672|t),t=1048576-t>>2),s=h-1),e=.5*s*s,t===0?s===0?c*Zf+(r+=c*Ef):c*Zf-((l=e*(1-.6666666666666666*s))-(c*Ef+r)-s):(l=(a=(o=s/(2+s))*o)*jM(a),c===0?s-(e-o*(e+l)):c*Zf-(e-(o*(e+l)+(c*Ef+r))-s))},tc=.6931471805599453,UM=function(i){return i===0?.3999999999940942:.3999999999940942+i*(.22222198432149784+.15313837699209373*i)},JM=function(i){return i===0?.6666666666666735:.6666666666666735+i*(.2857142874366239+i*(.1818357216161805+.14798198605116586*i))},bh=.6931471803691238,wh=19082149292705877e-26,_w=1048575,Uo=function(i){var e,t,n,s,r,o,a,l,h,c,d;return i===0?$t:We(i)||i<0?NaN:(s=0,(t=ye(i))<1048576&&(s-=54,t=ye(i*=0x40000000000000)),t>=2146435072?i+i:(s+=(t>>20)-wn|0,s+=(a=(t&=_w)+614244&1048576)>>20,o=(i=vi(i,t|1072693248^a))-1,(_w&2+t)<3?o===0?s===0?0:s*bh+s*wh:(r=o*o*(.5-.3333333333333333*o),s===0?o-r:s*bh-(r-s*wh-o)):(a=t-398458|0,l=440401-t|0,n=(c=(d=(h=o/(2+o))*h)*d)*UM(c),r=d*JM(c)+n,(a|=l)>0?(e=.5*o*o,s===0?o-(e-h*(e+r)):s*bh-(e-(h*(e+r)+s*wh)-o)):s===0?o-h*(o-r):s*bh-(h*(o-r)-s*wh-o))))},QM=function(i){var e;return We(i)||i<1?NaN:i===1?0:i>=268435456?Uo(i)+tc:i>2?Uo(2*i-1/(i+Ys(i*i-1))):jo((e=i-1)+Ys(2*e+e*e))},dn=function(i){return i===Qt||i===$t},$M=1/(1<<28),qM=function(i){var e,t,n;return We(i)||dn(i)?i:(i<0&&(i=-i,e=!0),n=i<$M?i:i>268435456?Uo(i)+tc:i>2?Uo(2*i+1/(Ys(i*i+1)+i)):jo(i+(t=i*i)/(1+Ys(1+t))),e?-n:n)},Iw=1.5707963267948966,e9=function(i){return i===0?-64.85021904942025:i*(i*(i*(-.8750608600031904*i-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025},t9=function(i){return i===0?194.5506571482614:194.5506571482614+i*(485.3903996359137+i*(432.88106049129027+i*(165.02700983169885+i*(24.858464901423062+1*i))))},Gw=6123233995736766e-32,yx=function(i){var e,t,n,s;return We(i)||i===0?i:i===Qt?Iw:i===$t?-1.5707963267948966:(i<0&&(t=!0,i=-i),e=0,i>2.414213562373095?(n=Iw,e=1,i=-1/i):i<=.66?n=0:(n=Bo,e=2,i=(i-1)/(i+1)),s=i*(s=(s=i*i)*e9(s)/t9(s))+i,e===2?s+=.5*Gw:e===1&&(s+=Gw),n+=s,t?-n:n)},i9=1/(1<<28),gp,yp,n9=function(i){var e,t;return We(i)||i<-1||i>1?NaN:i===1?Qt:i===-1?$t:(i<0&&(e=!0,i=-i),i<i9?e?-i:i:(t=i<.5?.5*jo((t=i+i)+t*i/(1-i)):.5*jo((i+i)/(1-i)),e?-t:t))};qs===!0?(gp=1,yp=0):(gp=0,yp=1);var bx={HIGH:gp,LOW:yp},wx=new $s(1),Ww=new Qs(wx.buffer),s9=bx.HIGH,r9=bx.LOW,Dw=function(i,e){return wx[0]=e,i[0]=Ww[s9],i[1]=Ww[r9],i},bp,wp,Hp=function(i,e){return arguments.length===1?Dw([0,0],i):Dw(i,e)};qs===!0?(bp=1,wp=0):(bp=0,wp=1);var vx={HIGH:bp,LOW:wp},xx=new $s(1),Nw=new Qs(xx.buffer),o9=vx.HIGH,a9=vx.LOW,l9=function(i,e){return Nw[o9]=i,Nw[a9]=e,xx[0]},Jo=l9,Xf=[0,0],Gi=function(i,e){var t,n;return Hp(Xf,i),t=Xf[0],t&=2147483647,n=ye(e),Jo(t|=n&=2147483648,Xf[1])},h9=function(i){return!!(ye(i)>>>31)},rn=3.141592653589793,c9=function(i,e){var t;return We(e)||We(i)?NaN:dn(e)?e===Qt?dn(i)?Gi(rn/4,i):Gi(0,i):dn(i)?Gi(3*rn/4,i):Gi(rn,i):dn(i)?Gi(rn/2,i):i===0?e>=0&&!h9(e)?Gi(0,i):Gi(rn,i):e===0?Gi(rn/2,i):(t=yx(i/e),e<0?t<=0?t+rn:t-rn:t)},Sx=22250738585072014e-324,d9=function(i){return i===0?1.87595182427177:1.87595182427177+i*(i*(1.6214297201053545+i*(.14599619288661245*i-.758397934778766))-1.8849797954337717)},Aw=2147483647,u9=function(i){var e,t,n,s,r;return We(i)||dn(i)||i===0?i:(t=-2147483648&(n=ye(i)),n&=Aw,r=0,i<Sx?(r=0x40000000000000,e=ye(r*=i),r=Jo(t|(e=(e&Aw)/3+696219795),0)):r=vi(r,t|(e=n/3+715094163)),r*=d9(s=r*r*(r/i)),e=ye(r),r=Jo(e+1,0),r+=r*(s=((s=i/(r*r))-r)/(r+r+s)))},f9=u9,p9=function(i){return i===0?.0416666666666666:.0416666666666666+i*(2480158728947673e-20*i-.001388888888887411)},m9=function(i){return i===0?-27557314351390663e-23:i*(2087572321298175e-24+-11359647557788195e-27*i)-27557314351390663e-23},Eo=function(i,e){var t,n,s,r;return s=(r=i*i)*r,n=r*p9(r),n+=s*s*m9(r),(s=1-(t=.5*r))+(1-s-t+(r*n-i*e))},Hw=-.16666666666666632,Xo=function(i,e){var t,n,s;return t=.00833333333332249+(s=i*i)*(27557313707070068e-22*s-.0001984126982985795)+s*(s*s)*(158969099521155e-24*s-25050760253406863e-24),n=s*i,e===0?i+n*(Hw+s*t):i-(s*(.5*e-n*t)-e-n*Hw)},g9=qs===!0?0:1,kx=new $s(1),y9=new Qs(kx.buffer),b9=function(i){return kx[0]=i,y9[g9]},Cx=Math.floor,Op=function(i){return i<0?-i:i===0?0:i},Ow=function(i,e){return We(e)||dn(e)?(i[0]=e,i[1]=0,i):e!==0&&Op(e)<Sx?(i[0]=4503599627370496*e,i[1]=-52,i):(i[0]=e,i[1]=0,i)},w9=function(i,e){return arguments.length===1?Ow([0,0],i):Ow(i,e)},v9=function(i){var e=ye(i);return(e=(2146435072&e)>>>20)-wn|0},x9=v9,_f=[0,0],If=[0,0],S9=function(i,e){var t,n;return i===0||We(i)||dn(i)?i:(w9(_f,i),e+=_f[1],(e+=x9(i=_f[0]))<-1074?Gi(0,i):e>1023?i<0?$t:Qt:(e<=-1023?(e+=52,n=2220446049250313e-31):n=1,Hp(If,i),t=If[0],t&=2148532223,n*Jo(t|=e+wn<<20,If[1])))},Po=S9,Lx=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],k9=[1.570796251296997,7549789415861596e-23,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],Gf=16777216,Wf=5960464477539063e-23,Df=ic(new Array(20)),Vw=ic(new Array(20)),vh=ic(new Array(20)),Ae=ic(new Array(20));function ic(i){var e,t=i.length;for(e=0;e<t;e++)i[e]=0;return i}function Tx(i,e,t,n,s,r,o,a,l){var h,c,d,u,f,g,C,p,k;for(u=r,k=n[t],p=t,f=0;p>0;f++)c=Wf*k|0,Ae[f]=k-Gf*c|0,k=n[p-1]+c,p-=1;if(k=Po(k,s),k-=8*Cx(.125*k),k-=C=0|k,d=0,s>0?(C+=f=Ae[t-1]>>24-s,Ae[t-1]-=f<<24-s,d=Ae[t-1]>>23-s):s===0?d=Ae[t-1]>>23:k>=.5&&(d=2),d>0){for(C+=1,h=0,f=0;f<t;f++)p=Ae[f],h===0?p!==0&&(h=1,Ae[f]=16777216-p):Ae[f]=16777215-p;if(s>0)switch(s){case 1:Ae[t-1]&=8388607;break;case 2:Ae[t-1]&=4194303}d===2&&(k=1-k,h!==0&&(k-=Po(1,s)))}if(k===0){for(p=0,f=t-1;f>=r;f--)p|=Ae[f];if(p===0){for(g=1;Ae[r-g]===0;g++);for(f=t+1;f<=t+g;f++){for(l[a+f]=Lx[o+f],c=0,p=0;p<=a;p++)c+=i[p]*l[a+(f-p)];n[f]=c}return Tx(i,e,t+=g,n,s,r,o,a,l)}}if(k===0)for(t-=1,s-=24;Ae[t]===0;)t-=1,s-=24;else(k=Po(k,-s))>=Gf?(c=Wf*k|0,Ae[t]=k-Gf*c|0,s+=24,Ae[t+=1]=c):Ae[t]=0|k;for(c=Po(1,s),f=t;f>=0;f--)n[f]=c*Ae[f],c*=Wf;for(f=t;f>=0;f--){for(c=0,g=0;g<=u&&g<=t-f;g++)c+=k9[g]*n[f+g];vh[t-f]=c}for(c=0,f=t;f>=0;f--)c+=vh[f];for(e[0]=d===0?c:-c,c=vh[0]-c,f=1;f<=t;f++)c+=vh[f];return e[1]=d===0?c:-c,7&C}var C9=function(i,e,t,n){var s,r,o,a,l,h,c;for((r=(t-3)/24|0)<0&&(r=0),a=t-24*(r+1),h=r-(o=n-1),c=o+4,l=0;l<=c;l++)Df[l]=h<0?0:Lx[h],h+=1;for(l=0;l<=4;l++){for(s=0,h=0;h<=o;h++)s+=i[h]*Df[o+(l-h)];Vw[l]=s}return Tx(i,e,4,Vw,a,4,r,o,Df)},L9=Math.round,xh=function(i,e,t){var n,s,r,o,a;return r=i-1.5707963267341256*(n=L9(.6366197723675814*i)),o=6077100506506192e-26*n,a=e>>20,t[0]=r-o,a-(ye(t[0])>>20&2047)>16&&(o=20222662487959506e-37*n-((s=r)-(r=s-(o=6077100506303966e-26*n))-o),t[0]=r-o,a-(ye(t[0])>>20&2047)>49&&(o=84784276603689e-45*n-((s=r)-(r=s-(o=20222662487111665e-37*n))-o),t[0]=r-o)),t[1]=r-t[0]-o,n},on=1.5707963267341256,Un=6077100506506192e-26,Sh=2*Un,kh=3*Un,Ch=4*Un,wo=new Array(3),vo=new Array(2),T9=function(i,e){var t,n,s,r,o,a,l;if((s=2147483647&ye(i))<=1072243195)return e[0]=i,e[1]=0,0;if(s<=1074752122)return(1048575&s)==598523?xh(i,s,e):s<=1073928572?i>0?(l=i-on,e[0]=l-Un,e[1]=l-e[0]-Un,1):(l=i+on,e[0]=l+Un,e[1]=l-e[0]+Un,-1):i>0?(l=i-2*on,e[0]=l-Sh,e[1]=l-e[0]-Sh,2):(l=i+2*on,e[0]=l+Sh,e[1]=l-e[0]+Sh,-2);if(s<=1075594811)return s<=1075183036?s===1074977148?xh(i,s,e):i>0?(l=i-3*on,e[0]=l-kh,e[1]=l-e[0]-kh,3):(l=i+3*on,e[0]=l+kh,e[1]=l-e[0]+kh,-3):s===1075388923?xh(i,s,e):i>0?(l=i-4*on,e[0]=l-Ch,e[1]=l-e[0]-Ch,4):(l=i+4*on,e[0]=l+Ch,e[1]=l-e[0]+Ch,-4);if(s<1094263291)return xh(i,s,e);if(s>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(t=b9(i),l=Jo(s-((n=(s>>20)-1046)<<20),t),o=0;o<2;o++)wo[o]=0|l,l=16777216*(l-wo[o]);for(wo[2]=l,r=3;wo[r-1]===0;)r-=1;return a=C9(wo,vo,n,r),i<0?(e[0]=-vo[0],e[1]=-vo[1],-a):(e[0]=vo[0],e[1]=vo[1],a)},Vp=T9,Zi=[0,0],M9=function(i){var e;if(e=ye(i),(e&=2147483647)<=1072243195)return e<1044381696?1:Eo(i,0);if(e>=2146435072)return NaN;switch(3&Vp(i,Zi)){case 0:return Eo(Zi[0],Zi[1]);case 1:return-Xo(Zi[0],Zi[1]);case 2:return-Eo(Zi[0],Zi[1]);default:return Xo(Zi[0],Zi[1])}},P9=Math.ceil,R9=function(i){return i<0?P9(i):Cx(i)},Z9=function(i){return i===0?.16666666666666602:.16666666666666602+i*(i*(6613756321437934e-20+i*(41381367970572385e-24*i-16533902205465252e-22))-.0027777777777015593)},E9=function(i,e,t){var n,s,r;return r=(n=i-e)-(s=n*n)*Z9(s),Po(1-(e-n*r/(2-r)-i),t)},zw=1.4426950408889634,X9=1/(1<<28),es=function(i){var e;return We(i)||i===Qt?i:i===$t?0:i>709.782712893384?Qt:i<-745.1332191019411?0:i>-3725290298461914e-24&&i<X9?1+i:(e=R9(i<0?zw*i-.5:zw*i+.5),E9(i-.6931471803691238*e,19082149292705877e-26*e,e))},_9=function(i){return We(i)?i:(i<0&&(i=-i),i>21?es(i)/2:(es(i)+es(-i))/2)},I9=function(i){return i===0?-.03333333333333313:i*(.0015873015872548146+i*(i*(4008217827329362e-21+-20109921818362437e-23*i)-793650757867488e-19))-.03333333333333313},Nf=.6931471803691238,Fw=19082149292705877e-26,Kw=1.4426950408889634,G9=function(i){var e,t,n,s,r,o,a,l,h,c,d,u;if(i===Qt||We(i))return i;if(i===$t)return-1;if(i===0)return i;if(i<0?(t=!0,a=-i):(t=!1,a=i),a>=38.816242111356935){if(t)return-1;if(a>=709.782712893384)return Qt}if(r=0|ye(a),a>.34657359027997264)a<1.0397207708399179?t?(n=i+Nf,s=-19082149292705877e-26,u=-1):(n=i-Nf,s=Fw,u=1):(u=t?Kw*i-.5:Kw*i+.5,n=i-(c=u|=0)*Nf,s=c*Fw),h=n-(i=n-s)-s;else{if(r<1016070144)return i;u=0}return d=(l=i*(e=.5*i))*(((o=1+l*I9(l))-(c=3-o*e))/(6-i*c)),u===0?i-(i*d-l):(d=i*(d-h)-h,d-=l,u===-1?.5*(i-d)-.5:u===1?i<-.25?-2*(d-(i+.5)):1+2*(i-d):u<=-2||u>56?(n=ye(a=1-(d-i))+(u<<20)|0,(a=vi(a,n))-1):(c=1,u<20?a=(c=vi(c,n=1072693248-(2097152>>u)|0))-(d-i):(a=i-(d+(c=vi(c,n=wn-u<<20))),a+=1),n=ye(a)+(u<<20)|0,vi(a,n)))},W9=qs===!0?0:1,vp=new $s(1),D9=new Qs(vp.buffer),N9=function(i,e){return vp[0]=i,D9[W9]=e>>>0,vp[0]},Vh=N9,A9=function(i){return i===0?.3999999999940942:.3999999999940942+i*(.22222198432149784+.15313837699209373*i)},H9=function(i){return i===0?.6666666666666735:.6666666666666735+i*(.2857142874366239+i*(.1818357216161805+.14798198605116586*i))},Yw=1048575,O9=function(i){var e,t,n,s,r,o,a,l,h,c;return n=ye(i),s=i-1,(Yw&2+n)<3?s===0?0:s*s*(.3333333333333333*s-.5):(h=(n&=Yw)-398458|0,c=440401-n|0,t=(l=(o=(r=s/(2+s))*r)*o)*A9(l),a=o*H9(l)+t,(h|=c)>0?r*((e=.5*s*s)+a)-e:r*(a-s))},Bw=.4342944818781689,V9=function(i){var e,t,n,s,r,o,a;return We(i)||i<0?NaN:i===0?$t:(r=0,(t=ye(i))<1048576&&(r-=54,t=ye(i*=0x40000000000000)),t>=2146435072?i+i:(r+=(t>>20)-wn|0,i=vi(i,(t&=1048575)|1072693248^(s=t+614244&1048576)),o=r+=s>>20,n=O9(i),a=3694239077158931e-28*o+25082946711645275e-27*((i-=1)+n),(a+=(i-(e=Vh(i,0))+n)*Bw+e*Bw)+.30102999566361177*o))},z9=function(i){return i===0?.3999999999940942:.3999999999940942+i*(.22222198432149784+.15313837699209373*i)},F9=function(i){return i===0?.6666666666666735:.6666666666666735+i*(.2857142874366239+i*(.1818357216161805+.14798198605116586*i))},jw=1048575,K9=function(i){var e,t,n,s,r,o,a,l,h,c;return n=ye(i),s=i-1,(jw&2+n)<3?s===0?0:s*s*(.3333333333333333*s-.5):(h=(n&=jw)-398458|0,c=440401-n|0,t=(l=(o=(r=s/(2+s))*r)*o)*z9(l),a=o*F9(l)+t,(h|=c)>0?r*((e=.5*s*s)+a)-e:r*(a-s))},Uw=1.4426950407214463,Af=[0,0],Y9=function(i){var e,t,n,s,r;if(We(i)||i<0)return NaN;if(Hp(Af,i),r=0,(t=Af[0])<1048576){if(!(2147483647&t|Af[1]))return $t;r-=54,t=ye(i*=0x40000000000000)}return t>=2146435072?i+i:(r+=(t>>20)-wn|0,i=vi(i,(t&=1048575)|1072693248^(s=t+614244&1048576)),r+=s>>20,n=K9(i),16751713164886512e-26*((i-=1)+n)+(i-(e=Vh(i,0))+n)*Uw+e*Uw+r)},Ei=[0,0],B9=function(i){var e;if(e=ye(i),(e&=2147483647)<=1072243195)return e<1045430272?i:Xo(i,0);if(e>=2146435072)return NaN;switch(3&Vp(i,Ei)){case 0:return Xo(Ei[0],Ei[1]);case 1:return Eo(Ei[0],Ei[1]);case 2:return-Xo(Ei[0],Ei[1]);default:return-Eo(Ei[0],Ei[1])}},j9=function(i){var e,t;return i===0?.16666666666666666:((i<0?-i:i)<=1?(e=i*(i*(-.789474443963537*i-163.72585752598383)-11561.443576500522)-351754.9648081514,t=i*(36157.827983443196+i*(1*i-277.7110814206028))-2.1105297888489086e6):(e=(i=1/i)*(i*(-351754.9648081514*i-11561.443576500522)-163.72585752598383)-.789474443963537,t=1+i*(i*(36157.827983443196+-2.1105297888489086e6*i)-277.7110814206028)),e/t)},Mx=709.782712893384,U9=Mx+tc,J9=Mx-tc,Q9=function(i){var e;return i===0?i:(e=Op(i),i>U9||i<-709.089565712824?i>0?Qt:$t:e>1?e>=J9?(e=es(.5*e),e*=.5*e,i<0&&(e=-e),e):(e=.5*(e=es(e))-.5/e,i<0&&(e=-e),e):i+i*(e*=e)*j9(e))},$9=function(i){return i===0?.13333333333320124:.13333333333320124+i*(.021869488294859542+i*(.0035920791075913124+i*(.0005880412408202641+i*(7817944429395571e-20+-18558637485527546e-21*i))))},q9=function(i){return i===0?.05396825397622605:.05396825397622605+i*(.0088632398235993+i*(.0014562094543252903+i*(.0002464631348184699+i*(7140724913826082e-20+2590730518636337e-20*i))))},Jw=function(i,e,t){var n,s,r,o,a,l,h,c,d;return(s=2147483647&(n=ye(i)))>=1072010280&&(i<0&&(i=-i,e=-e),i=(d=.7853981633974483-i)+(c=3061616997868383e-32-e),e=0),o=e+(d=i*i)*((a=d*i)*((o=$9(c=d*d))+(h=d*q9(c)))+e),c=i+(o+=.3333333333333341*a),s>=1072010280?(1-(n>>30&2))*((h=t)-2*(i-(c*c/(c+h)-o))):t===1?c:(Vh(d=c,0),h=o-(d-i),Vh(l=r=-1/c,0),l+r*((a=1+l*d)+l*h))},Hf=[0,0],e3=function(i){var e,t;return e=ye(i),(e&=2147483647)<=1072243195?e<1044381696?i:Jw(i,0,1):e>=2146435072?NaN:(t=Vp(i,Hf),Jw(Hf[0],Hf[1],1-((1&t)<<1)))},t3=function(i){var e,t;return i===0?-.3333333333333332:((i<0?-i:i)<=1?(e=i*(i*(0*i-.9643991794250523)-99.28772310019185)-1614.6876844170845,t=4844.063053251255+i*(2235.4883906010045+i*(112.81167849163293+1*i))):(e=0+(i=1/i)*(i*(-1614.6876844170845*i-99.28772310019185)-.9643991794250523),t=1+i*(112.81167849163293+i*(2235.4883906010045+4844.063053251255*i))),e/t)},i3=function(i){var e,t;if((t=Op(i))>44.014845965556525)return i<0?-1:1;if(t>=.625)t=1-2/((e=es(2*t))+1),i<0&&(t=-t);else{if(i===0)return i;t=i+i*(e=i*i)*t3(e)}return t};globalThis.CroquetMath===void 0&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:mM,acosh:QM,asin:pp,asinh:qM,atan:yx,atanh:n9,atan2:c9,cbrt:f9,cos:M9,cosh:_9,exp:es,expm1:G9,log:Uo,log1p:jo,log10:V9,log2:Y9,sin:B9,sinh:Q9,tan:e3,tanh:i3});var Of=Math.pow;function Qw(i){return i===1/0||i===-1/0}globalThis.CroquetMath.pow=(i,e)=>{if(isNaN(i)||isNaN(e))return NaN;if(Qw(i)||Qw(e)||i===0||e===0)return Of(i,e);if(i<0&&!function(n){return Number.isInteger(n)}(e))return NaN;if(e===1)return i;if(e===2)return i*i;if(e===3)return i*i*i;if(e===4)return i*i*i*i;let t=1;return i<0&&(i*=-1,t=Of(-1,e)),globalThis.CroquetMath.exp(globalThis.CroquetMath.log(i)*e)*t};var xp=class extends JT{poll(){let e=super.poll();return this.array[this.size]=null,e}asArray(){let e=[];return this.forEach(t=>e.push(t)),e}asUnsortedArray(){return this.array.slice(0,this.size)}},$w,qw={exports:{}};function Px(){return $w||($w=1,qw.exports=function(i){return function(){var e=i,t=e.lib.WordArray;function n(s,r,o){for(var a=[],l=0,h=0;h<r;h++)if(h%4){var c=o[s.charCodeAt(h-1)]<<h%4*2|o[s.charCodeAt(h)]>>>6-h%4*2;a[l>>>2]|=c<<24-l%4*8,l++}return t.create(a,l)}e.enc.Base64={stringify:function(s){var r=s.words,o=s.sigBytes,a=this._map;s.clamp();for(var l=[],h=0;h<o;h+=3)for(var c=(r[h>>>2]>>>24-h%4*8&255)<<16|(r[h+1>>>2]>>>24-(h+1)%4*8&255)<<8|r[h+2>>>2]>>>24-(h+2)%4*8&255,d=0;d<4&&h+.75*d<o;d++)l.push(a.charAt(c>>>6*(3-d)&63));var u=a.charAt(64);if(u)for(;l.length%4;)l.push(u);return l.join("")},parse:function(s){var r=s.length,o=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var l=0;l<o.length;l++)a[o.charCodeAt(l)]=l}var h=o.charAt(64);if(h){var c=s.indexOf(h);c!==-1&&(r=c)}return n(s,r,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),i.enc.Base64}(kt())),qw.exports}var ev,vt=ss(Px()),tv=kt(),iv={exports:{}},nv,n3=(ev||(ev=1,iv.exports=function(i){return i.enc.Utf8}(kt())),iv.exports),s3=ss(n3),sv={exports:{}},rv={exports:{}};function zp(){return nv||(nv=1,rv.exports=function(i){(function(){var e=i,t=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(s,r){s=this._hasher=new s.init,typeof r=="string"&&(r=n.parse(r));var o=s.blockSize,a=4*o;r.sigBytes>a&&(r=s.finalize(r)),r.clamp();for(var l=this._oKey=r.clone(),h=this._iKey=r.clone(),c=l.words,d=h.words,u=0;u<o;u++)c[u]^=1549556828,d[u]^=909522486;l.sigBytes=h.sigBytes=a,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var r=this._hasher,o=r.finalize(s);return r.reset(),r.finalize(this._oKey.clone().concat(o))}})})()}(kt())),rv.exports}var ov,av,r3=(ov||(ov=1,sv.exports=function(i){return function(){var e=i,t=e.lib,n=t.Base,s=t.WordArray,r=e.algo,o=r.SHA256,a=r.HMAC,l=r.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,c){for(var d=this.cfg,u=a.create(d.hasher,h),f=s.create(),g=s.create([1]),C=f.words,p=g.words,k=d.keySize,T=d.iterations;C.length<k;){var M=u.update(c).finalize(g);u.reset();for(var L=M.words,b=L.length,m=M,w=1;w<T;w++){m=u.finalize(m),u.reset();for(var v=m.words,S=0;S<b;S++)L[S]^=v[S]}f.concat(M),p[0]++}return f.sigBytes=4*k,f}});e.PBKDF2=function(h,c,d){return l.create(d).compute(h,c)}}(),i.PBKDF2}(kt(),Dp(),zp())),sv.exports),lv=ss(r3),hv={exports:{}},cv={exports:{}};function o3(){return av||(av=1,cv.exports=function(i){return function(e){var t=i,n=t.lib,s=n.WordArray,r=n.Hasher,o=t.algo,a=[];(function(){for(var f=0;f<64;f++)a[f]=4294967296*e.abs(e.sin(f+1))|0})();var l=o.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(f,g){for(var C=0;C<16;C++){var p=g+C,k=f[p];f[p]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8)}var T=this._hash.words,M=f[g+0],L=f[g+1],b=f[g+2],m=f[g+3],w=f[g+4],v=f[g+5],S=f[g+6],P=f[g+7],Z=f[g+8],E=f[g+9],D=f[g+10],A=f[g+11],O=f[g+12],j=f[g+13],U=f[g+14],W=f[g+15],R=T[0],X=T[1],I=T[2],_=T[3];R=h(R,X,I,_,M,7,a[0]),_=h(_,R,X,I,L,12,a[1]),I=h(I,_,R,X,b,17,a[2]),X=h(X,I,_,R,m,22,a[3]),R=h(R,X,I,_,w,7,a[4]),_=h(_,R,X,I,v,12,a[5]),I=h(I,_,R,X,S,17,a[6]),X=h(X,I,_,R,P,22,a[7]),R=h(R,X,I,_,Z,7,a[8]),_=h(_,R,X,I,E,12,a[9]),I=h(I,_,R,X,D,17,a[10]),X=h(X,I,_,R,A,22,a[11]),R=h(R,X,I,_,O,7,a[12]),_=h(_,R,X,I,j,12,a[13]),I=h(I,_,R,X,U,17,a[14]),R=c(R,X=h(X,I,_,R,W,22,a[15]),I,_,L,5,a[16]),_=c(_,R,X,I,S,9,a[17]),I=c(I,_,R,X,A,14,a[18]),X=c(X,I,_,R,M,20,a[19]),R=c(R,X,I,_,v,5,a[20]),_=c(_,R,X,I,D,9,a[21]),I=c(I,_,R,X,W,14,a[22]),X=c(X,I,_,R,w,20,a[23]),R=c(R,X,I,_,E,5,a[24]),_=c(_,R,X,I,U,9,a[25]),I=c(I,_,R,X,m,14,a[26]),X=c(X,I,_,R,Z,20,a[27]),R=c(R,X,I,_,j,5,a[28]),_=c(_,R,X,I,b,9,a[29]),I=c(I,_,R,X,P,14,a[30]),R=d(R,X=c(X,I,_,R,O,20,a[31]),I,_,v,4,a[32]),_=d(_,R,X,I,Z,11,a[33]),I=d(I,_,R,X,A,16,a[34]),X=d(X,I,_,R,U,23,a[35]),R=d(R,X,I,_,L,4,a[36]),_=d(_,R,X,I,w,11,a[37]),I=d(I,_,R,X,P,16,a[38]),X=d(X,I,_,R,D,23,a[39]),R=d(R,X,I,_,j,4,a[40]),_=d(_,R,X,I,M,11,a[41]),I=d(I,_,R,X,m,16,a[42]),X=d(X,I,_,R,S,23,a[43]),R=d(R,X,I,_,E,4,a[44]),_=d(_,R,X,I,O,11,a[45]),I=d(I,_,R,X,W,16,a[46]),R=u(R,X=d(X,I,_,R,b,23,a[47]),I,_,M,6,a[48]),_=u(_,R,X,I,P,10,a[49]),I=u(I,_,R,X,U,15,a[50]),X=u(X,I,_,R,v,21,a[51]),R=u(R,X,I,_,O,6,a[52]),_=u(_,R,X,I,m,10,a[53]),I=u(I,_,R,X,D,15,a[54]),X=u(X,I,_,R,L,21,a[55]),R=u(R,X,I,_,Z,6,a[56]),_=u(_,R,X,I,W,10,a[57]),I=u(I,_,R,X,S,15,a[58]),X=u(X,I,_,R,j,21,a[59]),R=u(R,X,I,_,w,6,a[60]),_=u(_,R,X,I,A,10,a[61]),I=u(I,_,R,X,b,15,a[62]),X=u(X,I,_,R,E,21,a[63]),T[0]=T[0]+R|0,T[1]=T[1]+X|0,T[2]=T[2]+I|0,T[3]=T[3]+_|0},_doFinalize:function(){var f=this._data,g=f.words,C=8*this._nDataBytes,p=8*f.sigBytes;g[p>>>5]|=128<<24-p%32;var k=e.floor(C/4294967296),T=C;g[15+(p+64>>>9<<4)]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8),g[14+(p+64>>>9<<4)]=16711935&(T<<8|T>>>24)|4278255360&(T<<24|T>>>8),f.sigBytes=4*(g.length+1),this._process();for(var M=this._hash,L=M.words,b=0;b<4;b++){var m=L[b];L[b]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}return M},clone:function(){var f=r.clone.call(this);return f._hash=this._hash.clone(),f}});function h(f,g,C,p,k,T,M){var L=f+(g&C|~g&p)+k+M;return(L<<T|L>>>32-T)+g}function c(f,g,C,p,k,T,M){var L=f+(g&p|C&~p)+k+M;return(L<<T|L>>>32-T)+g}function d(f,g,C,p,k,T,M){var L=f+(g^C^p)+k+M;return(L<<T|L>>>32-T)+g}function u(f,g,C,p,k,T,M){var L=f+(C^(g|~p))+k+M;return(L<<T|L>>>32-T)+g}t.MD5=r._createHelper(l),t.HmacMD5=r._createHmacHelper(l)}(Math),i.MD5}(kt())),cv.exports}var dv,uv={exports:{}},fv={exports:{}};function a3(){return dv||(dv=1,fv.exports=function(i){return function(){var e=i,t=e.lib,n=t.WordArray,s=t.Hasher,r=e.algo,o=[],a=r.SHA1=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,h){for(var c=this._hash.words,d=c[0],u=c[1],f=c[2],g=c[3],C=c[4],p=0;p<80;p++){if(p<16)o[p]=0|l[h+p];else{var k=o[p-3]^o[p-8]^o[p-14]^o[p-16];o[p]=k<<1|k>>>31}var T=(d<<5|d>>>27)+C+o[p];T+=p<20?1518500249+(u&f|~u&g):p<40?1859775393+(u^f^g):p<60?(u&f|u&g|f&g)-1894007588:(u^f^g)-899497514,C=g,g=f,f=u<<30|u>>>2,u=d,d=T}c[0]=c[0]+d|0,c[1]=c[1]+u|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+C|0},_doFinalize:function(){var l=this._data,h=l.words,c=8*this._nDataBytes,d=8*l.sigBytes;return h[d>>>5]|=128<<24-d%32,h[14+(d+64>>>9<<4)]=Math.floor(c/4294967296),h[15+(d+64>>>9<<4)]=c,l.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var l=s.clone.call(this);return l._hash=this._hash.clone(),l}});e.SHA1=s._createHelper(a),e.HmacSHA1=s._createHmacHelper(a)}(),i.SHA1}(kt())),fv.exports}var pv;function mv(){return pv||(pv=1,uv.exports=function(i){return function(){var e=i,t=e.lib,n=t.Base,s=t.WordArray,r=e.algo,o=r.MD5,a=r.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,h){for(var c,d=this.cfg,u=d.hasher.create(),f=s.create(),g=f.words,C=d.keySize,p=d.iterations;g.length<C;){c&&u.update(c),c=u.update(l).finalize(h),u.reset();for(var k=1;k<p;k++)c=u.finalize(c),u.reset();f.concat(c)}return f.sigBytes=4*C,f}});e.EvpKDF=function(l,h,c){return a.create(c).compute(l,h)}}(),i.EvpKDF}(kt(),a3(),zp())),uv.exports}var gv,l3={exports:{}},yv,bv,h3=(yv||(yv=1,hv.exports=function(i){return function(){var e=i,t=e.lib.BlockCipher,n=e.algo,s=[],r=[],o=[],a=[],l=[],h=[],c=[],d=[],u=[],f=[];(function(){for(var p=[],k=0;k<256;k++)p[k]=k<128?k<<1:k<<1^283;var T=0,M=0;for(k=0;k<256;k++){var L=M^M<<1^M<<2^M<<3^M<<4;L=L>>>8^255&L^99,s[T]=L,r[L]=T;var b=p[T],m=p[b],w=p[m],v=257*p[L]^16843008*L;o[T]=v<<24|v>>>8,a[T]=v<<16|v>>>16,l[T]=v<<8|v>>>24,h[T]=v,v=16843009*w^65537*m^257*b^16843008*T,c[L]=v<<24|v>>>8,d[L]=v<<16|v>>>16,u[L]=v<<8|v>>>24,f[L]=v,T?(T=b^p[p[p[w^b]]],M^=p[p[M]]):T=M=1}})();var g=[0,1,2,4,8,16,32,64,128,27,54],C=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var p=this._keyPriorReset=this._key,k=p.words,T=p.sigBytes/4,M=4*((this._nRounds=T+6)+1),L=this._keySchedule=[],b=0;b<M;b++)b<T?L[b]=k[b]:(v=L[b-1],b%T?T>6&&b%T==4&&(v=s[v>>>24]<<24|s[v>>>16&255]<<16|s[v>>>8&255]<<8|s[255&v]):(v=s[(v=v<<8|v>>>24)>>>24]<<24|s[v>>>16&255]<<16|s[v>>>8&255]<<8|s[255&v],v^=g[b/T|0]<<24),L[b]=L[b-T]^v);for(var m=this._invKeySchedule=[],w=0;w<M;w++){if(b=M-w,w%4)var v=L[b];else v=L[b-4];m[w]=w<4||b<=4?v:c[s[v>>>24]]^d[s[v>>>16&255]]^u[s[v>>>8&255]]^f[s[255&v]]}}},encryptBlock:function(p,k){this._doCryptBlock(p,k,this._keySchedule,o,a,l,h,s)},decryptBlock:function(p,k){var T=p[k+1];p[k+1]=p[k+3],p[k+3]=T,this._doCryptBlock(p,k,this._invKeySchedule,c,d,u,f,r),T=p[k+1],p[k+1]=p[k+3],p[k+3]=T},_doCryptBlock:function(p,k,T,M,L,b,m,w){for(var v=this._nRounds,S=p[k]^T[0],P=p[k+1]^T[1],Z=p[k+2]^T[2],E=p[k+3]^T[3],D=4,A=1;A<v;A++){var O=M[S>>>24]^L[P>>>16&255]^b[Z>>>8&255]^m[255&E]^T[D++],j=M[P>>>24]^L[Z>>>16&255]^b[E>>>8&255]^m[255&S]^T[D++],U=M[Z>>>24]^L[E>>>16&255]^b[S>>>8&255]^m[255&P]^T[D++],W=M[E>>>24]^L[S>>>16&255]^b[P>>>8&255]^m[255&Z]^T[D++];S=O,P=j,Z=U,E=W}O=(w[S>>>24]<<24|w[P>>>16&255]<<16|w[Z>>>8&255]<<8|w[255&E])^T[D++],j=(w[P>>>24]<<24|w[Z>>>16&255]<<16|w[E>>>8&255]<<8|w[255&S])^T[D++],U=(w[Z>>>24]<<24|w[E>>>16&255]<<16|w[S>>>8&255]<<8|w[255&P])^T[D++],W=(w[E>>>24]<<24|w[S>>>16&255]<<16|w[P>>>8&255]<<8|w[255&Z])^T[D++],p[k]=O,p[k+1]=j,p[k+2]=U,p[k+3]=W},keySize:8});e.AES=t._createHelper(C)}(),i.AES}(kt(),Px(),o3(),mv(),gv||(gv=1,l3.exports=function(i){i.lib.Cipher||function(e){var t=i,n=t.lib,s=n.Base,r=n.WordArray,o=n.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var l=a.Base64,h=t.algo.EvpKDF,c=n.Cipher=o.extend({cfg:s.extend(),createEncryptor:function(L,b){return this.create(this._ENC_XFORM_MODE,L,b)},createDecryptor:function(L,b){return this.create(this._DEC_XFORM_MODE,L,b)},init:function(L,b,m){this.cfg=this.cfg.extend(m),this._xformMode=L,this._key=b,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(L){return this._append(L),this._process()},finalize:function(L){return L&&this._append(L),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function L(b){return typeof b=="string"?M:k}return function(b){return{encrypt:function(m,w,v){return L(w).encrypt(b,m,w,v)},decrypt:function(m,w,v){return L(w).decrypt(b,m,w,v)}}}}()});n.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},u=n.BlockCipherMode=s.extend({createEncryptor:function(L,b){return this.Encryptor.create(L,b)},createDecryptor:function(L,b){return this.Decryptor.create(L,b)},init:function(L,b){this._cipher=L,this._iv=b}}),f=d.CBC=function(){var L=u.extend();function b(m,w,v){var S,P=this._iv;P?(S=P,this._iv=e):S=this._prevBlock;for(var Z=0;Z<v;Z++)m[w+Z]^=S[Z]}return L.Encryptor=L.extend({processBlock:function(m,w){var v=this._cipher,S=v.blockSize;b.call(this,m,w,S),v.encryptBlock(m,w),this._prevBlock=m.slice(w,w+S)}}),L.Decryptor=L.extend({processBlock:function(m,w){var v=this._cipher,S=v.blockSize,P=m.slice(w,w+S);v.decryptBlock(m,w),b.call(this,m,w,S),this._prevBlock=P}}),L}(),g=(t.pad={}).Pkcs7={pad:function(L,b){for(var m=4*b,w=m-L.sigBytes%m,v=w<<24|w<<16|w<<8|w,S=[],P=0;P<w;P+=4)S.push(v);var Z=r.create(S,w);L.concat(Z)},unpad:function(L){var b=255&L.words[L.sigBytes-1>>>2];L.sigBytes-=b}};n.BlockCipher=c.extend({cfg:c.cfg.extend({mode:f,padding:g}),reset:function(){var L;c.reset.call(this);var b=this.cfg,m=b.iv,w=b.mode;this._xformMode==this._ENC_XFORM_MODE?L=w.createEncryptor:(L=w.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==L?this._mode.init(this,m&&m.words):(this._mode=L.call(w,this,m&&m.words),this._mode.__creator=L)},_doProcessBlock:function(L,b){this._mode.processBlock(L,b)},_doFinalize:function(){var L,b=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(b.pad(this._data,this.blockSize),L=this._process(!0)):(L=this._process(!0),b.unpad(L)),L},blockSize:4});var C=n.CipherParams=s.extend({init:function(L){this.mixIn(L)},toString:function(L){return(L||this.formatter).stringify(this)}}),p=(t.format={}).OpenSSL={stringify:function(L){var b=L.ciphertext,m=L.salt;return(m?r.create([1398893684,1701076831]).concat(m).concat(b):b).toString(l)},parse:function(L){var b,m=l.parse(L),w=m.words;return w[0]==1398893684&&w[1]==1701076831&&(b=r.create(w.slice(2,4)),w.splice(0,4),m.sigBytes-=16),C.create({ciphertext:m,salt:b})}},k=n.SerializableCipher=s.extend({cfg:s.extend({format:p}),encrypt:function(L,b,m,w){w=this.cfg.extend(w);var v=L.createEncryptor(m,w),S=v.finalize(b),P=v.cfg;return C.create({ciphertext:S,key:m,iv:P.iv,algorithm:L,mode:P.mode,padding:P.padding,blockSize:L.blockSize,formatter:w.format})},decrypt:function(L,b,m,w){return w=this.cfg.extend(w),b=this._parse(b,w.format),L.createDecryptor(m,w).finalize(b.ciphertext)},_parse:function(L,b){return typeof L=="string"?b.parse(L,this):L}}),T=(t.kdf={}).OpenSSL={execute:function(L,b,m,w,v){if(w||(w=r.random(8)),v)S=h.create({keySize:b+m,hasher:v}).compute(L,w);else var S=h.create({keySize:b+m}).compute(L,w);var P=r.create(S.words.slice(b),4*m);return S.sigBytes=4*b,C.create({key:S,iv:P,salt:w})}},M=n.PasswordBasedCipher=k.extend({cfg:k.cfg.extend({kdf:T}),encrypt:function(L,b,m,w){var v=(w=this.cfg.extend(w)).kdf.execute(m,L.keySize,L.ivSize,w.salt,w.hasher);w.iv=v.iv;var S=k.encrypt.call(this,L,b,v.key,w);return S.mixIn(v),S},decrypt:function(L,b,m,w){w=this.cfg.extend(w),b=this._parse(b,w.format);var v=w.kdf.execute(m,L.keySize,L.ivSize,b.salt,w.hasher);return w.iv=v.iv,k.decrypt.call(this,L,b,v.key,w)}})}()}(kt(),mv())))),hv.exports),Lh=ss(h3),wv={exports:{}},c3=(bv||(bv=1,wv.exports=function(i){return i.HmacSHA256}(kt(),Dp(),zp())),wv.exports),Vf=ss(c3);function er(i){let e=i.length;for(;--e>=0;)i[e]=0}var Fp=256,Rx=286,_o=30,Io=15,Sp=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ah=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d3=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vv=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ni=new Array(576);er(Ni);var Go=new Array(60);er(Go);var Qo=new Array(512);er(Qo);var Wo=new Array(256);er(Wo);var Kp=new Array(29);er(Kp);var zh=new Array(_o);function zf(i,e,t,n,s){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=i&&i.length}var xv,Sv,kv;function Ff(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}er(zh);var Zx=i=>i<256?Qo[i]:Qo[256+(i>>>7)],$o=(i,e)=>{i.pending_buf[i.pending++]=255&e,i.pending_buf[i.pending++]=e>>>8&255},at=(i,e,t)=>{i.bi_valid>16-t?(i.bi_buf|=e<<i.bi_valid&65535,$o(i,i.bi_buf),i.bi_buf=e>>16-i.bi_valid,i.bi_valid+=t-16):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},wi=(i,e,t)=>{at(i,t[2*e],t[2*e+1])},Ex=(i,e)=>{let t=0;do t|=1&i,i>>>=1,t<<=1;while(--e>0);return t>>>1},Xx=(i,e,t)=>{let n=new Array(16),s,r,o=0;for(s=1;s<=Io;s++)o=o+t[s-1]<<1,n[s]=o;for(r=0;r<=e;r++){let a=i[2*r+1];a!==0&&(i[2*r]=Ex(n[a]++,a))}},_x=i=>{let e;for(e=0;e<Rx;e++)i.dyn_ltree[2*e]=0;for(e=0;e<_o;e++)i.dyn_dtree[2*e]=0;for(e=0;e<19;e++)i.bl_tree[2*e]=0;i.dyn_ltree[512]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Ix=i=>{i.bi_valid>8?$o(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},Cv=(i,e,t,n)=>{let s=2*e,r=2*t;return i[s]<i[r]||i[s]===i[r]&&n[e]<=n[t]},Kf=(i,e,t)=>{let n=i.heap[t],s=t<<1;for(;s<=i.heap_len&&(s<i.heap_len&&Cv(e,i.heap[s+1],i.heap[s],i.depth)&&s++,!Cv(e,n,i.heap[s],i.depth));)i.heap[t]=i.heap[s],t=s,s<<=1;i.heap[t]=n},Lv=(i,e,t)=>{let n,s,r,o,a=0;if(i.sym_next!==0)do n=255&i.pending_buf[i.sym_buf+a++],n+=(255&i.pending_buf[i.sym_buf+a++])<<8,s=i.pending_buf[i.sym_buf+a++],n===0?wi(i,s,e):(r=Wo[s],wi(i,r+Fp+1,e),o=Sp[r],o!==0&&(s-=Kp[r],at(i,s,o)),n--,r=Zx(n),wi(i,r,t),o=Ah[r],o!==0&&(n-=zh[r],at(i,n,o)));while(a<i.sym_next);wi(i,256,e)},Yf=(i,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.elems,o,a,l,h=-1;for(i.heap_len=0,i.heap_max=573,o=0;o<r;o++)t[2*o]!==0?(i.heap[++i.heap_len]=h=o,i.depth[o]=0):t[2*o+1]=0;for(;i.heap_len<2;)l=i.heap[++i.heap_len]=h<2?++h:0,t[2*l]=1,i.depth[l]=0,i.opt_len--,s&&(i.static_len-=n[2*l+1]);for(e.max_code=h,o=i.heap_len>>1;o>=1;o--)Kf(i,t,o);l=r;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Kf(i,t,1),a=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=a,t[2*l]=t[2*o]+t[2*a],i.depth[l]=(i.depth[o]>=i.depth[a]?i.depth[o]:i.depth[a])+1,t[2*o+1]=t[2*a+1]=l,i.heap[1]=l++,Kf(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],((c,d)=>{let u=d.dyn_tree,f=d.max_code,g=d.stat_desc.static_tree,C=d.stat_desc.has_stree,p=d.stat_desc.extra_bits,k=d.stat_desc.extra_base,T=d.stat_desc.max_length,M,L,b,m,w,v,S=0;for(m=0;m<=Io;m++)c.bl_count[m]=0;for(u[2*c.heap[c.heap_max]+1]=0,M=c.heap_max+1;M<573;M++)L=c.heap[M],m=u[2*u[2*L+1]+1]+1,m>T&&(m=T,S++),u[2*L+1]=m,L>f||(c.bl_count[m]++,w=0,L>=k&&(w=p[L-k]),v=u[2*L],c.opt_len+=v*(m+w),C&&(c.static_len+=v*(g[2*L+1]+w)));if(S!==0){do{for(m=T-1;c.bl_count[m]===0;)m--;c.bl_count[m]--,c.bl_count[m+1]+=2,c.bl_count[T]--,S-=2}while(S>0);for(m=T;m!==0;m--)for(L=c.bl_count[m];L!==0;)b=c.heap[--M],b>f||(u[2*b+1]!==m&&(c.opt_len+=(m-u[2*b+1])*u[2*b],u[2*b+1]=m),L--)}})(i,e),Xx(t,h,i.bl_count)},Tv=(i,e,t)=>{let n,s,r=-1,o=e[1],a=0,l=7,h=4;for(o===0&&(l=138,h=3),e[2*(t+1)+1]=65535,n=0;n<=t;n++)s=o,o=e[2*(n+1)+1],++a<l&&s===o||(a<h?i.bl_tree[2*s]+=a:s!==0?(s!==r&&i.bl_tree[2*s]++,i.bl_tree[32]++):a<=10?i.bl_tree[34]++:i.bl_tree[36]++,a=0,r=s,o===0?(l=138,h=3):s===o?(l=6,h=3):(l=7,h=4))},Mv=(i,e,t)=>{let n,s,r=-1,o=e[1],a=0,l=7,h=4;for(o===0&&(l=138,h=3),n=0;n<=t;n++)if(s=o,o=e[2*(n+1)+1],!(++a<l&&s===o)){if(a<h)do wi(i,s,i.bl_tree);while(--a!=0);else s!==0?(s!==r&&(wi(i,s,i.bl_tree),a--),wi(i,16,i.bl_tree),at(i,a-3,2)):a<=10?(wi(i,17,i.bl_tree),at(i,a-3,3)):(wi(i,18,i.bl_tree),at(i,a-11,7));a=0,r=s,o===0?(l=138,h=3):s===o?(l=6,h=3):(l=7,h=4)}},Pv=!1,Gx=(i,e,t,n)=>{at(i,0+(n?1:0),3),Ix(i),$o(i,t),$o(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},u3=(i,e,t,n)=>{let s,r,o=0;i.level>0?(i.strm.data_type===2&&(i.strm.data_type=(a=>{let l,h=4093624447;for(l=0;l<=31;l++,h>>>=1)if(1&h&&a.dyn_ltree[2*l]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(l=32;l<Fp;l++)if(a.dyn_ltree[2*l]!==0)return 1;return 0})(i)),Yf(i,i.l_desc),Yf(i,i.d_desc),o=(a=>{let l;for(Tv(a,a.dyn_ltree,a.l_desc.max_code),Tv(a,a.dyn_dtree,a.d_desc.max_code),Yf(a,a.bl_desc),l=18;l>=3&&a.bl_tree[2*vv[l]+1]===0;l--);return a.opt_len+=3*(l+1)+5+5+4,l})(i),s=i.opt_len+3+7>>>3,r=i.static_len+3+7>>>3,r<=s&&(s=r)):s=r=t+5,t+4<=s&&e!==-1?Gx(i,e,t,n):i.strategy===4||r===s?(at(i,2+(n?1:0),3),Lv(i,Ni,Go)):(at(i,4+(n?1:0),3),((a,l,h,c)=>{let d;for(at(a,l-257,5),at(a,h-1,5),at(a,c-4,4),d=0;d<c;d++)at(a,a.bl_tree[2*vv[d]+1],3);Mv(a,a.dyn_ltree,l-1),Mv(a,a.dyn_dtree,h-1)})(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),Lv(i,i.dyn_ltree,i.dyn_dtree)),_x(i),n&&Ix(i)},f3={_tr_init:i=>{Pv||((()=>{let e,t,n,s,r,o=new Array(16);for(n=0,s=0;s<28;s++)for(Kp[s]=n,e=0;e<1<<Sp[s];e++)Wo[n++]=s;for(Wo[n-1]=s,r=0,s=0;s<16;s++)for(zh[s]=r,e=0;e<1<<Ah[s];e++)Qo[r++]=s;for(r>>=7;s<_o;s++)for(zh[s]=r<<7,e=0;e<1<<Ah[s]-7;e++)Qo[256+r++]=s;for(t=0;t<=Io;t++)o[t]=0;for(e=0;e<=143;)Ni[2*e+1]=8,e++,o[8]++;for(;e<=255;)Ni[2*e+1]=9,e++,o[9]++;for(;e<=279;)Ni[2*e+1]=7,e++,o[7]++;for(;e<=287;)Ni[2*e+1]=8,e++,o[8]++;for(Xx(Ni,287,o),e=0;e<_o;e++)Go[2*e+1]=5,Go[2*e]=Ex(e,5);xv=new zf(Ni,Sp,257,Rx,Io),Sv=new zf(Go,Ah,0,_o,Io),kv=new zf(new Array(0),d3,0,19,7)})(),Pv=!0),i.l_desc=new Ff(i.dyn_ltree,xv),i.d_desc=new Ff(i.dyn_dtree,Sv),i.bl_desc=new Ff(i.bl_tree,kv),i.bi_buf=0,i.bi_valid=0,_x(i)},_tr_stored_block:Gx,_tr_flush_block:u3,_tr_tally:(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[2*t]++:(i.matches++,e--,i.dyn_ltree[2*(Wo[t]+Fp+1)]++,i.dyn_dtree[2*Zx(e)]++),i.sym_next===i.sym_end),_tr_align:i=>{at(i,2,3),wi(i,256,Ni),(e=>{e.bi_valid===16?($o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(i)}},qo=(i,e,t,n)=>{let s=65535&i,r=i>>>16&65535,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do s=s+e[n++]|0,r=r+s|0;while(--o);s%=65521,r%=65521}return s|r<<16},p3=new Uint32Array((()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e})()),Ge=(i,e,t,n)=>{let s=p3,r=n+t;i^=-1;for(let o=n;o<r;o++)i=i>>>8^s[255&(i^e[o])];return~i},ns={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},na={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:m3,_tr_stored_block:kp,_tr_flush_block:g3,_tr_tally:pn,_tr_align:y3}=f3,{Z_NO_FLUSH:mn,Z_PARTIAL_FLUSH:b3,Z_FULL_FLUSH:w3,Z_FINISH:It,Z_BLOCK:Rv,Z_OK:He,Z_STREAM_END:Zv,Z_STREAM_ERROR:xi,Z_DATA_ERROR:v3,Z_BUF_ERROR:Bf,Z_DEFAULT_COMPRESSION:x3,Z_FILTERED:S3,Z_HUFFMAN_ONLY:Th,Z_RLE:k3,Z_FIXED:C3,Z_DEFAULT_STRATEGY:L3,Z_UNKNOWN:T3,Z_DEFLATED:nc}=na,Jn=258,Si=262,Bs=42,Qn=113,Ro=666,$n=(i,e)=>(i.msg=ns[e],e),Ev=i=>2*i-(i>4?9:0),cn=i=>{let e=i.length;for(;--e>=0;)i[e]=0},M3=i=>{let e,t,n,s=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=s?t-s:0;while(--e);e=s,n=e;do t=i.prev[--n],i.prev[n]=t>=s?t-s:0;while(--e)},gn=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,wt=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},xt=(i,e)=>{g3(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,wt(i.strm)},se=(i,e)=>{i.pending_buf[i.pending++]=e},xo=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=255&e},Cp=(i,e,t,n)=>{let s=i.avail_in;return s>n&&(s=n),s===0?0:(i.avail_in-=s,e.set(i.input.subarray(i.next_in,i.next_in+s),t),i.state.wrap===1?i.adler=qo(i.adler,e,s,t):i.state.wrap===2&&(i.adler=Ge(i.adler,e,s,t)),i.next_in+=s,i.total_in+=s,s)},Wx=(i,e)=>{let t,n,s=i.max_chain_length,r=i.strstart,o=i.prev_length,a=i.nice_match,l=i.strstart>i.w_size-Si?i.strstart-(i.w_size-Si):0,h=i.window,c=i.w_mask,d=i.prev,u=i.strstart+Jn,f=h[r+o-1],g=h[r+o];i.prev_length>=i.good_match&&(s>>=2),a>i.lookahead&&(a=i.lookahead);do if(t=e,h[t+o]===g&&h[t+o-1]===f&&h[t]===h[r]&&h[++t]===h[r+1]){r+=2,t++;do;while(h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&h[++r]===h[++t]&&r<u);if(n=Jn-(u-r),r=u-Jn,n>o){if(i.match_start=e,o=n,n>=a)break;f=h[r+o-1],g=h[r+o]}}while((e=d[e&c])>l&&--s!=0);return o<=i.lookahead?o:i.lookahead},js=i=>{let e=i.w_size,t,n,s;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-Si)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),M3(i),n+=e),i.strm.avail_in===0)break;if(t=Cp(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=3)for(s=i.strstart-i.insert,i.ins_h=i.window[s],i.ins_h=gn(i,i.ins_h,i.window[s+1]);i.insert&&(i.ins_h=gn(i,i.ins_h,i.window[s+3-1]),i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,i.insert--,!(i.lookahead+i.insert<3)););}while(i.lookahead<Si&&i.strm.avail_in!==0)},Dx=(i,e)=>{let t,n,s,r=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,o=0,a=i.strm.avail_in;do{if(t=65535,s=i.bi_valid+42>>3,i.strm.avail_out<s||(s=i.strm.avail_out-s,n=i.strstart-i.block_start,t>n+i.strm.avail_in&&(t=n+i.strm.avail_in),t>s&&(t=s),t<r&&(t===0&&e!==It||e===mn||t!==n+i.strm.avail_in)))break;o=e===It&&t===n+i.strm.avail_in?1:0,kp(i,0,0,o),i.pending_buf[i.pending-4]=t,i.pending_buf[i.pending-3]=t>>8,i.pending_buf[i.pending-2]=~t,i.pending_buf[i.pending-1]=~t>>8,wt(i.strm),n&&(n>t&&(n=t),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+n),i.strm.next_out),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n,i.block_start+=n,t-=n),t&&(Cp(i.strm,i.strm.output,i.strm.next_out,t),i.strm.next_out+=t,i.strm.avail_out-=t,i.strm.total_out+=t)}while(o===0);return a-=i.strm.avail_in,a&&(a>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=a&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-a,i.strm.next_in),i.strstart),i.strstart+=a,i.insert+=a>i.w_size-i.insert?i.w_size-i.insert:a),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),o?4:e!==mn&&e!==It&&i.strm.avail_in===0&&i.strstart===i.block_start?2:(s=i.window_size-i.strstart,i.strm.avail_in>s&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,s+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),s>i.strm.avail_in&&(s=i.strm.avail_in),s&&(Cp(i.strm,i.window,i.strstart,s),i.strstart+=s,i.insert+=s>i.w_size-i.insert?i.w_size-i.insert:s),i.high_water<i.strstart&&(i.high_water=i.strstart),s=i.bi_valid+42>>3,s=i.pending_buf_size-s>65535?65535:i.pending_buf_size-s,r=s>i.w_size?i.w_size:s,n=i.strstart-i.block_start,(n>=r||(n||e===It)&&e!==mn&&i.strm.avail_in===0&&n<=s)&&(t=n>s?s:n,o=e===It&&i.strm.avail_in===0&&t===n?1:0,kp(i,i.block_start,t,o),i.block_start+=t,wt(i.strm)),o?3:1)},jf=(i,e)=>{let t,n;for(;;){if(i.lookahead<Si){if(js(i),i.lookahead<Si&&e===mn)return 1;if(i.lookahead===0)break}if(t=0,i.lookahead>=3&&(i.ins_h=gn(i,i.ins_h,i.window[i.strstart+3-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-Si&&(i.match_length=Wx(i,t)),i.match_length>=3)if(n=pn(i,i.strstart-i.match_start,i.match_length-3),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=3){i.match_length--;do i.strstart++,i.ins_h=gn(i,i.ins_h,i.window[i.strstart+3-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!=0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=gn(i,i.ins_h,i.window[i.strstart+1]);else n=pn(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(xt(i,!1),i.strm.avail_out===0))return 1}return i.insert=i.strstart<2?i.strstart:2,e===It?(xt(i,!0),i.strm.avail_out===0?3:4):i.sym_next&&(xt(i,!1),i.strm.avail_out===0)?1:2},Ds=(i,e)=>{let t,n,s;for(;;){if(i.lookahead<Si){if(js(i),i.lookahead<Si&&e===mn)return 1;if(i.lookahead===0)break}if(t=0,i.lookahead>=3&&(i.ins_h=gn(i,i.ins_h,i.window[i.strstart+3-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=2,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-Si&&(i.match_length=Wx(i,t),i.match_length<=5&&(i.strategy===S3||i.match_length===3&&i.strstart-i.match_start>4096)&&(i.match_length=2)),i.prev_length>=3&&i.match_length<=i.prev_length){s=i.strstart+i.lookahead-3,n=pn(i,i.strstart-1-i.prev_match,i.prev_length-3),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=s&&(i.ins_h=gn(i,i.ins_h,i.window[i.strstart+3-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!=0);if(i.match_available=0,i.match_length=2,i.strstart++,n&&(xt(i,!1),i.strm.avail_out===0))return 1}else if(i.match_available){if(n=pn(i,0,i.window[i.strstart-1]),n&&xt(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return 1}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=pn(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<2?i.strstart:2,e===It?(xt(i,!0),i.strm.avail_out===0?3:4):i.sym_next&&(xt(i,!1),i.strm.avail_out===0)?1:2};function yi(i,e,t,n,s){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=s}var Zo=[new yi(0,0,0,0,Dx),new yi(4,4,8,4,jf),new yi(4,5,16,8,jf),new yi(4,6,32,32,jf),new yi(4,4,16,16,Ds),new yi(8,16,32,32,Ds),new yi(8,16,128,128,Ds),new yi(8,32,128,256,Ds),new yi(32,128,258,1024,Ds),new yi(32,258,258,4096,Ds)];function P3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=nc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),cn(this.dyn_ltree),cn(this.dyn_dtree),cn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),cn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),cn(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Do=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.status!==Bs&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Qn&&e.status!==Ro?1:0},Nx=i=>{if(Do(i))return $n(i,xi);i.total_in=i.total_out=0,i.data_type=T3;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Bs:Qn,i.adler=e.wrap===2?0:1,e.last_flush=-2,m3(e),He},Ax=i=>{let e=Nx(i);var t;return e===He&&((t=i.state).window_size=2*t.w_size,cn(t.head),t.max_lazy_match=Zo[t.level].max_lazy,t.good_match=Zo[t.level].good_length,t.nice_match=Zo[t.level].nice_length,t.max_chain_length=Zo[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},Xv=(i,e,t,n,s,r)=>{if(!i)return xi;let o=1;if(e===x3&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>9||t!==nc||n<8||n>15||e<0||e>9||r<0||r>C3||n===8&&o!==1)return $n(i,xi);n===8&&(n=9);let a=new P3;return i.state=a,a.strm=i,a.status=Bs,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=r,a.method=t,Ax(i)},R3=(i,e)=>{if(Do(i)||e>Rv||e<0)return i?$n(i,xi):xi;let t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===Ro&&e!==It)return $n(i,i.avail_out===0?Bf:xi);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(wt(i),i.avail_out===0)return t.last_flush=-1,He}else if(i.avail_in===0&&Ev(e)<=Ev(n)&&e!==It)return $n(i,Bf);if(t.status===Ro&&i.avail_in!==0)return $n(i,Bf);if(t.status===Bs&&t.wrap===0&&(t.status=Qn),t.status===Bs){let s=nc+(t.w_bits-8<<4)<<8,r=-1;if(r=t.strategy>=Th||t.level<2?0:t.level<6?1:t.level===6?2:3,s|=r<<6,t.strstart!==0&&(s|=32),s+=31-s%31,xo(t,s),t.strstart!==0&&(xo(t,i.adler>>>16),xo(t,65535&i.adler)),i.adler=1,t.status=Qn,wt(i),t.pending!==0)return t.last_flush=-1,He}if(t.status===57){if(i.adler=0,se(t,31),se(t,139),se(t,8),t.gzhead)se(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),se(t,255&t.gzhead.time),se(t,t.gzhead.time>>8&255),se(t,t.gzhead.time>>16&255),se(t,t.gzhead.time>>24&255),se(t,t.level===9?2:t.strategy>=Th||t.level<2?4:0),se(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(se(t,255&t.gzhead.extra.length),se(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=Ge(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(se(t,0),se(t,0),se(t,0),se(t,0),se(t,0),se(t,t.level===9?2:t.strategy>=Th||t.level<2?4:0),se(t,3),t.status=Qn,wt(i),t.pending!==0)return t.last_flush=-1,He}if(t.status===69){if(t.gzhead.extra){let s=t.pending,r=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=a,wt(i),t.pending!==0)return t.last_flush=-1,He;s=0,r-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>s&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let s,r=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-r,r)),wt(i),t.pending!==0)return t.last_flush=-1,He;r=0}s=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,se(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let s,r=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-r,r)),wt(i),t.pending!==0)return t.last_flush=-1,He;r=0}s=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,se(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=Ge(i.adler,t.pending_buf,t.pending-r,r))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(wt(i),t.pending!==0))return t.last_flush=-1,He;se(t,255&i.adler),se(t,i.adler>>8&255),i.adler=0}if(t.status=Qn,wt(i),t.pending!==0)return t.last_flush=-1,He}if(i.avail_in!==0||t.lookahead!==0||e!==mn&&t.status!==Ro){let s=t.level===0?Dx(t,e):t.strategy===Th?((r,o)=>{let a;for(;;){if(r.lookahead===0&&(js(r),r.lookahead===0)){if(o===mn)return 1;break}if(r.match_length=0,a=pn(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,a&&(xt(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===It?(xt(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(xt(r,!1),r.strm.avail_out===0)?1:2})(t,e):t.strategy===k3?((r,o)=>{let a,l,h,c,d=r.window;for(;;){if(r.lookahead<=Jn){if(js(r),r.lookahead<=Jn&&o===mn)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(h=r.strstart-1,l=d[h],l===d[++h]&&l===d[++h]&&l===d[++h])){c=r.strstart+Jn;do;while(l===d[++h]&&l===d[++h]&&l===d[++h]&&l===d[++h]&&l===d[++h]&&l===d[++h]&&l===d[++h]&&l===d[++h]&&h<c);r.match_length=Jn-(c-h),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(a=pn(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(a=pn(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),a&&(xt(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===It?(xt(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(xt(r,!1),r.strm.avail_out===0)?1:2})(t,e):Zo[t.level].func(t,e);if(s!==3&&s!==4||(t.status=Ro),s===1||s===3)return i.avail_out===0&&(t.last_flush=-1),He;if(s===2&&(e===b3?y3(t):e!==Rv&&(kp(t,0,0,!1),e===w3&&(cn(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),wt(i),i.avail_out===0))return t.last_flush=-1,He}return e!==It?He:t.wrap<=0?Zv:(t.wrap===2?(se(t,255&i.adler),se(t,i.adler>>8&255),se(t,i.adler>>16&255),se(t,i.adler>>24&255),se(t,255&i.total_in),se(t,i.total_in>>8&255),se(t,i.total_in>>16&255),se(t,i.total_in>>24&255)):(xo(t,i.adler>>>16),xo(t,65535&i.adler)),wt(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?He:Zv)},No={deflateInit:(i,e)=>Xv(i,e,nc,15,8,L3),deflateInit2:Xv,deflateReset:Ax,deflateResetKeep:Nx,deflateSetHeader:(i,e)=>Do(i)||i.state.wrap!==2?xi:(i.state.gzhead=e,He),deflate:R3,deflateEnd:i=>{if(Do(i))return xi;let e=i.state.status;return i.state=null,e===Qn?$n(i,v3):He},deflateSetDictionary:(i,e)=>{let t=e.length;if(Do(i))return xi;let n=i.state,s=n.wrap;if(s===2||s===1&&n.status!==Bs||n.lookahead)return xi;if(s===1&&(i.adler=qo(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){s===0&&(cn(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let r=i.avail_in,o=i.next_in,a=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,js(n);n.lookahead>=3;){let l=n.strstart,h=n.lookahead-2;do n.ins_h=gn(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--h);n.strstart=l,n.lookahead=2,js(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,i.next_in=o,i.input=a,i.avail_in=r,n.wrap=s,He},deflateInfo:"pako deflate (from Nodeca project)"},Z3=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),Hx=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)Z3(t,n)&&(i[n]=t[n])}}return i},Ox=i=>{let e=0;for(let n=0,s=i.length;n<s;n++)e+=i[n].length;let t=new Uint8Array(e);for(let n=0,s=0,r=i.length;n<r;n++){let o=i[n];t.set(o,s),s+=o.length}return t},Vx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Vx=!1}var ea=new Uint8Array(256);for(let i=0;i<256;i++)ea[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;ea[254]=ea[254]=1;var Yp=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,s,r,o=i.length,a=0;for(s=0;s<o;s++)t=i.charCodeAt(s),(64512&t)==55296&&s+1<o&&(n=i.charCodeAt(s+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),r=0,s=0;r<a;s++)t=i.charCodeAt(s),(64512&t)==55296&&s+1<o&&(n=i.charCodeAt(s+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|63&t):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|63&t):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|63&t);return e},E3=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,s,r=new Array(2*t);for(s=0,n=0;n<t;){let o=i[n++];if(o<128){r[s++]=o;continue}let a=ea[o];if(a>4)r[s++]=65533,n+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|63&i[n++],a--;a>1?r[s++]=65533:o<65536?r[s++]=o:(o-=65536,r[s++]=55296|o>>10&1023,r[s++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Vx)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let l="";for(let h=0;h<a;h++)l+=String.fromCharCode(o[h]);return l})(r,s)},X3=(i,e)=>{(e=e||i.length)>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(192&i[t])==128;)t--;return t<0||t===0?e:t+ea[i[t]]>e?t:e},zx=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Fx=Object.prototype.toString,{Z_NO_FLUSH:_3,Z_SYNC_FLUSH:I3,Z_FULL_FLUSH:G3,Z_FINISH:W3,Z_OK:Fh,Z_STREAM_END:D3,Z_DEFAULT_COMPRESSION:N3,Z_DEFAULT_STRATEGY:A3,Z_DEFLATED:H3}=na;function Ao(i){this.options=Hx({level:N3,method:H3,chunkSize:16384,windowBits:15,memLevel:8,strategy:A3},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zx,this.strm.avail_out=0;let t=No.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Fh)throw new Error(ns[t]);if(e.header&&No.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(n=typeof e.dictionary=="string"?Yp(e.dictionary):Fx.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=No.deflateSetDictionary(this.strm,n),t!==Fh)throw new Error(ns[t]);this._dict_set=!0}}function Uf(i,e){let t=new Ao(e);if(t.push(i,!0),t.err)throw t.msg||ns[t.err];return t.result}Ao.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,s,r;if(this.ended)return!1;for(r=e===~~e?e:e===!0?W3:_3,typeof i=="string"?t.input=Yp(i):Fx.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(r===I3||r===G3)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(s=No.deflate(t,r),s===D3)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=No.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Fh;if(t.avail_out!==0){if(r>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},Ao.prototype.onData=function(i){this.chunks.push(i)},Ao.prototype.onEnd=function(i){i===Fh&&(this.result=Ox(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};var O3={Deflate:Ao,deflate:Uf,deflateRaw:function(i,e){return(e=e||{}).raw=!0,Uf(i,e)},gzip:function(i,e){return(e=e||{}).gzip=!0,Uf(i,e)}},Mh=16209,V3=function(i,e){let t,n,s,r,o,a,l,h,c,d,u,f,g,C,p,k,T,M,L,b,m,w,v,S,P=i.state;t=i.next_in,v=i.input,n=t+(i.avail_in-5),s=i.next_out,S=i.output,r=s-(e-i.avail_out),o=s+(i.avail_out-257),a=P.dmax,l=P.wsize,h=P.whave,c=P.wnext,d=P.window,u=P.hold,f=P.bits,g=P.lencode,C=P.distcode,p=(1<<P.lenbits)-1,k=(1<<P.distbits)-1;e:do{f<15&&(u+=v[t++]<<f,f+=8,u+=v[t++]<<f,f+=8),T=g[u&p];t:for(;;){if(M=T>>>24,u>>>=M,f-=M,M=T>>>16&255,M===0)S[s++]=65535&T;else{if(!(16&M)){if(64&M){if(32&M){P.mode=16191;break e}i.msg="invalid literal/length code",P.mode=Mh;break e}T=g[(65535&T)+(u&(1<<M)-1)];continue t}for(L=65535&T,M&=15,M&&(f<M&&(u+=v[t++]<<f,f+=8),L+=u&(1<<M)-1,u>>>=M,f-=M),f<15&&(u+=v[t++]<<f,f+=8,u+=v[t++]<<f,f+=8),T=C[u&k];;){if(M=T>>>24,u>>>=M,f-=M,M=T>>>16&255,16&M){if(b=65535&T,M&=15,f<M&&(u+=v[t++]<<f,f+=8,f<M&&(u+=v[t++]<<f,f+=8)),b+=u&(1<<M)-1,b>a){i.msg="invalid distance too far back",P.mode=Mh;break e}if(u>>>=M,f-=M,M=s-r,b>M){if(M=b-M,M>h&&P.sane){i.msg="invalid distance too far back",P.mode=Mh;break e}if(m=0,w=d,c===0){if(m+=l-M,M<L){L-=M;do S[s++]=d[m++];while(--M);m=s-b,w=S}}else if(c<M){if(m+=l+c-M,M-=c,M<L){L-=M;do S[s++]=d[m++];while(--M);if(m=0,c<L){M=c,L-=M;do S[s++]=d[m++];while(--M);m=s-b,w=S}}}else if(m+=c-M,M<L){L-=M;do S[s++]=d[m++];while(--M);m=s-b,w=S}for(;L>2;)S[s++]=w[m++],S[s++]=w[m++],S[s++]=w[m++],L-=3;L&&(S[s++]=w[m++],L>1&&(S[s++]=w[m++]))}else{m=s-b;do S[s++]=S[m++],S[s++]=S[m++],S[s++]=S[m++],L-=3;while(L>2);L&&(S[s++]=S[m++],L>1&&(S[s++]=S[m++]))}break}if(64&M){i.msg="invalid distance code",P.mode=Mh;break e}T=C[(65535&T)+(u&(1<<M)-1)]}}break}}while(t<n&&s<o);L=f>>3,t-=L,f-=L<<3,u&=(1<<f)-1,i.next_in=t,i.next_out=s,i.avail_in=t<n?n-t+5:5-(t-n),i.avail_out=s<o?o-s+257:257-(s-o),P.hold=u,P.bits=f},Ph=15,z3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),F3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Y3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ho=(i,e,t,n,s,r,o,a)=>{let l=a.bits,h,c,d,u,f,g,C=0,p=0,k=0,T=0,M=0,L=0,b=0,m=0,w=0,v=0,S=null,P=new Uint16Array(16),Z=new Uint16Array(16),E,D,A,O=null;for(C=0;C<=Ph;C++)P[C]=0;for(p=0;p<n;p++)P[e[t+p]]++;for(M=l,T=Ph;T>=1&&P[T]===0;T--);if(M>T&&(M=T),T===0)return s[r++]=20971520,s[r++]=20971520,a.bits=1,0;for(k=1;k<T&&P[k]===0;k++);for(M<k&&(M=k),m=1,C=1;C<=Ph;C++)if(m<<=1,m-=P[C],m<0)return-1;if(m>0&&(i===0||T!==1))return-1;for(Z[1]=0,C=1;C<Ph;C++)Z[C+1]=Z[C]+P[C];for(p=0;p<n;p++)e[t+p]!==0&&(o[Z[e[t+p]]++]=p);if(i===0?(S=O=o,g=20):i===1?(S=z3,O=F3,g=257):(S=K3,O=Y3,g=0),v=0,p=0,C=k,f=r,L=M,b=0,d=-1,w=1<<M,u=w-1,i===1&&w>852||i===2&&w>592)return 1;for(;;){E=C-b,o[p]+1<g?(D=0,A=o[p]):o[p]>=g?(D=O[o[p]-g],A=S[o[p]-g]):(D=96,A=0),h=1<<C-b,c=1<<L,k=c;do c-=h,s[f+(v>>b)+c]=E<<24|D<<16|A;while(c!==0);for(h=1<<C-1;v&h;)h>>=1;if(h!==0?(v&=h-1,v+=h):v=0,p++,--P[C]==0){if(C===T)break;C=e[t+o[p]]}if(C>M&&(v&u)!==d){for(b===0&&(b=M),f+=k,L=C-b,m=1<<L;L+b<T&&(m-=P[L+b],!(m<=0));)L++,m<<=1;if(w+=1<<L,i===1&&w>852||i===2&&w>592)return 1;d=v&u,s[d]=M<<24|L<<16|f-r}}return v!==0&&(s[f+v]=C-b<<24|64<<16),a.bits=M,0},{Z_FINISH:_v,Z_BLOCK:B3,Z_TREES:Rh,Z_OK:ts,Z_STREAM_END:j3,Z_NEED_DICT:U3,Z_STREAM_ERROR:Gt,Z_DATA_ERROR:Kx,Z_MEM_ERROR:Yx,Z_BUF_ERROR:J3,Z_DEFLATED:Iv}=na,sc=16180,Kh=16190,Xi=16191,Jf=16192,Qf=16194,Zh=16199,Eh=16200,$f=16206,we=16209,Gv=i=>(i>>>24&255)+(i>>>8&65280)+((65280&i)<<8)+((255&i)<<24);function Q3(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var is=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.mode<sc||e.mode>16211?1:0},Bx=i=>{if(is(i))return Gt;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=1&e.wrap),e.mode=sc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,ts},jx=i=>{if(is(i))return Gt;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,Bx(i)},Ux=(i,e)=>{let t;if(is(i))return Gt;let n=i.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Gt:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,jx(i))},Wv=(i,e)=>{if(!i)return Gt;let t=new Q3;i.state=t,t.strm=i,t.window=null,t.mode=sc;let n=Ux(i,e);return n!==ts&&(i.state=null),n},qf,ep,Dv=!0,$3=i=>{if(Dv){qf=new Int32Array(512),ep=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(Ho(1,i.lens,0,288,qf,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;Ho(2,i.lens,0,32,ep,0,i.work,{bits:5}),Dv=!1}i.lencode=qf,i.lenbits=9,i.distcode=ep,i.distbits=5},Jx=(i,e,t,n)=>{let s,r=i.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(e.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(e.subarray(t-n,t-n+s),r.wnext),(n-=s)?(r.window.set(e.subarray(t-n,t),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0},q3=(i,e)=>{let t,n,s,r,o,a,l,h,c,d,u,f,g,C,p,k,T,M,L,b,m,w,v=0,S=new Uint8Array(4),P,Z,E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(is(i)||!i.output||!i.input&&i.avail_in!==0)return Gt;t=i.state,t.mode===Xi&&(t.mode=Jf),o=i.next_out,s=i.output,l=i.avail_out,r=i.next_in,n=i.input,a=i.avail_in,h=t.hold,c=t.bits,d=a,u=l,w=ts;e:for(;;)switch(t.mode){case sc:if(t.wrap===0){t.mode=Jf;break}for(;c<16;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(2&t.wrap&&h===35615){t.wbits===0&&(t.wbits=15),t.check=0,S[0]=255&h,S[1]=h>>>8&255,t.check=Ge(t.check,S,2,0),h=0,c=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&h)<<8)+(h>>8))%31){i.msg="incorrect header check",t.mode=we;break}if((15&h)!==Iv){i.msg="unknown compression method",t.mode=we;break}if(h>>>=4,c-=4,m=8+(15&h),t.wbits===0&&(t.wbits=m),m>15||m>t.wbits){i.msg="invalid window size",t.mode=we;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=512&h?16189:Xi,h=0,c=0;break;case 16181:for(;c<16;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(t.flags=h,(255&t.flags)!==Iv){i.msg="unknown compression method",t.mode=we;break}if(57344&t.flags){i.msg="unknown header flags set",t.mode=we;break}t.head&&(t.head.text=h>>8&1),512&t.flags&&4&t.wrap&&(S[0]=255&h,S[1]=h>>>8&255,t.check=Ge(t.check,S,2,0)),h=0,c=0,t.mode=16182;case 16182:for(;c<32;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.head&&(t.head.time=h),512&t.flags&&4&t.wrap&&(S[0]=255&h,S[1]=h>>>8&255,S[2]=h>>>16&255,S[3]=h>>>24&255,t.check=Ge(t.check,S,4,0)),h=0,c=0,t.mode=16183;case 16183:for(;c<16;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.head&&(t.head.xflags=255&h,t.head.os=h>>8),512&t.flags&&4&t.wrap&&(S[0]=255&h,S[1]=h>>>8&255,t.check=Ge(t.check,S,2,0)),h=0,c=0,t.mode=16184;case 16184:if(1024&t.flags){for(;c<16;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.length=h,t.head&&(t.head.extra_len=h),512&t.flags&&4&t.wrap&&(S[0]=255&h,S[1]=h>>>8&255,t.check=Ge(t.check,S,2,0)),h=0,c=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&t.flags&&(f=t.length,f>a&&(f=a),f&&(t.head&&(m=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(r,r+f),m)),512&t.flags&&4&t.wrap&&(t.check=Ge(t.check,n,f,r)),a-=f,r+=f,t.length-=f),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&t.flags){if(a===0)break e;f=0;do m=n[r+f++],t.head&&m&&t.length<65536&&(t.head.name+=String.fromCharCode(m));while(m&&f<a);if(512&t.flags&&4&t.wrap&&(t.check=Ge(t.check,n,f,r)),a-=f,r+=f,m)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&t.flags){if(a===0)break e;f=0;do m=n[r+f++],t.head&&m&&t.length<65536&&(t.head.comment+=String.fromCharCode(m));while(m&&f<a);if(512&t.flags&&4&t.wrap&&(t.check=Ge(t.check,n,f,r)),a-=f,r+=f,m)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&t.flags){for(;c<16;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(4&t.wrap&&h!==(65535&t.check)){i.msg="header crc mismatch",t.mode=we;break}h=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=Xi;break;case 16189:for(;c<32;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}i.adler=t.check=Gv(h),h=0,c=0,t.mode=Kh;case Kh:if(t.havedict===0)return i.next_out=o,i.avail_out=l,i.next_in=r,i.avail_in=a,t.hold=h,t.bits=c,U3;i.adler=t.check=1,t.mode=Xi;case Xi:if(e===B3||e===Rh)break e;case Jf:if(t.last){h>>>=7&c,c-=7&c,t.mode=$f;break}for(;c<3;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}switch(t.last=1&h,h>>>=1,c-=1,3&h){case 0:t.mode=16193;break;case 1:if($3(t),t.mode=Zh,e===Rh){h>>>=2,c-=2;break e}break;case 2:t.mode=16196;break;case 3:i.msg="invalid block type",t.mode=we}h>>>=2,c-=2;break;case 16193:for(h>>>=7&c,c-=7&c;c<32;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){i.msg="invalid stored block lengths",t.mode=we;break}if(t.length=65535&h,h=0,c=0,t.mode=Qf,e===Rh)break e;case Qf:t.mode=16195;case 16195:if(f=t.length,f){if(f>a&&(f=a),f>l&&(f=l),f===0)break e;s.set(n.subarray(r,r+f),o),a-=f,r+=f,l-=f,o+=f,t.length-=f;break}t.mode=Xi;break;case 16196:for(;c<14;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(t.nlen=257+(31&h),h>>>=5,c-=5,t.ndist=1+(31&h),h>>>=5,c-=5,t.ncode=4+(15&h),h>>>=4,c-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=we;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;c<3;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.lens[E[t.have++]]=7&h,h>>>=3,c-=3}for(;t.have<19;)t.lens[E[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,P={bits:t.lenbits},w=Ho(0,t.lens,0,19,t.lencode,0,t.work,P),t.lenbits=P.bits,w){i.msg="invalid code lengths set",t.mode=we;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;v=t.lencode[h&(1<<t.lenbits)-1],p=v>>>24,k=v>>>16&255,T=65535&v,!(p<=c);){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(T<16)h>>>=p,c-=p,t.lens[t.have++]=T;else{if(T===16){for(Z=p+2;c<Z;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(h>>>=p,c-=p,t.have===0){i.msg="invalid bit length repeat",t.mode=we;break}m=t.lens[t.have-1],f=3+(3&h),h>>>=2,c-=2}else if(T===17){for(Z=p+3;c<Z;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}h>>>=p,c-=p,m=0,f=3+(7&h),h>>>=3,c-=3}else{for(Z=p+7;c<Z;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}h>>>=p,c-=p,m=0,f=11+(127&h),h>>>=7,c-=7}if(t.have+f>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=we;break}for(;f--;)t.lens[t.have++]=m}}if(t.mode===we)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=we;break}if(t.lenbits=9,P={bits:t.lenbits},w=Ho(1,t.lens,0,t.nlen,t.lencode,0,t.work,P),t.lenbits=P.bits,w){i.msg="invalid literal/lengths set",t.mode=we;break}if(t.distbits=6,t.distcode=t.distdyn,P={bits:t.distbits},w=Ho(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,P),t.distbits=P.bits,w){i.msg="invalid distances set",t.mode=we;break}if(t.mode=Zh,e===Rh)break e;case Zh:t.mode=Eh;case Eh:if(a>=6&&l>=258){i.next_out=o,i.avail_out=l,i.next_in=r,i.avail_in=a,t.hold=h,t.bits=c,V3(i,u),o=i.next_out,s=i.output,l=i.avail_out,r=i.next_in,n=i.input,a=i.avail_in,h=t.hold,c=t.bits,t.mode===Xi&&(t.back=-1);break}for(t.back=0;v=t.lencode[h&(1<<t.lenbits)-1],p=v>>>24,k=v>>>16&255,T=65535&v,!(p<=c);){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(k&&!(240&k)){for(M=p,L=k,b=T;v=t.lencode[b+((h&(1<<M+L)-1)>>M)],p=v>>>24,k=v>>>16&255,T=65535&v,!(M+p<=c);){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}h>>>=M,c-=M,t.back+=M}if(h>>>=p,c-=p,t.back+=p,t.length=T,k===0){t.mode=16205;break}if(32&k){t.back=-1,t.mode=Xi;break}if(64&k){i.msg="invalid literal/length code",t.mode=we;break}t.extra=15&k,t.mode=16201;case 16201:if(t.extra){for(Z=t.extra;c<Z;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.length+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;v=t.distcode[h&(1<<t.distbits)-1],p=v>>>24,k=v>>>16&255,T=65535&v,!(p<=c);){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(!(240&k)){for(M=p,L=k,b=T;v=t.distcode[b+((h&(1<<M+L)-1)>>M)],p=v>>>24,k=v>>>16&255,T=65535&v,!(M+p<=c);){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}h>>>=M,c-=M,t.back+=M}if(h>>>=p,c-=p,t.back+=p,64&k){i.msg="invalid distance code",t.mode=we;break}t.offset=T,t.extra=15&k,t.mode=16203;case 16203:if(t.extra){for(Z=t.extra;c<Z;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}t.offset+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=we;break}t.mode=16204;case 16204:if(l===0)break e;if(f=u-l,t.offset>f){if(f=t.offset-f,f>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=we;break}f>t.wnext?(f-=t.wnext,g=t.wsize-f):g=t.wnext-f,f>t.length&&(f=t.length),C=t.window}else C=s,g=o-t.offset,f=t.length;f>l&&(f=l),l-=f,t.length-=f;do s[o++]=C[g++];while(--f);t.length===0&&(t.mode=Eh);break;case 16205:if(l===0)break e;s[o++]=t.length,l--,t.mode=Eh;break;case $f:if(t.wrap){for(;c<32;){if(a===0)break e;a--,h|=n[r++]<<c,c+=8}if(u-=l,i.total_out+=u,t.total+=u,4&t.wrap&&u&&(i.adler=t.check=t.flags?Ge(t.check,s,u,o-u):qo(t.check,s,u,o-u)),u=l,4&t.wrap&&(t.flags?h:Gv(h))!==t.check){i.msg="incorrect data check",t.mode=we;break}h=0,c=0}t.mode=16207;case 16207:if(t.wrap&&t.flags){for(;c<32;){if(a===0)break e;a--,h+=n[r++]<<c,c+=8}if(4&t.wrap&&h!==(4294967295&t.total)){i.msg="incorrect length check",t.mode=we;break}h=0,c=0}t.mode=16208;case 16208:w=j3;break e;case we:w=Kx;break e;case 16210:return Yx;default:return Gt}return i.next_out=o,i.avail_out=l,i.next_in=r,i.avail_in=a,t.hold=h,t.bits=c,(t.wsize||u!==i.avail_out&&t.mode<we&&(t.mode<$f||e!==_v))&&Jx(i,i.output,i.next_out,u-i.avail_out),d-=i.avail_in,u-=i.avail_out,i.total_in+=d,i.total_out+=u,t.total+=u,4&t.wrap&&u&&(i.adler=t.check=t.flags?Ge(t.check,s,u,i.next_out-u):qo(t.check,s,u,i.next_out-u)),i.data_type=t.bits+(t.last?64:0)+(t.mode===Xi?128:0)+(t.mode===Zh||t.mode===Qf?256:0),(d===0&&u===0||e===_v)&&w===ts&&(w=J3),w},Hi={inflateReset:jx,inflateReset2:Ux,inflateResetKeep:Bx,inflateInit:i=>Wv(i,15),inflateInit2:Wv,inflate:q3,inflateEnd:i=>{if(is(i))return Gt;let e=i.state;return e.window&&(e.window=null),i.state=null,ts},inflateGetHeader:(i,e)=>{if(is(i))return Gt;let t=i.state;return 2&t.wrap?(t.head=e,e.done=!1,ts):Gt},inflateSetDictionary:(i,e)=>{let t=e.length,n,s,r;return is(i)?Gt:(n=i.state,n.wrap!==0&&n.mode!==Kh?Gt:n.mode===Kh&&(s=1,s=qo(s,e,t,0),s!==n.check)?Kx:(r=Jx(i,e,t,t),r?(n.mode=16210,Yx):(n.havedict=1,ts)))},inflateInfo:"pako inflate (from Nodeca project)"},eP=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Qx=Object.prototype.toString,{Z_NO_FLUSH:tP,Z_FINISH:iP,Z_OK:Oo,Z_STREAM_END:tp,Z_NEED_DICT:ip,Z_STREAM_ERROR:nP,Z_DATA_ERROR:Nv,Z_MEM_ERROR:sP}=na;function Vo(i){this.options=Hx({chunkSize:65536,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||i&&i.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zx,this.strm.avail_out=0;let t=Hi.inflateInit2(this.strm,e.windowBits);if(t!==Oo)throw new Error(ns[t]);if(this.header=new eP,Hi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Yp(e.dictionary):Qx.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Hi.inflateSetDictionary(this.strm,e.dictionary),t!==Oo)))throw new Error(ns[t])}function np(i,e){let t=new Vo(e);if(t.push(i),t.err)throw t.msg||ns[t.err];return t.result}Vo.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,s=this.options.dictionary,r,o,a;if(this.ended)return!1;for(o=e===~~e?e:e===!0?iP:tP,Qx.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),r=Hi.inflate(t,o),r===ip&&s&&(r=Hi.inflateSetDictionary(t,s),r===Oo?r=Hi.inflate(t,o):r===Nv&&(r=ip));t.avail_in>0&&r===tp&&t.state.wrap>0&&i[t.next_in]!==0;)Hi.inflateReset(t),r=Hi.inflate(t,o);switch(r){case nP:case Nv:case ip:case sP:return this.onEnd(r),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||r===tp))if(this.options.to==="string"){let l=X3(t.output,t.next_out),h=t.next_out-l,c=E3(t.output,l);t.next_out=h,t.avail_out=n-h,h&&t.output.set(t.output.subarray(l,l+h),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(r!==Oo||a!==0){if(r===tp)return r=Hi.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Vo.prototype.onData=function(i){this.chunks.push(i)},Vo.prototype.onEnd=function(i){i===Oo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ox(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};var rP={Inflate:Vo,inflate:np,inflateRaw:function(i,e){return(e=e||{}).raw=!0,np(i,e)},ungzip:np},{Deflate:oP,deflate:aP,deflateRaw:lP,gzip:hP}=O3,{Inflate:cP,inflate:dP,inflateRaw:uP,ungzip:fP}=rP,pP={Deflate:oP,deflate:aP,deflateRaw:lP,gzip:hP,Inflate:cP,inflate:dP,inflateRaw:uP,ungzip:fP,constants:na},Lp=class{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout(()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()},50),this.start=Date.now()}send(e){let{id:t,action:n,args:s}=JSON.parse(e);switch(n){case"JOIN":return this.id=t,this.ticks=s.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:s.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[s.user],active:1,total:1}]),void this.tick();case"SEND":{let r=[...s];return r[0]=this.time,r[1]=++this.seq,void this.reply("RECV",r)}case"PULSE":return;default:throw Error("Offline unhandled "+n)}}close(e,t){this.readyState=WebSocket.CLOSING,setTimeout(()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:e,reason:t})},50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval(()=>{this.reply("TICK",{time:this.time})},this.ticks)}reply(e,t){setTimeout(()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:e,args:t})})},50)}},mP=!!globalThis.navigator?.userAgent.toLowerCase().includes("firefox"),ge={get connection(){return ge={connection:K.has("debug","connection",!1)},ge.connection}},Tp=class{static get name(){return`${N.libName}WebRTCConnection`}constructor(e){var t;this.clientId=(t=4,Math.random().toString(36).substring(2,2+t)),ge.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(e)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(e){try{await this.openSignalingChannel(e),ge.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),ge.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),ge.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=s=>this.onDataChannelOpen(s),this.dataChannel.onmessage=s=>this.onDataChannelMessage(s),this.dataChannel.onclosing=s=>this.onDataChannelClosing(s),this.dataChannel.onclose=s=>this.onDataChannelClose(s),this.dataChannel.onerror=s=>this.onDataChannelError(s);let t=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN||(this.negotiationTimeout=setTimeout(()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||(ge.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")},15e3),this.signalToSessionRunner({type:"offer",sdp:t.sdp}),await this.pc.setLocalDescription(t),!this.pc.sctp))return;let n=this.pc.sctp.transport.iceTransport;n.onselectedcandidatepairchange=s=>{ge.connection&&console.log(`${this.clientId} ICE candidate pair changed`);let r=n.getSelectedCandidatePair();this.connectionTypes.local=r.local.type,this.connectionTypes.remote=r.remote.type,this.logConnectionState()}}catch(t){this.synchronizerDisconnected(t.code||4003,t.message)}}openSignalingChannel(e){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise(t=>{this.signaling=new WebSocket(e),this.signaling.onopen=()=>{ge.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=n=>{let s=JSON.parse(n.data);if(s.what==="READY")return this.clientId+=`_${s.id}`,this.iceServers=s.iceServers,void t();if(s.what!=="ERROR")if(s.type)switch(ge.connection&&console.log(`${this.clientId} received signal of type "${s.type}"`),s.type){case"answer":this.handleAnswer(s);break;case"candidate":this.handleCandidate(s);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:ge.connection&&console.log(`${this.clientId} unhandled: ${s.type}`)}else console.error(`${this.clientId} unexpected message: ${n.data}`);else console.error(`${this.clientId} registry error: ${s.reason}`)},this.signaling.onclose=n=>{ge.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${n.code})`),this.synchronizerDisconnected(n.code,n.reason)},this.signaling.onerror=n=>{ge.connection&&console.log(`${this.clientId} signaling socket error`,n),this.synchronizerError()}}))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(e){let t=JSON.stringify(e);try{this.signaling.send(t)}catch(n){console.error(`${this.clientId} WebRTC signaling send error`,n)}}async logConnectionState(){if(mP&&this.pc)try{let n=await this.pc.getStats();if(n){let s=null;for(let o of n.values())if(o.type==="transport"){s=o.selectedCandidatePairId;break}let r=n.get(s);if(!r){for(let o of n.values())if(o.type==="candidate-pair"&&o.selected){r=o;break}}r&&(this.connectionTypes.local=n.get(r.localCandidateId).candidateType,this.connectionTypes.remote=n.get(r.remoteCandidateId).candidateType)}}catch{}let e=this.connectionTypes.local||"",t=this.connectionTypes.remote||"";if(ge.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${e}"; synchronizer connection="${t}")`),this.signaling?.readyState===WebSocket.OPEN){let n={type:"selectedCandidatePair",clientType:e,syncType:t};this.signalToSessionRunner(n)}}close(e,t){this.cleanUpConnection()}synchronizerDisconnected(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1006,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"connection to synchronizer lost";this.synchronizerCloseReason&&(e=this.synchronizerCloseReason[0],t=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:e,reason:t})}synchronizerError(e){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,e)}cleanUpConnection(){this.closeSignalingChannel();let{pc:e}=this;e&&(this.pc=null,e.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){let{iceServers:e}=this,t=new Set,n=this.pc=new globalThis.RTCPeerConnection({iceServers:e});n.onnegotiationneeded=s=>{n===this.pc&&ge.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},n.onsignalingstatechange=s=>{n===this.pc&&ge.connection&&console.log(`${this.clientId} signaling state: "${n.signalingState}"`)},n.onconnectionstatechange=s=>{if(n!==this.pc)return;let{connectionState:r,iceConnectionState:o}=n;ge.connection&&console.log(`${this.clientId} connection state: "${r}" (cf. ICE connection state: "${o}")`),r!=="disconnected"&&r!=="failed"||this.synchronizerDisconnected()},n.oniceconnectionstatechange=s=>{if(n!==this.pc)return;let r=n.iceConnectionState,o=this.dataChannel.readyState;ge.connection&&console.log(`${this.clientId} ICE connection state: "${r}"; data channel: "${o}"`),r==="failed"&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},n.onicegatheringstatechange=s=>{if(n!==this.pc)return;let r=n.iceGatheringState;ge.connection&&console.log(`${this.clientId} ICE gathering state: "${r}"`),r==="complete"&&(this.localGatheringComplete=!0)},n.onicecandidate=s=>{if(n===this.pc)if(s.candidate){if(this.signaling?.readyState===WebSocket.OPEN){let r={type:"candidate",candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex};this.signalToSessionRunner(r)}}else this.localGatheringComplete=!0},n.onicecandidateerror=s=>{if(n===this.pc&&ge.connection){let r=`${s.errorCode}|${s.url}`;t.has(r)||(s.errorCode===701?console.log(`${this.clientId} ICE 701 warning on ${s.url}`):console.log(`${this.clientId} ICE error from ${s.url}: ${s.errorCode} ${s.errorText}`),t.add(r))}}}async handleAnswer(e){this.pc?await this.pc.setRemoteDescription(e):console.error("no peerconnection")}async handleCandidate(e){this.pc?e.candidate?await this.pc.addIceCandidate(e):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(e){this.dataChannel?this.dataChannel.send(e):console.warn(`${this.clientId} no data channel to send: ${e}`)}onDataChannelOpen(e){ge.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(e){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());let t=e.data;if(t.startsWith("!ping"))this.send(t.replace("ping","pong"));else if(t.startsWith("!close")){let n=t.split("|");this.synchronizerCloseReason=[Number(n[1]),n[2]]}else this.onmessage(e)}onDataChannelError(e){console.error(`${this.clientId} RTCDataChannel error`,e),this.synchronizerError(e.errorDetail)}onDataChannelClosing(e){this.pc&&(ge.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(e){this.pc&&(ge.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,ge.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);let{signalingKey:e}=this;setTimeout(()=>{e===this.signalingKey&&(ge.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())},1e3)}async defunct_readConnectionType(){let e=await this.pc.getStats();if(e){let t=null;for(let[s,r]of e)if(r.type==="transport"){t=r.selectedCandidatePairId;break}let n=e.get(t);if(!n){for(let[s,r]of e)if(r.type==="candidate-pair"&&r.selected){n=r;break}}if(n){for(let[s,r]of e)if(s===n.remoteCandidateId)return r.candidateType}}return""}};function gP(i,e,t){var n=function(a){return atob(a)}(i),s=n.indexOf(`
`,10)+1,r=n.substring(s)+"",o=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(o)}function yP(i,e,t){var n;return function(s){return n=n||gP(i),new Worker(n,s)}}var bP=yP("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI1CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjUtMDYtMDkKICogVmVyc2lvbjogMi4wLjQKICovCgohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiBlKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJkZWZhdWx0Iik/dC5kZWZhdWx0OnR9ZnVuY3Rpb24gcih0KXtpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiX19lc01vZHVsZSIpKXJldHVybiB0O3ZhciBlPXQuZGVmYXVsdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSl7dmFyIHI9ZnVuY3Rpb24gdCgpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgdD9SZWZsZWN0LmNvbnN0cnVjdChlLGFyZ3VtZW50cyx0aGlzLmNvbnN0cnVjdG9yKTplLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ci5wcm90b3R5cGU9ZS5wcm90b3R5cGV9ZWxzZSByPXt9O3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LGUpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShyLGUsbi5nZXQ/bjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdFtlXX19KX0pKSxyfXZhciBuLGk9e2V4cG9ydHM6e319O258fChuPTEsZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7dmFyIGUscj1PYmplY3QucHJvdG90eXBlLG49ci5oYXNPd25Qcm9wZXJ0eSxpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eXx8ZnVuY3Rpb24odCxlLHIpe3RbZV09ci52YWx1ZX0sYT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxzPWEuaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixvPWEuYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIsbD1hLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gaCh0LGUscil7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KSx0W2VdfXRyeXtoKHt9LCIiKX1jYXRjaCh0KXtoPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdFtlXT1yfX1mdW5jdGlvbiBjKHQsZSxyLG4pe3ZhciBhPWUmJmUucHJvdG90eXBlIGluc3RhbmNlb2YgeT9lOnkscz1PYmplY3QuY3JlYXRlKGEucHJvdG90eXBlKSxvPW5ldyBMKG58fFtdKTtyZXR1cm4gaShzLCJfaW52b2tlIix7dmFsdWU6RSh0LHIsbyl9KSxzfWZ1bmN0aW9uIHUodCxlLHIpe3RyeXtyZXR1cm57dHlwZToibm9ybWFsIixhcmc6dC5jYWxsKGUscil9fWNhdGNoKHQpe3JldHVybnt0eXBlOiJ0aHJvdyIsYXJnOnR9fX10LndyYXA9Yzt2YXIgXz0ic3VzcGVuZGVkU3RhcnQiLGQ9InN1c3BlbmRlZFlpZWxkIixmPSJleGVjdXRpbmciLHA9ImNvbXBsZXRlZCIsZz17fTtmdW5jdGlvbiB5KCl7fWZ1bmN0aW9uIHcoKXt9ZnVuY3Rpb24gdigpe312YXIgbT17fTtoKG0scywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKTt2YXIgYj1PYmplY3QuZ2V0UHJvdG90eXBlT2YseD1iJiZiKGIoUihbXSkpKTt4JiZ4IT09ciYmbi5jYWxsKHgscykmJihtPXgpO3ZhciBrPXYucHJvdG90eXBlPXkucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobSk7ZnVuY3Rpb24geih0KXtbIm5leHQiLCJ0aHJvdyIsInJldHVybiJdLmZvckVhY2goKGZ1bmN0aW9uKGUpe2godCxlLChmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faW52b2tlKGUsdCl9KSl9KSl9ZnVuY3Rpb24gQSh0LGUpe2Z1bmN0aW9uIHIoaSxhLHMsbyl7dmFyIGw9dSh0W2ldLHQsYSk7aWYoInRocm93IiE9PWwudHlwZSl7dmFyIGg9bC5hcmcsYz1oLnZhbHVlO3JldHVybiBjJiYib2JqZWN0Ij09dHlwZW9mIGMmJm4uY2FsbChjLCJfX2F3YWl0Iik/ZS5yZXNvbHZlKGMuX19hd2FpdCkudGhlbigoZnVuY3Rpb24odCl7cigibmV4dCIsdCxzLG8pfSksKGZ1bmN0aW9uKHQpe3IoInRocm93Iix0LHMsbyl9KSk6ZS5yZXNvbHZlKGMpLnRoZW4oKGZ1bmN0aW9uKHQpe2gudmFsdWU9dCxzKGgpfSksKGZ1bmN0aW9uKHQpe3JldHVybiByKCJ0aHJvdyIsdCxzLG8pfSkpfW8obC5hcmcpfXZhciBhO2kodGhpcywiX2ludm9rZSIse3ZhbHVlOmZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gaSgpe3JldHVybiBuZXcgZSgoZnVuY3Rpb24oZSxpKXtyKHQsbixlLGkpfSkpfXJldHVybiBhPWE/YS50aGVuKGksaSk6aSgpfX0pfWZ1bmN0aW9uIEUodCxyLG4pe3ZhciBpPV87cmV0dXJuIGZ1bmN0aW9uKGEscyl7aWYoaT09PWYpdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYoaT09PXApe2lmKCJ0aHJvdyI9PT1hKXRocm93IHM7cmV0dXJue3ZhbHVlOmUsZG9uZTohMH19Zm9yKG4ubWV0aG9kPWEsbi5hcmc9czs7KXt2YXIgbz1uLmRlbGVnYXRlO2lmKG8pe3ZhciBsPVMobyxuKTtpZihsKXtpZihsPT09Zyljb250aW51ZTtyZXR1cm4gbH19aWYoIm5leHQiPT09bi5tZXRob2Qpbi5zZW50PW4uX3NlbnQ9bi5hcmc7ZWxzZSBpZigidGhyb3ciPT09bi5tZXRob2Qpe2lmKGk9PT1fKXRocm93IGk9cCxuLmFyZztuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKX1lbHNlInJldHVybiI9PT1uLm1ldGhvZCYmbi5hYnJ1cHQoInJldHVybiIsbi5hcmcpO2k9Zjt2YXIgaD11KHQscixuKTtpZigibm9ybWFsIj09PWgudHlwZSl7aWYoaT1uLmRvbmU/cDpkLGguYXJnPT09Zyljb250aW51ZTtyZXR1cm57dmFsdWU6aC5hcmcsZG9uZTpuLmRvbmV9fSJ0aHJvdyI9PT1oLnR5cGUmJihpPXAsbi5tZXRob2Q9InRocm93IixuLmFyZz1oLmFyZyl9fX1mdW5jdGlvbiBTKHQscil7dmFyIG49ci5tZXRob2QsaT10Lml0ZXJhdG9yW25dO2lmKGk9PT1lKXJldHVybiByLmRlbGVnYXRlPW51bGwsInRocm93Ij09PW4mJnQuaXRlcmF0b3IucmV0dXJuJiYoci5tZXRob2Q9InJldHVybiIsci5hcmc9ZSxTKHQsciksInRocm93Ij09PXIubWV0aG9kKXx8InJldHVybiIhPT1uJiYoci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciK24rIicgbWV0aG9kIikpLGc7dmFyIGE9dShpLHQuaXRlcmF0b3Isci5hcmcpO2lmKCJ0aHJvdyI9PT1hLnR5cGUpcmV0dXJuIHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9YS5hcmcsci5kZWxlZ2F0ZT1udWxsLGc7dmFyIHM9YS5hcmc7cmV0dXJuIHM/cy5kb25lPyhyW3QucmVzdWx0TmFtZV09cy52YWx1ZSxyLm5leHQ9dC5uZXh0TG9jLCJyZXR1cm4iIT09ci5tZXRob2QmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksci5kZWxlZ2F0ZT1udWxsLGcpOnM6KHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9bmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSxyLmRlbGVnYXRlPW51bGwsZyl9ZnVuY3Rpb24gQih0KXt2YXIgZT17dHJ5TG9jOnRbMF19OzEgaW4gdCYmKGUuY2F0Y2hMb2M9dFsxXSksMiBpbiB0JiYoZS5maW5hbGx5TG9jPXRbMl0sZS5hZnRlckxvYz10WzNdKSx0aGlzLnRyeUVudHJpZXMucHVzaChlKX1mdW5jdGlvbiBPKHQpe3ZhciBlPXQuY29tcGxldGlvbnx8e307ZS50eXBlPSJub3JtYWwiLGRlbGV0ZSBlLmFyZyx0LmNvbXBsZXRpb249ZX1mdW5jdGlvbiBMKHQpe3RoaXMudHJ5RW50cmllcz1be3RyeUxvYzoicm9vdCJ9XSx0LmZvckVhY2goQix0aGlzKSx0aGlzLnJlc2V0KCEwKX1mdW5jdGlvbiBSKHQpe2lmKG51bGwhPXQpe3ZhciByPXRbc107aWYocilyZXR1cm4gci5jYWxsKHQpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB0Lm5leHQpcmV0dXJuIHQ7aWYoIWlzTmFOKHQubGVuZ3RoKSl7dmFyIGk9LTEsYT1mdW5jdGlvbiByKCl7Zm9yKDsrK2k8dC5sZW5ndGg7KWlmKG4uY2FsbCh0LGkpKXJldHVybiByLnZhbHVlPXRbaV0sci5kb25lPSExLHI7cmV0dXJuIHIudmFsdWU9ZSxyLmRvbmU9ITAscn07cmV0dXJuIGEubmV4dD1hfX10aHJvdyBuZXcgVHlwZUVycm9yKHR5cGVvZiB0KyIgaXMgbm90IGl0ZXJhYmxlIil9cmV0dXJuIHcucHJvdG90eXBlPXYsaShrLCJjb25zdHJ1Y3RvciIse3ZhbHVlOnYsY29uZmlndXJhYmxlOiEwfSksaSh2LCJjb25zdHJ1Y3RvciIse3ZhbHVlOncsY29uZmlndXJhYmxlOiEwfSksdy5kaXNwbGF5TmFtZT1oKHYsbCwiR2VuZXJhdG9yRnVuY3Rpb24iKSx0LmlzR2VuZXJhdG9yRnVuY3Rpb249ZnVuY3Rpb24odCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQuY29uc3RydWN0b3I7cmV0dXJuISFlJiYoZT09PXd8fCJHZW5lcmF0b3JGdW5jdGlvbiI9PT0oZS5kaXNwbGF5TmFtZXx8ZS5uYW1lKSl9LHQubWFyaz1mdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LHYpOih0Ll9fcHJvdG9fXz12LGgodCxsLCJHZW5lcmF0b3JGdW5jdGlvbiIpKSx0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGspLHR9LHQuYXdyYXA9ZnVuY3Rpb24odCl7cmV0dXJue19fYXdhaXQ6dH19LHooQS5wcm90b3R5cGUpLGgoQS5wcm90b3R5cGUsbywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSx0LkFzeW5jSXRlcmF0b3I9QSx0LmFzeW5jPWZ1bmN0aW9uKGUscixuLGksYSl7dm9pZCAwPT09YSYmKGE9UHJvbWlzZSk7dmFyIHM9bmV3IEEoYyhlLHIsbixpKSxhKTtyZXR1cm4gdC5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpP3M6cy5uZXh0KCkudGhlbigoZnVuY3Rpb24odCl7cmV0dXJuIHQuZG9uZT90LnZhbHVlOnMubmV4dCgpfSkpfSx6KGspLGgoayxsLCJHZW5lcmF0b3IiKSxoKGsscywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSxoKGssInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4iW29iamVjdCBHZW5lcmF0b3JdIn0pKSx0LmtleXM9ZnVuY3Rpb24odCl7dmFyIGU9T2JqZWN0KHQpLHI9W107Zm9yKHZhciBuIGluIGUpci5wdXNoKG4pO3JldHVybiByLnJldmVyc2UoKSxmdW5jdGlvbiB0KCl7Zm9yKDtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7aWYobiBpbiBlKXJldHVybiB0LnZhbHVlPW4sdC5kb25lPSExLHR9cmV0dXJuIHQuZG9uZT0hMCx0fX0sdC52YWx1ZXM9UixMLnByb3RvdHlwZT17Y29uc3RydWN0b3I6TCxyZXNldDpmdW5jdGlvbih0KXtpZih0aGlzLnByZXY9MCx0aGlzLm5leHQ9MCx0aGlzLnNlbnQ9dGhpcy5fc2VudD1lLHRoaXMuZG9uZT0hMSx0aGlzLmRlbGVnYXRlPW51bGwsdGhpcy5tZXRob2Q9Im5leHQiLHRoaXMuYXJnPWUsdGhpcy50cnlFbnRyaWVzLmZvckVhY2goTyksIXQpZm9yKHZhciByIGluIHRoaXMpInQiPT09ci5jaGFyQXQoMCkmJm4uY2FsbCh0aGlzLHIpJiYhaXNOYU4oK3Iuc2xpY2UoMSkpJiYodGhpc1tyXT1lKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuZG9uZT0hMDt2YXIgdD10aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZigidGhyb3ciPT09dC50eXBlKXRocm93IHQuYXJnO3JldHVybiB0aGlzLnJ2YWx9LGRpc3BhdGNoRXhjZXB0aW9uOmZ1bmN0aW9uKHQpe2lmKHRoaXMuZG9uZSl0aHJvdyB0O3ZhciByPXRoaXM7ZnVuY3Rpb24gaShuLGkpe3JldHVybiBvLnR5cGU9InRocm93IixvLmFyZz10LHIubmV4dD1uLGkmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksISFpfWZvcih2YXIgYT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7YT49MDstLWEpe3ZhciBzPXRoaXMudHJ5RW50cmllc1thXSxvPXMuY29tcGxldGlvbjtpZigicm9vdCI9PT1zLnRyeUxvYylyZXR1cm4gaSgiZW5kIik7aWYocy50cnlMb2M8PXRoaXMucHJldil7dmFyIGw9bi5jYWxsKHMsImNhdGNoTG9jIiksaD1uLmNhbGwocywiZmluYWxseUxvYyIpO2lmKGwmJmgpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX1lbHNlIGlmKGwpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApfWVsc2V7aWYoIWgpdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX19fX0sYWJydXB0OmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtyPj0wOy0tcil7dmFyIGk9dGhpcy50cnlFbnRyaWVzW3JdO2lmKGkudHJ5TG9jPD10aGlzLnByZXYmJm4uY2FsbChpLCJmaW5hbGx5TG9jIikmJnRoaXMucHJldjxpLmZpbmFsbHlMb2Mpe3ZhciBhPWk7YnJlYWt9fWEmJigiYnJlYWsiPT09dHx8ImNvbnRpbnVlIj09PXQpJiZhLnRyeUxvYzw9ZSYmZTw9YS5maW5hbGx5TG9jJiYoYT1udWxsKTt2YXIgcz1hP2EuY29tcGxldGlvbjp7fTtyZXR1cm4gcy50eXBlPXQscy5hcmc9ZSxhPyh0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5uZXh0PWEuZmluYWxseUxvYyxnKTp0aGlzLmNvbXBsZXRlKHMpfSxjb21wbGV0ZTpmdW5jdGlvbih0LGUpe2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuImJyZWFrIj09PXQudHlwZXx8ImNvbnRpbnVlIj09PXQudHlwZT90aGlzLm5leHQ9dC5hcmc6InJldHVybiI9PT10LnR5cGU/KHRoaXMucnZhbD10aGlzLmFyZz10LmFyZyx0aGlzLm1ldGhvZD0icmV0dXJuIix0aGlzLm5leHQ9ImVuZCIpOiJub3JtYWwiPT09dC50eXBlJiZlJiYodGhpcy5uZXh0PWUpLGd9LGZpbmlzaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci5maW5hbGx5TG9jPT09dClyZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sci5hZnRlckxvYyksTyhyKSxnfX0sY2F0Y2g6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtlPj0wOy0tZSl7dmFyIHI9dGhpcy50cnlFbnRyaWVzW2VdO2lmKHIudHJ5TG9jPT09dCl7dmFyIG49ci5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT1uLnR5cGUpe3ZhciBpPW4uYXJnO08ocil9cmV0dXJuIGl9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iil9LGRlbGVnYXRlWWllbGQ6ZnVuY3Rpb24odCxyLG4pe3JldHVybiB0aGlzLmRlbGVnYXRlPXtpdGVyYXRvcjpSKHQpLHJlc3VsdE5hbWU6cixuZXh0TG9jOm59LCJuZXh0Ij09PXRoaXMubWV0aG9kJiYodGhpcy5hcmc9ZSksZ319LHR9KHQuZXhwb3J0cyk7dHJ5e2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWV9Y2F0Y2godCl7Im9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWU6RnVuY3Rpb24oInIiLCJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikoZSl9fShpKSk7dmFyIGEscz17ZXhwb3J0czp7fX07dmFyIG89KGF8fChhPTEsZnVuY3Rpb24odCl7Y29uc3QgZT00LHI9MCxuPTEsaT0yO2Z1bmN0aW9uIGEodCl7bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH1jb25zdCBzPTAsbz0xLGw9MixoPTMsYz0yNTgsdT0yOSxfPTI1NixkPV8rMSt1LGY9MzAscD0xOSxnPTIqZCsxLHk9MTUsdz0xNix2PTcsbT0yNTYsYj0xNix4PTE3LGs9MTgsej1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSksQT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxLDEsMiwyLDMsMyw0LDQsNSw1LDYsNiw3LDcsOCw4LDksOSwxMCwxMCwxMSwxMSwxMiwxMiwxMywxM10pLEU9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMiwzLDddKSxTPW5ldyBVaW50OEFycmF5KFsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSksQj01MTIsTz1uZXcgQXJyYXkoMiooZCsyKSk7YShPKTtjb25zdCBMPW5ldyBBcnJheSgyKmYpO2EoTCk7Y29uc3QgUj1uZXcgQXJyYXkoQik7YShSKTtjb25zdCBEPW5ldyBBcnJheShjLWgrMSk7YShEKTtjb25zdCBVPW5ldyBBcnJheSh1KTthKFUpO2NvbnN0IEM9bmV3IEFycmF5KGYpO2Z1bmN0aW9uIFQodCxlLHIsbixpKXt0aGlzLnN0YXRpY190cmVlPXQsdGhpcy5leHRyYV9iaXRzPWUsdGhpcy5leHRyYV9iYXNlPXIsdGhpcy5lbGVtcz1uLHRoaXMubWF4X2xlbmd0aD1pLHRoaXMuaGFzX3N0cmVlPXQmJnQubGVuZ3RofWxldCBGLEgsWjtmdW5jdGlvbiBNKHQsZSl7dGhpcy5keW5fdHJlZT10LHRoaXMubWF4X2NvZGU9MCx0aGlzLnN0YXRfZGVzYz1lfWEoQyk7Y29uc3QgTj10PT50PDI1Nj9SW3RdOlJbMjU2Kyh0Pj4+NyldLEk9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTV9LGo9KHQsZSxyKT0+e3QuYmlfdmFsaWQ+dy1yPyh0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSxJKHQsdC5iaV9idWYpLHQuYmlfYnVmPWU+PnctdC5iaV92YWxpZCx0LmJpX3ZhbGlkKz1yLXcpOih0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSx0LmJpX3ZhbGlkKz1yKX0sUD0odCxlLHIpPT57aih0LHJbMiplXSxyWzIqZSsxXSl9LCQ9KHQsZSk9PntsZXQgcj0wO2Rve3J8PTEmdCx0Pj4+PTEscjw8PTF9d2hpbGUoLS1lPjApO3JldHVybiByPj4+MX0sSz10PT57MTY9PT10LmJpX3ZhbGlkPyhJKHQsdC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wKTp0LmJpX3ZhbGlkPj04JiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JnQuYmlfYnVmLHQuYmlfYnVmPj49OCx0LmJpX3ZhbGlkLT04KX0sWD0odCxlKT0+e2NvbnN0IHI9ZS5keW5fdHJlZSxuPWUubWF4X2NvZGUsaT1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxhPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxzPWUuc3RhdF9kZXNjLmV4dHJhX2JpdHMsbz1lLnN0YXRfZGVzYy5leHRyYV9iYXNlLGw9ZS5zdGF0X2Rlc2MubWF4X2xlbmd0aDtsZXQgaCxjLHUsXyxkLGYscD0wO2ZvcihfPTA7Xzw9eTtfKyspdC5ibF9jb3VudFtfXT0wO2ZvcihyWzIqdC5oZWFwW3QuaGVhcF9tYXhdKzFdPTAsaD10LmhlYXBfbWF4KzE7aDxnO2grKyljPXQuaGVhcFtoXSxfPXJbMipyWzIqYysxXSsxXSsxLF8+bCYmKF89bCxwKyspLHJbMipjKzFdPV8sYz5ufHwodC5ibF9jb3VudFtfXSsrLGQ9MCxjPj1vJiYoZD1zW2Mtb10pLGY9clsyKmNdLHQub3B0X2xlbis9ZiooXytkKSxhJiYodC5zdGF0aWNfbGVuKz1mKihpWzIqYysxXStkKSkpO2lmKDAhPT1wKXtkb3tmb3IoXz1sLTE7MD09PXQuYmxfY291bnRbX107KV8tLTt0LmJsX2NvdW50W19dLS0sdC5ibF9jb3VudFtfKzFdKz0yLHQuYmxfY291bnRbbF0tLSxwLT0yfXdoaWxlKHA+MCk7Zm9yKF89bDswIT09XztfLS0pZm9yKGM9dC5ibF9jb3VudFtfXTswIT09YzspdT10LmhlYXBbLS1oXSx1Pm58fChyWzIqdSsxXSE9PV8mJih0Lm9wdF9sZW4rPShfLXJbMip1KzFdKSpyWzIqdV0sclsyKnUrMV09XyksYy0tKX19LEc9KHQsZSxyKT0+e2NvbnN0IG49bmV3IEFycmF5KHkrMSk7bGV0IGksYSxzPTA7Zm9yKGk9MTtpPD15O2krKylzPXMrcltpLTFdPDwxLG5baV09cztmb3IoYT0wO2E8PWU7YSsrKXtsZXQgZT10WzIqYSsxXTswIT09ZSYmKHRbMiphXT0kKG5bZV0rKyxlKSl9fSxXPSgpPT57bGV0IHQsZSxyLG4saTtjb25zdCBhPW5ldyBBcnJheSh5KzEpO2ZvcihyPTAsbj0wO248dS0xO24rKylmb3IoVVtuXT1yLHQ9MDt0PDE8PHpbbl07dCsrKURbcisrXT1uO2ZvcihEW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihDW25dPWksdD0wO3Q8MTw8QVtuXTt0KyspUltpKytdPW47Zm9yKGk+Pj03O248ZjtuKyspZm9yKENbbl09aTw8Nyx0PTA7dDwxPDxBW25dLTc7dCsrKVJbMjU2K2krK109bjtmb3IoZT0wO2U8PXk7ZSsrKWFbZV09MDtmb3IodD0wO3Q8PTE0MzspT1syKnQrMV09OCx0KyssYVs4XSsrO2Zvcig7dDw9MjU1OylPWzIqdCsxXT05LHQrKyxhWzldKys7Zm9yKDt0PD0yNzk7KU9bMip0KzFdPTcsdCsrLGFbN10rKztmb3IoO3Q8PTI4NzspT1syKnQrMV09OCx0KyssYVs4XSsrO2ZvcihHKE8sZCsxLGEpLHQ9MDt0PGY7dCsrKUxbMip0KzFdPTUsTFsyKnRdPSQodCw1KTtGPW5ldyBUKE8seixfKzEsZCx5KSxIPW5ldyBUKEwsQSwwLGYseSksWj1uZXcgVChuZXcgQXJyYXkoMCksRSwwLHAsdil9LFk9dD0+e2xldCBlO2ZvcihlPTA7ZTxkO2UrKyl0LmR5bl9sdHJlZVsyKmVdPTA7Zm9yKGU9MDtlPGY7ZSsrKXQuZHluX2R0cmVlWzIqZV09MDtmb3IoZT0wO2U8cDtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVsyKm1dPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQuc3ltX25leHQ9dC5tYXRjaGVzPTB9LHE9dD0+e3QuYmlfdmFsaWQ+OD9JKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH0sVj0odCxlLHIsbik9Pntjb25zdCBpPTIqZSxhPTIqcjtyZXR1cm4gdFtpXTx0W2FdfHx0W2ldPT09dFthXSYmbltlXTw9bltyXX0sUT0odCxlLHIpPT57Y29uc3Qgbj10LmhlYXBbcl07bGV0IGk9cjw8MTtmb3IoO2k8PXQuaGVhcF9sZW4mJihpPHQuaGVhcF9sZW4mJlYoZSx0LmhlYXBbaSsxXSx0LmhlYXBbaV0sdC5kZXB0aCkmJmkrKywhVihlLG4sdC5oZWFwW2ldLHQuZGVwdGgpKTspdC5oZWFwW3JdPXQuaGVhcFtpXSxyPWksaTw8PTE7dC5oZWFwW3JdPW59LEo9KHQsZSxyKT0+e2xldCBuLGksYSxzLG89MDtpZigwIT09dC5zeW1fbmV4dClkb3tuPTI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLG4rPSgyNTUmdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrbysrXSk8PDgsaT10LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLDA9PT1uP1AodCxpLGUpOihhPURbaV0sUCh0LGErXysxLGUpLHM9elthXSwwIT09cyYmKGktPVVbYV0saih0LGkscykpLG4tLSxhPU4obiksUCh0LGEscikscz1BW2FdLDAhPT1zJiYobi09Q1thXSxqKHQsbixzKSkpfXdoaWxlKG88dC5zeW1fbmV4dCk7UCh0LG0sZSl9LHR0PSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsaT1lLnN0YXRfZGVzYy5oYXNfc3RyZWUsYT1lLnN0YXRfZGVzYy5lbGVtcztsZXQgcyxvLGwsaD0tMTtmb3IodC5oZWFwX2xlbj0wLHQuaGVhcF9tYXg9ZyxzPTA7czxhO3MrKykwIT09clsyKnNdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT1oPXMsdC5kZXB0aFtzXT0wKTpyWzIqcysxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOylsPXQuaGVhcFsrK3QuaGVhcF9sZW5dPWg8Mj8rK2g6MCxyWzIqbF09MSx0LmRlcHRoW2xdPTAsdC5vcHRfbGVuLS0saSYmKHQuc3RhdGljX2xlbi09blsyKmwrMV0pO2ZvcihlLm1heF9jb2RlPWgscz10LmhlYXBfbGVuPj4xO3M+PTE7cy0tKVEodCxyLHMpO2w9YTtkb3tzPXQuaGVhcFsxXSx0LmhlYXBbMV09dC5oZWFwW3QuaGVhcF9sZW4tLV0sUSh0LHIsMSksbz10LmhlYXBbMV0sdC5oZWFwWy0tdC5oZWFwX21heF09cyx0LmhlYXBbLS10LmhlYXBfbWF4XT1vLHJbMipsXT1yWzIqc10rclsyKm9dLHQuZGVwdGhbbF09KHQuZGVwdGhbc10+PXQuZGVwdGhbb10/dC5kZXB0aFtzXTp0LmRlcHRoW29dKSsxLHJbMipzKzFdPXJbMipvKzFdPWwsdC5oZWFwWzFdPWwrKyxRKHQsciwxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sWCh0LGUpLEcocixoLHQuYmxfY291bnQpfSxldD0odCxlLHIpPT57bGV0IG4saSxhPS0xLHM9ZVsxXSxvPTAsbD03LGg9NDtmb3IoMD09PXMmJihsPTEzOCxoPTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrbzxsJiZpPT09c3x8KG88aD90LmJsX3RyZWVbMippXSs9bzowIT09aT8oaSE9PWEmJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzIqYl0rKyk6bzw9MTA/dC5ibF90cmVlWzIqeF0rKzp0LmJsX3RyZWVbMiprXSsrLG89MCxhPWksMD09PXM/KGw9MTM4LGg9Myk6aT09PXM/KGw9NixoPTMpOihsPTcsaD00KSl9LHJ0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9Myksbj0wO248PXI7bisrKWlmKGk9cyxzPWVbMioobisxKSsxXSwhKCsrbzxsJiZpPT09cykpe2lmKG88aClkb3tQKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tbyk7ZWxzZSAwIT09aT8oaSE9PWEmJihQKHQsaSx0LmJsX3RyZWUpLG8tLSksUCh0LGIsdC5ibF90cmVlKSxqKHQsby0zLDIpKTpvPD0xMD8oUCh0LHgsdC5ibF90cmVlKSxqKHQsby0zLDMpKTooUCh0LGssdC5ibF90cmVlKSxqKHQsby0xMSw3KSk7bz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpfX0sbnQ9dD0+e2xldCBlO2ZvcihldCh0LHQuZHluX2x0cmVlLHQubF9kZXNjLm1heF9jb2RlKSxldCh0LHQuZHluX2R0cmVlLHQuZF9kZXNjLm1heF9jb2RlKSx0dCh0LHQuYmxfZGVzYyksZT1wLTE7ZT49MyYmMD09PXQuYmxfdHJlZVsyKlNbZV0rMV07ZS0tKTtyZXR1cm4gdC5vcHRfbGVuKz0zKihlKzEpKzUrNSs0LGV9LGl0PSh0LGUscixuKT0+e2xldCBpO2ZvcihqKHQsZS0yNTcsNSksaih0LHItMSw1KSxqKHQsbi00LDQpLGk9MDtpPG47aSsrKWoodCx0LmJsX3RyZWVbMipTW2ldKzFdLDMpO3J0KHQsdC5keW5fbHRyZWUsZS0xKSxydCh0LHQuZHluX2R0cmVlLHItMSl9LGF0PXQ9PntsZXQgZSxpPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKyssaT4+Pj0xKWlmKDEmaSYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIHI7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gbjtmb3IoZT0zMjtlPF87ZSsrKWlmKDAhPT10LmR5bl9sdHJlZVsyKmVdKXJldHVybiBuO3JldHVybiByfTtsZXQgc3Q9ITE7Y29uc3Qgb3Q9KHQsZSxyLG4pPT57aih0LChzPDwxKSsobj8xOjApLDMpLHEodCksSSh0LHIpLEkodCx+ciksciYmdC5wZW5kaW5nX2J1Zi5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK3IpLHQucGVuZGluZyksdC5wZW5kaW5nKz1yfSxsdD0odCxyLG4sYSk9PntsZXQgcyxoLGM9MDt0LmxldmVsPjA/KHQuc3RybS5kYXRhX3R5cGU9PT1pJiYodC5zdHJtLmRhdGFfdHlwZT1hdCh0KSksdHQodCx0LmxfZGVzYyksdHQodCx0LmRfZGVzYyksYz1udCh0KSxzPXQub3B0X2xlbiszKzc+Pj4zLGg9dC5zdGF0aWNfbGVuKzMrNz4+PjMsaDw9cyYmKHM9aCkpOnM9aD1uKzUsbis0PD1zJiYtMSE9PXI/b3QodCxyLG4sYSk6dC5zdHJhdGVneT09PWV8fGg9PT1zPyhqKHQsKG88PDEpKyhhPzE6MCksMyksSih0LE8sTCkpOihqKHQsKGw8PDEpKyhhPzE6MCksMyksaXQodCx0LmxfZGVzYy5tYXhfY29kZSsxLHQuZF9kZXNjLm1heF9jb2RlKzEsYysxKSxKKHQsdC5keW5fbHRyZWUsdC5keW5fZHRyZWUpKSxZKHQpLGEmJnEodCl9O3ZhciBodD17X3RyX2luaXQ6dD0+e3N0fHwoVygpLHN0PSEwKSx0LmxfZGVzYz1uZXcgTSh0LmR5bl9sdHJlZSxGKSx0LmRfZGVzYz1uZXcgTSh0LmR5bl9kdHJlZSxIKSx0LmJsX2Rlc2M9bmV3IE0odC5ibF90cmVlLFopLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wLFkodCl9LF90cl9zdG9yZWRfYmxvY2s6b3QsX3RyX2ZsdXNoX2Jsb2NrOmx0LF90cl90YWxseToodCxlLHIpPT4odC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lLHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ZT4+OCx0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPXIsMD09PWU/dC5keW5fbHRyZWVbMipyXSsrOih0Lm1hdGNoZXMrKyxlLS0sdC5keW5fbHRyZWVbMiooRFtyXStfKzEpXSsrLHQuZHluX2R0cmVlWzIqTihlKV0rKyksdC5zeW1fbmV4dD09PXQuc3ltX2VuZCksX3RyX2FsaWduOnQ9PntqKHQsbzw8MSwzKSxQKHQsbSxPKSxLKHQpfX0sY3Q9KHQsZSxyLG4pPT57bGV0IGk9NjU1MzUmdCxhPXQ+Pj4xNiY2NTUzNSxzPTA7Zm9yKDswIT09cjspe3M9cj4yZTM/MmUzOnIsci09cztkb3tpPWkrZVtuKytdfDAsYT1hK2l8MH13aGlsZSgtLXMpO2klPTY1NTIxLGElPTY1NTIxfXJldHVybiBpfGE8PDE2fTtjb25zdCB1dD1uZXcgVWludDMyQXJyYXkoKCgpPT57bGV0IHQsZT1bXTtmb3IodmFyIHI9MDtyPDI1NjtyKyspe3Q9cjtmb3IodmFyIG49MDtuPDg7bisrKXQ9MSZ0PzM5ODgyOTIzODRedD4+PjE6dD4+PjE7ZVtyXT10fXJldHVybiBlfSkoKSk7dmFyIF90PSh0LGUscixuKT0+e2NvbnN0IGk9dXQsYT1uK3I7dF49LTE7Zm9yKGxldCByPW47cjxhO3IrKyl0PXQ+Pj44XmlbMjU1Jih0XmVbcl0pXTtyZXR1cm5+dH0sZHQ9ezI6Im5lZWQgZGljdGlvbmFyeSIsMToic3RyZWFtIGVuZCIsMDoiIiwiLTEiOiJmaWxlIGVycm9yIiwiLTIiOiJzdHJlYW0gZXJyb3IiLCItMyI6ImRhdGEgZXJyb3IiLCItNCI6Imluc3VmZmljaWVudCBtZW1vcnkiLCItNSI6ImJ1ZmZlciBlcnJvciIsIi02IjoiaW5jb21wYXRpYmxlIHZlcnNpb24ifSxmdD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX01FTV9FUlJPUjotNCxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTtjb25zdHtfdHJfaW5pdDpwdCxfdHJfc3RvcmVkX2Jsb2NrOmd0LF90cl9mbHVzaF9ibG9jazp5dCxfdHJfdGFsbHk6d3QsX3RyX2FsaWduOnZ0fT1odCx7Wl9OT19GTFVTSDptdCxaX1BBUlRJQUxfRkxVU0g6YnQsWl9GVUxMX0ZMVVNIOnh0LFpfRklOSVNIOmt0LFpfQkxPQ0s6enQsWl9PSzpBdCxaX1NUUkVBTV9FTkQ6RXQsWl9TVFJFQU1fRVJST1I6U3QsWl9EQVRBX0VSUk9SOkJ0LFpfQlVGX0VSUk9SOk90LFpfREVGQVVMVF9DT01QUkVTU0lPTjpMdCxaX0ZJTFRFUkVEOlJ0LFpfSFVGRk1BTl9PTkxZOkR0LFpfUkxFOlV0LFpfRklYRUQ6Q3QsWl9ERUZBVUxUX1NUUkFURUdZOlR0LFpfVU5LTk9XTjpGdCxaX0RFRkxBVEVEOkh0fT1mdCxadD05LE10PTE1LE50PTgsSXQ9Mjg2LGp0PTMwLFB0PTE5LCR0PTIqSXQrMSxLdD0xNSxYdD0zLEd0PTI1OCxXdD1HdCtYdCsxLFl0PTMyLHF0PTQyLFZ0PTU3LFF0PTY5LEp0PTczLHRlPTkxLGVlPTEwMyxyZT0xMTMsbmU9NjY2LGllPTEsYWU9MixzZT0zLG9lPTQsbGU9MyxoZT0odCxlKT0+KHQubXNnPWR0W2VdLGUpLGNlPXQ9PjIqdC0odD40Pzk6MCksdWU9dD0+e2xldCBlPXQubGVuZ3RoO2Zvcig7LS1lPj0wOyl0W2VdPTB9LF9lPXQ9PntsZXQgZSxyLG4saT10Lndfc2l6ZTtlPXQuaGFzaF9zaXplLG49ZTtkb3tyPXQuaGVhZFstLW5dLHQuaGVhZFtuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSk7ZT1pLG49ZTtkb3tyPXQucHJldlstLW5dLHQucHJldltuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSl9O2xldCBkZT0odCxlLHIpPT4oZTw8dC5oYXNoX3NoaWZ0XnIpJnQuaGFzaF9tYXNrO2NvbnN0IGZlPXQ9Pntjb25zdCBlPXQuc3RhdGU7bGV0IHI9ZS5wZW5kaW5nO3I+dC5hdmFpbF9vdXQmJihyPXQuYXZhaWxfb3V0KSwwIT09ciYmKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsZS5wZW5kaW5nX291dCtyKSx0Lm5leHRfb3V0KSx0Lm5leHRfb3V0Kz1yLGUucGVuZGluZ19vdXQrPXIsdC50b3RhbF9vdXQrPXIsdC5hdmFpbF9vdXQtPXIsZS5wZW5kaW5nLT1yLDA9PT1lLnBlbmRpbmcmJihlLnBlbmRpbmdfb3V0PTApKX0scGU9KHQsZSk9Pnt5dCh0LHQuYmxvY2tfc3RhcnQ+PTA/dC5ibG9ja19zdGFydDotMSx0LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsZSksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0LGZlKHQuc3RybSl9LGdlPSh0LGUpPT57dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX0seWU9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JmV9LHdlPSh0LGUscixuKT0+e2xldCBpPXQuYXZhaWxfaW47cmV0dXJuIGk+biYmKGk9biksMD09PWk/MDoodC5hdmFpbF9pbi09aSxlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbix0Lm5leHRfaW4raSksciksMT09PXQuc3RhdGUud3JhcD90LmFkbGVyPWN0KHQuYWRsZXIsZSxpLHIpOjI9PT10LnN0YXRlLndyYXAmJih0LmFkbGVyPV90KHQuYWRsZXIsZSxpLHIpKSx0Lm5leHRfaW4rPWksdC50b3RhbF9pbis9aSxpKX0sdmU9KHQsZSk9PntsZXQgcixuLGk9dC5tYXhfY2hhaW5fbGVuZ3RoLGE9dC5zdHJzdGFydCxzPXQucHJldl9sZW5ndGgsbz10Lm5pY2VfbWF0Y2g7Y29uc3QgbD10LnN0cnN0YXJ0PnQud19zaXplLVd0P3Quc3Ryc3RhcnQtKHQud19zaXplLVd0KTowLGg9dC53aW5kb3csYz10LndfbWFzayx1PXQucHJldixfPXQuc3Ryc3RhcnQrR3Q7bGV0IGQ9aFthK3MtMV0sZj1oW2Erc107dC5wcmV2X2xlbmd0aD49dC5nb29kX21hdGNoJiYoaT4+PTIpLG8+dC5sb29rYWhlYWQmJihvPXQubG9va2FoZWFkKTtkb3tpZihyPWUsaFtyK3NdPT09ZiYmaFtyK3MtMV09PT1kJiZoW3JdPT09aFthXSYmaFsrK3JdPT09aFthKzFdKXthKz0yLHIrKztkb3t9d2hpbGUoaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmE8Xyk7aWYobj1HdC0oXy1hKSxhPV8tR3Qsbj5zKXtpZih0Lm1hdGNoX3N0YXJ0PWUscz1uLG4+PW8pYnJlYWs7ZD1oW2Ercy0xXSxmPWhbYStzXX19fXdoaWxlKChlPXVbZSZjXSk+bCYmMCE9LS1pKTtyZXR1cm4gczw9dC5sb29rYWhlYWQ/czp0Lmxvb2thaGVhZH0sbWU9dD0+e2NvbnN0IGU9dC53X3NpemU7bGV0IHIsbixpO2Rve2lmKG49dC53aW5kb3dfc2l6ZS10Lmxvb2thaGVhZC10LnN0cnN0YXJ0LHQuc3Ryc3RhcnQ+PWUrKGUtV3QpJiYodC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KGUsZStlLW4pLDApLHQubWF0Y2hfc3RhcnQtPWUsdC5zdHJzdGFydC09ZSx0LmJsb2NrX3N0YXJ0LT1lLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSxfZSh0KSxuKz1lKSwwPT09dC5zdHJtLmF2YWlsX2luKWJyZWFrO2lmKHI9d2UodC5zdHJtLHQud2luZG93LHQuc3Ryc3RhcnQrdC5sb29rYWhlYWQsbiksdC5sb29rYWhlYWQrPXIsdC5sb29rYWhlYWQrdC5pbnNlcnQ+PVh0KWZvcihpPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tpXSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1tpKzFdKTt0Lmluc2VydCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krWHQtMV0pLHQucHJldltpJnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPWksaSsrLHQuaW5zZXJ0LS0sISh0Lmxvb2thaGVhZCt0Lmluc2VydDxYdCkpOyk7fXdoaWxlKHQubG9va2FoZWFkPFd0JiYwIT09dC5zdHJtLmF2YWlsX2luKX0sYmU9KHQsZSk9PntsZXQgcixuLGksYT10LnBlbmRpbmdfYnVmX3NpemUtNT50Lndfc2l6ZT90Lndfc2l6ZTp0LnBlbmRpbmdfYnVmX3NpemUtNSxzPTAsbz10LnN0cm0uYXZhaWxfaW47ZG97aWYocj02NTUzNSxpPXQuYmlfdmFsaWQrNDI+PjMsdC5zdHJtLmF2YWlsX291dDxpKWJyZWFrO2lmKGk9dC5zdHJtLmF2YWlsX291dC1pLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LHI+bit0LnN0cm0uYXZhaWxfaW4mJihyPW4rdC5zdHJtLmF2YWlsX2luKSxyPmkmJihyPWkpLHI8YSYmKDA9PT1yJiZlIT09a3R8fGU9PT1tdHx8ciE9PW4rdC5zdHJtLmF2YWlsX2luKSlicmVhaztzPWU9PT1rdCYmcj09PW4rdC5zdHJtLmF2YWlsX2luPzE6MCxndCh0LDAsMCxzKSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy00XT1yLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTNdPXI+PjgsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMl09fnIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMV09fnI+PjgsZmUodC5zdHJtKSxuJiYobj5yJiYobj1yKSx0LnN0cm0ub3V0cHV0LnNldCh0LndpbmRvdy5zdWJhcnJheSh0LmJsb2NrX3N0YXJ0LHQuYmxvY2tfc3RhcnQrbiksdC5zdHJtLm5leHRfb3V0KSx0LnN0cm0ubmV4dF9vdXQrPW4sdC5zdHJtLmF2YWlsX291dC09bix0LnN0cm0udG90YWxfb3V0Kz1uLHQuYmxvY2tfc3RhcnQrPW4sci09biksciYmKHdlKHQuc3RybSx0LnN0cm0ub3V0cHV0LHQuc3RybS5uZXh0X291dCxyKSx0LnN0cm0ubmV4dF9vdXQrPXIsdC5zdHJtLmF2YWlsX291dC09cix0LnN0cm0udG90YWxfb3V0Kz1yKX13aGlsZSgwPT09cyk7cmV0dXJuIG8tPXQuc3RybS5hdmFpbF9pbixvJiYobz49dC53X3NpemU/KHQubWF0Y2hlcz0yLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tdC53X3NpemUsdC5zdHJtLm5leHRfaW4pLDApLHQuc3Ryc3RhcnQ9dC53X3NpemUsdC5pbnNlcnQ9dC5zdHJzdGFydCk6KHQud2luZG93X3NpemUtdC5zdHJzdGFydDw9byYmKHQuc3Ryc3RhcnQtPXQud19zaXplLHQud2luZG93LnNldCh0LndpbmRvdy5zdWJhcnJheSh0Lndfc2l6ZSx0Lndfc2l6ZSt0LnN0cnN0YXJ0KSwwKSx0Lm1hdGNoZXM8MiYmdC5tYXRjaGVzKyssdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpKSx0LndpbmRvdy5zZXQodC5zdHJtLmlucHV0LnN1YmFycmF5KHQuc3RybS5uZXh0X2luLW8sdC5zdHJtLm5leHRfaW4pLHQuc3Ryc3RhcnQpLHQuc3Ryc3RhcnQrPW8sdC5pbnNlcnQrPW8+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6byksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0KSx0LmhpZ2hfd2F0ZXI8dC5zdHJzdGFydCYmKHQuaGlnaF93YXRlcj10LnN0cnN0YXJ0KSxzP29lOmUhPT1tdCYmZSE9PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZ0LnN0cnN0YXJ0PT09dC5ibG9ja19zdGFydD9hZTooaT10LndpbmRvd19zaXplLXQuc3Ryc3RhcnQsdC5zdHJtLmF2YWlsX2luPmkmJnQuYmxvY2tfc3RhcnQ+PXQud19zaXplJiYodC5ibG9ja19zdGFydC09dC53X3NpemUsdC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyxpKz10Lndfc2l6ZSx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLGk+dC5zdHJtLmF2YWlsX2luJiYoaT10LnN0cm0uYXZhaWxfaW4pLGkmJih3ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCxpKSx0LnN0cnN0YXJ0Kz1pLHQuaW5zZXJ0Kz1pPnQud19zaXplLXQuaW5zZXJ0P3Qud19zaXplLXQuaW5zZXJ0OmkpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLGk9dC5iaV92YWxpZCs0Mj4+MyxpPXQucGVuZGluZ19idWZfc2l6ZS1pPjY1NTM1PzY1NTM1OnQucGVuZGluZ19idWZfc2l6ZS1pLGE9aT50Lndfc2l6ZT90Lndfc2l6ZTppLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LChuPj1hfHwobnx8ZT09PWt0KSYmZSE9PW10JiYwPT09dC5zdHJtLmF2YWlsX2luJiZuPD1pKSYmKHI9bj5pP2k6bixzPWU9PT1rdCYmMD09PXQuc3RybS5hdmFpbF9pbiYmcj09PW4/MTowLGd0KHQsdC5ibG9ja19zdGFydCxyLHMpLHQuYmxvY2tfc3RhcnQrPXIsZmUodC5zdHJtKSkscz9zZTppZSl9LHhlPSh0LGUpPT57bGV0IHIsbjtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksMCE9PXImJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpKSx0Lm1hdGNoX2xlbmd0aD49WHQpaWYobj13dCh0LHQuc3Ryc3RhcnQtdC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPD10Lm1heF9sYXp5X21hdGNoJiZ0Lmxvb2thaGVhZD49WHQpe3QubWF0Y2hfbGVuZ3RoLS07ZG97dC5zdHJzdGFydCsrLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydH13aGlsZSgwIT0tLXQubWF0Y2hfbGVuZ3RoKTt0LnN0cnN0YXJ0Kyt9ZWxzZSB0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wLHQuaW5zX2g9dC53aW5kb3dbdC5zdHJzdGFydF0sdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCsxXSk7ZWxzZSBuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0Kys7aWYobiYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sa2U9KHQsZSk9PntsZXQgcixuLGk7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDxXdCl7aWYobWUodCksdC5sb29rYWhlYWQ8V3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHI9MCx0Lmxvb2thaGVhZD49WHQmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpLHQucHJldl9sZW5ndGg9dC5tYXRjaF9sZW5ndGgsdC5wcmV2X21hdGNoPXQubWF0Y2hfc3RhcnQsdC5tYXRjaF9sZW5ndGg9WHQtMSwwIT09ciYmdC5wcmV2X2xlbmd0aDx0Lm1heF9sYXp5X21hdGNoJiZ0LnN0cnN0YXJ0LXI8PXQud19zaXplLVd0JiYodC5tYXRjaF9sZW5ndGg9dmUodCxyKSx0Lm1hdGNoX2xlbmd0aDw9NSYmKHQuc3RyYXRlZ3k9PT1SdHx8dC5tYXRjaF9sZW5ndGg9PT1YdCYmdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0PjQwOTYpJiYodC5tYXRjaF9sZW5ndGg9WHQtMSkpLHQucHJldl9sZW5ndGg+PVh0JiZ0Lm1hdGNoX2xlbmd0aDw9dC5wcmV2X2xlbmd0aCl7aT10LnN0cnN0YXJ0K3QubG9va2FoZWFkLVh0LG49d3QodCx0LnN0cnN0YXJ0LTEtdC5wcmV2X21hdGNoLHQucHJldl9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10LnByZXZfbGVuZ3RoLTEsdC5wcmV2X2xlbmd0aC09Mjtkb3srK3Quc3Ryc3RhcnQ8PWkmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpfXdoaWxlKDAhPS0tdC5wcmV2X2xlbmd0aCk7aWYodC5tYXRjaF9hdmFpbGFibGU9MCx0Lm1hdGNoX2xlbmd0aD1YdC0xLHQuc3Ryc3RhcnQrKyxuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1lbHNlIGlmKHQubWF0Y2hfYXZhaWxhYmxlKXtpZihuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0LTFdKSxuJiZwZSh0LCExKSx0LnN0cnN0YXJ0KyssdC5sb29rYWhlYWQtLSwwPT09dC5zdHJtLmF2YWlsX291dClyZXR1cm4gaWV9ZWxzZSB0Lm1hdGNoX2F2YWlsYWJsZT0xLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tfXJldHVybiB0Lm1hdGNoX2F2YWlsYWJsZSYmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLHQubWF0Y2hfYXZhaWxhYmxlPTApLHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0semU9KHQsZSk9PntsZXQgcixuLGksYTtjb25zdCBzPXQud2luZG93O2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8PUd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDw9R3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHQubWF0Y2hfbGVuZ3RoPTAsdC5sb29rYWhlYWQ+PVh0JiZ0LnN0cnN0YXJ0PjAmJihpPXQuc3Ryc3RhcnQtMSxuPXNbaV0sbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSkpe2E9dC5zdHJzdGFydCtHdDtkb3t9d2hpbGUobj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmaTxhKTt0Lm1hdGNoX2xlbmd0aD1HdC0oYS1pKSx0Lm1hdGNoX2xlbmd0aD50Lmxvb2thaGVhZCYmKHQubWF0Y2hfbGVuZ3RoPXQubG9va2FoZWFkKX1pZih0Lm1hdGNoX2xlbmd0aD49WHQ/KHI9d3QodCwxLHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5zdHJzdGFydCs9dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg9MCk6KHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyksciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sQWU9KHQsZSk9PntsZXQgcjtmb3IoOzspe2lmKDA9PT10Lmxvb2thaGVhZCYmKG1lKHQpLDA9PT10Lmxvb2thaGVhZCkpe2lmKGU9PT1tdClyZXR1cm4gaWU7YnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCxyPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0KyssciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX07ZnVuY3Rpb24gRWUodCxlLHIsbixpKXt0aGlzLmdvb2RfbGVuZ3RoPXQsdGhpcy5tYXhfbGF6eT1lLHRoaXMubmljZV9sZW5ndGg9cix0aGlzLm1heF9jaGFpbj1uLHRoaXMuZnVuYz1pfWNvbnN0IFNlPVtuZXcgRWUoMCwwLDAsMCxiZSksbmV3IEVlKDQsNCw4LDQseGUpLG5ldyBFZSg0LDUsMTYsOCx4ZSksbmV3IEVlKDQsNiwzMiwzMix4ZSksbmV3IEVlKDQsNCwxNiwxNixrZSksbmV3IEVlKDgsMTYsMzIsMzIsa2UpLG5ldyBFZSg4LDE2LDEyOCwxMjgsa2UpLG5ldyBFZSg4LDMyLDEyOCwyNTYsa2UpLG5ldyBFZSgzMiwxMjgsMjU4LDEwMjQsa2UpLG5ldyBFZSgzMiwyNTgsMjU4LDQwOTYsa2UpXSxCZT10PT57dC53aW5kb3dfc2l6ZT0yKnQud19zaXplLHVlKHQuaGVhZCksdC5tYXhfbGF6eV9tYXRjaD1TZVt0LmxldmVsXS5tYXhfbGF6eSx0Lmdvb2RfbWF0Y2g9U2VbdC5sZXZlbF0uZ29vZF9sZW5ndGgsdC5uaWNlX21hdGNoPVNlW3QubGV2ZWxdLm5pY2VfbGVuZ3RoLHQubWF4X2NoYWluX2xlbmd0aD1TZVt0LmxldmVsXS5tYXhfY2hhaW4sdC5zdHJzdGFydD0wLHQuYmxvY2tfc3RhcnQ9MCx0Lmxvb2thaGVhZD0wLHQuaW5zZXJ0PTAsdC5tYXRjaF9sZW5ndGg9dC5wcmV2X2xlbmd0aD1YdC0xLHQubWF0Y2hfYXZhaWxhYmxlPTAsdC5pbnNfaD0wfTtmdW5jdGlvbiBPZSgpe3RoaXMuc3RybT1udWxsLHRoaXMuc3RhdHVzPTAsdGhpcy5wZW5kaW5nX2J1Zj1udWxsLHRoaXMucGVuZGluZ19idWZfc2l6ZT0wLHRoaXMucGVuZGluZ19vdXQ9MCx0aGlzLnBlbmRpbmc9MCx0aGlzLndyYXA9MCx0aGlzLmd6aGVhZD1udWxsLHRoaXMuZ3ppbmRleD0wLHRoaXMubWV0aG9kPUh0LHRoaXMubGFzdF9mbHVzaD0tMSx0aGlzLndfc2l6ZT0wLHRoaXMud19iaXRzPTAsdGhpcy53X21hc2s9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMud2luZG93X3NpemU9MCx0aGlzLnByZXY9bnVsbCx0aGlzLmhlYWQ9bnVsbCx0aGlzLmluc19oPTAsdGhpcy5oYXNoX3NpemU9MCx0aGlzLmhhc2hfYml0cz0wLHRoaXMuaGFzaF9tYXNrPTAsdGhpcy5oYXNoX3NoaWZ0PTAsdGhpcy5ibG9ja19zdGFydD0wLHRoaXMubWF0Y2hfbGVuZ3RoPTAsdGhpcy5wcmV2X21hdGNoPTAsdGhpcy5tYXRjaF9hdmFpbGFibGU9MCx0aGlzLnN0cnN0YXJ0PTAsdGhpcy5tYXRjaF9zdGFydD0wLHRoaXMubG9va2FoZWFkPTAsdGhpcy5wcmV2X2xlbmd0aD0wLHRoaXMubWF4X2NoYWluX2xlbmd0aD0wLHRoaXMubWF4X2xhenlfbWF0Y2g9MCx0aGlzLmxldmVsPTAsdGhpcy5zdHJhdGVneT0wLHRoaXMuZ29vZF9tYXRjaD0wLHRoaXMubmljZV9tYXRjaD0wLHRoaXMuZHluX2x0cmVlPW5ldyBVaW50MTZBcnJheSgyKiR0KSx0aGlzLmR5bl9kdHJlZT1uZXcgVWludDE2QXJyYXkoMiooMipqdCsxKSksdGhpcy5ibF90cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKlB0KzEpKSx1ZSh0aGlzLmR5bl9sdHJlZSksdWUodGhpcy5keW5fZHRyZWUpLHVlKHRoaXMuYmxfdHJlZSksdGhpcy5sX2Rlc2M9bnVsbCx0aGlzLmRfZGVzYz1udWxsLHRoaXMuYmxfZGVzYz1udWxsLHRoaXMuYmxfY291bnQ9bmV3IFVpbnQxNkFycmF5KEt0KzEpLHRoaXMuaGVhcD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmhlYXApLHRoaXMuaGVhcF9sZW49MCx0aGlzLmhlYXBfbWF4PTAsdGhpcy5kZXB0aD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmRlcHRoKSx0aGlzLnN5bV9idWY9MCx0aGlzLmxpdF9idWZzaXplPTAsdGhpcy5zeW1fbmV4dD0wLHRoaXMuc3ltX2VuZD0wLHRoaXMub3B0X2xlbj0wLHRoaXMuc3RhdGljX2xlbj0wLHRoaXMubWF0Y2hlcz0wLHRoaXMuaW5zZXJ0PTAsdGhpcy5iaV9idWY9MCx0aGlzLmJpX3ZhbGlkPTB9Y29uc3QgTGU9dD0+e2lmKCF0KXJldHVybiAxO2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4hZXx8ZS5zdHJtIT09dHx8ZS5zdGF0dXMhPT1xdCYmZS5zdGF0dXMhPT1WdCYmZS5zdGF0dXMhPT1RdCYmZS5zdGF0dXMhPT1KdCYmZS5zdGF0dXMhPT10ZSYmZS5zdGF0dXMhPT1lZSYmZS5zdGF0dXMhPT1yZSYmZS5zdGF0dXMhPT1uZT8xOjB9LFJlPXQ9PntpZihMZSh0KSlyZXR1cm4gaGUodCxTdCk7dC50b3RhbF9pbj10LnRvdGFsX291dD0wLHQuZGF0YV90eXBlPUZ0O2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4gZS5wZW5kaW5nPTAsZS5wZW5kaW5nX291dD0wLGUud3JhcDwwJiYoZS53cmFwPS1lLndyYXApLGUuc3RhdHVzPTI9PT1lLndyYXA/VnQ6ZS53cmFwP3F0OnJlLHQuYWRsZXI9Mj09PWUud3JhcD8wOjEsZS5sYXN0X2ZsdXNoPS0yLHB0KGUpLEF0fSxEZT10PT57Y29uc3QgZT1SZSh0KTtyZXR1cm4gZT09PUF0JiZCZSh0LnN0YXRlKSxlfSxVZT0odCxlLHIsbixpLGEpPT57aWYoIXQpcmV0dXJuIFN0O2xldCBzPTE7aWYoZT09PUx0JiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+WnR8fHIhPT1IdHx8bjw4fHxuPjE1fHxlPDB8fGU+OXx8YTwwfHxhPkN0fHw4PT09biYmMSE9PXMpcmV0dXJuIGhlKHQsU3QpOzg9PT1uJiYobj05KTtjb25zdCBvPW5ldyBPZTtyZXR1cm4gdC5zdGF0ZT1vLG8uc3RybT10LG8uc3RhdHVzPXF0LG8ud3JhcD1zLG8uZ3poZWFkPW51bGwsby53X2JpdHM9bixvLndfc2l6ZT0xPDxvLndfYml0cyxvLndfbWFzaz1vLndfc2l6ZS0xLG8uaGFzaF9iaXRzPWkrNyxvLmhhc2hfc2l6ZT0xPDxvLmhhc2hfYml0cyxvLmhhc2hfbWFzaz1vLmhhc2hfc2l6ZS0xLG8uaGFzaF9zaGlmdD1+figoby5oYXNoX2JpdHMrWHQtMSkvWHQpLG8ud2luZG93PW5ldyBVaW50OEFycmF5KDIqby53X3NpemUpLG8uaGVhZD1uZXcgVWludDE2QXJyYXkoby5oYXNoX3NpemUpLG8ucHJldj1uZXcgVWludDE2QXJyYXkoby53X3NpemUpLG8ubGl0X2J1ZnNpemU9MTw8aSs2LG8ucGVuZGluZ19idWZfc2l6ZT00Km8ubGl0X2J1ZnNpemUsby5wZW5kaW5nX2J1Zj1uZXcgVWludDhBcnJheShvLnBlbmRpbmdfYnVmX3NpemUpLG8uc3ltX2J1Zj1vLmxpdF9idWZzaXplLG8uc3ltX2VuZD0zKihvLmxpdF9idWZzaXplLTEpLG8ubGV2ZWw9ZSxvLnN0cmF0ZWd5PWEsby5tZXRob2Q9cixEZSh0KX07dmFyIENlPXtkZWZsYXRlSW5pdDoodCxlKT0+VWUodCxlLEh0LE10LE50LFR0KSxkZWZsYXRlSW5pdDI6VWUsZGVmbGF0ZVJlc2V0OkRlLGRlZmxhdGVSZXNldEtlZXA6UmUsZGVmbGF0ZVNldEhlYWRlcjoodCxlKT0+TGUodCl8fDIhPT10LnN0YXRlLndyYXA/U3Q6KHQuc3RhdGUuZ3poZWFkPWUsQXQpLGRlZmxhdGU6KHQsZSk9PntpZihMZSh0KXx8ZT56dHx8ZTwwKXJldHVybiB0P2hlKHQsU3QpOlN0O2NvbnN0IHI9dC5zdGF0ZTtpZighdC5vdXRwdXR8fDAhPT10LmF2YWlsX2luJiYhdC5pbnB1dHx8ci5zdGF0dXM9PT1uZSYmZSE9PWt0KXJldHVybiBoZSh0LDA9PT10LmF2YWlsX291dD9PdDpTdCk7Y29uc3Qgbj1yLmxhc3RfZmx1c2g7aWYoci5sYXN0X2ZsdXNoPWUsMCE9PXIucGVuZGluZyl7aWYoZmUodCksMD09PXQuYXZhaWxfb3V0KXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9ZWxzZSBpZigwPT09dC5hdmFpbF9pbiYmY2UoZSk8PWNlKG4pJiZlIT09a3QpcmV0dXJuIGhlKHQsT3QpO2lmKHIuc3RhdHVzPT09bmUmJjAhPT10LmF2YWlsX2luKXJldHVybiBoZSh0LE90KTtpZihyLnN0YXR1cz09PXF0JiYwPT09ci53cmFwJiYoci5zdGF0dXM9cmUpLHIuc3RhdHVzPT09cXQpe2xldCBlPUh0KyhyLndfYml0cy04PDw0KTw8OCxuPS0xO2lmKG49ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj8wOnIubGV2ZWw8Nj8xOjY9PT1yLmxldmVsPzI6MyxlfD1uPDw2LDAhPT1yLnN0cnN0YXJ0JiYoZXw9WXQpLGUrPTMxLWUlMzEseWUocixlKSwwIT09ci5zdHJzdGFydCYmKHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSx0LmFkbGVyPTEsci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKHIuc3RhdHVzPT09VnQpaWYodC5hZGxlcj0wLGdlKHIsMzEpLGdlKHIsMTM5KSxnZShyLDgpLHIuZ3poZWFkKWdlKHIsKHIuZ3poZWFkLnRleHQ/MTowKSsoci5nemhlYWQuaGNyYz8yOjApKyhyLmd6aGVhZC5leHRyYT80OjApKyhyLmd6aGVhZC5uYW1lPzg6MCkrKHIuZ3poZWFkLmNvbW1lbnQ/MTY6MCkpLGdlKHIsMjU1JnIuZ3poZWFkLnRpbWUpLGdlKHIsci5nemhlYWQudGltZT4+OCYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MTYmMjU1KSxnZShyLHIuZ3poZWFkLnRpbWU+PjI0JjI1NSksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLDI1NSZyLmd6aGVhZC5vcyksci5nemhlYWQuZXh0cmEmJnIuZ3poZWFkLmV4dHJhLmxlbmd0aCYmKGdlKHIsMjU1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCksZ2UocixyLmd6aGVhZC5leHRyYS5sZW5ndGg+PjgmMjU1KSksci5nemhlYWQuaGNyYyYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZywwKSksci5nemluZGV4PTAsci5zdGF0dXM9UXQ7ZWxzZSBpZihnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLGxlKSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7aWYoci5zdGF0dXM9PT1RdCl7aWYoci5nemhlYWQuZXh0cmEpe2xldCBlPXIucGVuZGluZyxuPSg2NTUzNSZyLmd6aGVhZC5leHRyYS5sZW5ndGgpLXIuZ3ppbmRleDtmb3IoO3IucGVuZGluZytuPnIucGVuZGluZ19idWZfc2l6ZTspe2xldCBpPXIucGVuZGluZ19idWZfc2l6ZS1yLnBlbmRpbmc7aWYoci5wZW5kaW5nX2J1Zi5zZXQoci5nemhlYWQuZXh0cmEuc3ViYXJyYXkoci5nemluZGV4LHIuZ3ppbmRleCtpKSxyLnBlbmRpbmcpLHIucGVuZGluZz1yLnBlbmRpbmdfYnVmX3NpemUsci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4Kz1pLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtlPTAsbi09aX1sZXQgaT1uZXcgVWludDhBcnJheShyLmd6aGVhZC5leHRyYSk7ci5wZW5kaW5nX2J1Zi5zZXQoaS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K24pLHIucGVuZGluZyksci5wZW5kaW5nKz1uLHIuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5lJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLWUsZSkpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPUp0fWlmKHIuc3RhdHVzPT09SnQpe2lmKHIuZ3poZWFkLm5hbWUpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5uYW1lLmxlbmd0aD8yNTUmci5nemhlYWQubmFtZS5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPXRlfWlmKHIuc3RhdHVzPT09dGUpe2lmKHIuZ3poZWFkLmNvbW1lbnQpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5jb21tZW50Lmxlbmd0aD8yNTUmci5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpfXIuc3RhdHVzPWVlfWlmKHIuc3RhdHVzPT09ZWUpe2lmKHIuZ3poZWFkLmhjcmMpe2lmKHIucGVuZGluZysyPnIucGVuZGluZ19idWZfc2l6ZSYmKGZlKHQpLDAhPT1yLnBlbmRpbmcpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7Z2UociwyNTUmdC5hZGxlciksZ2Uocix0LmFkbGVyPj44JjI1NSksdC5hZGxlcj0wfWlmKHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1pZigwIT09dC5hdmFpbF9pbnx8MCE9PXIubG9va2FoZWFkfHxlIT09bXQmJnIuc3RhdHVzIT09bmUpe2xldCBuPTA9PT1yLmxldmVsP2JlKHIsZSk6ci5zdHJhdGVneT09PUR0P0FlKHIsZSk6ci5zdHJhdGVneT09PVV0P3plKHIsZSk6U2Vbci5sZXZlbF0uZnVuYyhyLGUpO2lmKG4hPT1zZSYmbiE9PW9lfHwoci5zdGF0dXM9bmUpLG49PT1pZXx8bj09PXNlKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihyLmxhc3RfZmx1c2g9LTEpLEF0O2lmKG49PT1hZSYmKGU9PT1idD92dChyKTplIT09enQmJihndChyLDAsMCwhMSksZT09PXh0JiYodWUoci5oZWFkKSwwPT09ci5sb29rYWhlYWQmJihyLnN0cnN0YXJ0PTAsci5ibG9ja19zdGFydD0wLHIuaW5zZXJ0PTApKSksZmUodCksMD09PXQuYXZhaWxfb3V0KSlyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fXJldHVybiBlIT09a3Q/QXQ6ci53cmFwPD0wP0V0OigyPT09ci53cmFwPyhnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSxnZShyLHQuYWRsZXI+PjE2JjI1NSksZ2Uocix0LmFkbGVyPj4yNCYyNTUpLGdlKHIsMjU1JnQudG90YWxfaW4pLGdlKHIsdC50b3RhbF9pbj4+OCYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MTYmMjU1KSxnZShyLHQudG90YWxfaW4+PjI0JjI1NSkpOih5ZShyLHQuYWRsZXI+Pj4xNikseWUociw2NTUzNSZ0LmFkbGVyKSksZmUodCksci53cmFwPjAmJihyLndyYXA9LXIud3JhcCksMCE9PXIucGVuZGluZz9BdDpFdCl9LGRlZmxhdGVFbmQ6dD0+e2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBlPXQuc3RhdGUuc3RhdHVzO3JldHVybiB0LnN0YXRlPW51bGwsZT09PXJlP2hlKHQsQnQpOkF0fSxkZWZsYXRlU2V0RGljdGlvbmFyeToodCxlKT0+e2xldCByPWUubGVuZ3RoO2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBuPXQuc3RhdGUsaT1uLndyYXA7aWYoMj09PWl8fDE9PT1pJiZuLnN0YXR1cyE9PXF0fHxuLmxvb2thaGVhZClyZXR1cm4gU3Q7aWYoMT09PWkmJih0LmFkbGVyPWN0KHQuYWRsZXIsZSxyLDApKSxuLndyYXA9MCxyPj1uLndfc2l6ZSl7MD09PWkmJih1ZShuLmhlYWQpLG4uc3Ryc3RhcnQ9MCxuLmJsb2NrX3N0YXJ0PTAsbi5pbnNlcnQ9MCk7bGV0IHQ9bmV3IFVpbnQ4QXJyYXkobi53X3NpemUpO3Quc2V0KGUuc3ViYXJyYXkoci1uLndfc2l6ZSxyKSwwKSxlPXQscj1uLndfc2l6ZX1jb25zdCBhPXQuYXZhaWxfaW4scz10Lm5leHRfaW4sbz10LmlucHV0O2Zvcih0LmF2YWlsX2luPXIsdC5uZXh0X2luPTAsdC5pbnB1dD1lLG1lKG4pO24ubG9va2FoZWFkPj1YdDspe2xldCB0PW4uc3Ryc3RhcnQsZT1uLmxvb2thaGVhZC0oWHQtMSk7ZG97bi5pbnNfaD1kZShuLG4uaW5zX2gsbi53aW5kb3dbdCtYdC0xXSksbi5wcmV2W3Qmbi53X21hc2tdPW4uaGVhZFtuLmluc19oXSxuLmhlYWRbbi5pbnNfaF09dCx0Kyt9d2hpbGUoLS1lKTtuLnN0cnN0YXJ0PXQsbi5sb29rYWhlYWQ9WHQtMSxtZShuKX1yZXR1cm4gbi5zdHJzdGFydCs9bi5sb29rYWhlYWQsbi5ibG9ja19zdGFydD1uLnN0cnN0YXJ0LG4uaW5zZXJ0PW4ubG9va2FoZWFkLG4ubG9va2FoZWFkPTAsbi5tYXRjaF9sZW5ndGg9bi5wcmV2X2xlbmd0aD1YdC0xLG4ubWF0Y2hfYXZhaWxhYmxlPTAsdC5uZXh0X2luPXMsdC5pbnB1dD1vLHQuYXZhaWxfaW49YSxuLndyYXA9aSxBdH0sZGVmbGF0ZUluZm86InBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkifTtjb25zdCBUZT0odCxlKT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsZSk7dmFyIEZlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2Zvcig7ZS5sZW5ndGg7KXtjb25zdCByPWUuc2hpZnQoKTtpZihyKXtpZigib2JqZWN0IiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcihyKyJtdXN0IGJlIG5vbi1vYmplY3QiKTtmb3IoY29uc3QgZSBpbiByKVRlKHIsZSkmJih0W2VdPXJbZV0pfX1yZXR1cm4gdH0sSGU9e2Fzc2lnbjpGZSxmbGF0dGVuQ2h1bmtzOnQ9PntsZXQgZT0wO2ZvcihsZXQgcj0wLG49dC5sZW5ndGg7cjxuO3IrKyllKz10W3JdLmxlbmd0aDtjb25zdCByPW5ldyBVaW50OEFycmF5KGUpO2ZvcihsZXQgZT0wLG49MCxpPXQubGVuZ3RoO2U8aTtlKyspe2xldCBpPXRbZV07ci5zZXQoaSxuKSxuKz1pLmxlbmd0aH1yZXR1cm4gcn19O2xldCBaZT0hMDt0cnl7U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLG5ldyBVaW50OEFycmF5KDEpKX1jYXRjaCh0KXtaZT0hMX1jb25zdCBNZT1uZXcgVWludDhBcnJheSgyNTYpO2ZvcihsZXQgdD0wO3Q8MjU2O3QrKylNZVt0XT10Pj0yNTI/Njp0Pj0yNDg/NTp0Pj0yNDA/NDp0Pj0yMjQ/Mzp0Pj0xOTI/MjoxO01lWzI1NF09TWVbMjU0XT0xO2NvbnN0IE5lPSh0LGUpPT57aWYoZTw2NTUzNCYmdC5zdWJhcnJheSYmWmUpcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCx0Lmxlbmd0aD09PWU/dDp0LnN1YmFycmF5KDAsZSkpO2xldCByPSIiO2ZvcihsZXQgbj0wO248ZTtuKyspcis9U3RyaW5nLmZyb21DaGFyQ29kZSh0W25dKTtyZXR1cm4gcn07dmFyIEllPXtzdHJpbmcyYnVmOnQ9PntpZigiZnVuY3Rpb24iPT10eXBlb2YgVGV4dEVuY29kZXImJlRleHRFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUpcmV0dXJuKG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHQpO2xldCBlLHIsbixpLGEscz10Lmxlbmd0aCxvPTA7Zm9yKGk9MDtpPHM7aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxvKz1yPDEyOD8xOnI8MjA0OD8yOnI8NjU1MzY/Mzo0O2ZvcihlPW5ldyBVaW50OEFycmF5KG8pLGE9MCxpPTA7YTxvO2krKylyPXQuY2hhckNvZGVBdChpKSw1NTI5Nj09KDY0NTEyJnIpJiZpKzE8cyYmKG49dC5jaGFyQ29kZUF0KGkrMSksNTYzMjA9PSg2NDUxMiZuKSYmKHI9NjU1MzYrKHItNTUyOTY8PDEwKSsobi01NjMyMCksaSsrKSkscjwxMjg/ZVthKytdPXI6cjwyMDQ4PyhlW2ErK109MTkyfHI+Pj42LGVbYSsrXT0xMjh8NjMmcik6cjw2NTUzNj8oZVthKytdPTIyNHxyPj4+MTIsZVthKytdPTEyOHxyPj4+NiY2MyxlW2ErK109MTI4fDYzJnIpOihlW2ErK109MjQwfHI+Pj4xOCxlW2ErK109MTI4fHI+Pj4xMiY2MyxlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik7cmV0dXJuIGV9LGJ1ZjJzdHJpbmc6KHQsZSk9Pntjb25zdCByPWV8fHQubGVuZ3RoO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RGVjb2RlciYmVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSlyZXR1cm4obmV3IFRleHREZWNvZGVyKS5kZWNvZGUodC5zdWJhcnJheSgwLGUpKTtsZXQgbixpO2NvbnN0IGE9bmV3IEFycmF5KDIqcik7Zm9yKGk9MCxuPTA7bjxyOyl7bGV0IGU9dFtuKytdO2lmKGU8MTI4KXthW2krK109ZTtjb250aW51ZX1sZXQgcz1NZVtlXTtpZihzPjQpYVtpKytdPTY1NTMzLG4rPXMtMTtlbHNle2ZvcihlJj0yPT09cz8zMTozPT09cz8xNTo3O3M+MSYmbjxyOyllPWU8PDZ8NjMmdFtuKytdLHMtLTtzPjE/YVtpKytdPTY1NTMzOmU8NjU1MzY/YVtpKytdPWU6KGUtPTY1NTM2LGFbaSsrXT01NTI5NnxlPj4xMCYxMDIzLGFbaSsrXT01NjMyMHwxMDIzJmUpfX1yZXR1cm4gTmUoYSxpKX0sdXRmOGJvcmRlcjoodCxlKT0+eyhlPWV8fHQubGVuZ3RoKT50Lmxlbmd0aCYmKGU9dC5sZW5ndGgpO2xldCByPWUtMTtmb3IoO3I+PTAmJjEyOD09KDE5MiZ0W3JdKTspci0tO3JldHVybiByPDB8fDA9PT1yP2U6citNZVt0W3JdXT5lP3I6ZX19O2Z1bmN0aW9uIGplKCl7dGhpcy5pbnB1dD1udWxsLHRoaXMubmV4dF9pbj0wLHRoaXMuYXZhaWxfaW49MCx0aGlzLnRvdGFsX2luPTAsdGhpcy5vdXRwdXQ9bnVsbCx0aGlzLm5leHRfb3V0PTAsdGhpcy5hdmFpbF9vdXQ9MCx0aGlzLnRvdGFsX291dD0wLHRoaXMubXNnPSIiLHRoaXMuc3RhdGU9bnVsbCx0aGlzLmRhdGFfdHlwZT0yLHRoaXMuYWRsZXI9MH12YXIgUGU9amU7Y29uc3QgJGU9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyx7Wl9OT19GTFVTSDpLZSxaX1NZTkNfRkxVU0g6WGUsWl9GVUxMX0ZMVVNIOkdlLFpfRklOSVNIOldlLFpfT0s6WWUsWl9TVFJFQU1fRU5EOnFlLFpfREVGQVVMVF9DT01QUkVTU0lPTjpWZSxaX0RFRkFVTFRfU1RSQVRFR1k6UWUsWl9ERUZMQVRFRDpKZX09ZnQ7ZnVuY3Rpb24gdHIodCl7dGhpcy5vcHRpb25zPUhlLmFzc2lnbih7bGV2ZWw6VmUsbWV0aG9kOkplLGNodW5rU2l6ZToxNjM4NCx3aW5kb3dCaXRzOjE1LG1lbUxldmVsOjgsc3RyYXRlZ3k6UWV9LHR8fHt9KTtsZXQgZT10aGlzLm9wdGlvbnM7ZS5yYXcmJmUud2luZG93Qml0cz4wP2Uud2luZG93Qml0cz0tZS53aW5kb3dCaXRzOmUuZ3ppcCYmZS53aW5kb3dCaXRzPjAmJmUud2luZG93Qml0czwxNiYmKGUud2luZG93Qml0cys9MTYpLHRoaXMuZXJyPTAsdGhpcy5tc2c9IiIsdGhpcy5lbmRlZD0hMSx0aGlzLmNodW5rcz1bXSx0aGlzLnN0cm09bmV3IFBlLHRoaXMuc3RybS5hdmFpbF9vdXQ9MDtsZXQgcj1DZS5kZWZsYXRlSW5pdDIodGhpcy5zdHJtLGUubGV2ZWwsZS5tZXRob2QsZS53aW5kb3dCaXRzLGUubWVtTGV2ZWwsZS5zdHJhdGVneSk7aWYociE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7aWYoZS5oZWFkZXImJkNlLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLGUuaGVhZGVyKSxlLmRpY3Rpb25hcnkpe2xldCB0O2lmKHQ9InN0cmluZyI9PXR5cGVvZiBlLmRpY3Rpb25hcnk/SWUuc3RyaW5nMmJ1ZihlLmRpY3Rpb25hcnkpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKGUuZGljdGlvbmFyeSk/bmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KTplLmRpY3Rpb25hcnkscj1DZS5kZWZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sdCksciE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7dGhpcy5fZGljdF9zZXQ9ITB9fWZ1bmN0aW9uIGVyKHQsZSl7Y29uc3Qgcj1uZXcgdHIoZSk7aWYoci5wdXNoKHQsITApLHIuZXJyKXRocm93IHIubXNnfHxkdFtyLmVycl07cmV0dXJuIHIucmVzdWx0fWZ1bmN0aW9uIHJyKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxlcih0LGUpfWZ1bmN0aW9uIG5yKHQsZSl7cmV0dXJuKGU9ZXx8e30pLmd6aXA9ITAsZXIodCxlKX10ci5wcm90b3R5cGUucHVzaD1mdW5jdGlvbih0LGUpe2NvbnN0IHI9dGhpcy5zdHJtLG49dGhpcy5vcHRpb25zLmNodW5rU2l6ZTtsZXQgaSxhO2lmKHRoaXMuZW5kZWQpcmV0dXJuITE7Zm9yKGE9ZT09PX5+ZT9lOiEwPT09ZT9XZTpLZSwic3RyaW5nIj09dHlwZW9mIHQ/ci5pbnB1dD1JZS5zdHJpbmcyYnVmKHQpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKHQpP3IuaW5wdXQ9bmV3IFVpbnQ4QXJyYXkodCk6ci5pbnB1dD10LHIubmV4dF9pbj0wLHIuYXZhaWxfaW49ci5pbnB1dC5sZW5ndGg7OylpZigwPT09ci5hdmFpbF9vdXQmJihyLm91dHB1dD1uZXcgVWludDhBcnJheShuKSxyLm5leHRfb3V0PTAsci5hdmFpbF9vdXQ9biksKGE9PT1YZXx8YT09PUdlKSYmci5hdmFpbF9vdXQ8PTYpdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNle2lmKGk9Q2UuZGVmbGF0ZShyLGEpLGk9PT1xZSlyZXR1cm4gci5uZXh0X291dD4wJiZ0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxpPUNlLmRlZmxhdGVFbmQodGhpcy5zdHJtKSx0aGlzLm9uRW5kKGkpLHRoaXMuZW5kZWQ9ITAsaT09PVllO2lmKDAhPT1yLmF2YWlsX291dCl7aWYoYT4wJiZyLm5leHRfb3V0PjApdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNlIGlmKDA9PT1yLmF2YWlsX2luKWJyZWFrfWVsc2UgdGhpcy5vbkRhdGEoci5vdXRwdXQpfXJldHVybiEwfSx0ci5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LHRyLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXt0PT09WWUmJih0aGlzLnJlc3VsdD1IZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksdGhpcy5jaHVua3M9W10sdGhpcy5lcnI9dCx0aGlzLm1zZz10aGlzLnN0cm0ubXNnfTt2YXIgaXI9dHIsYXI9ZXIsc3I9cnIsb3I9bnIsbHI9ZnQsaHI9e0RlZmxhdGU6aXIsZGVmbGF0ZTphcixkZWZsYXRlUmF3OnNyLGd6aXA6b3IsY29uc3RhbnRzOmxyfTt0LkRlZmxhdGU9aXIsdC5jb25zdGFudHM9bHIsdC5kZWZhdWx0PWhyLHQuZGVmbGF0ZT1hcix0LmRlZmxhdGVSYXc9c3IsdC5nemlwPW9yLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0ocy5leHBvcnRzKSkscy5leHBvcnRzKSxsPXtleHBvcnRzOnt9fTt2YXIgaCxjPXtleHBvcnRzOnt9fSx1PXIoT2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsZGVmYXVsdDp7fX0pKTtmdW5jdGlvbiBfKCl7cmV0dXJuIGh8fChoPTEsYy5leHBvcnRzPShlPWV8fGZ1bmN0aW9uKGUscil7dmFyIG47aWYoInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5jcnlwdG8mJihuPXdpbmRvdy5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZiYmc2VsZi5jcnlwdG8mJihuPXNlbGYuY3J5cHRvKSwidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMuY3J5cHRvJiYobj1nbG9iYWxUaGlzLmNyeXB0byksIW4mJiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cubXNDcnlwdG8mJihuPXdpbmRvdy5tc0NyeXB0byksIW4mJnZvaWQgMCE9PXQmJnQuY3J5cHRvJiYobj10LmNyeXB0byksIW4pdHJ5e249dX1jYXRjaCh0KXt9dmFyIGk9ZnVuY3Rpb24oKXtpZihuKXtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5nZXRSYW5kb21WYWx1ZXMpdHJ5e3JldHVybiBuLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdfWNhdGNoKHQpe31pZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5yYW5kb21CeXRlcyl0cnl7cmV0dXJuIG4ucmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKX1jYXRjaCh0KXt9fXRocm93IG5ldyBFcnJvcigiTmF0aXZlIGNyeXB0byBtb2R1bGUgY291bGQgbm90IGJlIHVzZWQgdG8gZ2V0IHNlY3VyZSByYW5kb20gbnVtYmVyLiIpfSxhPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPWUscj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLHM9e30sbz1zLmxpYj17fSxsPW8uQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBlPWEodGhpcyk7cmV0dXJuIHQmJmUubWl4SW4odCksZS5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1lLmluaXR8fChlLmluaXQ9ZnVuY3Rpb24oKXtlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGUuaW5pdC5wcm90b3R5cGU9ZSxlLiRzdXBlcj10aGlzLGV9LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShlKSYmKHRoaXNbZV09dFtlXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0saD1vLldvcmRBcnJheT1sLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPWUhPXI/ZTo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8Xykuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKyspe3ZhciBzPXJbYT4+PjJdPj4+MjQtYSU0KjgmMjU1O2VbbithPj4+Ml18PXM8PDI0LShuK2EpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288aTtvKz00KWVbbitvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPWksdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlczt0W3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0KjgsdC5sZW5ndGg9ZS5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9bC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxyPTA7cjx0O3IrPTQpZS5wdXNoKGkoKSk7cmV0dXJuIG5ldyBoLmluaXQoZSx0KX19KSxjPXMuZW5jPXt9LF89Yy5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgaC5pbml0KHIsZS8yKX19LGQ9Yy5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKylyW24+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGguaW5pdChyLGUpfX0sZj1jLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoZC5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gZC5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LHA9by5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWwuZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IGguaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1mLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbih0KXt2YXIgcixuPXRoaXMuX2RhdGEsaT1uLndvcmRzLGE9bi5zaWdCeXRlcyxzPXRoaXMuYmxvY2tTaXplLG89YS8oNCpzKSxsPShvPXQ/ZS5jZWlsKG8pOmUubWF4KCgwfG8pLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKnMsYz1lLm1pbig0KmwsYSk7aWYobCl7Zm9yKHZhciB1PTA7dTxsO3UrPXMpdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSx1KTtyPWkuc3BsaWNlKDAsbCksbi5zaWdCeXRlcy09Y31yZXR1cm4gbmV3IGguaW5pdChyLGMpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWwuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH0sX21pbkJ1ZmZlclNpemU6MH0pO28uSGFzaGVyPXAuZXh0ZW5kKHtjZmc6bC5leHRlbmQoKSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7cC5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxibG9ja1NpemU6MTYsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHQuaW5pdChyKS5maW5hbGl6ZShlKX19LF9jcmVhdGVIbWFjSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgZy5ITUFDLmluaXQodCxyKS5maW5hbGl6ZShlKX19fSk7dmFyIGc9cy5hbGdvPXt9O3JldHVybiBzfShNYXRoKSxlKSksYy5leHBvcnRzO3ZhciBlfXZhciBkO2Z1bmN0aW9uIGYoKXtyZXR1cm4gZHx8KGQ9MSxsLmV4cG9ydHM9KHQ9XygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLldvcmRBcnJheTtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIGk9W10sYT0wLHM9MDtzPGU7cysrKWlmKHMlNCl7dmFyIG89blt0LmNoYXJDb2RlQXQocy0xKV08PHMlNCoyfG5bdC5jaGFyQ29kZUF0KHMpXT4+PjYtcyU0KjI7aVthPj4+Ml18PW88PDI0LWElNCo4LGErK31yZXR1cm4gci5jcmVhdGUoaSxhKX1lLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLGE9MDthPHI7YSs9Mylmb3IodmFyIHM9KGVbYT4+PjJdPj4+MjQtYSU0KjgmMjU1KTw8MTZ8KGVbYSsxPj4+Ml0+Pj4yNC0oYSsxKSU0KjgmMjU1KTw8OHxlW2ErMj4+PjJdPj4+MjQtKGErMiklNCo4JjI1NSxvPTA7bzw0JiZhKy43NSpvPHI7bysrKWkucHVzaChuLmNoYXJBdChzPj4+NiooMy1vKSY2MykpO3ZhciBsPW4uY2hhckF0KDY0KTtpZihsKWZvcig7aS5sZW5ndGglNDspaS5wdXNoKGwpO3JldHVybiBpLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZT10Lmxlbmd0aCxyPXRoaXMuX21hcCxpPXRoaXMuX3JldmVyc2VNYXA7aWYoIWkpe2k9dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIGE9MDthPHIubGVuZ3RoO2ErKylpW3IuY2hhckNvZGVBdChhKV09YX12YXIgcz1yLmNoYXJBdCg2NCk7aWYocyl7dmFyIG89dC5pbmRleE9mKHMpOy0xIT09byYmKGU9byl9cmV0dXJuIG4odCxlLGkpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9fSgpLHQuZW5jLkJhc2U2NCkpLGwuZXhwb3J0czt2YXIgdH12YXIgcCxnPWUoZigpKSx5PXtleHBvcnRzOnt9fSx3PXtleHBvcnRzOnt9fTtmdW5jdGlvbiB2KCl7cmV0dXJuIHB8fChwPTEsdy5leHBvcnRzPSh0PV8oKSxmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLHM9ci5hbGdvLG89W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PTA7dDw2NDt0Kyspb1t0XT00Mjk0OTY3Mjk2KmUuYWJzKGUuc2luKHQrMSkpfDB9KCk7dmFyIGw9cy5NRDU9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTA7cjwxNjtyKyspe3ZhciBuPWUrcixpPXRbbl07dFtuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgYT10aGlzLl9oYXNoLndvcmRzLHM9dFtlKzBdLGw9dFtlKzFdLGQ9dFtlKzJdLGY9dFtlKzNdLHA9dFtlKzRdLGc9dFtlKzVdLHk9dFtlKzZdLHc9dFtlKzddLHY9dFtlKzhdLG09dFtlKzldLGI9dFtlKzEwXSx4PXRbZSsxMV0saz10W2UrMTJdLHo9dFtlKzEzXSxBPXRbZSsxNF0sRT10W2UrMTVdLFM9YVswXSxCPWFbMV0sTz1hWzJdLEw9YVszXTtTPWgoUyxCLE8sTCxzLDcsb1swXSksTD1oKEwsUyxCLE8sbCwxMixvWzFdKSxPPWgoTyxMLFMsQixkLDE3LG9bMl0pLEI9aChCLE8sTCxTLGYsMjIsb1szXSksUz1oKFMsQixPLEwscCw3LG9bNF0pLEw9aChMLFMsQixPLGcsMTIsb1s1XSksTz1oKE8sTCxTLEIseSwxNyxvWzZdKSxCPWgoQixPLEwsUyx3LDIyLG9bN10pLFM9aChTLEIsTyxMLHYsNyxvWzhdKSxMPWgoTCxTLEIsTyxtLDEyLG9bOV0pLE89aChPLEwsUyxCLGIsMTcsb1sxMF0pLEI9aChCLE8sTCxTLHgsMjIsb1sxMV0pLFM9aChTLEIsTyxMLGssNyxvWzEyXSksTD1oKEwsUyxCLE8seiwxMixvWzEzXSksTz1oKE8sTCxTLEIsQSwxNyxvWzE0XSksUz1jKFMsQj1oKEIsTyxMLFMsRSwyMixvWzE1XSksTyxMLGwsNSxvWzE2XSksTD1jKEwsUyxCLE8seSw5LG9bMTddKSxPPWMoTyxMLFMsQix4LDE0LG9bMThdKSxCPWMoQixPLEwsUyxzLDIwLG9bMTldKSxTPWMoUyxCLE8sTCxnLDUsb1syMF0pLEw9YyhMLFMsQixPLGIsOSxvWzIxXSksTz1jKE8sTCxTLEIsRSwxNCxvWzIyXSksQj1jKEIsTyxMLFMscCwyMCxvWzIzXSksUz1jKFMsQixPLEwsbSw1LG9bMjRdKSxMPWMoTCxTLEIsTyxBLDksb1syNV0pLE89YyhPLEwsUyxCLGYsMTQsb1syNl0pLEI9YyhCLE8sTCxTLHYsMjAsb1syN10pLFM9YyhTLEIsTyxMLHosNSxvWzI4XSksTD1jKEwsUyxCLE8sZCw5LG9bMjldKSxPPWMoTyxMLFMsQix3LDE0LG9bMzBdKSxTPXUoUyxCPWMoQixPLEwsUyxrLDIwLG9bMzFdKSxPLEwsZyw0LG9bMzJdKSxMPXUoTCxTLEIsTyx2LDExLG9bMzNdKSxPPXUoTyxMLFMsQix4LDE2LG9bMzRdKSxCPXUoQixPLEwsUyxBLDIzLG9bMzVdKSxTPXUoUyxCLE8sTCxsLDQsb1szNl0pLEw9dShMLFMsQixPLHAsMTEsb1szN10pLE89dShPLEwsUyxCLHcsMTYsb1szOF0pLEI9dShCLE8sTCxTLGIsMjMsb1szOV0pLFM9dShTLEIsTyxMLHosNCxvWzQwXSksTD11KEwsUyxCLE8scywxMSxvWzQxXSksTz11KE8sTCxTLEIsZiwxNixvWzQyXSksQj11KEIsTyxMLFMseSwyMyxvWzQzXSksUz11KFMsQixPLEwsbSw0LG9bNDRdKSxMPXUoTCxTLEIsTyxrLDExLG9bNDVdKSxPPXUoTyxMLFMsQixFLDE2LG9bNDZdKSxTPV8oUyxCPXUoQixPLEwsUyxkLDIzLG9bNDddKSxPLEwscyw2LG9bNDhdKSxMPV8oTCxTLEIsTyx3LDEwLG9bNDldKSxPPV8oTyxMLFMsQixBLDE1LG9bNTBdKSxCPV8oQixPLEwsUyxnLDIxLG9bNTFdKSxTPV8oUyxCLE8sTCxrLDYsb1s1Ml0pLEw9XyhMLFMsQixPLGYsMTAsb1s1M10pLE89XyhPLEwsUyxCLGIsMTUsb1s1NF0pLEI9XyhCLE8sTCxTLGwsMjEsb1s1NV0pLFM9XyhTLEIsTyxMLHYsNixvWzU2XSksTD1fKEwsUyxCLE8sRSwxMCxvWzU3XSksTz1fKE8sTCxTLEIseSwxNSxvWzU4XSksQj1fKEIsTyxMLFMseiwyMSxvWzU5XSksUz1fKFMsQixPLEwscCw2LG9bNjBdKSxMPV8oTCxTLEIsTyx4LDEwLG9bNjFdKSxPPV8oTyxMLFMsQixkLDE1LG9bNjJdKSxCPV8oQixPLEwsUyxtLDIxLG9bNjNdKSxhWzBdPWFbMF0rU3wwLGFbMV09YVsxXStCfDAsYVsyXT1hWzJdK098MCxhWzNdPWFbM10rTHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JbaT4+PjVdfD0xMjg8PDI0LWklMzI7dmFyIGE9ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLHM9bjtyWzE1KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpLHJbMTQrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKHM8PDh8cz4+PjI0KXw0Mjc4MjU1MzYwJihzPDwyNHxzPj4+OCksdC5zaWdCeXRlcz00KihyLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsbD1vLndvcmRzLGg9MDtoPDQ7aCsrKXt2YXIgYz1sW2hdO2xbaF09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIG99LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2Z1bmN0aW9uIGgodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZSZyfH5lJm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBjKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmbnxyJn5uKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gdSh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlXnJebikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIF8odCxlLHIsbixpLGEscyl7dmFyIG89dCsocl4oZXx+bikpK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1yLk1ENT1hLl9jcmVhdGVIZWxwZXIobCksci5IbWFjTUQ1PWEuX2NyZWF0ZUhtYWNIZWxwZXIobCl9KE1hdGgpLHQuTUQ1KSksdy5leHBvcnRzO3ZhciB0fXZhciBtLGI9e2V4cG9ydHM6e319LHg9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGsoKXtyZXR1cm4gbXx8KG09MSx4LmV4cG9ydHM9KHQ9XygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5Xb3JkQXJyYXksaT1yLkhhc2hlcixhPWUuYWxnbyxzPVtdLG89YS5TSEExPWkuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IG4uaW5pdChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4LDMyODUzNzc1MjBdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0sbz1yWzNdLGw9cls0XSxoPTA7aDw4MDtoKyspe2lmKGg8MTYpc1toXT0wfHRbZStoXTtlbHNle3ZhciBjPXNbaC0zXV5zW2gtOF1ec1toLTE0XV5zW2gtMTZdO3NbaF09Yzw8MXxjPj4+MzF9dmFyIHU9KG48PDV8bj4+PjI3KStsK3NbaF07dSs9aDwyMD8xNTE4NTAwMjQ5KyhpJmF8fmkmbyk6aDw0MD8xODU5Nzc1MzkzKyhpXmFebyk6aDw2MD8oaSZhfGkmb3xhJm8pLTE4OTQwMDc1ODg6KGleYV5vKS04OTk0OTc1MTQsbD1vLG89YSxhPWk8PDMwfGk+Pj4yLGk9bixuPXV9clswXT1yWzBdK258MCxyWzFdPXJbMV0raXwwLHJbMl09clsyXSthfDAsclszXT1yWzNdK298MCxyWzRdPXJbNF0rbHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEsZT10LndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCp0LnNpZ0J5dGVzO3JldHVybiBlW24+Pj41XXw9MTI4PDwyNC1uJTMyLGVbMTQrKG4rNjQ+Pj45PDw0KV09TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGVbMTUrKG4rNjQ+Pj45PDw0KV09cix0LnNpZ0J5dGVzPTQqZS5sZW5ndGgsdGhpcy5fcHJvY2VzcygpLHRoaXMuX2hhc2h9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2UuU0hBMT1pLl9jcmVhdGVIZWxwZXIobyksZS5IbWFjU0hBMT1pLl9jcmVhdGVIbWFjSGVscGVyKG8pfSgpLHQuU0hBMSkpLHguZXhwb3J0czt2YXIgdH12YXIgeixBPXtleHBvcnRzOnt9fTtmdW5jdGlvbiBFKCl7cmV0dXJuIHp8fCh6PTEsQS5leHBvcnRzPSh0PV8oKSxyPShlPXQpLmxpYi5CYXNlLG49ZS5lbmMuVXRmOCx2b2lkKGUuYWxnby5ITUFDPXIuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLl9oYXNoZXI9bmV3IHQuaW5pdCwic3RyaW5nIj09dHlwZW9mIGUmJihlPW4ucGFyc2UoZSkpO3ZhciByPXQuYmxvY2tTaXplLGk9NCpyO2Uuc2lnQnl0ZXM+aSYmKGU9dC5maW5hbGl6ZShlKSksZS5jbGFtcCgpO2Zvcih2YXIgYT10aGlzLl9vS2V5PWUuY2xvbmUoKSxzPXRoaXMuX2lLZXk9ZS5jbG9uZSgpLG89YS53b3JkcyxsPXMud29yZHMsaD0wO2g8cjtoKyspb1toXV49MTU0OTU1NjgyOCxsW2hdXj05MDk1MjI0ODY7YS5zaWdCeXRlcz1zLnNpZ0J5dGVzPWksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2hhc2hlcjt0LnJlc2V0KCksdC51cGRhdGUodGhpcy5faUtleSl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9oYXNoZXIscj1lLmZpbmFsaXplKHQpO3JldHVybiBlLnJlc2V0KCksZS5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19KSkpKSxBLmV4cG9ydHM7dmFyIHQsZSxyLG59dmFyIFM7ZnVuY3Rpb24gQigpe3JldHVybiBTfHwoUz0xLGIuZXhwb3J0cz0odD1fKCksaygpLEUoKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuQmFzZSxpPXIuV29yZEFycmF5LGE9ZS5hbGdvLHM9YS5NRDUsbz1hLkV2cEtERj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtrZXlTaXplOjQsaGFzaGVyOnMsaXRlcmF0aW9uczoxfSksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCl9LGNvbXB1dGU6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHIsbj10aGlzLmNmZyxhPW4uaGFzaGVyLmNyZWF0ZSgpLHM9aS5jcmVhdGUoKSxvPXMud29yZHMsbD1uLmtleVNpemUsaD1uLml0ZXJhdGlvbnM7by5sZW5ndGg8bDspe3ImJmEudXBkYXRlKHIpLHI9YS51cGRhdGUodCkuZmluYWxpemUoZSksYS5yZXNldCgpO2Zvcih2YXIgYz0xO2M8aDtjKyspcj1hLmZpbmFsaXplKHIpLGEucmVzZXQoKTtzLmNvbmNhdChyKX1yZXR1cm4gcy5zaWdCeXRlcz00Kmwsc319KTtlLkV2cEtERj1mdW5jdGlvbih0LGUscil7cmV0dXJuIG8uY3JlYXRlKHIpLmNvbXB1dGUodCxlKX19KCksdC5FdnBLREYpKSxiLmV4cG9ydHM7dmFyIHR9dmFyIE8sTD17ZXhwb3J0czp7fX07dmFyIFI7dmFyIEQsVSxDPShSfHwoUj0xLHkuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxhPVtdLHM9W10sbz1bXSxsPVtdLGg9W10sYz1bXSx1PVtdLF89W10sZD1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBmPW5ebjw8MV5uPDwyXm48PDNebjw8NDtmPWY+Pj44XjI1NSZmXjk5LGlbcl09ZixhW2ZdPXI7dmFyIHA9dFtyXSxnPXRbcF0seT10W2ddLHc9MjU3KnRbZl1eMTY4NDMwMDgqZjtzW3JdPXc8PDI0fHc+Pj44LG9bcl09dzw8MTZ8dz4+PjE2LGxbcl09dzw8OHx3Pj4+MjQsaFtyXT13LHc9MTY4NDMwMDkqeV42NTUzNypnXjI1NypwXjE2ODQzMDA4KnIsY1tmXT13PDwyNHx3Pj4+OCx1W2ZdPXc8PDE2fHc+Pj4xNixfW2ZdPXc8PDh8dz4+PjI0LGRbZl09dyxyPyhyPXBedFt0W3RbeV5wXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgZj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0scD1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksYT10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/YVtzXT1lW3NdOihoPWFbcy0xXSxzJXI/cj42JiZzJXI9PTQmJihoPWlbaD4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdKTooaD1pWyhoPWg8PDh8aD4+PjI0KT4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdLGhePWZbcy9yfDBdPDwyNCksYVtzXT1hW3Mtcl1eaCk7Zm9yKHZhciBvPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGw9MDtsPG47bCsrKXtpZihzPW4tbCxsJTQpdmFyIGg9YVtzXTtlbHNlIGg9YVtzLTRdO29bbF09bDw0fHxzPD00P2g6Y1tpW2g+Pj4yNF1dXnVbaVtoPj4+MTYmMjU1XV1eX1tpW2g+Pj44JjI1NV1dXmRbaVsyNTUmaF1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxvLGwsaCxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxjLHUsXyxkLGEpLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLGEscyxvKXtmb3IodmFyIGw9dGhpcy5fblJvdW5kcyxoPXRbZV1eclswXSxjPXRbZSsxXV5yWzFdLHU9dFtlKzJdXnJbMl0sXz10W2UrM11eclszXSxkPTQsZj0xO2Y8bDtmKyspe3ZhciBwPW5baD4+PjI0XV5pW2M+Pj4xNiYyNTVdXmFbdT4+PjgmMjU1XV5zWzI1NSZfXV5yW2QrK10sZz1uW2M+Pj4yNF1eaVt1Pj4+MTYmMjU1XV5hW18+Pj44JjI1NV1ec1syNTUmaF1ecltkKytdLHk9blt1Pj4+MjRdXmlbXz4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXnNbMjU1JmNdXnJbZCsrXSx3PW5bXz4+PjI0XV5pW2g+Pj4xNiYyNTVdXmFbYz4+PjgmMjU1XV5zWzI1NSZ1XV5yW2QrK107aD1wLGM9Zyx1PXksXz13fXA9KG9baD4+PjI0XTw8MjR8b1tjPj4+MTYmMjU1XTw8MTZ8b1t1Pj4+OCYyNTVdPDw4fG9bMjU1Jl9dKV5yW2QrK10sZz0ob1tjPj4+MjRdPDwyNHxvW3U+Pj4xNiYyNTVdPDwxNnxvW18+Pj44JjI1NV08PDh8b1syNTUmaF0pXnJbZCsrXSx5PShvW3U+Pj4yNF08PDI0fG9bXz4+PjE2JjI1NV08PDE2fG9baD4+PjgmMjU1XTw8OHxvWzI1NSZjXSlecltkKytdLHc9KG9bXz4+PjI0XTw8MjR8b1toPj4+MTYmMjU1XTw8MTZ8b1tjPj4+OCYyNTVdPDw4fG9bMjU1JnVdKV5yW2QrK10sdFtlXT1wLHRbZSsxXT1nLHRbZSsyXT15LHRbZSszXT13fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIocCl9KCksdC5BRVN9KF8oKSxmKCksdigpLEIoKSxPfHwoTz0xLEwuZXhwb3J0cz0oRD1fKCksQigpLHZvaWQoRC5saWIuQ2lwaGVyfHxmdW5jdGlvbih0KXt2YXIgZT1ELHI9ZS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxhPXIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobSxzPWUuZW5jO3MuVXRmODt2YXIgbz1zLkJhc2U2NCxsPWUuYWxnby5FdnBLREYsaD1yLkNpcGhlcj1hLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKCksY3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSxyKXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQociksdGhpcy5feGZvcm1Nb2RlPXQsdGhpcy5fa2V5PWUsdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe2EucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHByb2Nlc3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCl9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxrZXlTaXplOjQsaXZTaXplOjQsX0VOQ19YRk9STV9NT0RFOjEsX0RFQ19YRk9STV9NT0RFOjIsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3c6Z31yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19KCl9KTtyLlN0cmVhbUNpcGhlcj1oLmV4dGVuZCh7X2RvRmluYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcHJvY2VzcyghMCl9LGJsb2NrU2l6ZToxfSk7dmFyIGM9ZS5tb2RlPXt9LHU9ci5CbG9ja0NpcGhlck1vZGU9bi5leHRlbmQoe2NyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUodCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZSh0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSl7dGhpcy5fY2lwaGVyPXQsdGhpcy5faXY9ZX19KSxfPWMuQ0JDPWZ1bmN0aW9uKCl7dmFyIGU9dS5leHRlbmQoKTtmdW5jdGlvbiByKGUscixuKXt2YXIgaSxhPXRoaXMuX2l2O2E/KGk9YSx0aGlzLl9pdj10KTppPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIHM9MDtzPG47cysrKWVbcitzXV49aVtzXX1yZXR1cm4gZS5FbmNyeXB0b3I9ZS5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplO3IuY2FsbCh0aGlzLHQsZSxpKSxuLmVuY3J5cHRCbG9jayh0LGUpLHRoaXMuX3ByZXZCbG9jaz10LnNsaWNlKGUsZStpKX19KSxlLkRlY3J5cHRvcj1lLmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemUsYT10LnNsaWNlKGUsZStpKTtuLmRlY3J5cHRCbG9jayh0LGUpLHIuY2FsbCh0aGlzLHQsZSxpKSx0aGlzLl9wcmV2QmxvY2s9YX19KSxlfSgpLGQ9KGUucGFkPXt9KS5Qa2NzNz17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGE9bjw8MjR8bjw8MTZ8bjw8OHxuLHM9W10sbz0wO288bjtvKz00KXMucHVzaChhKTt2YXIgbD1pLmNyZWF0ZShzLG4pO3QuY29uY2F0KGwpfSx1bnBhZDpmdW5jdGlvbih0KXt2YXIgZT0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1lfX07ci5CbG9ja0NpcGhlcj1oLmV4dGVuZCh7Y2ZnOmguY2ZnLmV4dGVuZCh7bW9kZTpfLHBhZGRpbmc6ZH0pLHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ7aC5yZXNldC5jYWxsKHRoaXMpO3ZhciBlPXRoaXMuY2ZnLHI9ZS5pdixuPWUubW9kZTt0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFP3Q9bi5jcmVhdGVFbmNyeXB0b3I6KHQ9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlJiZ0aGlzLl9tb2RlLl9fY3JlYXRvcj09dD90aGlzLl9tb2RlLmluaXQodGhpcyxyJiZyLndvcmRzKToodGhpcy5fbW9kZT10LmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPXQpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh0LGUpfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT8oZS5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksdD10aGlzLl9wcm9jZXNzKCEwKSk6KHQ9dGhpcy5fcHJvY2VzcyghMCksZS51bnBhZCh0KSksdH0sYmxvY2tTaXplOjR9KTt2YXIgZj1yLkNpcGhlclBhcmFtcz1uLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0KXt0aGlzLm1peEluKHQpfSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19KSxwPShlLmZvcm1hdD17fSkuT3BlblNTTD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9pLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdChlKTplKS50b1N0cmluZyhvKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGUscj1vLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09blswXSYmMTcwMTA3NjgzMT09blsxXSYmKGU9aS5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxmLmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6ZX0pfX0sZz1yLlNlcmlhbGl6YWJsZUNpcGhlcj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtmb3JtYXQ6cH0pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobik7dmFyIGk9dC5jcmVhdGVFbmNyeXB0b3IocixuKSxhPWkuZmluYWxpemUoZSkscz1pLmNmZztyZXR1cm4gZi5jcmVhdGUoe2NpcGhlcnRleHQ6YSxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTp0LmJsb2NrU2l6ZSxmb3JtYXR0ZXI6bi5mb3JtYXR9KX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtyZXR1cm4gbj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLG4pLmZpbmFsaXplKGUuY2lwaGVydGV4dCl9LF9wYXJzZTpmdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLnBhcnNlKHQsdGhpcyk6dH19KSx5PShlLmtkZj17fSkuT3BlblNTTD17ZXhlY3V0ZTpmdW5jdGlvbih0LGUscixuLGEpe2lmKG58fChuPWkucmFuZG9tKDgpKSxhKXM9bC5jcmVhdGUoe2tleVNpemU6ZStyLGhhc2hlcjphfSkuY29tcHV0ZSh0LG4pO2Vsc2UgdmFyIHM9bC5jcmVhdGUoe2tleVNpemU6ZStyfSkuY29tcHV0ZSh0LG4pO3ZhciBvPWkuY3JlYXRlKHMud29yZHMuc2xpY2UoZSksNCpyKTtyZXR1cm4gcy5zaWdCeXRlcz00KmUsZi5jcmVhdGUoe2tleTpzLGl2Om8sc2FsdDpufSl9fSx3PXIuUGFzc3dvcmRCYXNlZENpcGhlcj1nLmV4dGVuZCh7Y2ZnOmcuY2ZnLmV4dGVuZCh7a2RmOnl9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPShuPXRoaXMuY2ZnLmV4dGVuZChuKSkua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsbi5zYWx0LG4uaGFzaGVyKTtuLml2PWkuaXY7dmFyIGE9Zy5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIGEubWl4SW4oaSksYX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0LG4uaGFzaGVyKTtyZXR1cm4gbi5pdj1pLml2LGcuZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpKSkpKSkseS5leHBvcnRzKSxUPWUoQyksRj17ZXhwb3J0czp7fX07ZnVuY3Rpb24gSCgpe3JldHVybiBVfHwoVT0xLEYuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI9dCxuPXIubGliLGk9bi5Xb3JkQXJyYXksYT1uLkhhc2hlcixzPXIuYWxnbyxvPVtdLGw9W107IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtmb3IodmFyIHI9ZS5zcXJ0KHQpLG49MjtuPD1yO24rKylpZighKHQlbikpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gcih0KXtyZXR1cm4gNDI5NDk2NzI5NioodC0oMHx0KSl8MH1mb3IodmFyIG49MixpPTA7aTw2NDspdChuKSYmKGk8OCYmKG9baV09cihlLnBvdyhuLC41KSkpLGxbaV09cihlLnBvdyhuLDEvMykpLGkrKyksbisrfSgpO3ZhciBoPVtdLGM9cy5TSEEyNTY9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KG8uc2xpY2UoMCkpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLGE9clsyXSxzPXJbM10sbz1yWzRdLGM9cls1XSx1PXJbNl0sXz1yWzddLGQ9MDtkPDY0O2QrKyl7aWYoZDwxNiloW2RdPTB8dFtlK2RdO2Vsc2V7dmFyIGY9aFtkLTE1XSxwPShmPDwyNXxmPj4+NyleKGY8PDE0fGY+Pj4xOCleZj4+PjMsZz1oW2QtMl0seT0oZzw8MTV8Zz4+PjE3KV4oZzw8MTN8Zz4+PjE5KV5nPj4+MTA7aFtkXT1wK2hbZC03XSt5K2hbZC0xNl19dmFyIHc9biZpXm4mYV5pJmEsdj0objw8MzB8bj4+PjIpXihuPDwxOXxuPj4+MTMpXihuPDwxMHxuPj4+MjIpLG09XysoKG88PDI2fG8+Pj42KV4obzw8MjF8bz4+PjExKV4obzw8N3xvPj4+MjUpKSsobyZjXn5vJnUpK2xbZF0raFtkXTtfPXUsdT1jLGM9byxvPXMrbXwwLHM9YSxhPWksaT1uLG49bSsodit3KXwwfXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStzfDAscls0XT1yWzRdK298MCxyWzVdPXJbNV0rY3wwLHJbNl09cls2XSt1fDAscls3XT1yWzddK198MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLHI9dC53b3JkcyxuPTgqdGhpcy5fbkRhdGFCeXRlcyxpPTgqdC5zaWdCeXRlcztyZXR1cm4gcltpPj4+NV18PTEyODw8MjQtaSUzMixyWzE0KyhpKzY0Pj4+OTw8NCldPWUuZmxvb3Iobi80Mjk0OTY3Mjk2KSxyWzE1KyhpKzY0Pj4+OTw8NCldPW4sdC5zaWdCeXRlcz00KnIubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWEuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtyLlNIQTI1Nj1hLl9jcmVhdGVIZWxwZXIoYyksci5IbWFjU0hBMjU2PWEuX2NyZWF0ZUhtYWNIZWxwZXIoYyl9KE1hdGgpLHQuU0hBMjU2fShfKCkpKSxGLmV4cG9ydHN9dmFyIFosTT1lKEgoKSksTj17ZXhwb3J0czp7fX07dmFyIEksaj0oWnx8KFo9MSxOLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5QnVmZmVyKXt2YXIgZT10LmxpYi5Xb3JkQXJyYXkscj1lLmluaXQsbj1lLmluaXQ9ZnVuY3Rpb24odCl7aWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYodD1uZXcgVWludDhBcnJheSh0KSksKHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fCJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhDbGFtcGVkQXJyYXkmJnQgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheXx8dCBpbnN0YW5jZW9mIEludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIEludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkmJih0PW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCx0LmJ5dGVMZW5ndGgpKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl7Zm9yKHZhciBlPXQuYnl0ZUxlbmd0aCxuPVtdLGk9MDtpPGU7aSsrKW5baT4+PjJdfD10W2ldPDwyNC1pJTQqODtyLmNhbGwodGhpcyxuLGUpfWVsc2Ugci5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O24ucHJvdG90eXBlPWV9fSgpLHQubGliLldvcmRBcnJheX0oXygpKSksTi5leHBvcnRzKSxQPWUoaiksJD17ZXhwb3J0czp7fX07dmFyIEs9KEl8fChJPTEsJC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LkhtYWNTSEEyNTZ9KF8oKSxIKCksRSgpKSksJC5leHBvcnRzKSxYPWUoSyk7Y29uc3QgRz0hMTtsZXQgVyxZPWZldGNoO29ubWVzc2FnZT1mdW5jdGlvbih0KXtjb25zdHtqb2I6ZSxjbWQ6cixzZXJ2ZXI6bixwYXRoOmksYnVmZmVyOmEsa2V5QmFzZTY0OnMsZ3ppcDpsLHJlZmVycmVyOmgsaWQ6YyxhcHBJZDp1LHBlcnNpc3RlbnRJZDpfLENST1FVRVRfVkVSU0lPTjpkLGRlYnVnOmYsd2hhdDpwLG9mZmxpbmU6eX09dC5kYXRhO3kmJihZPWspO3N3aXRjaChyKXtjYXNlInVwbG9hZEVuY3J5cHRlZCI6eChpKTticmVhaztjYXNlImdldE9mZmxpbmVGaWxlIjp6KHQuZGF0YS51cmwpO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5lcnJvcigiVW5rbm93biB3b3JrZXIgY29tbWFuZCIscil9ZnVuY3Rpb24gdyh0KXtjb25zdCBlPURhdGUubm93KCkscj1QLmNyZWF0ZSh0KSxuPWcucGFyc2UocyksaT1YKHIsbiksYT1QLnJhbmRvbSgxNikse2NpcGhlcnRleHQ6b309VC5lbmNyeXB0KHIsbix7aXY6YX0pLGw9bmV3IEFycmF5QnVmZmVyKDQrYS5zaWdCeXRlcytpLnNpZ0J5dGVzK28uc2lnQnl0ZXMpLGg9bmV3IERhdGFWaWV3KGwpO2xldCB1PTA7aC5zZXRVaW50MzIodSwxMTI5NDY4MjA5LCExKSx1Kz00O2Zvcihjb25zdCB0IG9mW2EsaSxvXSlmb3IoY29uc3QgZSBvZiB0LndvcmRzKWguc2V0SW50MzIodSxlLCExKSx1Kz00O3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IGVuY3J5cHRlZCAoJHtsLmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLGx9ZnVuY3Rpb24gdih0KXtjb25zdCBlPURhdGUubm93KCkscj1vLmRlZmxhdGUodCx7Z3ppcDohMCxsZXZlbDoxfSk7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gY29tcHJlc3NlZCAoJHtyLmxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCkscn1mdW5jdGlvbiBtKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPU0oUC5jcmVhdGUodCkpLG49Zy5zdHJpbmdpZnkocikucmVwbGFjZSgvPS9nLCIiKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IGhhc2hlZCAoJHt0LmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLG59YXN5bmMgZnVuY3Rpb24gYih0KXtpZih5KXtjb25zdCBlPWBvZmZsaW5lOi8vLyR7dH1gO3JldHVybnt1cmw6ZSx1cGxvYWRVcmw6ZX19Y29uc3QgZT1EYXRlLm5vdygpLHI9YCR7bi51cmx9LyR7dH1gO2lmKCFuLmFwaUtleSlyZXR1cm57dXJsOnIsdXBsb2FkVXJsOnJ9O2NvbnN0IGk9YXdhaXQgWShyLHtoZWFkZXJzOnsiWC1Dcm9xdWV0LUF1dGgiOm4uYXBpS2V5LCJYLUNyb3F1ZXQtQXBwIjp1LCJYLUNyb3F1ZXQtSWQiOl8sIlgtQ3JvcXVldC1TZXNzaW9uIjpjLCJYLUNyb3F1ZXQtVmVyc2lvbiI6ZCwiWC1Dcm9xdWV0LVBhdGgiOm5ldyBVUkwoaCkucGF0aG5hbWV9LHJlZmVycmVyOmh9KSx7b2s6YSxzdGF0dXM6cyxzdGF0dXNUZXh0Om99PWk7aWYoIWEpdGhyb3cgRXJyb3IoYEVycm9yIGluIHNpZ25pbmcgVVJMOiAke3N9IC0gJHtvfWApO2NvbnN0e2Vycm9yOmwscmVhZDpnLHdyaXRlOnd9PWF3YWl0IGkuanNvbigpO2lmKGwpdGhyb3cgRXJyb3IobCk7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gdXBsb2FkIGF1dGhvcml6ZWQgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSx7dXJsOmcsdXBsb2FkVXJsOnd9fWFzeW5jIGZ1bmN0aW9uIHgodCl7dHJ5e2xldCByPXcobD92KGEpOmEpO0csdC5pbmNsdWRlcygiJUhBU0glIikmJih0PXQucmVwbGFjZSgiJUhBU0glIixtKHIpKSk7Y29uc3R7dXBsb2FkVXJsOm4sdXJsOml9PWF3YWl0IGIodCkscz1EYXRlLm5vdygpLHtvazpvLHN0YXR1czp1LHN0YXR1c1RleHQ6X309YXdhaXQgWShuLHttZXRob2Q6IlBVVCIsbW9kZToiY29ycyIsaGVhZGVyczp7IkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSJ9LHJlZmVycmVyOmgsYm9keTpyfSk7aWYoIW8pdGhyb3cgRXJyb3IoYHNlcnZlciByZXR1cm5lZCAke3V9ICR7X30gZm9yIFBVVCAke259YCk7ZiYmY29uc29sZS5sb2coYyxgJHtwfSB1cGxvYWRlZCAoJHt1fSkgaW4gJHtEYXRlLm5vdygpLXN9bXMgJHtpfWApLFcoe2pvYjplLHVybDppLG9rOm8sc3RhdHVzOnUsc3RhdHVzVGV4dDpfLGJ5dGVzOnIuYnl0ZUxlbmd0aH0pfWNhdGNoKHQpe2YmJmNvbnNvbGUuZXJyb3IoYCR7Y30gdXBsb2FkIGVycm9yICR7dC5tZXNzYWdlfWApLFcoe2pvYjplLG9rOiExLHN0YXR1czotMSxzdGF0dXNUZXh0OnQubWVzc2FnZX0pfX1mdW5jdGlvbiBrKHQsZSl7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYHN0b3JpbmcgJHt0fWApLHEuc2V0KHQsZS5ib2R5KSx7b2s6ITAsc3RhdHVzOjIwMSxzdGF0dXNUZXh0OiJPZmZsaW5lIGNyZWF0ZWQifX1mdW5jdGlvbiB6KHQpe2NvbnN0IHI9cS5nZXQodCk7aWYoIXIpcmV0dXJuIGYmJmNvbnNvbGUuZXJyb3IoYCR7Y30gZmlsZSBub3QgZm91bmQgJHt0fWApLHZvaWQgVyh7am9iOmUsb2s6ITEsc3RhdHVzOi0xLHN0YXR1c1RleHQ6Ik9mZmxpbmUgZmlsZSBub3QgZm91bmQifSk7ZiYmY29uc29sZS5sb2coYyxgcmV0cmlldmVkICR7dH1gKSxXKHtqb2I6ZSxvazohMCxzdGF0dXM6MjAwLHN0YXR1c1RleHQ6Ik9mZmxpbmUgZmlsZSBmb3VuZCIsYm9keTpyLGJ5dGVzOnIuYnl0ZUxlbmd0aH0pfX0sVz1wb3N0TWVzc2FnZTtjb25zdCBxPW5ldyBNYXB9KCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXVwbG9hZC5qcy5tYXAKCg=="),Wt=qh.CROQUET_VERSION,Jt=qh.CROQUET_PLATFORM==="node",Av="https://croquet.io/files/v1",$x="https://files.croquet.io",sp=$x,V=null;function qx(){globalThis.__MULTISYNQ__||(Jt?console.log("Croquet "+Wt):console.log("%cCroquet%c %c"+Wt,"color:#F0493E","color:inherit","color:"+(Wt.includes("+")?"#909":"inherit")));let i=!Jt&&window.location.hostname.match(/^(.*\.)?croquet\.io$/i)&&window.location.pathname.startsWith("/dev/"),e=K.dev||K.dev!==!1&&i;if(V={messages:K.has("debug","messages",!1),sends:K.has("debug","sends",!1),publish:K.has("debug","publish",!1),events:K.has("debug","events",!1),ticks:K.has("debug","ticks",!1),pong:K.has("debug","pong",!1),snapshot:K.has("debug","snapshot",!1),session:K.has("debug","session",!1),initsnapshot:K.has("debug","initsnapshot",!0),reflector:K.has("debug","reflector",e),offline:K.has("debug","offline",!1)},V.offline&&N.showMessage(`${N.libName}: offline mode enabled, no multiuser`,{level:"warning"}),K.box){let t=new URL(K.box,window.location).href;t.endsWith("/")||(t+="/"),K.reflector=t+"reflector",K.files=t+"files"}}function Hv(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V||qx(),typeof i=="string"&&(i=Object.fromEntries(i.split(",").map(e=>[e.replace(/^no/,""),!i.startsWith("no")])));for(let[e,t]of Object.entries(i))e in V?V[e]=t:N.showMessage(`${N.libName}: unknown debug option "${e}"`,{level:"warning",only:"once"});return V}var e2="wss://api.multisynq.io/depin",wP=e2,ue,bt,Ut="reflector",vP=K.nocheat,So=200,ko=[0],Ov=4096,rp,Kn=new bP;Kn.onerror=i=>console.error(`UploadWorker error: ${i.message}`);var Vv=0,Us=new Set;function zv(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=null;for(let t of Us)if(e||(e=t),t.id===i){e=t;break}if(e){let{appId:t,persistentId:n}=e.sessionSpec;return{appId:t,persistentId:n,key:e.key,uploadEncrypted:s=>e.uploadEncrypted(s),downloadEncrypted:s=>e.downloadEncrypted(s)}}return{}}Object.defineProperty(Oe,"controller",{get(){return this.controllers.values().next().value}}),Oe.controllers=Us;var Mp=class{constructor(){V||qx(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new Pp(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,Oe.removeAllSubscriptionsFor(this.viewId),Oe.addSubscription(this.viewId,"__views__",this.viewId,e=>dx(`users now ${e}`),"oncePerFrameWhileSynced"),this.leaving||N.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||this.sessionSpec.rejoinLimit===0}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;let{codeHash:e,computedCodeHash:t}=this.sessionSpec;return e!==t}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){let{name:t,optionsFromUrl:n,persistentIdOptions:s,password:r,appId:o,apiKey:a,viewData:l,viewIdDebugSuffix:h,location:c}=e,d=o?`${o}/${t}`:t;this.key=lv(r,"",{keySize:8,hasher:tv.algo.SHA1,iterations:1}),h&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+h).slice(0,16)).replace(/[^a-z0-9]/gi,S=>`_${S==="%"?"":S.charCodeAt(0).toString(16).toUpperCase()}`));let u={...e.options};if(n)for(let S of n)S in K&&(u[S]=K[S]);let f={},g={};for(let[S,P]of Object.entries(u))s?.includes(S)?f[S]=P:g[S]=P;let C=V.events||V.publish;C&&(g.__debugEvents=!0),c&&(g.__location=!0);let p=K.hashOverride||e.hashOverride,k=await async function(S,P){return Vs(S+qn(P))}(d,f),{developerId:T,token:M}=await this.verifyApiKey(a,o,k),{id:L,codeHash:b,computedCodeHash:m}=await async function(S,P,Z,E,D){let A,O,j=yw[S],U="";j?(A=j.codeHashes,O=j.computedCodeHash,U=" (code hashing from cache)"):(A=await Promise.all(Np),O=await Vs([D,...A].join("|")),yw[S]={codeHashes:A,computedCodeHash:O});let W=E||O,R=await Vs(S+"|"+P+qn(Z)+W);if(gw()&&!bw.has(R)){sM||[...document.getElementsByTagName("meta")].find(I=>I.getAttribute("charset"))||console.warn(`${N.libName}: Missing <meta charset="..."> declaration. ${N.libName} model code hashing might differ between browsers.`),bi[O].what="Version ID",bi[S].what="Persistent ID",bi[R].what="Session ID",W!==O&&(A.push(O),bi[O].what="Computed Version ID (replaced by overrideHash)",bi[W]={what:"Version ID (as specified by overrideHash)"});let X=[...A,W,S,R].map(I=>({hash:I,...bi[I]}));console.log(`${N.libName}: Debug Hashing for session ${R}${U}`,X),bw.add(R)}return gw()||(bi={}),{id:R,persistentId:S,codeHash:W,computedCodeHash:O}}(k,T,g,p,Wt);this.tove||(this.tove=await this.encrypt(L)),l&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(l)),V.session&&console.log(`${N.libName} session "${d}":
        sessionId=${L}${o?`
        persistentId=${k}`:""}
        versionId=${b===m?b:`${b} (specified in hashOverride)
        versionId=${m} (computed)`}
        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:u,name:d,id:L,persistentId:k,developerId:T,token:M,codeHash:b,computedCodeHash:m,debugEvents:C};let{msPerTick:w,multiplier:v}=this.getTickAndMultiplier();this.msPerTick=w,this.tickMultiplier=v,this.setUpActivityChecks()}async establishSession(){let{id:e,persistentId:t,codeHash:n}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:n,created:new Date().toISOString()}};let s=new Promise(r=>{this.sessionSpec.sessionJoined=r});this.checkForConnection(!1),V.session&&console.log(e,"waiting for join and SYNC"),await s,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(e){if(V.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(K.box||K.reflector)return{apiKey:"none",signServer:"none",reflector:K.reflector};let t={};for(let l of e.split(",")){let h=l.lastIndexOf(":"),c=l[h===-1?0:h+1];if(!c?.match(/^[12]$/))throw Error("Invalid API key: "+l);if(c in t)throw Error("Duplicate API key versions");t[c]={key:h===-1?l:l.slice(h+1),backend:h===-1?"":l.slice(0,h)}}let n=!t[1];n&&t[2].backend&&(n=t[2].backend),function(l){ue===void 0&&(ue="depin"in K?K.depin:l,ue&&!V.offline?(bt=ue===!0?wP:ue==="prod"?e2:ue==="dev"?"wss://api.multisynq.dev/depin":ue==="local"?"ws://localhost:8787":ue,bt.endsWith("/")&&(bt=bt.slice(0,-1)),bt=bt.replace(/^http(s):/,"ws$1:"),bt.startsWith("ws")||(bt=(Jt||window.location.protocol!=="https:"?"ws://":"wss://")+bt),Ut="synchronizer",V.session&&console.log(`DEPIN_API=${bt}`)):ue=!1)}(n);let s=t[ue?2:1];if(!s)throw Error(`No ${ue?"Multisynq":"Croquet"} API key provided`);let r=s.key,o=K.backend||s.backend,a=K.reflector?.includes("/");return o==="none"?{apiKey:r,signServer:"none",reflector:"overridden"}:ue?{apiKey:r,signServer:`${bt.replace(/^ws/,"http")}/clients`,reflector:"depin"}:{apiKey:r,signServer:"https://api.croquet.io/sign",reflector:a?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(e,t,n){let{signServer:s,apiKey:r}=this.getBackend(e);if(s==="none")return{developerId:"unknown_dev_id"};try{let a=await this.fetchWithRetries("verifying API key",[403],2,()=>fetch(`${s}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":r,"X-Croquet-App":t,"X-Croquet-Id":n,"X-Croquet-Version":Wt,"X-Croquet-Path":new URL(N.referrerURL()).pathname},referrer:N.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"})),l=await a.json(),{developerId:h,error:c}=l;if(c)throw Error(c);return V.session&&console.log(`${ue?"Multisynq":"Croquet"}: verified API key for developer ${h}`),l}catch(o){throw Error(`${ue?"Multisynq":"Croquet"} API key validation failed for "${r}": ${o.message}`)}}async fetchWithRetries(e,t,n,s){let r=1+n,o,a=0;for(;;){let l,h;try{if(l=await s(),l.ok)return l}catch(f){h=f}a++;let c="",d=l&&t.includes(l.status);if(d?c="fatal ":a===r&&(c="final "),o=l?`${c}status ${l.status} ${l.statusText} - "${await l.text()}"`:`${c}error "${h?.message}"`,a===r||d)break;let u=a===1?100:a===2?1e3:5e3;console.warn(`${o} while ${e}; retrying in ${u}ms`),await new Promise(f=>{setTimeout(f,u)})}throw console.warn(`${o} while ${e}; giving up`),Error(o)}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){let e=this.vm.snapshot(),t=this.lastKnownTime(e),n=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:n,date:new globalThis.CroquetViewDate().toISOString(),host:Jt?"localhost":window.location.hostname,sdk:Wt},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,n;try{e=te.begin("snapshot"),n=this.takeSnapshot()}catch(s){return Ke("snapshot",s),null}finally{t=te.end("snapshot")-e}return V.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)}ms`),n}setDebug(e){return Hv(e)}requestDebugSnapshot(){Hv("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(!this.connected||!this.vm||this.viewOnly)return;let t=this.vm.time,n=t-this.vm.lastSnapshotPoll;if(n<5e3&&!e)return void(V.snapshot&&console.log(`not requesting snapshot poll (${n}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(e){let r=Object.keys(this.vm.views);if(r.sort(),e!==this.viewId&&r[0]!==this.viewId&&r[1]!==this.viewId&&r[2]!==this.viewId)return void(V.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));V.snapshot&&console.log("forcing snapshot poll")}let s=new it(t,0,"_","handlePollForSnapshot",[]);this.sendTagged(s,{debounce:5e3,msgID:"pollForSnapshot"}),V.snapshot&&console.log(this.id,`requesting snapshot poll via ${Ut}`)}handlePollForSnapshot(e){if(this.synced!==!0||this.viewOnly)return void(this.triggeringCpuTime=null);let t=this.triggeringCpuTime||this.cpuTime,n,s,r;this.triggeringCpuTime=null,this.cpuTime=0;try{n=te.begin("snapshot"),s={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(o){return void Ke("snapshot",o)}finally{r=te.end("snapshot")-n,this.cpuTime-=r}V.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(r)}ms`),queueMicrotask(()=>this.pollForSnapshot(e,s))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),V.snapshot&&console.log(this.id,"sending snapshot vote",t),this.sendTutti({time:e,topic:"snapshot",data:t,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(e){let{tally:t}=e;V.snapshot&&console.log(this.id,"received snapshot votes",t);let{numberOfGroups:n,shouldUpload:s,dissidentFlag:r}=this.analyzeTally(t,"cpuTime");if(n>1){this.diverged=!0;let o=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${o})! Snapshots fall into ${n} groups`)}if(this.synced!==!0)V.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(s){let o={...this.auditStats},a=this.takeSnapshotHandleErrors();a&&queueMicrotask(()=>this.uploadSnapshot(a,o,r))}}analyzeTally(e,t){let n=!1,s=null,r=[],o={},a=null;Object.keys(e).forEach((u,f)=>{let g=JSON.parse(u);r.push(g);let{hash:C,viewId:p}=g;p===this.viewId&&(a=f),o[C]||(o[C]=[]),o[C].push(f)});let l=Object.keys(o),h=l.length,c=0;h>1&&(l.sort((u,f)=>o[f].length-o[u].length),o[l[0]].length===o[l[1]].length&&(V.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),l[1]<l[0]&&(c=1)));let d=l[c];if(a!==null){let u=r[a].hash,f=o[u];f.length>1&&f.sort((g,C)=>r[g][t]-r[C][t]),f[0]===a&&(n=!0,u!==d&&(s={groupVotes:f.length,allVotes:r.length}))}return{numberOfGroups:h,shouldUpload:n,dissidentFlag:s}}snapshotPath(e,t,n){let s=Math.ceil(e).toString().padStart(10,"0"),{appId:r,persistentId:o,codeHash:a,apiKey:l}=this.sessionSpec;return l?`apps/${r}/snap/${a}/${o}.${this.id}/${s}_${t}.${n}`:`snapshots/${this.id}/${s}_${t}-${n}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise(t=>{let n={...e};delete n.meta,Vs(JSON.stringify(n)).then(s=>{e.meta.hash=s,delete e.meta.hashPromise,t(s)})})),e.meta.hashPromise)}uploadServer(e){if(typeof K.files=="string"){let s=new URL(K.files,window.location).href;return s.endsWith("/")&&(s=s.slice(0,-1)),{url:s,apiKey:null}}let{apiKey:t,signServer:n}=this.getBackend(e);if(n==="none"&&!V.offline)throw Error("no file server configured");return{url:n,apiKey:t}}async uploadSnapshot(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;await this.hashSnapshot(e);let s=te.begin("snapshot"),r=JSON.stringify(e),o=te.end("snapshot")-s;V.snapshot&&console.log(this.id,`snapshot stringified (${r.length} bytes) in ${Math.ceil(o)}ms`);let{time:a,seq:l,hash:h}=e.meta,c=this.connection.socket;try{let d=await this.uploadEncrypted({content:r,path:this.snapshotPath(a,l,h),key:this.key,gzip:!0,debug:V.snapshot,what:"snapshot"});return this.connection.socket!==c?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(a,l,h,d,t,n),!0)}catch{return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(e,t,n,s,r,o){if(V.snapshot){let a=`time: ${e}, seq: ${t}, hash: ${n}`;o&&(a+=", as dissident; "+JSON.stringify(o)),console.log(this.id,`sending snapshot url to ${Ut} (${a}): ${s}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:e,seq:t,hash:n,url:s,auditStats:r,dissident:o}}))}catch(a){console.error("ERROR while sending",a)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${e}#${t}`,url:s,dissident:o})}async diffDivergedSnapshots(e){let t=await Promise.all(e.map(s=>this.downloadEncrypted({url:s,gzip:!0,key:this.key,debug:V.snapshot,json:!0,what:"diverged snapshot"})));for(let s of t)delete s.meta;let n=0;(function s(r,o,a){if(typeof r!=typeof o)console.log(`${a} diverged (${typeof r} vs ${typeof o}):`,r,o),n++;else if(Array.isArray(r)!==Array.isArray(o))console.log(`${a} diverged (array vs object):`,r,o),n++;else if(typeof r=="object"){let l=r?Object.keys(r):[],h=o?Object.keys(o):[],c=l.filter(u=>!h.includes(u)),d=h.filter(u=>!l.includes(u));(c.length||d.length)&&(console.log(`${a} diverged (keys mismatch):`,c,d),n++);for(let u of l)h.includes(u)&&s(r[u],o[u],`${a}${Fs(r,u)}`)}else r!==o&&(console.log(`${a} diverged (value mismatch):`,r,o),n++)})(t[0],t[1],"CROQUETVM"),n?console.log(`Total ${n} differences between diverged snapshots:`,t.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted(e){let{url:t,gzip:n,key:s,debug:r,json:o,what:a}=e;t.startsWith(Av)&&(t=t.replace(Av,$x));let l=t.startsWith("offline:"),h=l?1:3,c=Date.now(),d=await this.fetchWithRetries(`fetching ${a}`,[],h,()=>l?this.fetchOffline(t,a,r):fetch(t,{method:"GET",mode:"cors",referrer:N.referrerURL()})),u=await d.arrayBuffer();r&&console.log(this.id,`${a} fetched (${u.byteLength} bytes) in ${-c+(c=Date.now())}ms`),te.addNetworkTraffic(`${a}_in`,u.byteLength);let f=this.decryptBinary(u,s);r&&console.log(this.id,`${a} decrypted (${f.length} bytes) in ${-c+(c=Date.now())}ms`);let g=n?pP.inflate(f):f;return r&&n&&console.log(this.id,`${a} inflated (${g.length} bytes) in ${-c+(c=Date.now())}ms`),o?JSON.parse(new TextDecoder().decode(g)):g}async fetchOffline(e,t,n){let s=++Vv;return new Promise((r,o)=>{let a=Jt?"addListener":"addEventListener",l=Jt?"removeListener":"removeEventListener";Kn.postMessage({job:s,cmd:"getOfflineFile",url:e,id:this.id,what:t,debug:n,offline:V.offline});let h=c=>{if(s!==c.data.job)return;let{ok:d,status:u,statusText:f,body:g,bytes:C}=c.data;te.addNetworkTraffic(`${t}_out`,C),Kn[l]("message",h),d?r({arrayBuffer:()=>g}):o(Error(`${u}: ${f}`))};try{Kn[a]("message",h)}catch(c){console.log("failed to add listener",c)}})}async uploadEncrypted(e){let{content:t,path:n,key:s,gzip:r,keep:o,debug:a,what:l}=e,h=typeof t=="string"?new TextEncoder().encode(t).buffer:t,c=o?void 0:[h],d=typeof s=="string"?s:vt.stringify(s),{apiKey:u,appId:f,persistentId:g}=this.sessionSpec,C=++Vv;return new Promise((p,k)=>{let T=Jt?"addListener":"addEventListener",M=Jt?"removeListener":"removeEventListener";Kn.postMessage({job:C,cmd:"uploadEncrypted",server:this.uploadServer(u),path:n,buffer:h,keyBase64:d,gzip:r,referrer:N.referrerURL(),id:this.id,appId:f,persistentId:g,CROQUET_VERSION:Wt,debug:a,what:l,offline:V.offline},c);let L=b=>{if(C!==b.data.job)return;let{url:m,ok:w,status:v,statusText:S,bytes:P}=b.data;te.addNetworkTraffic(`${l}_out`,P),Kn[M]("message",L),w?p(m):k(Error(`${v}: ${S}`))};try{Kn[T]("message",L)}catch(b){console.log("failed to add listener",b)}})}persistentPath(e){let{appId:t,persistentId:n}=this.sessionSpec;return`apps/${t}/${n}/save/${e}`}pollForPersist(e,t,n,s,r){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(V.offline)return;let o={viewId:this.viewId,hash:s,ms:r+.001*Math.random()},a={persistTime:t,persistentHash:s,persistentString:n};V.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,o),this.sendTutti({time:e,topic:"persist",data:o,localContext:a,tallyTarget:["handlePersistVote"]})}async handlePersistVote(e){let{tally:t,localContext:n}=e;if(V.snapshot){let c=n?`for time @${n.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${c}`,t)}let{numberOfGroups:s,shouldUpload:r,dissidentFlag:o}=this.analyzeTally(t,"ms");if(s>1&&console.warn(this.id,`Persistence records fall into ${s} groups`),!r||!n)return;let{persistTime:a,persistentHash:l,persistentString:h}=n;this.doPersist(a,h,l,o)}async doPersist(e,t,n,s){let r=await this.uploadEncrypted({path:this.persistentPath(n),content:t,key:this.key,gzip:!0,debug:V.snapshot,what:"persistence"});if(V.snapshot){let o=s?` (as dissident; ${JSON.stringify(s)})`:"";console.log(this.id,`sending persistent data url to ${Ut}${o}: ${r}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:e,url:r,dissident:s}}))}catch(o){console.error("ERROR while sending",o)}}async forcePersist(e,t,n){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${t.length} bytes`),K.forcePersist==="alert"&&confirm("forcePersist triggered. Do it?"),await this.doPersist(e,t,n),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(e){let t="noop",n=[];switch(e[2].what){case"users":{let{joined:r,left:o,active:a,total:l}=e[2];this.users=a,this.usersTotal=l;let h="__VM__",c="__peers__",d={entered:r||[],exited:o||[],count:a,total:l};for(let u of d.entered.concat(d.exited))u.data&&(u.data=this.decryptPayload(u.data));t="publishFromModelOnly",n=[h,c,d],Oe.handleEvent(this.viewId+":__views__",d.count);break}case"tally":{let{tuttiSeq:r,tuttiKey:o,tally:a,tallyTarget:l,missingClients:h}=e[2];(V.messages||V.snapshot)&&h&&console.log(`${h} ${h===1?"client":"clients"} failed to participate in tally ${o||r}`),t="handleTuttiResult",n=[{tuttiSeq:r,tuttiKey:o,tally:a,tallyTarget:l}];break}case"audit":{let r=e[0];V.messages&&console.log(`audit request at time ${r}`),t="handleAuditRequest",n=[{time:r}];break}}let s=new it(0,0,"_",t,n);e[2]=s.asState()[2]}handleTuttiResult(e){let{tuttiSeq:t,tuttiKey:n,tally:s,tallyTarget:r}=e,o=n?d=>d.tuttiKey===n:d=>d.dummyTuttiSeq===t,a=this.tuttiHistory.findIndex(o),l=a!==-1&&this.tuttiHistory.splice(a,1)[0],h=null,c=null;if(l&&(h=l.payload,c=l.localContext),r){let[d,...u]=r,f=[...u,{tally:s,localPayload:h,localContext:c}],g=new it(0,0,"_",d,f);this.vm.verifyExternal(g),g.executeOn(this.vm,!0)}}handleAuditRequest(e){let{time:t}=e;this.vm.time!==t&&console.error(`time ${this.vm.time} cf audit time ${t}`);let{auditStats:n}=this,{lastUsers:s,minUsers:r,maxUsers:o,payloadTally:a,sessionTimeAtDispatch:l}=n;if(n.payloadTally=0,this.vm.time>l&&(n.minUsers=n.maxUsers=s),!this.fastForwardHandler){let h=te.networkTraffic.audit_reflector_in||0,c=te.networkTraffic.audit_reflector_out||0;te.resetAuditStats();let{clientId:d}=this.connection.socket;queueMicrotask(()=>{V.session&&console.log(this.id,`handling audit request at ${t} after ${h} bytes in, ${c} out`);let u=encodeURIComponent(JSON.stringify({time:t,clientId:d,lastUsers:s,minUsers:r,maxUsers:o,payloadTally:a,bytesIn:h,bytesOut:c})),f=`${bt}/clients/report?session=${this.id}&stats=${u}`.replace("ws","http");fetch(f,{mode:"no-cors"})})}}handleUserTotalForAccounting(e){if(ue){let{auditStats:t}=this;if(t.lastUsers=e,this.vm.time<=t.sessionTimeAtDispatch)return;(t.minUsers===-1||e<t.minUsers)&&(t.minUsers=e),e>t.maxUsers&&(t.maxUsers=e)}}messageSizeForAccounting(e){let t=typeof e[2]=="string"?e[2].length:e[2]._size||0;return t+=16,t}async receive(e,t){let n=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),Us.add(this);let{progressReporter:s}=this.sessionSpec,r=s||(()=>{}),{messages:o,url:a,persisted:l,time:h,seq:c,snapshotSeq:d,tove:u,reflector:f,flags:g,auditStatsInitializer:C}=t;if(u&&u!==this.tove)try{if(this.decrypt(u)!==this.id)throw Error("wrong sessionId in tove?!")}catch(w){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${w.message}`),4200),void r(-1)}let p=t.timeline;this.flags=g||{};let k=l?"persistence":"snapshot";V.session&&console.log(this.id,`received SYNC from ${f} ${Ut}: time ${h}, ${o.length} messages, ${k} ${a||"<none>"}`);let T=!!this.vm;if(T){this.networkQueue.length=0;let w=!!p&&p===this.timeline,v=o[0],S=c,P=d!==void 0?d:v?v[1]:S;V.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${P}-#${S}`);let Z=w&&zo(P,this.vm.seq)&&zo(this.vm.seq,S)&&h>=this.reflectorTime;if(Z){let E=0;v&&zo(v[1],this.vm.seq)&&(E=this.vm.seq-v[1]+1>>>0);for(let D=E;Z&&D<o.length;D++){let A=o[D][2];typeof A!="string"&&A.what==="users"&&A.left&&A.left.includes(this.viewId)&&(V.session&&console.log(this.id,`${Ut} reports that this view has left`),Z=!1)}Z&&E&&(V.messages&&console.log(this.id,`rejoin: discarding ${E} messages #${v[1]}-#${this.vm.seq}`),o.splice(0,E))}if(Z){if(this.sendBuffer.length>0){let E=this.sendBuffer;this.sendBuffer=[],V.session&&console.log(this.id,`rejoin: sending ${E.length} messages buffered while disconnected`);for(let D of E)D()}}else V.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),T=!1}let M=this.networkQueue;this.networkQueue=[];for(let w of o){let v=this.messageSizeForAccounting(w);if(typeof w[2]!="string")this.convertReflectorMessage(w);else try{w[2]=this.decryptPayload(w[2])[0]}catch(S){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${S.message}`),4200),void r(-1)}V.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(w)),this.networkQueue.push([w,v])}if(this.networkQueue.push(...M),h>this.reflectorTime&&this.timeFromReflector(h,"reflector"),T)return V.session&&console.log(this.id,"seamless rejoin successful"),void(this.syncCompleted=!0);let L;if(this.timeline=p||"",V.snapshot&&a&&console.log(this.id,`fetching ${k} ${a}`),a)try{L=await this.downloadEncrypted({url:a,gzip:!0,key:this.key,debug:V.snapshot,json:!0,what:k})}catch(w){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${k}: ${w.message}`),4200),void r(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void r(-1);if(l){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(L)}else L&&(this.sessionSpec.snapshot=L),this.install();C&&(V.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(C)}`),this.auditStats=C),V.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${h}`);let b=this.vm.time,m=await new Promise(w=>{let{port1:v,port2:S}=new MessageChannel;v.onmessage=()=>{let P=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(r(1),w(!0),P=!1);else{let Z=(this.vm.time-b)/(this.reflectorTime-b);r(Z)}else V.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),r(-1),w(!1),P=!1;P&&this.stepSession("fastForward",{budget:So})},this.fastForwardHandler=P=>{this.connected&&this.vm?P==="error"?(r(-1),w(!1)):S.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),r(-1),w(!1))},queueMicrotask(()=>this.stepSession("fastForward",{budget:So}))});return delete this.fastForwardHandler,void(m&&(V.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&N.showMessage(`${N.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{let s=t;s[1]>>>=0;let r=this.messageSizeForAccounting(s);if(typeof s[2]!="string")V.messages&&console.log(this.id,"received META "+JSON.stringify(s)),this.convertReflectorMessage(s),V.messages&&console.log(this.id,"converted to "+JSON.stringify(s));else try{let[a,l,h]=this.decryptPayload(s[2]);s[2]=a,l===this.viewId&&this.addToStatistics(h,this.lastReceived),V.messages&&console.log(this.id,"received "+JSON.stringify(s))}catch(a){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${a.message}`),4200)}let o;return this.networkQueue.push([s,r]),this.flags.rawtime&&(o=s[s.length-1]),this.timeFromReflector(s[0],"reflector",o),void(this.simulateIfNeeded&&queueMicrotask(()=>this.simulateIfNeeded()))}case"TICK":{if(!this.vm)return;let s=typeof t=="number"?t:t.time;if(V.ticks){let r=n&&this.lastReceived-n-this.msPerTick*this.tickMultiplier|0,o=s-this.vm.time;console.log(this.id,`received TICK ${s} ${Math.abs(r)<5?"on time":r<0?"early":"late"} (${o} ms, jitter ${r>0?"+":""}${r} ms)`)}return this.timeFromReflector(s,"reflector"),this.tickMultiplier>1&&this.multiplyTick(s),void(this.simulateIfNeeded&&queueMicrotask(()=>this.simulateIfNeeded()))}case"INFO":{let{msg:s,options:r}=t,o=ue?"Multisynq Synchronizer":"Croquet Reflector";return void N.showMessage(`${o}: ${s}`,r)}case"REQU":return V.snapshot&&console.log(`received REQU (snapshot request) from ${Ut}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",e,t)}}install(e){let t=Date.now(),{snapshot:n,initFn:s,options:r,debugEvents:o}=this.sessionSpec,[a,l]=n.models?["deserializ","snapshot"]:["initializ","root model"];V.session&&console.log(this.id,`${a}ing ${l}`);let h=new tt(n,o,()=>{try{return s(r,e)}catch(d){throw Ke("init",d,"fatal"),d}},this.migratingOldSnapshot);if((V.session||V.snapshot&&n.models)&&console.log(this.id,`${l} ${a}ed in ${Date.now()-t}ms`),V.initsnapshot&&!n.models){V.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let d=null;try{d=JSON.stringify(h.snapshot())}catch(u){throw Ke("initial snapshot",u,"fatal"),u}try{h=new tt(JSON.parse(d),o,()=>s(r))}catch(u){throw Ke("initial snapshot resume",u,"fatal"),u}}let c=this.lastKnownTime(h);this.reflectorTime=Math.max(this.reflectorTime,c),this.setVM(h)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),V.session&&console.log(this.id,"Controller sending JOIN");let{tick:e,delay:t}=this.getTickAndMultiplier(),{name:n,codeHash:s,appId:r,apiKey:o,persistentId:a,developerId:l,heraldUrl:h,rejoinLimit:c,autoSleep:d,computedCodeHash:u,location:f,flags:g}=this.sessionSpec,C=ue?"hiddenName":n,p=ue?"hiddenApiKey":this.getBackend(o).apiKey,k=ue?"hiddenAppId":r,T=ue?"hiddenUrl":N.referrerURL(),M=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:f?[this.viewId]:this.viewId,L={name:C,apiKey:p,appId:k,url:T,persistentId:a,sdk:Wt,developerId:l,version:1,user:M,location:f,ticks:{tick:e,delay:t},dormantDelay:d,tove:this.tove,codeHash:s};h&&Object.assign(L,{heraldUrl:h}),c&&Object.assign(L,{leaveDelay:c+250}),u!==s&&Object.assign(L,{computedCodeHash:u}),g&&Object.assign(L,{flags:g}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:L})),this.syncReceiptTimeout=setTimeout(()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))},5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout(()=>{this.leaving?V.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(V.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())},this.sessionSpec.rejoinLimit)))}leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],{rebootModelView:t}=this.sessionSpec;if(this.reset(),V.session&&console.log(this.id,`resetting ${e?"(but keeping)":"and discarding"} controller`),e||Us.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");t()}async encrypt(e){let t=jn.random(16),n=Lh.encrypt(e,this.key,{iv:t}),s=Vf(e,this.key);return`${vt.stringify(t)}${vt.stringify(s)}${n}`}get deprecatedDefaultKey(){return rp||(rp=lv("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:tv.algo.SHA1,iterations:1})),rp}decrypt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.key,n=vt.parse(e.slice(0,24)),s=vt.parse(e.slice(24,68)),r=e.slice(68),o=Lh.decrypt(r,t,{iv:n}),a="";try{a=s3.stringify(o)}catch{}let l=Vf(a,this.key);if(this.compareHmacs(s.words,l.words))return a;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(e,t){let n=new TextDecoder().decode(new Uint8Array(e,0,4)),s,r,o,a,l;switch(typeof t=="string"&&(t=vt.parse(t)),n){case"CRQ0":s=new TextDecoder().decode(e),r=vt.parse(s.slice(4,28)),o=vt.parse(s.slice(28,72)),a=s.slice(72),l=Lh.decrypt(a,t,{iv:r});break;case"CRQ1":s=new Uint8Array(e),r=jn.create(s.subarray(4,20)),o=jn.create(s.subarray(20,52)),a=jn.create(s.subarray(52)),l=Lh.decrypt({ciphertext:a},t,{iv:r});break;default:throw Error(`${this.id} unknown encryption version ${n}`)}l.clamp();let h=Vf(l,t);if(this.compareHmacs(o.words,h.words))return ox(l);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(e,t,n){let[s,r,o]=e.asState();return[s,r,await this.encryptPayload([o,t,n])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let n=e.length===t.length;for(let s=0;s<e.length;s++)e[s]!==t[s]&&(n=!1);return n}sendMessage(e){if(this.viewOnly||!this.vm)return;let t=e.asState()[2].length;if(t>16384)return void console.warn(this.id,`Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to ${Ut}.`);!this.payloadSizeWarned&&t>Ov&&(console.log(this.id,`Message with payload of ${t} bytes being sent to ${Ut}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);let n=Date.now(),s=this.rateLimitedSendTimes,r=this.rateLimitBuffer;if(te.perSecondTally({requestedMessages:1}),r.length)return void this.addToRateLimitBuffer(e);let o=0;if(s.length&&this.synced){let a=s[s.length-1],l=1e3/this.eventRateLimit-(n-a);l>1&&(o=Math.ceil(l))}o?(this.addToRateLimitBuffer(e),setTimeout(()=>this.serviceRateLimitBuffer(),o)):(this.recordRateLimitedSend(n),this.socketSendMessage(e),te.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){let t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(this.id,`Sends to ${Ut} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){te.perSecondTally({bundledMessages:1});let t=Date.now(),n=e.asState(),s=n[2].length,r=this.rateLimitBuffer;if(r.length){let a=r[r.length-1],{msgStates:l,totalPayload:h}=a;if(h<Ov)return l.push({msgState:n,bufferTime:t}),void(a.totalPayload+=s)}te.perSecondTally({newBundles:1}),r.push({msgStates:[{msgState:n,bufferTime:t}],totalPayload:s});let o=r.length;V.session&&o%5==0&&o!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${o} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=o),o>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&o>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;let e=this.rateLimitBuffer;if(!e.length)return;let t=Date.now(),n=1e3/this.eventRateLimit,s=this.rateLimitedSendTimes;if(s.length){let c=s[s.length-1];if(n-(t-c)>0)return}let r=e.shift(),{msgStates:o,totalPayload:a}=r,l=[],h=0;if(o.forEach(c=>{l.push(c.msgState),h+=t-c.bufferTime}),l.length===1){let c=it.fromState(l[0],this.vm);this.socketSendMessage(c)}else{let c=new it(this.vm.time,0,"_","handleBundledEvents",[l]);this.socketSendMessage(c)}if(this.recordRateLimitedSend(t),te.perSecondTally({sentBundles:1,sentMessagesTotal:o.length,sendDelay:h,sentBundlePayload:a,sentPayloadTotal:a}),V.session&&this.connected){let c=e.length;c&&c%5==0&&c!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${c} event bundles`),this.rateLimitLastLogged=c)}e.length&&setTimeout(()=>this.serviceRateLimitBuffer(),n)}async socketSendMessage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=await this.encryptMessage(e,this.viewId,Date.now()),s=V.sends&&(t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(V.sends&&console.log(this.id,`buffering ${s}`),this.sendBuffer.push(()=>this.socketSendMessage(e,t))));V.sends&&console.log(this.id,`sending ${s}`);let r={id:this.id,action:"SEND",args:[...n,this.latency]};t&&(r.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(r))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti(e){let{time:t,topic:n,data:s,localContext:r=null,firstMessage:o=null,wantsVote:a=!0,tallyTarget:l=null}=e;if(this.viewOnly)return;let h=o&&await this.encryptMessage(o,this.viewId,Date.now()),c=qn(s);if(!this.connected||!this.syncCompleted)return void(this.vm&&(V.sends&&console.log(this.id,`buffering "${n}" TUTTI ${c} ${o&&o.asState()}`),this.sendBuffer.push(()=>this.sendTutti({time:t,topic:n,data:s,localContext:r,firstMessage:o,wantsVote:a,tallyTarget:l}))));V.sends&&console.log(this.id,`sending "${n}" TUTTI ${c} ${o&&o.asState()}`),this.lastSent=Date.now();let d=`${n}@${t}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,0,c,h,a,l,d]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:t,tuttiKey:d,dummyTuttiSeq:0,payload:c,localContext:r})}sendLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.connected&&this.syncCompleted?(V.sends&&console.log(this.id,"sending LOG"),t.length<2&&(t=t[0]),this.connection.send(JSON.stringify({action:"LOG",args:t}))):this.vm&&(V.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push(()=>this.sendLog(...t)))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){let e=this.sessionSpec.options,t=["number","string"].includes(typeof e.tps)?e.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[n,s]=(t+"x").split("x").map(h=>Number.parseFloat("0"+h)),r=1e3/Math.max(1/30,Math.min(60,n)),o=Math.max(1,s),a=r,l=0;return o>1&&!vP&&(a=r/o,l=Math.ceil(a*(o-1))),{msPerTick:a,multiplier:o,tick:r,delay:l}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{let o=te.begin("simulate");for(;t;){let a=this.networkQueue[0];if(!a)break;let[l,h]=a;if(t=this.vm.advanceTo(l[0],e),!t)break;this.networkQueue.shift(),ue&&(this.auditStats.payloadTally+=h);let c=this.vm.scheduleExternalMessage(l);t=this.vm.advanceTo(c.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,te.end("simulate")-o)}te.backlog(this.backlog);let n=this.lag,s=Math.max(200,.1*this.msPerTick),r=Math.max(2e3,.2*this.msPerTick);if(typeof this.synced=="boolean"&&this.viewed&&(this.synced&&n>r||!this.synced&&n<s)&&(this.synced?this.applySyncChange(!1):this.syncTimer||(this.syncTimer=setTimeout(()=>{delete this.syncTimer,this.connected&&this.lag<s&&this.applySyncChange(!0)},200))),!V.offline)if(this.synced&&t&&this.vm.time-this.lastSnapshotRequest>5e3){let o=!1;this.cpuTime>5e3?(V.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),o=!0):ue&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(V.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),o=!0),o&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout(()=>this.scheduleSnapshot(),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return t}catch(t){return Ke("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}stepSession(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=te.stepSession(t.frameTime,!0);n&&console.log(n);let{backlog:s,latency:r,starvation:o,activity:a}=this;if(e==="animation"){te.animationFrame(t.frameTime,{backlog:s,starvation:o,latency:r,activity:a,users:this.users});let h=Date.now();if(this.lastAnimationEnd){let c=h-this.lastAnimationEnd;if(this.animationGapCheck===!0&&c>200&&(this.animationGapCheck=[],V.session&&console.log(this.id,"animation has stopped (too long between steps)")),this.animationGapCheck!==!0){let d=this.animationGapCheck;d.push(c),d.length>4&&d.shift(),d.length===4&&d.reduce((u,f)=>u+f,0)<=400&&(this.animationGapCheck=!0,V.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=h}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let l;switch(e){case"animation":{let h=t.expectedSimFPS,c=Date.now(),d=ko.reduce((u,f)=>u+f,0)/ko.length;if(l=this.simulate(c+Math.min(d,So)),l===!1){let u=h===0?0:1e3/h*4;this.backlog>u&&(l=this.simulate(c+So-d))}l!=="error"&&(ko.push(Date.now()-c),ko.length>4&&ko.shift());break}case"fastForward":case"background":l=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(l),l!=="error"&&(te.begin("update"),this.processModelViewEvents(e==="animation"),te.end("update"),this.vm&&(this.serviceRateLimitBuffer(),e==="animation"&&(t.view&&(te.begin("render"),this.inViewRealm(()=>t.view.update(t.frameTime)),te.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(e){V.session&&console.log(this.id,`synced=${e}`),this.synced=e,N.showSyncWait(!e),this.vm.publishFromView(this.viewId,"synced",e)}inViewRealm(e){return Yo(this.vm,()=>e(this.vm))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,n){e<this.reflectorTime?(t!=="controller"||V.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):(typeof this.synced!="boolean"&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&te.backlog(this.backlog),this.tickHook&&this.tickHook(e,n))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);let t=this.msPerTick,n=this.tickMultiplier,s=1;this.localTicker=globalThis.setInterval(()=>{this.timeFromReflector(Math.round(e+s*t),"controller"),V.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,s),++s>=n&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)},t)}startStepping(e){let t=n=>{this.leaving||(this.isOutOfSight()||e(n),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){let e=null;this.isOutOfSight=()=>!(Jt||document.visibilityState!=="hidden"&&e),this.isBeingAnimated=()=>{let o=this.animationGapCheck===!0,a=Date.now()-this.lastAnimationEnd<200;return o&&!a&&(this.animationGapCheck=[],V.session&&console.log(this.id,"animation has stopped (too long since last step)")),o&&a},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated(),!Jt&&new IntersectionObserver((o,a)=>e=o[0].isIntersecting).observe(document.body);let t=this.sessionSpec.autoSleep,n;if(t){let o=1e3*t,a=0,l=0;n=()=>{let h=Date.now();h-a<980||(a=h,this.isOutOfSight()?l?h-l>o&&(this.dormantDisconnect(),l=0):l=h:l=0)}}let s=()=>{this.leaving?r&&(clearInterval(r),r=null):this.connected&&this.vm&&(n&&n(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))},r=setInterval(s,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(s(),!this.fastForwardHandler&&this.connected)){let o=.9*this.msPerTick;t&&(o=Math.min(o,So));let a=this.synced?"background":"fastForward";this.stepSession(a,{budget:o})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}},Pp=class{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let e;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;let t=()=>{V.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,te.connected(!0),this.controller.sendJoin()};if(V.offline)e=new Lp,e.isConnected=()=>e.readyState===WebSocket.OPEN;else if(ue){let{synchSpec:n,developSpec:s}=K;if(n&&s)throw Error("Cannot handle both synchSpec and developSpec options");let r="",o=n||s;o&&(r+=`&synch=${encodeURIComponent(o)}`);let a=this.id,{persistentId:l,appId:h,developerId:c}=this.controller.sessionSpec;e=new Tp(`${bt}/clients/connect?session=${a}&persist=${l}&app=${encodeURIComponent(h)}&developer=${c}${r}`),e.isConnected=()=>e.dataChannel?.readyState==="open",e.onconnected=t}else{let n=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector,s=Jt?void 0:window.location.href,r={},o=this.controller.sessionSpec.token;if(o&&(r.token=o),K.reflector){let l=K.reflector.toUpperCase();l==="CF"||l.match(/^[A-Z]{3}$/)?(n=V.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",l.length===3&&(r.colo=l)):K.reflector.match(/^[-a-z0-9]+$/i)?r.region=K.reflector:n=new URL(K.reflector,s).href.replace(/^http/,"ws")}if(!n.match(/^wss?:/))throw Error("Cannot interpret reflector address "+n);n.endsWith("/")||(n+="/");let a=new URL(n+this.id,s);for(let[l,h]of Object.entries(r))a.searchParams.append(l,h);e=new WebSocket(a),e.isConnected=()=>e.readyState===WebSocket.OPEN}e.onopen=n=>{let s=this.socket;s&&(s.onopen=s.onmessage=s.onerror=s.onclose=null),this.socket=e,this.connectHasBeenCalled=!1,e.twoStageConnection||t()},e.onmessage=n=>{if(e!==this.socket)return;let{data:s}=n;if(s.startsWith("_CHUNK")){let o=s.charAt(6)==="1",a=s.charAt(7)==="1",l=s.slice(8);if(o&&(e.chunkCollector=[]),e.chunkCollector.push(l),a){let h="".concat(...e.chunkCollector);e.chunkCollector=[],te.addNetworkTraffic("reflector_in",h.length,!!ue),this.receive(h)}}else te.addNetworkTraffic("reflector_in",s.length,!!ue),this.receive(s)},e.onerror=n=>{V.session&&console.log(this.id,e.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},e.onclose=n=>{this.socket&&e!==this.socket||this.socketClosed(n.code,n.reason)}}socketClosed(e,t){V.session&&console.log(this.id,`socketClosed with code=${e} message="${t}"`),e>=4100&&e!==4110&&(V.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);let n=!this.controller.leaving&&e!==1e3&&e<4100,s=e===4110;s||e===1e3||this.reconnectDelay||setTimeout(()=>{if(this.connected||this.socket?.isConnecting?.())return;let r=n?"Reconnecting":"Connection closed";N.showMessage(`${r}: ${e} ${t}`,{level:n?"warning":"fatal"})},500),V.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${e} ${t}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),te.connected(!1),te.resetAuditStats(),s?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),n&&(V.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout(()=>{delete this.reconnectTimeout,this.connectToReflector()},this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e),te.addNetworkTraffic("reflector_out",e.length,!!ue)}receive(e){this.lastReceived=Date.now();let{id:t,action:n,args:s}=JSON.parse(e);if(t)try{this.controller.receive(n,s)}catch(r){this.closeConnectionWithError("receive",r)}else if(n==="PONG"){if(V.pong&&console.log("PONG after",Date.now()-s,"ms"),this.pongHook)try{this.pongHook(s)}catch(r){console.error(r)}}else console.warn("Unknown action",n)}dormantDisconnect(){this.connected&&(V.session&&console.log(this.id,`dormant; disconnecting from ${Ut}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4e3;console.error(n,t),this.closeConnection(n,`Error in ${e}: ${t.message||t}`)}closeConnection(e,t){if(this.socket){this.socket.onclose=null;try{this.socket.close(e,t)}catch(n){console.error(`Error in socket.close(${e}, ${JSON.stringify(t)}):`,n)}}this.socketClosed(e,t)}PULSE(e){this.connected&&(this.socket.bufferedAmount===0?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){this.lastReceived!==0&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((ue?"Synchronizer":"Reflector")+" has gone away")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();this.connected&&this.send(JSON.stringify({action:"PING",args:e}))}};globalThis.setInterval(()=>{for(let i of Us)i.connected&&i.vm&&i.connection.keepAlive(Date.now())},100);var op=Symbol("hash"),ap=Symbol("key"),Xh=Symbol("url"),Fv=new Map,Kv=0;function Co(i){return K.has("debug",i,!1)}function lp(i){return i.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Lo(i){return i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+3&-4,"=")}function _h(i,e){return i||(i="*"),e.replace(/[\s\S]/g,t=>String.fromCharCode(t.charCodeAt(0)^i.charCodeAt(0)))}var Rp=class{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(e,t,n){if(tt.hasCurrent())throw Error(`${N.libName}.Data.store() called from Model code`);let s,r,o;if(typeof e=="string"?(s=e,e=t,r=!0,o=n):(s=t&&t.sessionId,r=t&&t.shareable,o=t&&t.keep),!(e instanceof ArrayBuffer))throw Error(`${N.libName}.Data.store() called with non-ArrayBuffer data`);let{appId:a,persistentId:l,key:h,uploadEncrypted:c}=zv(s),d=r?jn.random(32).toString(vt):vt.stringify(h),u=`apps/${a}/${l}/data/%HASH%`,f="data#"+ ++Kv;Co("data")&&console.log(`${N.libName}.Data: storing ${f} ${e.byteLength} bytes`);let g=await c({path:u,content:e,key:d,keep:o,debug:Co("data"),what:f}),C=function(k){return k.replace(/.*\//,"")}(g),p=new lt(C,r&&d,g);return Co("data")&&console.log(`${N.libName}.Data: stored ${f} as ${this.toId(p)}`),p}static async fetch(e,t){let n;if(t&&t[Xh]?(n=e,e=t):n=t&&t.sessionId,tt.hasCurrent())throw Error(`${N.libName}.Data.fetch() called from Model code`);let{downloadEncrypted:s,key:r}=zv(n),o=e&&e[op],a=e&&e[ap]||vt.stringify(r),l=e&&e[Xh];if(typeof o!="string"||typeof a!="string"||typeof l!="string")throw Error(`${N.libName}.Data.fetch() called with invalid handle`);let h="data#"+ ++Kv;return Co("data")&&console.log(`${N.libName}.Data: fetching ${h} ${this.toId(e)}`),s({url:l,key:a,debug:Co("data"),what:h})}static hash(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"base64url";typeof e=="function"&&(e=Function.prototype.toString.call(e)),typeof e=="string"?e=new TextEncoder().encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=new TextEncoder().encode(qn(e)));let n=sx(jn.create(e));switch(t){case"hex":return n.toString();case"base64":return n.toString(vt);case"base64url":return lp(n.toString(vt));default:throw Error(`${N.libName}.Data: unknown hash output "${t}", expected "hex"/"base64"/"base64url"`)}}static fromId(e){let t=e.slice(0,1),n,s,r,o;switch(t){case"0":n=e.slice(1,44),s=e.slice(44),r=`${sp}/sessiondata/${n}`;break;case"1":n=e.slice(1,44),s=e.slice(44,87)+"=",o=e.slice(87),r=`${sp}/apps/${o}/data/${n}`;break;case"2":n=e.slice(1,44),s=Lo(e.slice(44,87)),o=_h(s,atob(Lo(e.slice(87)))),r=`${sp}/apps/${o}/data/${n}`;break;case"3":s=Lo(e.slice(1,44)),r=_h(s,atob(Lo(e.slice(44)))),n=r.slice(-43);break;case"4":s=null,r=_h(s,atob(Lo(e.slice(1)))),n=r.slice(-43);break;default:throw Error(`${N.libName}.Data expected handle v0-v4 got v${t}`)}return new this(n,s,r)}static toId(e){if(!e)return"";let t=e[op],n=e[ap],s=e[Xh];if(s.slice(-43)!==t)throw Error(`${N.libName} Data: malformed URL`);let r=n&&lp(n),o=lp(btoa(_h(n,s)));return n?`3${r}${o}`:`4${o}`}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,s=Fv.get(e);if(s)return s;if(n.slice(-43)!==e)throw Error(`${N.libName} Data: malformed URL`);Object.defineProperty(this,op,{value:e}),t&&Object.defineProperty(this,ap,{value:t}),Object.defineProperty(this,Xh,{value:n}),Fv.set(e,this)}},lt=class extends Rp{},Bp={cls:lt,write:i=>lt.toId(i),read:i=>lt.fromId(i)},Q=null,_i=null,To=Symbol("DEBUG_WRITE_TARGET"),an=null;function Fs(i,e){return Array.isArray(i)||typeof e!="string"?`[${e}]`:e.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${e}`:`["${e}"]`}var Yh=class extends Error{};function Yv(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>Q.random(),globalThis.CroquetViewMath={};for(let[i,e]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[i]=e.value;for(let[i,e]of Object.entries(globalThis.CroquetMath)){let t=Math[i];Math[i]=e.length===1?n=>Q?e(n):t(n):(n,s)=>Q?e(n,s):t(n,s)}}if(!globalThis.CroquetViewDate){let t=function(s,r){return e||(e=!0,console.warn(new Yh(`${s} used in Model code`))),r},n=function(s,r,o,a,l,h,c){let d=this instanceof n,u=[s,r,o,a,l,h,c];if(u.length=arguments.length,Q)switch(t(d?"new Date()":"Date()"),arguments.length){case 0:u.push(Q.time);break;case 1:break;default:u[0]=i.UTC(...u),u.length=1}let f=new i(...u);return d?f:""+f},i=globalThis.Date,e=!1;n.prototype=i.prototype,n.UTC=i.UTC,n.now=()=>Q?t("Date.now()",Q.time):i.now(),n.parse=function(){return Q?t("Date.parse()",0):i.parse(...arguments)},globalThis.CroquetViewDate=i,globalThis.Date=n}}Object.defineProperty(Yh.prototype,"name",{value:`${N.libName}Warning`});var yn=Symbol("QFUNC");function t2(i,e,t,n){let s=new Zp(i,e,t,n),r=s.compile();return r[yn]=s,r}function i2(i,e,t,n){let s=[],r=[],o,a,l,h;if(t){if("this"in t){for(e=t.this,o="_this";o in t;)o="_"+o;delete(t={...t,[o]:e}).this}if(l=[...Object.keys(t).sort()],h=[...l.map(p=>t[p])],l.length){for(a="env";a in t||a===n;)a="_"+a;s.push(a),r.push(h)}}i.match(/\bCroquet\b/)&&!l?.includes("Croquet")&&(s.push("Croquet"),r.push(pe.Croquet)),i.match(/\bMultisynq\b/)&&!l?.includes("Multisynq")&&(s.push("Multisynq"),r.push(pe.Croquet));let c=n||"qFunc";for(;l?.includes(c);)c="_"+c;let d=`"use strict"

`;d+=`// Croquet QFunc Compiler by Codefrau

`,d+=`//////////////// Start Compiler /////////////////
`,d+="try { const ",l?.length&&(d+=`[${l.join(", ")}] = ${a}, `);let u=i.split(`
`),f=u.slice(1),g=Math.min(...f.map(p=>p.match(/^\s*/)[0].length));g>0&&(u.some(p=>(p.match(/`/g)||[]).length%2==1)||(u=[u[0],...f.map(p=>p.slice(g))],i=u.join(`
`)));let C=u[u.length-1].match(/^\s*/)[0];C&&(i=C+i),d+=`${c} =
`,d+=`//////////////// Start User Code ////////////////

`,d+=i,d+=`

///////////////// End User Code /////////////////
`,d+=`return ${c}`,o&&(d+=`.bind(${o})`),d+=` } catch (compileError) { return compileError; }
`,d+="///////////////// End Compiler //////////////////";try{let p=new Function(...s,d).call(e,...r);if(p instanceof Error)throw console.warn("rethrowing error",p),p;return p}catch(p){throw console.warn(`createQFunc compiling:

${i}`),Error(`createQFunc(): ${p.message}`)}}var Zp=class{constructor(e,t,n,s){if(this.thisVal=e,this.env=t,this.selfRef=s,this.source=n,s===void 0){this.selfRef="",typeof n=="function"&&(this.source=n.toString());let r=Object.keys(t);for(let o of r)if(n===t[o]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${o} cannot both reference the function`);this.selfRef=o}this.selfRef&&(this.env={...t},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return i2(this.source,this.thisVal,this.env,this.selfRef)}},jp={cls:yn,write:i=>{let{[yn]:{thisVal:e,env:t,source:n,selfRef:s}}=i;return[e,n,s,...Object.entries(t).flat()]},read:i=>{let[e,t,n,...s]=i,r={};for(let o=0;o<s.length;o+=2)r[s[o]]=s[o+1];return t2(e,r,t,n)}},Bh="future message",Bv="message in cancelFuture",Up="subscription handler";function n2(i){return`qFunc~${i.split(" ")[0]}~`}var s2=n2(Bh),Ep=n2(Up);function xP(i){return i===Bh||i===Up}function Xp(i){return i.startsWith(s2)}function jv(i){return`${Ep}${i}`}function Ih(i,e){return!!i.startsWith(Ep)&&i.slice(Ep.length)===e}function r2(i,e){if(Q)throw Error("VirtualMachine confusion");if(!(i instanceof tt))throw Error("not a VM: "+i);let t=Q;try{Q=i,globalThis.CROQUETVM=i,e()}finally{Q=t}}var SP="#reflected",_p=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],Jp={};for(let i=0;i<_p.length;i++)Jp[_p[i]]=i;var Ip=new WeakMap;function Uv(i){Ip.set(i,null)}var Gp=class{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}},tt=class{static current(){return Q||console.warn("VirtualMachine.current() called from outside the vm!"),Q}static hasCurrent(){return!!Q}static evaluate(e){if(Q)return e();Yv();let t=Q;try{return Q=new Gp,e()}finally{Q=t}}constructor(e,t,n,s){Yv(),_i={snapshot:K.has("debug","snapshot",!1),session:K.has("debug","session",!1),write:K.has("debug","write",!1)},Uv(this),r2(this,()=>{fx(this,()=>{if(this.models={},this.namedModels={},this.messages=new xp((r,o)=>r.before(o)),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=t,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,e.models){let r=ia.newOrRecycled(this).readVM(e,"VM",s),o=[],a=[];for(let l of Object.keys(r))l!=="meta"&&(l==="staticInitializers"?o=r[l]:l in this?l==="_random"?this[l]=new Hh(null,{state:r[l]}):l==="messages"?a=r.messages:this[l]=r[l]:console.warn(`Ignoring property snapshot.${l}`));for(let l of o)l();for(let l of a)this.messages.add(l);for(let[l,h]of Object.entries(this.subscriptions))for(let c of h){let[d]=c.split("."),u=this.subscribers.get(d);u||this.subscribers.set(d,u=new Set),u.add(l)}}else this._random=new Hh(e.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),n(this)})})}registerModel(e,t){if(Q!==this)throw Error("You can only create models from model code!");return t||(t="M"+ ++this.modelsId),this.models[t]=e,t}deregisterModel(e){if(Q!==this)throw Error("You can only destroy models from model code!");let t=this.models;delete this.models[e];for(let[n,s]of Object.entries(this.namedModels))t===s&&delete this.namedModels[n];this.messages.removeMany(n=>n.hasReceiver(e))}lookUpModel(e){if(e==="_")return this;let t=this.models[e];if(t)return t;let[n,s,r]=e.match(/^([^#]+)#(.*)$/)||[];return t=this.models[s],t&&t.lookUp(r)}get(e){let t=this.namedModels[e];return Q!==this&&_i.write&&t?this.debugWriteProxy(this,t,t.id):t}set(e,t){if(Q!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[e]=t}debugWriteProxy(e,t,n){if(typeof t!="object"||t===null||t[To])return t;if(t instanceof pe&&(n=t.id),!this.$debugWriteProxyHandler){let r=function(o,a,l){l&&(o+=` ${l} of`);let h=an.get(a).path;if(console.warn(`write-debug: non-model code is ${o} ${h}:`,a),l&&l[0]!=="$")throw Error(`write-debug: Attempt to modify ${N.libName} model state from outside!`)};an||(an=new WeakMap),this.$debugWriteProxyHandler={set(o,a,l){Q!==e?r("assigning",o,a):console.warn(`${N.libName} debug write protection inside model - this should not happen!`),o[a]=l},deleteProperty(o,a){Q!==e?r("deleting",o,a):console.warn(`${N.libName} debug write protection inside model - this should not happen!`),delete o[a]},get(o,a){if(a===To)return o;let l=o[a];if(l&&l[To])return l;if(Q!==e){if(typeof l=="object"&&l!==null){let h=an.get(o).path;if(l instanceof Map){let c=new Map([...l.entries()].map((d,u)=>{let[f,g]=d;return[e.debugWriteProxy(e,f,`${h}.key#${u}`),e.debugWriteProxy(e,g,`${h}.value#${u}`)]}));return c[To]=l,c.set=()=>r("setting an item in",l),c.delete=()=>r("deleting from",l),c.clear=()=>r("clearing",l),an.set(l,{proxy:c,path:h+Fs(l,a)}),c}if(l instanceof Set){let c=new Set([...l.values()].map((d,u)=>e.debugWriteProxy(e,d,`${h}.item#${u}`)));return c[To]=l,c.add=()=>r("adding to",l),c.delete=()=>r("deleting from",l),c.clear=()=>r("clearing",l),an.set(l,{proxy:c,path:h+Fs(l,a)}),c}return e.debugWriteProxy(e,l,h+Fs(l,a))}}else console.warn(`${N.libName} debug write protection inside model - this should not happen!`);return l}}}let s=an.get(t);return s||(s={proxy:new Proxy(t,this.$debugWriteProxyHandler),path:n},an.set(t,s)),s.proxy}noop(){}generateJoinExit(e){let{entered:t,exited:n,count:s,total:r}=e;this.controller.handleUserTotalForAccounting(r);let o={};for(let h of t){if(typeof h=="string")continue;let c,d,u;Array.isArray(h)?[c,d]=h:(c=h.id,u=h.data,d=h.location),o[c]={},u&&(o[c].data=u),d&&(d.region&&(d.country=d.region.slice(0,2),d.region=d.region.slice(2)),o[c].loc=d)}if(t=t.map(h=>typeof h=="string"?h:Array.isArray(h)?h[0]:h.id),n=n.map(h=>typeof h=="string"?h:Array.isArray(h)?h[0]:h.id),t.length===s){n=Object.keys(this.views);for(let h of n)this.views[h].extraConnections=0}if(t.length>0&&n.length>0&&t.some(h=>n.includes(h))){for(let h=0;h<t.length;h++){let c=t[h],d=n.indexOf(c);d>=0&&(t.splice(h,1),n.splice(d,1),h--)}if(t.length+n.length===0)return}let a=h=>{let{data:c,loc:d}=this.views[h];if(!c)return h;let u={viewId:h,viewData:c};return d&&(u.location=d),u};for(let h of n)if(this.views[h]){if(this.views[h].extraConnections){this.views[h].extraConnections--,_i.session&&console.log(this.id,`@${this.time}#${this.seq} view ${h} closed extra connection`);continue}let c=a(h);delete this.views[h],this.publishFromModelOnly(this.id,"view-exit",c)}else{let{time:c,seq:d}=this;console.error(`${this.id} @${c}#${d} view ${h} exited without being present - this should not happen`),Promise.resolve().then(()=>{this.controller.sendLog(`view-exit-mismatch @${c}#${d} ${h} left without being present`)})}for(let h of t)if(this.views[h])_i.session&&console.log(this.id,`@${this.time}#${this.seq} view ${h} opened another connection`),this.views[h].extraConnections=(this.views[h].extraConnections||0)+1;else{this.views[h]=o[h]||{};let c=a(h);this.publishFromModelOnly(this.id,"view-join",c)}let l=Object.values(this.views).reduce((h,c)=>h+1+(c.extraConnections||0),0);if(s!==l){let{time:h,seq:c}=this;console.error(`@${h}#${c} view count mismatch (model: ${l}, reflector: ${s}) - this should not happen`),Promise.resolve().then(()=>{this.controller.sendLog(`view-exit-mismatch @${h}#${c} connections model: ${l} reflector: ${s}`)})}}scheduleExternalMessage(e){let t=it.fromState(e,this);if(t.time<this.time)throw Error("past message from reflector "+e);let n=this.externalSeq+1>>>0;if(t.seq!==n)throw Error(`External message error. Expected message #${n} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if(e.receiver!=="_")throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in Jp))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,n,s){if(e.every)return this.futureRepeat(e.every,t,n,s);if(e<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;let r=new it(this.time+e,2*this.futureSeq,t,n,s);return this.messages.add(r),{time:r.time,seq:r.seq}}cancelFuture(e,t){let n=this.messages,s;if(typeof t.time=="number"){let{time:r,seq:o}=t;s=n.removeOne(a=>a.time===r&&a.seq===o)}else{if(t==="*")return s=n.removeMany(r=>r.receiver===e.id),s.length>0;{let r=this.asMethodName(e,t,Bv),o=e.id;s=n.removeOne(a=>a.receiver===o&&a.selector===r||a.receiver==="_"&&a.selector==="futureExecAndRepeat"&&a.args[1]===o&&a.args[2]===r),Xp(r)&&delete e[r]}}return s!==void 0}futureRepeat(e,t,n,s){this.futureSend(e,"_","futureExecAndRepeat",[e,t,n,s])}futureExecAndRepeat(e,t,n,s){let r=this.lookUpModel(t);if(r){if(typeof r[n]=="function")try{r[n](...s)}catch(o){Ke(`future message ${r}.${n}`,o)}else{let o=this.compileFuncString(n,r);try{o(...s)}catch(a){Ke(`future message ${r} ${o}`,a)}}this.futureRepeat(e,t,n,s)}}future(e,t,n,s){if(!this.lookUpModel(e.id))throw Error(`future send to unregistered model ${e}`);if(n===void 0){let o=this;return new Proxy(e,{get:(a,l)=>function(){for(var h=arguments.length,c=new Array(h),d=0;d<h;d++)c[d]=arguments[d];return o.future(e,t,l,c)}})}let r=this.asMethodName(e,n,Bh);if(typeof r!="string")throw Error(`future message to ${e} ${r} is not a string`);if(typeof e[r]!="function"&&r.indexOf(".")<0&&r[0]!=="{")throw Error(`future send to ${e} with unknown method ${r}()`);return this.futureSend(t,e.id,r,s)}advanceTo(e,t){if(Q)throw Error("cannot advance time from model code");let n;for(;(n=this.messages.peek())&&n.time<=e;){let{time:s,seq:r}=n;if(s<this.time)throw Error("past message encountered: "+n);if(1&r&&(this.seq=this.seq+1>>>0,r/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${r/2>>>0} in ${n}`);if(this.messages.poll(),this.time=n.time,n.executeOn(this),globalThis.CroquetViewDate.now()>=t)return!1}return this.time=e,!0}asMethodName(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(typeof t=="string")return t;if(typeof t=="function"){if(e[t.name]===t)return t.name;if(t[yn]&&s){let h=jv(s);if(e[h]===t)return h}let o=e;for(;o!==null;){for(let[h,c]of Object.entries(Object.getOwnPropertyDescriptors(o)))if(c.value===t){if(t[yn]&&((r=n)!==Bh&&r!==Bv||!Xp(h)))continue;return h}if(o===e&&t[yn]){if(!xP(n))return un(`${n} is not a registered QFunc: ${t}`,{only:"once"}),null;let h;if(s)h=jv(s);else{let c=s2,d=0;do h=`${c}${d++}`;while(e[h])}return e[h]=t,h}o=Object.getPrototypeOf(o)}un(`${n} is not a method of ${e} and not a QFunc: ${t}
`,{only:"once"});let a=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,l=t.toString().match(a);return!l||l[3]&&l[3]!==l[1]?this.asFuncString(t):l[2]}var r;return null}asFuncString(e){let t=e.toString();return`{${btoa(JSON.stringify(t))}}`}compileFuncString(e,t){this.$compiledFuncs||(this.$compiledFuncs={});let n=t.id+":"+e,s=this.$compiledFuncs[n];if(!s){let r=JSON.parse(atob(e.slice(1,-1)));s=i2(r,t),r.startsWith("function")&&(s=s.bind(t)),this.$compiledFuncs[n]=s}return s}addSubscription(e,t,n,s){if(Q!==this)throw Error("Cannot add a model subscription from outside model code");if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);let r=t+":"+n,o=this.asMethodName(e,s,Up,r);if(typeof o!="string")throw Error(`Subscription handler for "${n}" must be a method name`);if(o.indexOf(".")<0&&typeof e[o]!="function"&&o[0]!=="{")throw Error(`Subscriber method for "${n}" not found: ${e}.${o}()`);let a=e===this?"_":e.id,l=a+"."+o;if(t==="*"||n==="*")return void this.addGenericSubscription(r,l);if(this.subscriptions[r]){if(this.subscriptions[r].indexOf(l)!==-1)throw Error(`${e}.${o} already subscribed to ${n}`)}else this.subscriptions[r]=[];this.subscriptions[r].push(l);let h=this.subscribers.get(a);h||this.subscribers.set(a,h=new Set),h.add(r)}removeSubscription(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*";if(Q!==this)throw Error("Cannot remove a model subscription from outside model code");if(t==="*"||n==="*")return void this.removeGenericSubscription(e,t,n,s);let r=t+":"+n,o=this.subscriptions[r];if(o){let a=e.id+".";if(s==="*"){for(let h=o.length-1;h>=0;h--)if(o[h].startsWith(a)){let c=o[h].slice(a.length);Ih(c,r)&&delete e[c],o.splice(h,1)}o.length===0&&delete this.subscriptions[r]}else{let h=this.asMethodName(e,s,"unsubscribe argument",r);if(typeof h!="string")throw Error(`Invalid unsubscribe args for "${n}" in ${e}: ${s}`);let c=a+h,d=o.indexOf(c);if(d!==-1&&(o.splice(d,1),o.length===0&&delete this.subscriptions[r],Ih(h,r)&&delete e[h]),o.find(u=>u.startsWith(a)))return}let l=this.subscribers.get(e.id);l.delete(r),l.size===0&&this.subscribers.delete(e.id)}}addGenericSubscription(e,t){this.genericSubscriptions.push({topic:e,handler:t})}removeGenericSubscription(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*",r=t+":"+n,o=e.id+".";for(let a=this.genericSubscriptions.length-1;a>=0;a--){let l=this.genericSubscriptions[a];l.topic===r&&l.handler.startsWith(o)&&(s!=="*"&&l.handler!==o+s||(this.genericSubscriptions.splice(a,1),Ih(s,r)&&delete e[s]))}}removeAllSubscriptionsFor(e){let t=this.subscribers.get(e.id);if(t){let n=e.id+".";for(let s of t){let r=this.subscriptions[s];for(let o=r.length-1;o>=0;o--)if(r[o].startsWith(n)){let a=r[o].slice(n.length);Ih(a,s)&&delete e[a],r.splice(o,1)}r.length===0&&delete this.subscriptions[s]}this.subscribers.delete(e.id)}}publishFromModel(e,t,n){if(Q!==this)throw Error("Cannot publish a model event from outside model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);let s=t.endsWith(SP);s&&(t=t.slice(0,t.length-10));let r=this.currentEventFromModel;this.currentEventFromModel=!0;let o=e+":"+t;this.handleModelEventInModel(o,n,s),this.handleModelEventInView(o,n),this.currentEventFromModel=r}publishFromModelOnly(e,t,n){if(Q!==this)throw Error("Cannot publish a model event from outside model code");let s=e+":"+t;this.handleModelEventInModel(s,n)}publishFromView(e,t,n){if(Q)throw Error("Cannot publish a view event from model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);let s=e+":"+t;this.handleViewEventInModel(s,n),this.handleViewEventInView(s,n)}handleBundledEvents(e){for(let t of e){let n=it.fromState(t,this);this.verifyExternal(n),n.executeOn(this,!0)}}handleModelEventInModel(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(Q!==this)throw Error("handleModelEventInModel called from outside model code");if(n){if(this.controller.synced!==!0)return;let s=e+"#__vote",r=e+"#divergence",o=!!Oe.subscriptions[s],a=!!this.subscriptions[e],l=!!this.subscriptions[r];o&&l&&console.log(`divergence subscription for ${e} overridden by vote subscription`);let h=a?new it(this.time,0,"_","handleModelEventInModel",[e,t]):null,c;c=o?["handleModelEventInView",s]:["handleTuttiDivergence",r],Promise.resolve().then(()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:h,wantsVote:o,tallyTarget:c}))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(e,t),this.subscriptions[e]&&this.invokeHandlers(this.subscriptions[e],e,t)}invokeHandlers(e,t,n){let s=e.slice();for(let r=0;r<s.length;r++){let o=s[r];(o===e[r]||e.includes(o))&&this.invokeHandler(o,t,n)}}invokeGenericHandlers(e,t){let[n,s]=e.split(":");if(!(n.startsWith("__")&&n.endsWith("__")||s.startsWith("__")&&s.endsWith("__")))for(let r of this.genericSubscriptions){let[o,a]=r.topic.split(":");(o==="*"&&a===s||o===n&&a==="*"||o==="*"&&a==="*")&&this.invokeHandler(r.handler,e,t)}}invokeHandler(e,t,n){let s=this.currentEvent;this.currentEvent=t;try{let[r,...o]=e.split("."),a=o.join("."),l=this.lookUpModel(r);if(!l)return void un(`event ${t} .${a}(): subscriber not found`);if(a[0]==="{"){let h=this.compileFuncString(a,l);try{h(n)}catch(c){Ke(`event ${t} ${l} ${h}`,c)}return}if(a.indexOf(".")>=0){let h=a.indexOf("."),c=a.slice(0,h),d=a.slice(h+1);try{l.call(c,d,n)}catch(u){Ke(`event ${t} ${l}.call(${JSON.stringify(c)}, ${JSON.stringify(d)})`,u)}return}if(typeof l[a]!="function")return void Ke(`event ${t} ${l}.${a}(): method not found`);try{l[a](n)}catch(h){Ke(`event ${t} ${l}.${a}()`,h)}}finally{this.currentEvent=s}}handleViewEventInModel(e,t){if(this.subscriptions[e]){let n=[e];t!==void 0&&n.push(t);let s=new it(this.time,0,"_","handleModelEventInModel",n);this.controller.sendMessage(s)}}handleModelEventInView(e,t){_i.write&&(t=this.debugWriteProxy(this,t,`event ${e} arg`)),Oe.handleEvent(e,t,n=>function(s){if(!Q)throw Error("VirtualMachine confusion");let r=Q;try{Q=null,s()}finally{Q=r}}(()=>Yo(this,n,!0)))}handleViewEventInView(e,t){Oe.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{let n=e.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${n}:`,t)}}handleSessionDiverged(e){let{key:t,url:n}=e;this.diverged||(this.diverged=new Map);let s=this.diverged.get(t);s||this.diverged.set(t,s=[]),s.push(n),s.length===2&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(t)}debugDiverged(e){e||(e=this.diverged.keys().next().value);let t=this.diverged.get(e);if(!t||t.length<2)throw Error(`no diverged urls for snapshot ${e}`);Promise.resolve().then(()=>this.controller.diffDivergedSnapshots(t))}processModelViewEvents(e){if(Q)throw Error("cannot process view events in model code");return Yo(this,()=>Oe.processFrameEvents(e,!!this.controller.synced))}handlePollForSnapshot(){let e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}handleAuditRequest(e){this.controller.handleAuditRequest(e)}snapshot(){return ta.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return qn(new Wp().getHash(this))}debug(e){return this.controller.setDebug(e)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(e,t){this.controller&&this.controller.sessionSpec.appId==="no.appId"&&console.warn(`${N.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);let n=te.begin("snapshot"),s=typeof t=="function"?t.call(e):t;if(typeof s!="object")throw Error(`${N.libName}: persistSession() can only persist objects (got ${typeof s})`);let r=qn(s),o=lt.hash(r),a=te.end("snapshot")-n,l=this.persisted===o,h=this.time;var c,d;if(_i.snapshot&&console.log(this.id,`persistent data @${h} collected, stringified and hashed in ${Math.ceil(a)}ms${l?" (unchanged, ignoring)":""}`),K.forcePersist&&queueMicrotask(()=>this.controller.forcePersist(h,r,o)),!l)if(c=this,d={persistTime:h,persistentString:r,persistentHash:o,ms:a},Ip.set(c,d),this.persisted=o,this.inPersistenceCoolOff)_i.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{let u=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;u>0?(_i.snapshot&&console.log(this.id,`postponing persistence poll by ${u}ms`),this.futureSend(u,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;let e=(t=this,Ip.get(t));var t;if(!e)return;let{persistTime:n,persistentString:s,persistentHash:r,ms:o}=e;if(Uv(this),this.controller&&this.controller.synced){_i.snapshot&&console.log(this.id,`asking controller to poll for persistence @${n}`);let a=this.time;Promise.resolve().then(()=>this.controller.pollForPersist(a,n,s,r,o))}}random(){if(Q!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(Q!==this)throw Error("synchronized random accessed from outside the model");let e="";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}};function kP(i,e,t){let n;if(i==="_"){let s=Jp[e];typeof s=="number"&&(n=s.toString(36))}if(n===void 0&&(n=`${i}>${e}`),t.length>0){let s=jh.newOrRecycled();n+=JSON.stringify(s.encode(t))}return n}function zo(i,e){return(e-i|0)>=0}var it=class i{constructor(e,t,n,s,r){this.time=e,this.seq=t,this.receiver=n,this.selector=s,this.args=r}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?zo(this.externalSeq,e.externalSeq):zo(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,kP(this.receiver,this.selector,this.args)]}static fromState(e,t){let[n,s,r]=e,{receiver:o,selector:a,args:l}=function(h,c){let d,u,f;if(h.length===1||h[1]==="["){let C=parseInt(h[0],36);d="_",u=_p[C],f=h.slice(1)}else{let C=h.indexOf(">"),p=h.indexOf("[");p===-1&&(p=h.length),d=h.slice(0,C),u=h.slice(C+1,p),f=h.slice(p)}let g=[];return f&&(g=Uh.newOrRecycled(c).decode(JSON.parse(f))),{receiver:d,selector:u,args:g}}(r,t);return new i(n,s,o,a,l)}executeOn(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];e.currentEventFromModel=!this.isExternal();let n=t?l=>l():l=>r2(e,()=>fx(e,l)),{receiver:s,selector:r,args:o}=this,a=e.lookUpModel(s);if(a)if(r[0]==="{"){let l=e.compileFuncString(r,a);n(()=>{try{l(...o)}catch(h){Ke(`${this.shortString()} ${l}`,h)}})}else r.indexOf(".")>=0?n(()=>{let l=r.indexOf("."),h=r.slice(0,l),c=r.slice(l+1);try{a.call(h,c,...o)}catch(d){Ke(`${this.shortString()} ${a}.call(${JSON.stringify(h)}, ${JSON.stringify(c)})`,d)}}):typeof a[r]!="function"?un(`${this.shortString()} ${a}.${r}(): method not found`):n(()=>{try{if(Xp(r)){let l=a[r];delete a[r],l(...o)}else a[r](...o)}catch(l){Ke(`${this.shortString()} ${a}.${r}()`,l)}});else un(`${this.shortString()} ${r}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){let{receiver:e,selector:t,args:n}=this,s=this.isExternal(),r=s?this.externalSeq:this.internalSeq;return`${s?"External":"Future"}Message[${this.time}${":#"[+s]}${r} ${e}.${t}(${n.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}},CP=(()=>{let i=new ArrayBuffer(8),e=new DataView(i);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})(),Wp=class{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",it),this.addHasher("Teatime:Data",Bp),this.addHasher("Teatime:QFunc",jp);for(let[e,t]of pe.allClassTypes())this.addHasher(e,t)}addHasher(e,t){let{cls:n,write:s}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:r=>({...r})};s&&this.hashers.set(n,r=>this.hashStructure(r,s(r)))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(let[t,n]of Object.entries(e))if(t!=="controller"&&t!=="meta")if(t==="_random")this.hash(n.state(),!1);else if(t==="messages"){let s=n.asArray();(this.hashState.fC=s.length)&&this.hash(s,!1)}else this.hashEntry(t,n);return this.hashDeferred(),this.hashState}hashDeferred(){let e=0;for(;e<this.todo.length;){let{key:t,value:n}=this.todo[e++];this.hashEntry(t,n,!1)}this.todo.length=0}hash(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];switch(typeof e){case"number":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?e===0?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=CP(e)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=e.length);case"boolean":case"undefined":return;case"bigint":if(e===0n)this.hashState.zC++;else{this.hashState.nC++;let n=e<0?-1n:0n;for(;e!==n;)this.hashState.nH+=Number(0xFFFFFFFFn&e),e>>=32n}return;default:{if(this.done.has(e)||e===null)return;if(this.hashers.has(e.constructor))return void this.hashers.get(e.constructor)(e);let n=Object.prototype.toString.call(e).slice(8,-1);if(this.hashers.has(n))return void this.hashers.get(n)(e);switch(n){case"Array":return void this.hashArray(e,t);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(e));case"Set":return void this.hashStructure(e,[...e]);case"Map":return void this.hashStructure(e,[...e],!1);case"DataView":return void this.hashIntArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(e);case"Float32Array":case"Float64Array":return void this.hashArray(e,!1);case"Object":e instanceof pe?this.hashModel(e):e.constructor===Object&&this.hashObject(e,t)}}}}hashModel(e){this.hashState.mC++,this.done.add(e);for(let[t,n]of Object.entries(e))t!=="__realm"&&n!==void 0&&this.hashEntry(t,n)}hashObject(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.hashState.oC++,this.done.add(e);for(let[n,s]of Object.entries(e))s!==void 0&&this.hashEntry(n,s,t)}hashArray(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.done.add(e);for(let n=0;n<e.length;n++)this.hashEntry(n,e[n],t)}hashIntArray(e){this.done.add(e);for(let t=0;t<e.length;t++){let n=e[t];n===0?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=n)}}hashStructure(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];t!==void 0&&(this.done.add(e),this.hash(t,n))}hashEntry(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];e[0]!=="$"&&(n&&typeof t=="object"?this.todo.push({key:e,value:t}):this.hash(t,n))}},ta=class{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",it),this.addWriter("Teatime:Data",Bp),this.addWriter("Teatime:QFunc",jp);for(let[t,n]of pe.allClassTypes())this.addWriter(t,n);this.okayToIgnore={$debugWriteProxyHandler:!0};for(let t of pe.allClasses())if(Object.prototype.hasOwnProperty.call(t,"okayToIgnore")){let n=t.okayToIgnore();if(!Array.isArray(n))throw new Error("okayToIgnore() must return an array");for(let s of n){if(s[0]!=="$")throw Error(`okayToIgnore: ignored prop "${s}" must start with '$'`);this.okayToIgnore[s]=!0}}}addWriter(e,t){let n=Object.getPrototypeOf(t)===Object.prototype,{cls:s,write:r}=n?t:{cls:t,write:o=>({...o})};if(s===Object)throw Error(`${N.libName} types: '${e}' is the Object class itself, must be a user class`);if(s===Array)throw Error(`${N.libName} types: '${e}' is the Array class, must be a user class`);r?this.writers.set(s,(o,a)=>this.writeAs(e,o,r(o),n?`${a}.write(${s.name})`:a)):t.writeStatic||console.warn(`${N.libName} types: ${e} does not implement write() or writeStatic()`)}snapshot(e,t){let n={_random:e._random.state(),messages:this.write(e.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(n);for(let[s,r]of Object.entries(e))s in n||this.writeInto(n,s,r,t);return this.writeDeferred(),delete n.controller,delete n.subscribers,delete n.$compiledFuncs,n}writeAllStaticInto(e){for(let t of pe.allClasses())if(t!==pe)for(let[n,s]of Object.entries(t)){if(n[0]==="$")continue;let r=pe.classToID(t);e.staticModelProps||(e.staticModelProps={}),r in e.staticModelProps||(e.staticModelProps[r]={}),this.writeInto(e.staticModelProps[r],n,s,`Model(${r}).static`),Jh("Model",r)}for(let[t,n]of pe.allClassTypes())if(typeof n=="object"){let{writeStatic:s}=n;if(s){let r=s();r&&(e.staticTypeProps||(e.staticTypeProps={}),e.staticTypeProps[t]=this.write(r,`Type(${t}).writeStatic()`),Jh("Type",t))}}}writeDeferred(){let e=0;for(;e<this.todo.length;){let{state:t,key:n,value:s,path:r}=this.todo[e++];this.writeInto(t,n,s,r,!1)}this.todo.length=0}write(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];switch(typeof e){case"number":return Object.is(e,-0)?{$class:"NegZero"}:Number.isFinite(e)?e:Number.isNaN(e)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(e)};case"string":case"boolean":return e;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:e.toString()};default:{if(this.refs.has(e))return this.writeRef(e);if(e===null)return e;if(this.writers.has(e.constructor))return this.writers.get(e.constructor)(e,t);let s=Object.prototype.toString.call(e).slice(8,-1);if(this.writers.has(s))return this.writers.get(s)(e,t);switch(s){case"Array":return this.writeArray(e,t,n);case"ArrayBuffer":return this.writeArrayBuffer(e);case"Set":return this.writeAs(s,e,[...e],t);case"Map":return this.writeAs(s,e,[...e].flat(),t);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(s,e);case"Object":if(e instanceof pe)return this.writeModel(e,t);if(e.constructor===Object||typeof e.constructor!="function")return this.writeObject(e,t,n);throw console.warn(`${N.libName}: unknown class at ${t}:`,e),Error(`${N.libName}: class not registered in Model.types(): ${e.constructor.name}`);case"Function":if(e[yn])return this.writers.get(yn)(e,t);throw console.warn(`${N.libName}: found function at ${t}:`,e),Error(`${N.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${N.libName}: unsupported property at ${t}:`,e),Error(`${N.libName}: serialization of ${s}s is not supported`)}}}}writeModel(e,t){let n={};this.refs.set(e,n);try{n.$model=pe.classToID(e.constructor)}catch(s){throw console.error(`unregistered model class at ${t}:`,e),s}for(let s of Object.keys(e).sort()){if(s==="__realm")continue;let r=e[s];(typeof r=="number"&&Number.isFinite(r)&&!Object.is(r,-0)||typeof r=="string"||typeof r=="boolean")&&s[0]!=="$"?n[s]=r:this.writeInto(n,s,r,`${e}`,!0)}return n}writeObject(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],s={};this.refs.set(e,s);for(let r of Object.keys(e).sort()){let o=e[r];(typeof o=="number"&&Number.isFinite(o)&&!Object.is(o,-0)||typeof o=="string"||typeof o=="boolean")&&r[0]!=="$"?s[r]=o:this.writeInto(s,r,o,t,n)}return s}writeArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],s=[];this.refs.set(e,s);for(let r=0;r<e.length;r++){let o=e[r];typeof o=="number"&&Number.isFinite(o)&&!Object.is(o,-0)||typeof o=="string"||typeof o=="boolean"?s[r]=o:this.writeInto(s,r,o,t,n)}return s}writeArrayBuffer(e){let t={$class:"ArrayBuffer",$value:TP(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){let n={$class:e,$value:[this.write(t.buffer),t.byteOffset,e==="DataView"?t.byteLength:t.length]};return this.refs.set(t,n),n}writeAs(e,t,n,s){let r={$class:e};this.refs.set(t,r);let o=this.write(n,s,!1);return typeof o!="object"||o===null||o.$class||Array.isArray(o)?r.$value=o:Object.assign(r,o),r}writeRef(e){let t=this.refs.get(e);if(typeof t!="object")throw Error("Non-object in refs: "+e);return Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}}),{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,n,s){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t[0]==="$")return void(this.okayToIgnore[t]||(un(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[t]=!0));if(r&&typeof n=="object")return void this.todo.push({state:e,key:t,value:n,path:s});let o=this.write(n,s+Fs(e,t));e[t]=o}},Jv=Symbol("croquet:unresolved"),ia=class{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[],t.postprocess=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",it),this.addReader("Teatime:Data",Bp),this.addReader("Teatime:QFunc",jp),this.readers.set("Undefined",()=>{}),this.readers.set("NaN",()=>NaN),this.readers.set("Infinity",t=>t*(1/0)),this.readers.set("NegZero",()=>-0),this.readers.set("BigInt",t=>BigInt(t)),this.readers.set("ArrayBuffer",t=>function(n){let s=globalThis.atob(n),r=s.length,o=new Uint8Array(r);for(let a=0;a<r;a++)o[a]=s.charCodeAt(a);return o.buffer}(t)),this.readers.set("DataView",t=>new DataView(...t)),this.readers.set("Int8Array",t=>new Int8Array(...t)),this.readers.set("Uint8Array",t=>new Uint8Array(...t)),this.readers.set("Uint8ClampedArray",t=>new Uint8ClampedArray(...t)),this.readers.set("Int16Array",t=>new Int16Array(...t)),this.readers.set("Uint16Array",t=>new Uint16Array(...t)),this.readers.set("Int32Array",t=>new Int32Array(...t)),this.readers.set("Uint32Array",t=>new Uint32Array(...t)),this.readers.set("Float32Array",t=>new Float32Array(...t)),this.readers.set("Float64Array",t=>new Float64Array(...t));for(let[t,n]of pe.allClassTypes())this.addReader(t,n)}addReader(e,t){let n=s=>Object.assign(Object.create(t.prototype),s);typeof t=="object"&&(n=t.read),this.readers.set(e,n)}enableBackwardCompatibility(e){let t=e?.meta?.sdk;if(!t)return;let[n,s,r,o]=t.split(/[-.+]/).map(l=>+l),a=`${n}.${s}`;r&&(a+=`.${r}`),o&&(a+=`-${o}`),console.warn(`${N.libName}: reading snapshot version ${a}`),this.compatMaps=n<1||n===1&&(s<1||s===1&&r<7)}readVM(e,t,n){if(t!=="VM")throw Error("VirtualMachine must be root object");n&&this.enableBackwardCompatibility(e);let s=this.read(e,t,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(s),s}readDeferred(){let e=0;for(;e<this.todo.length;){let{object:t,key:n,value:s,path:r}=this.todo[e++];this.readInto(t,n,s,r,!1)}this.todo.length=0}resolveRefs(){for(let{object:e,key:t,ref:n,path:s}of this.unresolved){if(!this.refs.has(n))throw Error(`Unresolved ref: ${n} at ${s}[${JSON.stringify(t)}]`);e[t]=this.refs.get(n)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(let e of this.postprocess)e();this.postprocess.length=0}readAllStatic(e){let{staticModelProps:t,staticTypeProps:n}=e,s=[];if(t){for(let[r,o]of Object.entries(t)){let a=pe.classFromID(r);s.push(()=>Object.assign(a,o)),Jh("Model",r)}delete e.staticModelProps}if(n){let r=Object.fromEntries(pe.allClassTypes());for(let[o,a]of Object.entries(n)){let l=r[o];if(typeof l=="object"){let h=l;s.push(()=>h.readStatic(a))}else{let h=l;s.push(()=>Object.assign(h,a))}Jh("Type",o)}delete e.staticTypeProps}s.length&&(e.staticInitializers=s)}read(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];switch(typeof e){case"number":case"string":case"boolean":return e;default:{let s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case"Array":return this.readArray(e,t,n);case"Null":return null;case"Object":{let{$class:r,$model:o,$ref:a}=e;if(a)throw Error("refs should have been handled in readInto()");return o?this.readModel(e,t):r?this.readAs(r,e,t):this.readObject(Object,e,t,n)}default:throw Error(`Don't know how to deserialize ${s} at ${t}`)}}}}readModel(e,t){let n=pe.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,n);for(let[s,r]of Object.entries(e))s!=="id"&&s[0]!=="$"&&this.readInto(n,s,r,t);return n}readObject(e,t,n){let s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],r=new e;t.$id&&this.refs.set(t.$id,r);for(let[o,a]of Object.entries(t))o[0]!=="$"&&this.readInto(r,o,a,n,s);return r}readArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],s=[];e.$id&&this.refs.set(e.$id,s);for(let r=0;r<e.length;r++)e[r]!==void 0&&this.readInto(s,r,e[r],t,n);return s}readAsArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],s=e.$value;return e.$id&&(s.$id=e.$id),this.readArray(s,t,n)}readAsSet(e,t){let n=new Set;e.$id&&this.refs.set(e.$id,n);let s=this.unresolved.length,r=this.read(e.$value,t,!1),o=()=>{for(let a of r)n.add(a)};return this.unresolved.length===s?o():this.postprocess.push(o),n}readAsMap(e,t){let n=new Map;e.$id&&this.refs.set(e.$id,n);let s=this.unresolved.length,r=this.read(e.$value,t,!1),o=this.compatMaps?()=>{if(r.some(a=>a.length!==2))console.warn("Deferring map resolution at",t),this.postprocess.push(o);else for(let[a,l]of r)n.set(a,l)}:()=>{for(let a=0;a<r.length;a+=2)n.set(r[a],r[a+1])};return this.unresolved.length===s?o():this.postprocess.push(o),n}readAsClass(e,t,n){let s={},r=new Map;if("$value"in t)s=this.read(t.$value,n,!1);else for(let[a,l]of Object.entries(t)){if(a[0]==="$")continue;let h=l&&l.$ref;h?this.refs.has(h)?s[a]=this.refs.get(h):(s[a]=Jv,r.set(h,a)):this.readInto(s,a,l,n,!1)}let o=this.readers.get(e)(s,n);o||e==="Undefined"||e==="BigInt"||e==="NaN"||e==="NegZero"||console.warn(`Reading "${e}" returned ${o} at ${n}`),t.$id&&this.refs.set(t.$id,o);for(let[a,l]of r.entries())this.unresolved.push({object:o,key:l,ref:a,path:n});return o}readAs(e,t,n){switch(e){case"Array":return this.readAsArray(t,n);case"Set":return this.readAsSet(t,n);case"Map":return this.readAsMap(t,n);default:return this.readAsClass(e,t,n)}}readRef(e,t,n,s){if(!n||!n.$ref)return!1;let r=n.$ref;return this.refs.has(r)?e[t]=this.refs.get(r):(e[t]=Jv,this.unresolved.push({object:e,key:t,ref:r,path:s})),!0}readInto(e,t,n,s){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.readRef(e,t,n,s)||(r&&typeof n=="object"?this.todo.push({object:e,key:t,value:n,path:s}):e[t]=this.read(n,s+Fs(e,t)))}},jh=class extends ta{encode(e){let t=this.writeArray(e,"args");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}},Uh=class extends ia{decode(e){let t=this.readArray(e,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),t}resolveRefs(){for(let{object:e,key:t,ref:n,path:s}of this.unresolved)if(this.refs.has(n))e[t]=this.refs.get(n);else{let r=this.vm.lookUpModel(n);if(!r)throw Error(`Unresolved ref: ${n} at ${s}[${JSON.stringify(t)}]`);e[t]=r}}},LP=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function o2(i,e,t,n){let s=Array.isArray(i)?i:i.constructor===Set?i.values():i.constructor===Map?i.entries():Object.values(i),r=[];for(let o of s)typeof o!="object"||o===null||n.has(o)||(n.add(o),r.push(o));for(let o of r){if(LP.includes(o.constructor))continue;let a=e+"."+o.constructor.name;if(t[a]){if(t[a]!==o.constructor)throw new Error("Class with name "+a+" already gathered, but new one has different identity")}else t[a]=o.constructor}for(let o of r)o2(o,e,t,n)}function Jh(i,e){let t=Oe.controllers.size;t>1&&un(`Static properties in shared ${i} ${e} can lead to divergence because ${t} ${N.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function TP(i){let e=new Uint8Array(i),t=[];for(let n=0;n<e.byteLength;n+=4096){let s=e.subarray(n,n+4096);t.push(String.fromCharCode.apply(null,s))}return globalThis.btoa(t.join(""))}var ln={classes:K.has("debug","classes")},hp=Symbol("SECRET"),Gh=new WeakSet,pe=class i{static create(){if(!cp(this))throw Error(`Model class "${this.name}" not registered`);let e=this,t=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(t.beWellKnownAs("modelRoot"),t.__realm.vm.debugEvents&&this.eventDebugInit(t)),Gh.add(t),t.init(...arguments),Gh.has(t)&&(Gh.delete(t),Object.getPrototypeOf(e)!==i&&console.warn(`${t} did not call super.init(options)`)),t}static createNoInit(e){let t=Ai(),n=new this(hp);return e||(e=t.register(n)),ln.write===void 0&&(ln.write=K.has("debug","write"),ln.publish=K.has("debug","publish"),ln.events=K.has("debug","events")),Object.defineProperty(n,"__realm",{value:t,writable:ln.write}),Object.defineProperty(n,"id",{value:e,enumerable:!0}),n}static allowConstructors(){hp=void 0,console.warn("disabling error reporting for Model constructors")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),ia.resetInstance(),ta.resetInstance(),jh.resetInstance(),Uh.resetInstance(),function(t,n){let s=ax(t),r=Vs(`${n}:${s}`);Np.push(r),r.then(o=>bi[o].what=`Class ${n}`)}(this,e),function(t,n){let s=Js[n];if(s&&s!==t)throw Error(`Registering model class ${t.name} failed, id "${n}" already used by ${s.name}`);cp(t)?ln.classes&&!s&&console.warn(`ignoring re-exported model class ${n}`):(ln.classes&&console.log(`registering model class ${n}`),t[Fo]=n),Js[n]=t}(this,e),i.lastRegistered=this,this}static wellKnownModel(e){if(!tt.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return tt.current().get(e)}static evaluate(e){return tt.evaluate(e)}static isExecuting(){return tt.hasCurrent()}static types(){return{}}static gatherClassTypes(e,t){let n={};return o2({root:e},t,n,new Set),n}static eventDebugOptions(){return ln}static eventDebugInit(e){e.subscribe("*","*",e.createQFunc(`
        function logEvents(data) {
            // do this now to have no side effects below
            const { scope, event, source } = this.activeSubscription;
            // below stuff is outside the model. Must not have any side effects!
            const debug = this.constructor.eventDebugOptions();
            if (!debug.events && !debug.publish) return;
            const action = source === "model" ? "publish" : "receive";
            const emoji = source === "model" ? "\u{1F52E}" : "\u{1F4EC}";
            console.log(\`\${emoji} @\${this.now()} Model \${action} \${scope}:\${event}\`, data);
        }
        `))}static okayToIgnore(){return[]}static classToID(e){return function(t){if(cp(t))return t[Fo];let n=t.name||"ClassName";throw Error(`Model class not registered, did you call ${n}.register("${n}")?`)}(e)}static classFromID(e){return $v(e)}static allClasses(){return Qv()}static allClassTypes(){return function(){let e={};for(let t of Qv())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return $v(e).createNoInit(t)}constructor(e){if(e!==hp)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(e,t){Gh.delete(this)}destroy(){Ai().unsubscribeAll(this),Ai().deregister(this)}publish(e,t,n){this.__realm||this.__realmError(),this.__realm.publish(t,n,e)}subscribe(e,t,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,n)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"*";this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,n)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!tt.hasCurrent())return;let{currentEvent:e,currentEventFromModel:t}=tt.current();if(!e)return;let[n,s]=e.split(":");return{scope:n,event:s,source:t?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;this.__realm||this.__realmError();for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];return this.__realm.future(this,e,t,s)}cancelFuture(e){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,e)}random(){return Ai().random()}now(){return Ai().now()}beWellKnownAs(e){Ai().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(tt.current()===this.__realm.vm)return!0;let t=Error(e||`${this}.modelOnly() called from outside a model!`);throw Ke("view code",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(e,t){return t===void 0&&(t=e,e={}),t2(this,e,t)}persistSession(e){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){return`${this.constructor[Fo]||this.constructor.name}#${this.id}`}},Js={},Fo=Symbol("CLASS_ID");function Qv(){return Object.values(Js)}function cp(i){return Object.prototype.hasOwnProperty.call(i,Fo)}function $v(i){if(Js[i])return Js[i];throw Error(`Model class "${i}" in snapshot, but not registered?`)}var qv="Croquet.Model",Mo;pe[Fo]=qv,Js[qv]=pe;var bn=class{static displayStatus(e,t){return dx(e,t)}static displayWarning(e,t){return un(e,t)}static displayError(e,t){return function(n){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return n&&N.showMessage(n,{...s,level:"error"})}(e,t)}constructor(e){typeof e=="object"&&"__realm"in e||console.warn(`${N.libName}: argument to View constructor needs to be a Model`);let t=Ai("");t&&t.isViewRealm()||(t=Yo(e.__realm.vm,()=>Ai(),!0)),Object.defineProperty(this,"realm",{value:t}),Object.defineProperty(this,"id",{value:t.register(this),configurable:!0});let n=t.controller.session;if(n.view||(n.view=this),Mo||(Mo={events:K.has("debug","events"),publish:K.has("debug","publish")}),n.view===this&&(Mo.events||Mo.publish)){let s=a=>{if(!t.vm.debugEvents)return;let{scope:l,event:h,source:c,subscribed:d}=this.activeSubscription;if(!d&&!Mo.publish)return;let u=c==="view"?"publish":"receive";console.log(`${c==="view"?"\u{1F4EE}":"\u{1F441}\uFE0F"} View ${u} ${l}:${h}${d||u==="publish"?"":" (no subscribers)"}`,a)},r=a=>this.activeSubscription.source==="view"&&s(a),o=a=>this.activeSubscription.source==="model"&&s(a);r.__CROQUET__=!0,o.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},o),this.subscribe("*",{event:"*",handling:"immediate"},r)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(e,t,n){this.realm.publish(t,n,e)}subscribe(e,t,n){if(typeof n=="string"&&(n=this[n]),typeof n!="function")throw Error(`${N.libName}: subscribe() handler is not a function`);let s=n;(n=s.bind(this)).unbound=s;let{event:r,handling:o}=t.event?t:{event:t};this.realm.subscribe(r,this.id,n,e,o)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;typeof n=="string"&&(n=this[n]),this.realm.unsubscribe(t,this.id,n,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){let{currentEvent:e,currentEventFromModel:t,currentEventOnlyGeneric:n}=Oe;if(!e)return;let[s,r]=e.split(":");return{scope:s,event:r,source:t?"model":"view",subscribed:!n}}future(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.realm.future(this,e)}random(){return Ai().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){let e=this.constructor.name;return e.includes("View")?e:`${e}[View]`}},Qh=new class{constructor(){this.ready=!1,this.isInIframe=window.top!==window,this.subscriptions={},this.enumerator=null}setReceiver(i){this.receiver=i,this.ready=!0}setIframeEnumerator(i){this.enumerator=i}on(i,e){if(!this.receiver)throw Error("setReceiver() has not been called");if(typeof e=="string"&&(e=this.receiver[e]),!e)throw Error("Messenger.on: the second argument must be a method name or a function");if(this.subscriptions[i]){if(this.findIndex(this.subscriptions[i],e)>=0)throw Error(`${e} is already subscribed`)}else this.subscriptions[i]=[];this.subscriptions[i].push(e),this.listener||(this.listener=t=>this.receive(t),window.addEventListener("message",this.listener))}detach(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=null),this.stopPublishingPointerMove(),this.receiver=null,this.subscriptions={},this.enumerator=null,this.ready=!1}removeSubscription(i,e){typeof e=="string"&&(e=this.receiver[e]);let t=this.subscriptions[i];if(t){let n=this.findIndex(t,e);t.splice(n,1),t.length===0&&delete this.subscriptions[i]}}removeAllSubscriptions(){this.subscriptions={}}receive(i){let{event:e,data:t}=i.data,n=i.source;this.handleEvent(e,t,n)}handleEvent(i,e,t){let n=this.subscriptions[i];n&&n.forEach(s=>{s.call(this.receiver,e,t)})}send(i,e,t){if(this.isInIframe)return void window.top.postMessage({event:i,data:e},"*");if(t)return void t.postMessage({event:i,data:e},"*");this.enumerator&&this.enumerator().forEach(n=>{n.contentWindow.postMessage({event:i,data:e},"*")})}findIndex(i,e){let t=e.name;return i.findIndex(n=>{let s=n.name;return t||s?t===s:e===n})}startPublishingPointerMove(){this._moveHandler||(this._moveHandler=i=>this.send("pointerPosition",{x:i.clientX,y:i.clientY,type:i.type}),window.document.addEventListener("pointermove",this._moveHandler,!0))}stopPublishingPointerMove(){this._moveHandler&&(window.document.removeEventListener("pointermove",this._moveHandler,!0),this._moveHandler=null)}},MP=qh.CROQUET_PLATFORM==="node",ex=60,$h=class i{static async join(e){try{return await this.join_impl(e)}catch(t){throw N.showMessage(t.message||t,{level:"fatal"}),t}}static async join_impl(e){e.appId||(e.appId="no.appId"),e.name||(e.name=N.autoSession(),e.password||(e.password=N.autoPassword())),e.model||(e.model=pe.lastRegistered),e.view||(e.view=bn);let t=[];for(let[f,g]of Object.entries(e))g instanceof Promise&&t.push(g.then(C=>e[f]=C));function n(f,g){return f===g||f.prototype instanceof g}if(await Promise.all(t),e.box){if(typeof e.box!="string")throw Error(`${N.libName}: box must be a string in Session.join()!`);if(!e.box.includes("/"))throw Error(`${N.libName}: box must be a (partial) URL in Session.join()!`)}else if(!e.reflector||!e.files){if(typeof e.apiKey!="string")throw Error(`${N.libName}: no apiKey provided in Session.join()!`);if(e.apiKey.length>128)throw Error(`${N.libName}: apiKey > 128 characters in Session.join()!`)}if(typeof e.name!="string")throw Error(`${N.libName}: no session name provided in Session.join()!`);if(e.name.length>128)throw Error(`${N.libName}: session name > 128 characters in Session.join()!`);let s=e.model;if(typeof s!="function"||!n(s,pe))throw Error(`${N.libName}: bad model class in Session.join()`);let r=e.view||bn;if(typeof r!="function"||!n(r,bn))throw Error(`${N.libName}: bad view class in Session.join()`);if(typeof e.appId!="string")throw Error(`${N.libName}: no appId provided in Session.join()`);if(!e.appId.length>128)throw Error(`${N.libName}: appId > 128 characters in Session.join()`);if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${N.libName}: malformed appId in Session.join()`);if(typeof e.password!="string"||!e.password)throw Error(`${N.libName}: no password provided in Session.join()`);for(let f of["reflector","synchronizer","files","backend","box"]){let g=K[f]||e[f];g!==void 0&&(K[f]=g)}if(MP&&e.step!=="manual")throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in e){if(typeof e.rejoinLimit!="number"||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else e.rejoinLimit=1e3;if("eventRateLimit"in e){if(typeof e.eventRateLimit!="number"||e.eventRateLimit<1||e.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!e.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(e.hashOverride){if(e.hashOverride.length!==43)throw Error("hashOverride must be 43 characters");if(e.hashOverride.search(/[^-_a-zA-Z0-9]/)!==-1)throw Error("hashOverride must be base64url encoded")}if(e.debug){let f=function(g){return typeof g=="string"&&(g=g.split(",")),g?Array.isArray(g)?g:[g]:[]};K.debug=[...f(e.debug),...f(K.debug)].join(",")}if("autoSleep"in e){let f=e.autoSleep,g=typeof f;if(g==="number"){if(f<0)throw Error("an autoSleep value must be >= 0")}else{if(g!=="boolean")throw Error("autoSleep must be numeric or boolean");e.autoSleep=f?10:0}}else e.autoSleep=10;if(e.flags){let f=e.flags;typeof f=="string"&&(f=f.split(",")),f=f?Array.isArray(f)?f:[f]:[],f=f.filter(g=>typeof g!="object"),f.length?(e.flags={},f.forEach(g=>e.flags[g]=!0)):e.flags=null}"expectedSimFPS"in e&&(ex=Math.min(e.expectedSimFPS,120));let o=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];(function(){Object.isFrozen(Ko)||(a2(Ko),function(f){let g=JSON.stringify(f,(k,T)=>typeof T=="function"?ax(T):T);if(g==="{}")return;let C=JSON.parse(g),p=Vs(qn(C));Np.push(p),p.then(k=>bi[k].what=`${N.libName} Constants`)}(Ko))})();let a=new Mp,l=JSON.parse(JSON.stringify({...e.options}));if(e.persistentIdOptions){if(!Array.isArray(e.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(let f of e.persistentIdOptions)if(!(f in l))throw Error(`persistentIdOptions key "${f}" not found in options`)}let h={id:"",persistentId:"",versionId:"",name:e.name,model:null,view:null,step(f){a.stepSession("animation",{frameTime:f,view:h.view,expectedSimFPS:ex})},leave:()=>i.leave(h.id),data:{store:(f,g)=>lt.store(f,{...g,sessionId:h.id}),fetch:(f,g)=>lt.fetch(f,{...g,sessionId:h.id}),hash:f=>lt.hash(f),toId:f=>lt.toId(f),fromId:f=>lt.fromId(f)},get latency(){return a.latency},get latencies(){return a.latencies}};typeof __CROQUET_DEVTOOLS__<"u"&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:h,controller:a}}));let c={options:l,initFn:(f,g)=>s.create(f,g),rebootModelView:u};for(let[f,g]of Object.entries(e))o.includes(f)&&(c[f]=g);await a.initFromSessionSpec(c);let d=!1;return await u(),e.step!=="manual"&&a.startStepping(h.step),h;async function u(){(function(){h.model=null,h.view&&(K.has("debug","session",!1)&&console.log(h.id,"detaching root view"),h.view.detach(),h.view.id!==""&&console.warn(`${N.libName}: ${h.view} did not call super.detach()`),h.view=null),N.clearSessionMoniker(),Qh.ready&&Qh.detach()})(),a.leaving?a.leaving(!0):d||(d=!0,await a.establishSession(c),d=!1,h.model=a.vm.get("modelRoot"),h.id=a.id,h.persistentId=a.persistentId,h.versionId=a.versionId,a.session=h,N.makeSessionWidgets(h.id),a.inViewRealm(()=>{K.has("debug","session",!1)&&console.log(h.id,"creating root view"),new r(h.model,c.viewOptions)}))}}static async leave(e){let t=function(r){for(let o of Us)if(o.id===r)return o;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);let n=new Promise(r=>t.leaving=r),s=t.connection;return!!s.connected&&(s.closeConnection(1e3),n)}static thisSession(){let e=tt.current();return e?e.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(e){}leave(){}},Ko={};function a2(i){if(!Object.isFrozen(i)){Object.freeze(i);for(let e of Object.values(i))!e||typeof e!="object"&&typeof e!="function"||a2(e)}}var tx={Model:pe,View:bn,Session:$h,Data:lt,Constants:Ko,App:N,Messenger:Qh,VERSION:Wt};pe.Croquet=tx,bn.Croquet=tx,typeof __CROQUET_DEVTOOLS__<"u"&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:Wt}})),typeof globalThis<"u"&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=Wt),Wi.App=N,Wi.Constants=Ko,Wi.Data=lt,Wi.Messenger=Qh,Wi.Model=pe,Wi.Session=$h,Wi.VERSION=Wt,Wi.View=bn});var PR=Ci(mc()),ag=Ci(da()),lg=Ci(xc());function as(i){return Math.min(Math.max(i,0),1)}var LR=window.webkit!==void 0,$2="featurePoint",q2="horizontalPlane",eS="verticalPlane",tS="existingPlane",iS="existingPlaneUsingExtent";var ma={[$2]:1,[q2]:2,[eS]:4,[tS]:8,[iS]:16},Tn={normal:"normal",notAvailable:"notAvailable",excessiveMotion:"excessiveMotion",insufficientFeatures:"insufficientFeatures",initializing:"initializing",relocalizing:"relocalizing"};var nS={camera:{near:.001,far:1e3},pointCloud:!1,imageFrame:!1},je=nS;var sS=new class{constructor(){(0,ag.default)(this),this.sethandlers(),(0,lg.default)(je).on("change",this.updateConfig)}onARFrame(e){this.emit("frame",JSON.parse(e))}onHitTest(e){this.emit("hitTest",JSON.parse(e))}onAnchorsAdded(e){this.emit("anchorsAdded",JSON.parse(e))}onAnchorsRemoved(e){this.emit("anchorsRemoved",JSON.parse(e))}onSessionInterupted(){this.emit("sessionInterupted")}onSessionInteruptedEnded(){this.emit("sessionInteruptedEnded")}onTrackingStateChange(e){this.emit("trackingStateChange",e)}hitTest(e,t,n=ma.featurePoint){let s={action:"hitTest",value:{x:as(e,0,1),y:as(t,0,1)},hitType:n};this.postMessage(s)}addAnchor(e=[]){let t={action:"addAnchor",value:e};this.postMessage(t)}removeAnchors(e=[]){let t={action:"removeAnchors",value:e};this.postMessage(t)}loadPage(e){let t={action:"loadPage",value:e};this.postMessage(t)}resetSession(){let e={action:"resetSession"};this.postMessage(e)}sethandlers(){this.updateConfig=()=>{let e={action:"config",value:je};this.postMessage(e)},this.postMessage=e=>{try{window.webkit.messageHandlers.callbackHandler.postMessage(e)}catch(t){if(!window.webkit)return;console.warn("webkit callback",t)}}}},hg=sS;var IR=Ci(mc()),cg=Ci(da()),dg=Ci(xc());var rS=new class{constructor(){(0,cg.default)(this),this.sethandlers(),(0,dg.default)(je).on("change",this.updateConfig)}onARFrame(e){this.emit("frame",JSON.parse(e))}onHitTest(e){this.emit("hitTest",JSON.parse(e))}onAnchorsAdded(e){this.emit("anchorsAdded",JSON.parse(e))}onAnchorsRemoved(e){this.emit("anchorsRemoved",JSON.parse(e))}onSessionInterupted(){this.emit("sessionInterupted")}onSessionInteruptedEnded(){this.emit("sessionInteruptedEnded")}onTrackingStateChange(e){this.emit("trackingStateChange",e)}hitTest(e,t,n=ma.featurePoint){let s={action:"hitTest",value:{x:as(e,0,1),y:as(t,0,1)},hitType:n};this.postMessage(s)}addAnchor(e=[]){let t={action:"addAnchor",value:e};this.postMessage(t)}removeAnchors(e=[]){let t={action:"removeAnchors",value:e};this.postMessage(t)}loadPage(e){let t={action:"loadPage",value:e};this.postMessage(t)}resetSession(){let e={action:"resetSession"};this.postMessage(e)}sethandlers(){this.updateConfig=()=>{let e={action:"config",value:je};this.postMessage(e)},this.postMessage=e=>{try{window.webkit.messageHandlers.callbackHandler.postMessage(e)}catch(t){if(!window.webkit)return;console.warn("webkit callback",t)}}}onDebug(e){this.emit("debug",e)}},Ve=rS;var dr=class extends aa{update(e){this.quaternion.fromArray(e.quaternion),this.position.fromArray(e.position),this.projectionMatrix.fromArray(e.projection),this.updateMatrix()}};var Sc="ARAnchor",ur="ARPlaneAnchor",ga=class{constructor(e,t){this.type=t,this.identifier=e}},ya=class extends ga{constructor(e){super(e.identifier,Sc),this.group=new gm,this.group.matrixAutoUpdate=!1,this.update(e)}update(e){this.group.matrix.fromArray(e.transform)}},ug=new la(1,1,10,10);ug.applyMatrix4(new Lt().makeRotationX(Math.PI/2));var ba=class extends ga{constructor(e){super(e.identifier,ur),this.group=new kn,this.group.matrixAutoUpdate=!1,this.mesh=new Sn(ug,new bm({wireframe:!1,opacity:.3,transparent:!0,side:dm})),this.mesh.receiveShadow=!0,this.mesh.visible=!1,this.group.add(this.mesh),this.update(e)}update(e){this.group.matrix.fromArray(e.transform),this.mesh.position.fromArray(e.center),this.mesh.scale.x=e.extent[0],this.mesh.scale.z=e.extent[2]}getPosition(){return[this.group.matrix.elements[12],this.group.matrix.elements[13],this.group.matrix.elements[14]]}};var fg=.1,pg=new la(fg,fg,1,1);pg.applyMatrix4(new Lt().makeRotationX(-Math.PI/2));var fr=class{constructor(){this.tracking=!1,this.raycaster=new Rm,this.origin=new Ye(.5*2-1,-.5*2+1),this.nup=0,this.nintersect=0,this.mesh=new Sn(pg,new vm({vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          varying vec2 vUv;

          float sdRect(vec2 uv2, vec2 tl, vec2 br) {
            vec2 d = max(tl - uv2, uv2 - br);
            return step(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)), 0.0);
          }

          void main() {
            float rect = 1.0 - sdRect(vUv, vec2(0.1), vec2(0.9));
            gl_FragColor = vec4(rect);
          }
        `,transparent:!0}))}update(e,t){this.objects=[],t.forEach(s=>{s.type===ur&&this.objects.push(s.mesh)}),this.raycaster.setFromCamera(this.origin,e);let n=this.raycaster.intersectObjects(this.objects)[0];this.nup++,n?(this.nintersect++,this.mesh.visible=!0,this.tracking=!0,this.mesh.position.copy(n.point),this.mesh.position.y+=1e-4):(this.mesh.visible=!1,this.tracking=!1)}getPosition(){return this.mesh.position}};var wa=class i{static createButton(e,t={}){let n=document.createElement("button");function s(){let h=null;async function c(f){f.addEventListener("end",d),await e.xr.setSession(f),n.textContent="EXIT VR",h=f}function d(){h.removeEventListener("end",d),n.textContent="ENTER VR",h=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";let u={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){h===null?navigator.xr.requestSession("immersive-vr",u).then(c):(h.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",u).then(c).catch(f=>{console.warn(f)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",u).then(c).catch(f=>{console.warn(f)})}function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function o(){r(),n.textContent="VR NOT SUPPORTED"}function a(h){r(),console.warn("Exception when trying to call xr.isSessionSupported",h),n.textContent="VR NOT ALLOWED"}function l(h){h.style.position="absolute",h.style.bottom="20px",h.style.padding="12px 6px",h.style.border="1px solid #fff",h.style.borderRadius="4px",h.style.background="rgba(0,0,0,0.1)",h.style.color="#fff",h.style.font="normal 13px sans-serif",h.style.textAlign="center",h.style.opacity="0.5",h.style.outline="none",h.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",l(n),navigator.xr.isSessionSupported("immersive-vr").then(function(h){h?s():o(),h&&i.xrSessionIsGranted&&n.click()}).catch(a),n;{let h=document.createElement("a");return window.isSecureContext===!1?(h.href=document.location.href.replace(/^http:/,"https:"),h.innerHTML="WEBXR NEEDS HTTPS"):(h.href="https://immersiveweb.dev/",h.innerHTML="WEBXR NOT AVAILABLE"),h.style.left="calc(50% - 90px)",h.style.width="180px",h.style.textDecoration="none",l(h),h}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{i.xrSessionIsGranted=!0})}}};wa.xrSessionIsGranted=!1;wa.registerSessionGrantedListener();var mg={type:"change"},Cc={type:"start"},yg={type:"end"},va=new mm,gg=new km,oS=Math.cos(70*ti.DEG2RAD),Pe=new q,nt=2*Math.PI,oe={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},kc=1e-6,xa=class extends uc{constructor(e,t=null){super(e,t),this.state=oe.NONE,this.enabled=!0,this.target=new q,this.cursor=new q,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:xn.ROTATE,MIDDLE:xn.DOLLY,RIGHT:xn.PAN},this.touches={ONE:ei.ROTATE,TWO:ei.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new q,this._lastQuaternion=new nr,this._lastTargetPosition=new q,this._quat=new nr().setFromUnitVectors(e.up,new q(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new rr,this._sphericalDelta=new rr,this._scale=1,this._panOffset=new q,this._rotateStart=new Ye,this._rotateEnd=new Ye,this._rotateDelta=new Ye,this._panStart=new Ye,this._panEnd=new Ye,this._panDelta=new Ye,this._dollyStart=new Ye,this._dollyEnd=new Ye,this._dollyDelta=new Ye,this._dollyDirection=new q,this._mouse=new Ye,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=lS.bind(this),this._onPointerDown=aS.bind(this),this._onPointerUp=hS.bind(this),this._onContextMenu=gS.bind(this),this._onMouseWheel=uS.bind(this),this._onKeyDown=fS.bind(this),this._onTouchStart=pS.bind(this),this._onTouchMove=mS.bind(this),this._onMouseDown=cS.bind(this),this._onMouseMove=dS.bind(this),this._interceptControlDown=yS.bind(this),this._interceptControlUp=bS.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(mg),this.update(),this.state=oe.NONE}update(e=null){let t=this.object.position;Pe.copy(t).sub(this.target),Pe.applyQuaternion(this._quat),this._spherical.setFromVector3(Pe),this.autoRotate&&this.state===oe.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=nt:n>Math.PI&&(n-=nt),s<-Math.PI?s+=nt:s>Math.PI&&(s-=nt),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{let o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(Pe.setFromSpherical(this._spherical),Pe.applyQuaternion(this._quatInverse),t.copy(this.target).add(Pe),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){let a=Pe.length();o=this._clampDistance(a*this._scale);let l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){let a=new q(this._mouse.x,this._mouse.y,0);a.unproject(this.object);let l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;let h=new q(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(a),this.object.updateMatrixWorld(),o=Pe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(va.origin.copy(this.object.position),va.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(va.direction))<oS?this.object.lookAt(this.target):(gg.setFromNormalAndCoplanarPoint(this.object.up,this.target),va.intersectPlane(gg,this.target))))}else if(this.object.isOrthographicCamera){let o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>kc||8*(1-this._lastQuaternion.dot(this.object.quaternion))>kc||this._lastTargetPosition.distanceToSquared(this.target)>kc?(this.dispatchEvent(mg),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?nt/60*this.autoRotateSpeed*e:nt/60/60*this.autoRotateSpeed}_getZoomScale(e){let t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Pe.setFromMatrixColumn(t,0),Pe.multiplyScalar(-e),this._panOffset.add(Pe)}_panUp(e,t){this.screenSpacePanning===!0?Pe.setFromMatrixColumn(t,1):(Pe.setFromMatrixColumn(t,0),Pe.crossVectors(this.object.up,Pe)),Pe.multiplyScalar(e),this._panOffset.add(Pe)}_pan(e,t){let n=this.domElement;if(this.object.isPerspectiveCamera){let s=this.object.position;Pe.copy(s).sub(this.target);let r=Pe.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;let n=this.domElement.getBoundingClientRect(),s=e-n.left,r=t-n.top,o=n.width,a=n.height;this._mouse.x=s/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this._rotateLeft(nt*this._rotateDelta.x/t.clientHeight),this._rotateUp(nt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){let t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{let n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this._rotateLeft(nt*this._rotateDelta.x/t.clientHeight),this._rotateUp(nt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){let t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);let o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ye,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){let t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){let t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}};function aS(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function lS(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function hS(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(yg),this.state=oe.NONE;break;case 1:let e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function cS(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=oe.DOLLY;break;case xn.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=oe.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=oe.ROTATE}break;case xn.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=oe.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=oe.PAN}break;default:this.state=oe.NONE}this.state!==oe.NONE&&this.dispatchEvent(Cc)}function dS(i){switch(this.state){case oe.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case oe.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case oe.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function uS(i){this.enabled===!1||this.enableZoom===!1||this.state!==oe.NONE||(i.preventDefault(),this.dispatchEvent(Cc),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(yg))}function fS(i){this.enabled!==!1&&this._handleKeyDown(i)}function pS(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case ei.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=oe.TOUCH_ROTATE;break;case ei.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=oe.TOUCH_PAN;break;default:this.state=oe.NONE}break;case 2:switch(this.touches.TWO){case ei.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=oe.TOUCH_DOLLY_PAN;break;case ei.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=oe.TOUCH_DOLLY_ROTATE;break;default:this.state=oe.NONE}break;default:this.state=oe.NONE}this.state!==oe.NONE&&this.dispatchEvent(Cc)}function mS(i){switch(this._trackPointer(i),this.state){case oe.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case oe.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case oe.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case oe.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=oe.NONE}}function gS(i){this.enabled!==!1&&i.preventDefault()}function yS(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function bS(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var eZ=new q,tZ=new rr,iZ=new q,nZ=new q;var bg=Ci(da()),pr=class{constructor(e){(0,bg.default)(this),this.pointers=[],this.isDown=!1;let t={passive:!0};e.addEventListener("touchstart",n=>this.onTouchStart(n),t),e.addEventListener("touchmove",n=>this.onTouchMove(n),t),e.addEventListener("touchend",n=>this.onTouchEnd(n),t)}getPointers(e){let t=[];return e.touches!==void 0?Object.keys(e.touches).forEach(n=>{let s=e.touches[n];t.push({x:s.pageX/window.innerWidth,y:s.pageY/window.innerHeight})}):t.push({x:e.pageX/window.innerWidth,y:e.pageY/window.innerHeight}),t}onTouchStart(e){this.isDown=!0,this.pointers=this.getPointers(e),this.emit("start",this.pointers)}onTouchMove(e){this.isDown&&(this.pointers=this.getPointers(e),this.emit("move",this.pointers))}onTouchEnd(){this.isDown=!1,this.emit("end",this.pointers)}};var Mn=class i{constructor(e,t){this.height=1.6,this.velocityMin=Math.log(1),this.velocityMax=Math.log(4),this.velocityRange=this.velocityMax-this.velocityMin,this.camera=e,this.isLocked=!1,this.movement=new q,this.element=t,this.velocity=2,this.target=new q,this.buttons={primary:!1,secondary:!1,tertiary:!1},e.position.set(0,this.height,0),e.rotation.order="YXZ",e.userData.targetPosition=e.position.clone(),e.userData.targetRotation=e.rotation.clone(),e.userData.targetQuaternion=e.quaternion.clone(),document.addEventListener("contextmenu",n=>n.preventDefault()),t.addEventListener("touchstart",n=>n.preventDefault()),t.addEventListener("pointerdown",this._pointerdown=this.onPointerDown.bind(this)),document.addEventListener("pointerlockchange",this._pointerlockchange=this.onLock.bind(this)),document.addEventListener("pointermove",this._pointermove=this.onPointerMove.bind(this)),document.addEventListener("pointerup",this._pointerup=this.onPointerUp.bind(this)),document.addEventListener("keydown",this._keydown=this.onKeyDown.bind(this)),document.addEventListener("keyup",this._keyup=this.onKeyUp.bind(this))}detach(){this.element.removeEventListener("pointerdown",this._pointerdown),document.removeEventListener("pointerlockchange",this._pointerlockchange),document.removeEventListener("pointermove",this._pointermove),document.removeEventListener("pointerup",this._pointerup),document.removeEventListener("keydown",this._keydown),document.removeEventListener("keyup",this._keyup)}lock(){let{isLocked:e,element:t}=this;if(!e)try{t.requestPointerLock()}catch{console.warn("RPL")}}unlock(){let{buttons:e,isLocked:t}=this;t&&(e.primary=!1,e.secondary=!1,e.tertiary=!1,document.exitPointerLock())}onLock(){function e(n){document.querySelector("#status").innerHTML=n}let{movement:t}=this;this.isLocked=!!document.pointerLockElement,e("L:"+this.isLocked),document.body.classList[this.isLocked?"add":"remove"]("pointerlock"),this.isLocked||t.set(0,0,0)}onPointerDown(e){let{buttons:t,isLocked:n}=this;if(e.isPrimary){if(!n){this.lock();return}if(n){this.unlock();return}switch(e.button){case 0:t.primary=!0;break;case 2:t.secondary=!0;break;case 1:t.tertiary=!0;break}}}onPointerMove(e){let{camera:t,isLocked:n}=this;if(!e.isPrimary||!n)return;let{movementX:s,movementY:r}=e;t.userData.targetRotation.y-=s*.003,t.userData.targetRotation.x-=r*.003,t.userData.targetRotation.x=Math.min(Math.max(t.userData.targetRotation.x,Math.PI*-.5),Math.PI*.5)}onPointerUp(e){let{buttons:t,isLocked:n}=this;if(!(!e.isPrimary||!n))switch(e.button){case 0:t.primary=!1;break;case 2:t.secondary=!1;break;case 1:t.tertiary=!1;break}}onKeyDown(e){let{isLocked:t,movement:n}=this;if(e.code=="Enter"){t?this.unlock():(this.lock(),this.onLock());return}if(!(!t||e.repeat))switch(e.code){case"KeyW":case"ArrowUp":n.z=1;break;case"KeyA":case"ArrowLeft":n.x=-1;break;case"KeyS":case"ArrowDown":n.z=-1;break;case"KeyD":case"ArrowRight":n.x=1;break;case"KeyK":case"KeyQ":n.y=1;break;case"KeyJ":case"KeyZ":n.y=-1;break}}onKeyUp(e){let{isLocked:t,movement:n}=this;if(t)switch(e.code){case"KeyW":case"ArrowUp":n.z>0&&(n.z=0);break;case"KeyA":case"ArrowLeft":n.x<0&&(n.x=0);break;case"KeyS":case"ArrowDown":n.z<0&&(n.z=0);break;case"KeyD":case"ArrowRight":n.x>0&&(n.x=0);break;case"KeyK":case"KeyQ":n.y>0&&(n.y=0);break;case"KeyJ":case"KeyZ":n.y<0&&(n.y=0);break}}onWheel(e){let{velocity:t,isLocked:n}=this;if(!n)return;let{velocityMin:s,velocityRange:r}=i,o=Math.min(Math.max((Math.log(t)-s)/r-e.deltaY*3e-4,0),1);this.velocity=Math.exp(s+o*r)}setHeightmap(e){this.heightmap=e}update(e){let{camera:t,heightmap:n,movement:s,velocity:r}=this;t.rotation.x=ti.damp(t.rotation.x,t.userData.targetRotation.x,20,e),t.rotation.y=ti.damp(t.rotation.y,t.userData.targetRotation.y,20,e),(s.x!==0||s.y!==0||s.z!==0)&&(t.getWorldDirection(i.forward),i.right.crossVectors(i.forward,i.worldUp).normalize(),i.direction.set(0,0,0).addScaledVector(i.right,s.x).addScaledVector(i.worldUp,s.y).addScaledVector(i.forward,s.z).normalize(),t.userData.targetPosition.addScaledVector(i.direction,r*e),n&&(t.userData.targetPosition.y=Math.max(t.userData.targetPosition.y,n.getHeight(t.userData.targetPosition)+i.height))),t.position.x=ti.damp(t.position.x,t.userData.targetPosition.x,10,e),t.position.y=ti.damp(t.position.y,t.userData.targetPosition.y,10,e),t.position.z=ti.damp(t.position.z,t.userData.targetPosition.z,10,e),this.changelistener&&this.changelistener()}};Mn.forward=new q;Mn.right=new q;Mn.worldUp=new q(0,1,0);Mn.direction=new q;var Lc=Mn;var Tc=new Lt,Sa=class i{constructor(e){e=e||{},this.zNear=e.webGL===!0?-1:0,this.vertices={near:[new q,new q,new q,new q],far:[new q,new q,new q,new q]},e.projectionMatrix!==void 0&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,t){let n=this.zNear,s=e.elements[2*4+3]===0;return Tc.copy(e).invert(),this.vertices.near[0].set(1,1,n),this.vertices.near[1].set(1,-1,n),this.vertices.near[2].set(-1,-1,n),this.vertices.near[3].set(-1,1,n),this.vertices.near.forEach(function(r){r.applyMatrix4(Tc)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(r){r.applyMatrix4(Tc);let o=Math.abs(r.z);s?r.z*=Math.min(t/o,1):r.multiplyScalar(Math.min(t/o,1))}),this.vertices}split(e,t){for(;e.length>t.length;)t.push(new i);t.length=e.length;for(let n=0;n<e.length;n++){let s=t[n];if(n===0)for(let r=0;r<4;r++)s.vertices.near[r].copy(this.vertices.near[r]);else for(let r=0;r<4;r++)s.vertices.near[r].lerpVectors(this.vertices.near[r],this.vertices.far[r],e[n-1]);if(n===e.length-1)for(let r=0;r<4;r++)s.vertices.far[r].copy(this.vertices.far[r]);else for(let r=0;r<4;r++)s.vertices.far[r].lerpVectors(this.vertices.near[r],this.vertices.far[r],e[n])}}toSpace(e,t){for(let n=0;n<4;n++)t.vertices.near[n].copy(this.vertices.near[n]).applyMatrix4(e),t.vertices.far[n].copy(this.vertices.far[n]).applyMatrix4(e)}};var wS={lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
 	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

  		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
		vec2 cascade;
		float cascadeCenter;
		float closestEdge;
		float margin;
		float csmx;
		float csmy;

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
				// NOTE: Depth gets larger away from the camera.
				// cascade.x is closer, cascade.y is further
				cascade = CSM_cascades[ i ];
				cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
				closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
				margin = 0.25 * pow( closestEdge, 2.0 );
				csmx = cascade.x - margin / 2.0;
				csmy = cascade.y + margin / 2.0;
				if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

					float dist = min( linearDepth - csmx, csmy - linearDepth );
					float ratio = clamp( dist / margin, 0.0, 1.0 );

					vec3 prevColor = directLight.color;
					directionalLightShadow = directionalLightShadows[ i ];
					directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

					bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
					directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

					ReflectedLight prevLight = reflectedLight;
					RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

					bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
					float blendRatio = shouldBlend ? ratio : 1.0;

					reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
					reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
					reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
					reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

				}
			#endif

		}
		#pragma unroll_loop_end
	#elif defined (USE_SHADOWMAP)

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

				directionalLightShadow = directionalLightShadows[ i ];
				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#elif ( NUM_DIR_LIGHT_SHADOWS > 0 )
		// note: no loop here - all CSM lights are in fact one light only
		getDirectionalLightInfo( directionalLights[0], directLight );
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, directLight );

			RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_pars_begin:`
#if defined( USE_CSM ) && defined( CSM_CASCADES )
uniform vec2 CSM_cascades[CSM_CASCADES];
uniform float cameraNear;
uniform float shadowFar;
#endif
	`+fc.lights_pars_begin};var bZ=new Lt,wZ=new Sa({webGL:!0}),vZ=new q,xZ=new pm;var SZ=new Lt,kZ=new Lt,CZ=new q(0,1,0);var Ec={};T2(Ec,{clear:()=>LS,createStore:()=>wg,del:()=>kS,delMany:()=>CS,entries:()=>PS,get:()=>Pc,getMany:()=>xS,keys:()=>TS,promisifyRequest:()=>Ue,set:()=>Rc,setMany:()=>vS,update:()=>SS,values:()=>MS});function Ue(i){return new Promise((e,t)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>t(i.error)})}function wg(i,e){let t=indexedDB.open(i);t.onupgradeneeded=()=>t.result.createObjectStore(e);let n=Ue(t);return(s,r)=>n.then(o=>r(o.transaction(e,s).objectStore(e)))}var Mc;function Nt(){return Mc||(Mc=wg("keyval-store","keyval")),Mc}function Pc(i,e=Nt()){return e("readonly",t=>Ue(t.get(i)))}function Rc(i,e,t=Nt()){return t("readwrite",n=>(n.put(e,i),Ue(n.transaction)))}function vS(i,e=Nt()){return e("readwrite",t=>(i.forEach(n=>t.put(n[1],n[0])),Ue(t.transaction)))}function xS(i,e=Nt()){return e("readonly",t=>Promise.all(i.map(n=>Ue(t.get(n)))))}function SS(i,e,t=Nt()){return t("readwrite",n=>new Promise((s,r)=>{n.get(i).onsuccess=function(){try{n.put(e(this.result),i),s(Ue(n.transaction))}catch(o){r(o)}}}))}function kS(i,e=Nt()){return e("readwrite",t=>(t.delete(i),Ue(t.transaction)))}function CS(i,e=Nt()){return e("readwrite",t=>(i.forEach(n=>t.delete(n)),Ue(t.transaction)))}function LS(i=Nt()){return i("readwrite",e=>(e.clear(),Ue(e.transaction)))}function Zc(i,e){return i.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Ue(i.transaction)}function TS(i=Nt()){return i("readonly",e=>{if(e.getAllKeys)return Ue(e.getAllKeys());let t=[];return Zc(e,n=>t.push(n.key)).then(()=>t)})}function MS(i=Nt()){return i("readonly",e=>{if(e.getAll)return Ue(e.getAll());let t=[];return Zc(e,n=>t.push(n.value)).then(()=>t)})}function PS(i=Nt()){return i("readonly",e=>{if(e.getAll&&e.getAllKeys)return Promise.all([Ue(e.getAllKeys()),Ue(e.getAll())]).then(([n,s])=>n.map((r,o)=>[r,s[o]]));let t=[];return i("readonly",n=>Zc(n,s=>t.push([s.key,s.value])).then(()=>t))})}window.kv=Ec;async function ka(i){return Pc(i)}async function Ca(i,e){return await Rc(i,e)}var xg=Ci(M2());var mr=function(){var i=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(c){c.preventDefault(),n(++i%e.children.length)},!1);function t(c){return e.appendChild(c.dom),c}function n(c){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===c?"block":"none";i=c}var s=(performance||Date).now(),r=s,o=0,a=t(new mr.Panel("FPS","#0ff","#002")),l=t(new mr.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new mr.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){o++;var c=(performance||Date).now();if(l.update(c-s,200),c>=r+1e3&&(a.update(o*1e3/(c-r),100),r=c,o=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){s=this.end()},domElement:e,setMode:n}};mr.Panel=function(i,e,t){var n=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,c=2*o,d=3*o,u=15*o,f=74*o,g=30*o,C=document.createElement("canvas");C.width=a,C.height=l,C.style.cssText="width:80px;height:48px";var p=C.getContext("2d");return p.font="bold "+9*o+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=t,p.fillRect(0,0,a,l),p.fillStyle=e,p.fillText(i,h,c),p.fillRect(d,u,f,g),p.fillStyle=t,p.globalAlpha=.9,p.fillRect(d,u,f,g),{dom:C,update:function(k,T){n=Math.min(n,k),s=Math.max(s,k),p.fillStyle=t,p.globalAlpha=1,p.fillRect(0,0,a,u),p.fillStyle=e,p.fillText(r(k)+" "+i+" ("+r(n)+"-"+r(s)+")",h,c),p.drawImage(C,d+o,u,f-o,g,d,u,f-o,g),p.fillRect(d+f-o,u,o,g),p.fillStyle=t,p.globalAlpha=.9,p.fillRect(d+f-o,u,o,r((1-k/T)*g))}}};var vg=mr;window.rasterizeHTML=xg.default;function Sg(i){let e=new vg;document.body.appendChild(e.dom),i.updatefns.push(e.update.bind(e))}window.addstats=Sg;async function kg(){console.log("ldpp"),await import("./postproc-2YWBXW7K.js")}kg();async function RS(){await import("./ext-ORTX7ELX.js")}window.ldpp=kg;window.ldext=RS;window.ARKit=Ve;window.THREE=pc;function At(...i){console.log("[lim]",...i)}window.nerk=At;function Fi(){return window._embedded==!0}window.isembedded=Fi;var ls=class i extends fm{static create=(...e)=>new i(...e);constructor(e,t){if(super(),window.app=this,this.parent=e,this.width=this.parent.clientWidth,this.height=this.parent.clientHeight,this.clock=new Pm,this.idletime=180*1e3,this.anchors={},this.mixers=[],this.updatefns=[],this.resizefns=[],this.trackingstate="",this.interval=0,this.resizeTimeout=0,this.campos=new q,this.lastcampos=new q,Sg(this),je.imageFrame=!1,je.pointCloud=!1,Ve.updateConfig(),this.initevents(),this.makekeytab(),this.scene=new Sm,this.root=new kn,this.scene.add(this.root),Fi()&&(this.root.position.y=-1),this.renderer=new Em({alpha:!0,powerPreference:"high-performance"}),this.renderer.outputColorSpace="srgb",this.renderer.autoClear=!0,this.renderer.info.autoReset=!1,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.needsUpdate=!0,this.renderer.shadowMap.type=hm,this.renderer.shadowMap.type=am,this.renderer.shadowMap.type=lm,this.parent.appendChild(this.renderer.domElement),Fi())this.camera=new dr,this.camera.far=400,this.camera.position.y=1e3,this.camera.updateMatrixWorld();else{let o=40,a=600,l=.1,h=this.width/this.height;this.camera=new aa(o,h,l,a),this.camera.position.set(0,.8,4)}this.camtform=new kn,this.scene.add(this.camtform),this.camtform.add(this.camera),Fi();{let o=function(a){let l=new Cn(16777215,.5);l.position.set(0,1,3),l.castShadow=!0,l.shadow.bias=-1e-4,l.shadow.mapSize.set(4096,4096),a.add(l);let h=new Cn(16777215,.5);h.position.set(-3,-3,-3),h.castShadow=!0,h.shadow.bias=-1e-4,h.shadow.mapSize.set(4096,4096),a.add(h);let c=new sr(12303291,526344,1);a.add(c);let d=new ha(2105376);a.add(d);let u=new Mm(10585087,1);u.castShadow=!0,u.distance=8,u.decay=2,u.power=40,a.add(u)};this.lightset1()}let n=new Zm(this.renderer);n.compileEquirectangularShader(),this.envmap=n.fromScene(new Im).texture,this.envmap.colorSpace="srgb",this.scene.environment=this.envmap,this.renderer.toneMapping=um,this.scene.fog=new xm(3355443,.03),this.touchControls=new pr(this.renderer.domElement),this.setuphandlers(),this.bindlisteners(),this.resize(),Fi()||(this.fpcontrols=new Lc(this.camera,this.renderer.domElement),this.restorecamera()),this.makefloor(),Fi()&&(this.planeindicator=new fr,this.scene.add(this.planeindicator.mesh),this.overlayui()),this.anchorMesh=(()=>{let o=new wm(.1,.1,.1),a=new Tm({opacity:.7,side:cm,transparent:!0}),l=new Sn(o,a);return o.translate(0,.05,0),l.castShadow=!0,l.receiveShadow=!0,l})(),Fi()?this.renderer.setAnimationLoop(this.render.bind(this)):this.rafid=requestAnimationFrame(this.render_raf.bind(this)),this.parent.focus();function s(o,a){let l=new Gm;return l.text=a||`there is
nothing here`,l.font="./stuff/SpecialElite-Regular.ttf",l.fontSize=.2,l.position.y=.2,l.material.transparent=!0,l.castShadow=!0,l.fillOpacity=.2,l.outlineColor=0,l.outlineOpacity=.2,l.outlineWidth=.002,l.strokeColor=16777215,l.strokeColor=0,l.strokeWidth=.007,l.strokeOpacity=1,l.sync(),l}let r=s();r.position.set(1,1,-2),this.root.add(r),setInterval(this.checkidle.bind(this),1e3),this.inited=new Date().toLocaleString()}addorbitcontrols(){this.orbitcontrols=new xa(this.camera,this.renderer.domElement),this.orbitcontrols.enableDamping=!0,this.orbitcontrols.dampingFactor=.6,this.orbitcontrols.touches.ONE=ei.PAN,this.orbitcontrols.touches.TWO=ei.DOLLY_ROTATE,this.fpcontrols.detach(),this.fpcontrols=null}addfpcontrols(){this.fpcontrols=new Lc(this.camera,this.renderer.domElement),this.orbitcontrols.dispose(),this.orbitcontrols=null}async p0place(){let e=(await place()).a;e.position.y=-1,this.root.add(e)}lightset0(){let e=new sr(16777215,16777215,1),t=new Cn(16777215,1);e.intensity=.5,this.hemilight=e,this.scene.add(e),t.intensity=1,t.position.set(-10,30,10),t.shadow.mapSize.set(2048,2048),t.castShadow=!0;{let n=20;t.shadow.camera.left=-n,t.shadow.camera.right=n,t.shadow.camera.top=n,t.shadow.camera.bottom=-n,t.shadow.camera.aspect=1,t.shadow.camera.near=.1,t.shadow.camera.far=50,t.shadow.bias=-.005}this.dlight=t,this.scene.add(t)}lightset1___(){let e=new sr(16777215,0,1),t=new Cn(16777215,1),n=new ha;n.intensity=.5,this.scene.add(n),e.intensity=.3,this.hemilight=e,this.scene.add(e),t.intensity=.5,t.position.set(-10,30,10),t.shadow.mapSize.set(2048,2048),t.castShadow=!0;let s=25;t.shadow.camera.left=-s,t.shadow.camera.right=s,t.shadow.camera.top=s,t.shadow.camera.bottom=-s,t.shadow.camera.aspect=1,t.shadow.camera.near=1,t.shadow.camera.far=50,t.shadow.bias=-.005,this.dlight=t,this.scene.add(t)}lightset1(){let e=new sr(16777215,0,1),t=new Cn(16777215,1),n=new ha;n.intensity=.2,this.ambient=n,this.scene.add(n),e.intensity=.3,this.hemilight=e,this.scene.add(e),t.intensity=.5,t.position.set(-10,30,10),t.shadow.mapSize.set(2048,2048),t.castShadow=!0;{let s=25;t.shadow.camera.left=-s,t.shadow.camera.right=s,t.shadow.camera.top=s,t.shadow.camera.bottom=-s,t.shadow.camera.aspect=1,t.shadow.camera.near=1,t.shadow.camera.far=50}this.dlight=t,this.scene.add(t)}makefloor(){this.floor=new Sn(new Cm(350,350,.001,20),new Lm),this.floor.receiveShadow=!0,this.floor.material.transparent=!0,this.floor.material.opacity=.5,this.floor.renderOrder=1,this.root.add(this.floor)}overlayui(){document.body.style.background="transparent";let e=this.makebutton("exit");e.style.position="absolute",e.style.bottom="1px",e.style.right="1px",document.body.appendChild(e),e.addEventListener("click",()=>ii({action:"exit"})),e=this.makebutton("reload"),e.style.position="absolute",e.style.bottom="1px",e.style.right="60px",document.body.appendChild(e),e.addEventListener("click",()=>{ii({action:"reload"})})}pause(){this.orbitcontrols&&(this.orbitcontrols.enabled=!1),this.renderer.setAnimationLoop(null)}resume(){this.orbitcontrols&&(this.orbitcontrols.enabled=!0),this.renderer.setAnimationLoop(this.render.bind(this))}hittest(){Ve.hitTest(x,y,hitType=ARHitTestResultType.featurePoint)}setpoints(e){return je.pointCloud=!!e,Ve.updateConfig(),je.pointCloud}toggleimage(e){return e===!0||e===!1?je.imageFrame=e:je.imageFrame=!je.imageFrame,Ve.updateConfig(),je.imageFrame}bindlisteners(){window.addEventListener("resize",this.onResize,!1),this.touchControls.on("end",this.onTouch),hg.on("frame",this.onARFrame.bind(this)),Ve.on("frame",this.onARFrame.bind(this)),Ve.on("sessionInterupted",this.onARSessionInterupted),Ve.on("sessionInteruptedEnded",this.onARSessionInteruptedEnded),Ve.on("trackingStateChange",this.onARTrackingStateChange),Ve.on("anchorsAdded",this.onARAnchorsAdded),Ve.on("anchorsRemoved",this.onARAnchorsRemoved),Ve.on("debug",e=>At("debug",e))}setuphandlers(){this.onResize=()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize.bind(this),1)},this.onARFrame=e=>{let t=this.camera;if(e.mapdata&&(this.mapdata=e.mapdata,console.log("mapdata",this.mapdata.length),this.onmapdata&&this.onmapdata(this.mapdata)),e.camera&&(this.camera.update(e.camera),this.dispatchEvent({type:"viewchange"})),e.ambientIntensity&&this.dlight&&(this.dlight.intensity=e.ambientIntensity),this.planeindicator&&this.planeindicator.update(this.camera,Object.values(this.anchors)),e.pointCloud)try{let n=e.pointCloud.points;pointscallback&&pointscallback(n)}catch(n){console.warn(n)}if(e.image)try{let n=document.querySelector("#img0");n.src="data:image/jpeg;charset=utf-8;base64,"+e.image,imgcallback&&imgcallback(n)}catch(n){console.warn(n)}e.anchors&&e.anchors.forEach(n=>{this.anchors[n.identifier]===void 0?this.addARAnchor(n):this.updateARAnchor(n)})},this.onARAnchorsAdded=e=>{},this.onARAnchorsRemoved=e=>{e.anchors.forEach(t=>{this.anchors[t.identifier]&&this.scene.remove(this.anchors[t.identifier].group)})},this.onARSessionInterupted=()=>{At("session interupted")},this.onARSessionInteruptedEnded=()=>{At("session interupted ended")},this.onTouch=()=>{if(this.planeindicator&&this.planeindicator.tracking){let e=this.planeindicator.getPosition(),t=Object.values(this.anchors).filter(o=>o.type===Sc),n=t.map(o=>o.identifier),s=new Lt;Ve.removeAnchors(n),s.makeTranslation(e.x,e.y,e.z),At("ground",e.y.toFixed(2)),this.root.position.y=e.y,Ve.addAnchor(s.toArray());let r=e.toArray().map(o=>o.toFixed(1))}},this.onARTrackingStateChange=e=>{switch(e){case Tn.normal:this.trackingstate="normal";break;case Tn.notAvailable:this.trackingstate="not available";break;case Tn.excessiveMotion:this.trackingstate="too much camera motion";break;case Tn.insufficientFeatures:this.trackingstate="not enough features";break;case Tn.initializing:this.trackingstate="initialising";break;case Tn.relocalizing:this.trackingstate="relocalising";break;default:break}At("tracking",this.trackingstate)}}addARAnchor(e){switch(e.type){case ur:{this.anchors[e.identifier]=new ba(e);break}default:{this.anchors[e.identifier]=new ya(e),this.anchorMesh&&(this.anchorMesh.visible=!0,this.anchors[e.identifier].group.add(this.anchorMesh));break}}this.scene.add(this.anchors[e.identifier].group)}updateARAnchor(e){this.anchors[e.identifier].update(e)}prerendertasks(e){this.updatefns.forEach(t=>t()),this.mixers.forEach(t=>t.update(e)),tweenupdate()}render(){let e=this.clock.getDelta();this.renderer.info.reset(),this.prerendertasks(e),this.orbitcontrols&&this.orbitcontrols.update(),this.fpcontrols&&this.fpcontrols.update(.05),this.csm&&this.csm.update(),this.composer?this.composer.render(e):this.renderer.render(this.scene,this.camera),this.cssrend&&this.cssrend.render(this.cssscene,this.camera)}checkidle(){let e=Date.now();if(Fi()){this.activitystamp=e;return}return this.checkpointcamera(),this.camera.position.equals(this.campos)||(this.campos.copy(this.camera.position),this.activitystamp=e),e-this.activitystamp>this.idletime?(this.interval||(this.interval=1e3),this.isidle=!0):this.isidle=!1,this.interval}restorecamera(){let e=localStorage.getItem("camera");try{if(e){e=JSON.parse(e),this.camera.position.fromArray(e.pos),this.camera.rotation.fromArray(e.rot),this.camera.userData.targetPosition.copy(this.camera.position),this.camera.userData.targetRotation.copy(this.camera.rotation);let t=this.orbitcontrols||this.fpcontrols;t.target.fromArray(e.target),t.update(1)}}catch(t){At(t)}return e}checkpointcamera(){try{if(this.camera.position.distanceToSquared(this.lastcampos)>0){let e=this.orbitcontrols||this.fpcontrols,t={pos:this.camera.position.toArray(),rot:this.camera.rotation.toArray(),target:e.target.toArray()};localStorage.setItem("camera",JSON.stringify(t)),this.lastcampos.copy(this.camera.position)}}catch(e){At(e)}}focus(){return this.parent.focus()}initevents(){let e=this.parent,t=this,n={passive:!0};e.addEventListener("mouseenter",s=>{this.focus()},!0),e.addEventListener("touchend",s=>{this.focus()}),e.addEventListener("keydown",s=>this.keydispatch(s)),["mouseenter","touchstart","touchend","touchmove","dragstart","dragend","dragmove","wheel","mousewheel","click","keypress","keyup","keydown"].forEach(s=>e.addEventListener(s,r=>t.setactive(r),n))}setactive(e){this.interval=0,this.isidle&&(this.activitystamp=Date.now(),this.idletimeout&&clearTimeout(this.idletimeout),this.rafid&&(cancelAnimationFrame(this.rafid),this.rafid=requestAnimationFrame(this.render_raf.bind(this))),this.checkidle())}render_raf(){this.interval?this.idletimeout=setTimeout(e=>this.rafid=requestAnimationFrame(this.render_raf.bind(this)),this.interval):this.rafid=requestAnimationFrame(this.render_raf.bind(this)),this.render()}resize(){let e=this.parent.clientWidth,t=this.parent.clientHeight;this.width=e,this.height=t,this.renderer.setSize(e,t),this.composer&&this.composer.setSize(e,t),this.cssrend&&this.cssrend.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.resizefns.forEach(n=>n())}makekeytab(){this.keytab={h:()=>this.home(),c:()=>repl.cfocus(),\u00E7:()=>repl.cfocus(),r:()=>this.reload()}}reload(){console.warn("reload"),this.unload("reload"),window.location.reload()}unload(e){return At("unload...return",e,lim.inited)}keydispatch(e){if(!(e.ctrlKey||e.altKey||e.metaKey))return!1;if(e.key=="f")try{ca(null,document.body)}catch(n){At("tfs",n)}let t=this.keytab[e.key];return t?(e.preventDefault(),t(e)):!0}synclight(){return this.pointlight.position.copy(this.camera.position)}home(e){_m(Xm(0,1.2,0),5,.1,e)}bindbutton(e,t,n){let s=document.getElementById(e);s.addEventListener("click",t),n&&(s.innerHTML=n)}makebutton(e){let t=document.createElement("div"),n=document.createElement("span");return t.id=e,t.classList.add("button"),t.appendChild(n),n.innerText=e,t}exportmap(e){ii({action:"exportmap",file:e})}importmapfile(e){ii({action:"importmap",file:e})}importmap(e){ii({action:"importmap",mapdata:e})}clearcache(){ii({action:"clearcache"})}async savemap(e){e=e||"default",this.exportmap(e),this.onmapdata=async t=>{console.warn("onmapdata",t.length),await Ca(e,t),this.onmapdata=!1}}async restoremap(e){e=e||"default";let t=await ka(e);console.warn("restoremap",t.length),this.importmap(t)}nerk(...e){At("lim",e)}postmessage(e){return ii(e)}};function ZS(i){document.onkeydown=e=>{if(!(e.ctrlKey||e.altKey||e.metaKey)||e.repeat)return;let t=i[e.key];t&&t(e)}}ZS({t:()=>lim.composer=lim.composer?!1:composer0invert(lim),z:()=>console.warn("fuck off")});var ii=i=>i;window.webkit&&(ii=i=>Ve.postMessage(i));window.jsinterface&&(ii=i=>window.jsinterface.postMessage(JSON.stringify(i)));window.postmessage=ii;ls.info={version:.1,revision:2881,lastmod:"last modified: Thu Nov 28 11:27:26 2024 "};window.Lim=ls;function ES(...i){console.warn(";; gambit-embed",...i)}window.confirm=()=>!0;var gr=class{constructor(e){let t=_os_device_from_basic_console();this.dev=t,this.callback=e||(n=>window.lastout=n),t.use_async_input=()=>!0,t.output_add_buffer=n=>{this.callback(t.decoder.decode(n))},_program_start()}async evalsync(e){let t=this.callback,n=this;return new Promise((s,r)=>{n.callback=o=>{o.match("> ")&&(this.callback=t),o=o.trim(),o=o.replace("> ",""),s(o)},n.eval(e)})}eval(e){if(!e.length)return;ES(">EVAL",JSON.stringify(e));let t=this.dev,n=t.read_condvar_scm;t.rbuf=t.encoder.encode(e),t.rlo=0,t.read_condvar_scm=null,n&&_os_condvar_ready_set(n,!0)}};window.Gambit=gr;var _c=[],Mg=[];(()=>{let i="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<i.length;e++)(e%2?Mg:_c).push(t=t+i[e])})();function XS(i){if(i<768)return!1;for(let e=0,t=_c.length;;){let n=e+t>>1;if(i<_c[n])t=n;else if(i>=Mg[n])e=n+1;else return!0;if(e==t)return!1}}function Cg(i){return i>=127462&&i<=127487}var Lg=8205;function Pg(i,e,t=!0,n=!0){return(t?Rg:_S)(i,e,n)}function Rg(i,e,t){if(e==i.length)return e;e&&Zg(i.charCodeAt(e))&&Eg(i.charCodeAt(e-1))&&e--;let n=Xc(i,e);for(e+=Tg(n);e<i.length;){let s=Xc(i,e);if(n==Lg||s==Lg||t&&XS(s))e+=Tg(s),n=s;else if(Cg(s)){let r=0,o=e-2;for(;o>=0&&Cg(Xc(i,o));)r++,o-=2;if(r%2==0)break;e+=2}else break}return e}function _S(i,e,t){for(;e>0;){let n=Rg(i,e-2,t);if(n<e)return n;e--}return 0}function Xc(i,e){let t=i.charCodeAt(e);if(!Eg(t)||e+1==i.length)return t;let n=i.charCodeAt(e+1);return Zg(n)?(t-55296<<10)+(n-56320)+65536:t}function Zg(i){return i>=56320&&i<57344}function Eg(i){return i>=55296&&i<56320}function Tg(i){return i<65536?1:2}var ie=class i{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){[e,t]=fs(this,e,t);let s=[];return this.decompose(0,e,s,2),n.length&&n.decompose(0,n.length,s,3),this.decompose(t,this.length,s,1),cs.from(s,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=fs(this,e,t);let n=[];return this.decompose(e,t,n,0),cs.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),s=new Zn(this),r=new Zn(e);for(let o=t,a=t;;){if(s.next(o),r.next(o),o=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(a+=s.value.length,s.done||a>=n)return!0}}iter(e=1){return new Zn(this,e)}iterRange(e,t=this.length){return new Pa(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let s=this.line(e).from;n=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Ra(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?i.empty:e.length<=32?new ct(e):cs.from(ct.split(e,[]))}},ct=class i extends ie{constructor(e,t=IS(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,s){for(let r=0;;r++){let o=this.text[r],a=s+o.length;if((t?n:a)>=e)return new Gc(s,a,n,o);s=a+1,n++}}decompose(e,t,n,s){let r=e<=0&&t>=this.length?this:new i(Xg(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(s&1){let o=n.pop(),a=Ma(r.text,o.text.slice(),0,r.length);if(a.length<=32)n.push(new i(a,o.length+r.length));else{let l=a.length>>1;n.push(new i(a.slice(0,l)),new i(a.slice(l)))}}else n.push(r)}replace(e,t,n){if(!(n instanceof i))return super.replace(e,t,n);[e,t]=fs(this,e,t);let s=Ma(this.text,Ma(n.text,Xg(this.text,0,e)),t),r=this.length+n.length-(t-e);return s.length<=32?new i(s,r):cs.from(i.split(s,[]),r)}sliceString(e,t=this.length,n=`
`){[e,t]=fs(this,e,t);let s="";for(let r=0,o=0;r<=t&&o<this.text.length;o++){let a=this.text[o],l=r+a.length;r>e&&o&&(s+=n),e<l&&t>r&&(s+=a.slice(Math.max(0,e-r),t-r)),r=l+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],s=-1;for(let r of e)n.push(r),s+=r.length+1,n.length==32&&(t.push(new i(n,s)),n=[],s=-1);return s>-1&&t.push(new i(n,s)),t}},cs=class i extends ie{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,s){for(let r=0;;r++){let o=this.children[r],a=s+o.length,l=n+o.lines-1;if((t?l:a)>=e)return o.lineInner(e,t,n,s);s=a+1,n=l+1}}decompose(e,t,n,s){for(let r=0,o=0;o<=t&&r<this.children.length;r++){let a=this.children[r],l=o+a.length;if(e<=l&&t>=o){let h=s&((o<=e?1:0)|(l>=t?2:0));o>=e&&l<=t&&!h?n.push(a):a.decompose(e-o,t-o,n,h)}o=l+1}}replace(e,t,n){if([e,t]=fs(this,e,t),n.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let o=this.children[s],a=r+o.length;if(e>=r&&t<=a){let l=o.replace(e-r,t-r,n),h=this.lines-o.lines+l.lines;if(l.lines<h>>4&&l.lines>h>>6){let c=this.children.slice();return c[s]=l,new i(c,this.length-(t-e)+n.length)}return super.replace(r,a,l)}r=a+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){[e,t]=fs(this,e,t);let s="";for(let r=0,o=0;r<this.children.length&&o<=t;r++){let a=this.children[r],l=o+a.length;o>e&&r&&(s+=n),e<l&&t>o&&(s+=a.sliceString(e-o,t-o,n)),o=l+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof i))return 0;let n=0,[s,r,o,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,r+=t){if(s==o||r==a)return n;let l=this.children[s],h=e.children[r];if(l!=h)return n+l.scanIdentical(h,t);n+=l.length+1}}static from(e,t=e.reduce((n,s)=>n+s.length+1,-1)){let n=0;for(let f of e)n+=f.lines;if(n<32){let f=[];for(let g of e)g.flatten(f);return new ct(f,t)}let s=Math.max(32,n>>5),r=s<<1,o=s>>1,a=[],l=0,h=-1,c=[];function d(f){let g;if(f.lines>r&&f instanceof i)for(let C of f.children)d(C);else f.lines>o&&(l>o||!l)?(u(),a.push(f)):f instanceof ct&&l&&(g=c[c.length-1])instanceof ct&&f.lines+g.lines<=32?(l+=f.lines,h+=f.length+1,c[c.length-1]=new ct(g.text.concat(f.text),g.length+1+f.length)):(l+f.lines>s&&u(),l+=f.lines,h+=f.length+1,c.push(f))}function u(){l!=0&&(a.push(c.length==1?c[0]:i.from(c,h)),h=-1,l=c.length=0)}for(let f of e)d(f);return u(),a.length==1?a[0]:new i(a,t)}};ie.empty=new ct([""],0);function IS(i){let e=-1;for(let t of i)e+=t.length+1;return e}function Ma(i,e,t=0,n=1e9){for(let s=0,r=0,o=!0;r<i.length&&s<=n;r++){let a=i[r],l=s+a.length;l>=t&&(l>n&&(a=a.slice(0,n-s)),s<t&&(a=a.slice(t-s)),o?(e[e.length-1]+=a,o=!1):e.push(a)),s=l+1}return e}function Xg(i,e,t){return Ma(i,[""],e,t)}var Zn=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof ct?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,s=this.nodes[n],r=this.offsets[n],o=r>>1,a=s instanceof ct?s.text.length:s.children.length;if(o==(t>0?a:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof ct){let l=s.text[o+(t<0?-1:0)];if(this.offsets[n]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=s.children[o+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof ct?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},Pa=class{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new Zn(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=n?s:t<0?s.slice(s.length-n):s.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},Ra=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:s}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(ie.prototype[Symbol.iterator]=function(){return this.iter()},Zn.prototype[Symbol.iterator]=Pa.prototype[Symbol.iterator]=Ra.prototype[Symbol.iterator]=function(){return this});var Gc=class{constructor(e,t,n,s){this.from=e,this.to=t,this.number=n,this.text=s}get length(){return this.to-this.from}};function fs(i,e,t){return e=Math.max(0,Math.min(i.length,e)),[e,Math.max(e,Math.min(i.length,t))]}function Te(i,e,t=!0,n=!0){return Pg(i,e,t,n)}function GS(i){return i>=56320&&i<57344}function WS(i){return i>=55296&&i<56320}function De(i,e){let t=i.charCodeAt(e);if(!WS(t)||e+1==i.length)return t;let n=i.charCodeAt(e+1);return GS(n)?(t-55296<<10)+(n-56320)+65536:t}function Sr(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}function dt(i){return i<65536?1:2}var Wc=/\r\n?|\n/,Xe=function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i}(Xe||(Xe={})),Li=class i{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,n=0,s=0;t<this.sections.length;){let r=this.sections[t++],o=this.sections[t++];o<0?(e(n,s,r),s+=r):s+=o,n+=r}}iterChangedRanges(e,t=!1){Dc(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let n=this.sections[t++],s=this.sections[t++];s<0?e.push(n,s):e.push(s,n)}return new i(e)}composeDesc(e){return this.empty?e:e.empty?this:Ng(this,e)}mapDesc(e,t=!1){return e.empty?this:Nc(this,e,t)}mapPos(e,t=-1,n=Xe.Simple){let s=0,r=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],h=s+a;if(l<0){if(h>e)return r+(e-s);r+=a}else{if(n!=Xe.Simple&&h>=e&&(n==Xe.TrackDel&&s<e&&h>e||n==Xe.TrackBefore&&s<e||n==Xe.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!a)return e==s||t<0?r:r+l;r+=l}s=h}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return r}touchesRange(e,t=e){for(let n=0,s=0;n<this.sections.length&&s<=t;){let r=this.sections[n++],o=this.sections[n++],a=s+r;if(o>=0&&s<=t&&a>=e)return s<e&&a>t?"cover":!0;s=a}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let n=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+n+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new i(e)}static create(e){return new i(e)}},Je=class i extends Li{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Dc(this,(t,n,s,r,o)=>e=e.replace(s,s+(n-t),o),!1),e}mapDesc(e,t=!1){return Nc(this,e,t,!0)}invert(e){let t=this.sections.slice(),n=[];for(let s=0,r=0;s<t.length;s+=2){let o=t[s],a=t[s+1];if(a>=0){t[s]=a,t[s+1]=o;let l=s>>1;for(;n.length<l;)n.push(ie.empty);n.push(o?e.slice(r,r+o):ie.empty)}r+=o}return new i(t,n)}compose(e){return this.empty?e:e.empty?this:Ng(this,e,!0)}map(e,t=!1){return e.empty?this:Nc(this,e,t,!0)}iterChanges(e,t=!1){Dc(this,e,t)}get desc(){return Li.create(this.sections)}filter(e){let t=[],n=[],s=[],r=new En(this);e:for(let o=0,a=0;;){let l=o==e.length?1e9:e[o++];for(;a<l||a==l&&r.len==0;){if(r.done)break e;let c=Math.min(r.len,l-a);ze(s,c,-1);let d=r.ins==-1?-1:r.off==0?r.ins:0;ze(t,c,d),d>0&&Ki(n,t,r.text),r.forward(c),a+=c}let h=e[o++];for(;a<h;){if(r.done)break e;let c=Math.min(r.len,h-a);ze(t,c,-1),ze(s,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),a+=c}}return{changes:new i(t,n),filtered:Li.create(s)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t],s=this.sections[t+1];s<0?e.push(n):s==0?e.push([n]):e.push([n].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,n){let s=[],r=[],o=0,a=null;function l(c=!1){if(!c&&!s.length)return;o<t&&ze(s,t-o,-1);let d=new i(s,r);a=a?a.compose(d.map(a)):d,s=[],r=[],o=0}function h(c){if(Array.isArray(c))for(let d of c)h(d);else if(c instanceof i){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);l(),a=a?a.compose(c.map(a)):c}else{let{from:d,to:u=d,insert:f}=c;if(d>u||d<0||u>t)throw new RangeError(`Invalid change range ${d} to ${u} (in doc of length ${t})`);let g=f?typeof f=="string"?ie.of(f.split(n||Wc)):f:ie.empty,C=g.length;if(d==u&&C==0)return;d<o&&l(),d>o&&ze(s,d-o,-1),ze(s,u-d,C),Ki(r,s,g),o=u}}return h(e),l(!a),a}static empty(e){return new i(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],n=[];for(let s=0;s<e.length;s++){let r=e[s];if(typeof r=="number")t.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)t.push(r[0],0);else{for(;n.length<s;)n.push(ie.empty);n[s]=ie.of(r.slice(1)),t.push(r[0],n[s].length)}}}return new i(t,n)}static createSet(e,t){return new i(e,t)}};function ze(i,e,t,n=!1){if(e==0&&t<=0)return;let s=i.length-2;s>=0&&t<=0&&t==i[s+1]?i[s]+=e:s>=0&&e==0&&i[s]==0?i[s+1]+=t:n?(i[s]+=e,i[s+1]+=t):i.push(e,t)}function Ki(i,e,t){if(t.length==0)return;let n=e.length-2>>1;if(n<i.length)i[i.length-1]=i[i.length-1].append(t);else{for(;i.length<n;)i.push(ie.empty);i.push(t)}}function Dc(i,e,t){let n=i.inserted;for(let s=0,r=0,o=0;o<i.sections.length;){let a=i.sections[o++],l=i.sections[o++];if(l<0)s+=a,r+=a;else{let h=s,c=r,d=ie.empty;for(;h+=a,c+=l,l&&n&&(d=d.append(n[o-2>>1])),!(t||o==i.sections.length||i.sections[o+1]<0);)a=i.sections[o++],l=i.sections[o++];e(s,h,r,c,d),s=h,r=c}}}function Nc(i,e,t,n=!1){let s=[],r=n?[]:null,o=new En(i),a=new En(e);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let h=Math.min(o.len,a.len);ze(s,h,-1),o.forward(h),a.forward(h)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!t))){let h=a.len;for(ze(s,a.ins,-1);h;){let c=Math.min(o.len,h);o.ins>=0&&l<o.i&&o.len<=c&&(ze(s,0,o.ins),r&&Ki(r,s,o.text),l=o.i),o.forward(c),h-=c}a.next()}else if(o.ins>=0){let h=0,c=o.len;for(;c;)if(a.ins==-1){let d=Math.min(c,a.len);h+=d,c-=d,a.forward(d)}else if(a.ins==0&&a.len<c)c-=a.len,a.next();else break;ze(s,h,l<o.i?o.ins:0),r&&l<o.i&&Ki(r,s,o.text),l=o.i,o.forward(o.len-c)}else{if(o.done&&a.done)return r?Je.createSet(s,r):Li.create(s);throw new Error("Mismatched change set lengths")}}}function Ng(i,e,t=!1){let n=[],s=t?[]:null,r=new En(i),o=new En(e);for(let a=!1;;){if(r.done&&o.done)return s?Je.createSet(n,s):Li.create(n);if(r.ins==0)ze(n,r.len,0,a),r.next();else if(o.len==0&&!o.done)ze(n,0,o.ins,a),s&&Ki(s,n,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(r.len2,o.len),h=n.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;ze(n,l,c,a),s&&c&&Ki(s,n,o.text)}else o.ins==-1?(ze(n,r.off?0:r.len,l,a),s&&Ki(s,n,r.textBit(l))):(ze(n,r.off?0:r.len,o.off?0:o.ins,a),s&&!o.off&&Ki(s,n,o.text));a=(r.ins>l||o.ins>=0&&o.len>l)&&(a||n.length>h),r.forward2(l),o.forward(l)}}}}var En=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?ie.empty:e[t]}textBit(e){let{inserted:t}=this.set,n=this.i-2>>1;return n>=t.length&&!e?ie.empty:t[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},hs=class i{constructor(e,t,n){this.from=e,this.to=t,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let n,s;return this.empty?n=s=e.mapPos(this.from,t):(n=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),n==this.from&&s==this.to?this:new i(n,s,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return H.range(e,t);let n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return H.range(this.anchor,n)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return H.range(e.anchor,e.head)}static create(e,t,n){return new i(e,t,n)}},H=class i{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:i.create(this.ranges.map(n=>n.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(e.ranges[n],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new i([this.main],0)}addRange(e,t=!0){return i.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let n=this.ranges.slice();return n[t]=e,i.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new i(e.ranges.map(t=>hs.fromJSON(t)),e.main)}static single(e,t=e){return new i([i.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,s=0;s<e.length;s++){let r=e[s];if(r.empty?r.from<=n:r.from<n)return i.normalized(e.slice(),t);n=r.to}return new i(e,t)}static cursor(e,t=0,n,s){return hs.create(e,e,(t==0?0:t<0?8:16)|(n==null?7:Math.min(6,n))|(s??16777215)<<6)}static range(e,t,n,s){let r=(n??16777215)<<6|(s==null?7:Math.min(6,s));return t<e?hs.create(t,e,48|r):hs.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let n=e[t];e.sort((s,r)=>s.from-r.from),t=e.indexOf(n);for(let s=1;s<e.length;s++){let r=e[s],o=e[s-1];if(r.empty?r.from<=o.to:r.from<o.to){let a=o.from,l=Math.max(r.to,o.to);s<=t&&t--,e.splice(--s,2,r.anchor>r.head?i.range(l,a):i.range(a,l))}}return new i(e,t)}};function Ag(i,e){for(let t of i.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}var jc=0,Y=class i{constructor(e,t,n,s,r){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=s,this.id=jc++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(e={}){return new i(e.combine||(t=>t),e.compareInput||((t,n)=>t===n),e.compare||(e.combine?(t,n)=>t===n:Uc),!!e.static,e.enables)}of(e){return new ds([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ds(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ds(e,this,2,t)}from(e,t){return t||(t=n=>n),this.compute([e],n=>t(n.field(e)))}};function Uc(i,e){return i==e||i.length==e.length&&i.every((t,n)=>t===e[n])}var ds=class{constructor(e,t,n,s){this.dependencies=e,this.facet=t,this.type=n,this.value=s,this.id=jc++}dynamicSlot(e){var t;let n=this.value,s=this.facet.compareInput,r=this.id,o=e[r]>>1,a=this.type==2,l=!1,h=!1,c=[];for(let d of this.dependencies)d=="doc"?l=!0:d=="selection"?h=!0:((t=e[d.id])!==null&&t!==void 0?t:1)&1||c.push(e[d.id]);return{create(d){return d.values[o]=n(d),1},update(d,u){if(l&&u.docChanged||h&&(u.docChanged||u.selection)||Ac(d,c)){let f=n(d);if(a?!_g(f,d.values[o],s):!s(f,d.values[o]))return d.values[o]=f,1}return 0},reconfigure:(d,u)=>{let f,g=u.config.address[r];if(g!=null){let C=_a(u,g);if(this.dependencies.every(p=>p instanceof Y?u.facet(p)===d.facet(p):p instanceof Ze?u.field(p,!1)==d.field(p,!1):!0)||(a?_g(f=n(d),C,s):s(f=n(d),C)))return d.values[o]=C,0}else f=n(d);return d.values[o]=f,1}}}};function _g(i,e,t){if(i.length!=e.length)return!1;for(let n=0;n<i.length;n++)if(!t(i[n],e[n]))return!1;return!0}function Ac(i,e){let t=!1;for(let n of e)br(i,n)&1&&(t=!0);return t}function DS(i,e,t){let n=t.map(l=>i[l.id]),s=t.map(l=>l.type),r=n.filter(l=>!(l&1)),o=i[e.id]>>1;function a(l){let h=[];for(let c=0;c<n.length;c++){let d=_a(l,n[c]);if(s[c]==2)for(let u of d)h.push(u);else h.push(d)}return e.combine(h)}return{create(l){for(let h of n)br(l,h);return l.values[o]=a(l),1},update(l,h){if(!Ac(l,r))return 0;let c=a(l);return e.compare(c,l.values[o])?0:(l.values[o]=c,1)},reconfigure(l,h){let c=Ac(l,n),d=h.config.facets[e.id],u=h.facet(e);if(d&&!c&&Uc(t,d))return l.values[o]=u,0;let f=a(l);return e.compare(f,u)?(l.values[o]=u,0):(l.values[o]=f,1)}}}var Ig=Y.define({static:!0}),Ze=class i{constructor(e,t,n,s,r){this.id=e,this.createF=t,this.updateF=n,this.compareF=s,this.spec=r,this.provides=void 0}static define(e){let t=new i(jc++,e.create,e.update,e.compare||((n,s)=>n===s),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Ig).find(n=>n.field==this);return(t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:n=>(n.values[t]=this.create(n),1),update:(n,s)=>{let r=n.values[t],o=this.updateF(r,s);return this.compareF(r,o)?0:(n.values[t]=o,1)},reconfigure:(n,s)=>s.config.address[this.id]!=null?(n.values[t]=s.field(this),0):(n.values[t]=this.create(n),1)}}init(e){return[this,Ig.of({field:this,create:e})]}get extension(){return this}},Pn={lowest:4,low:3,default:2,high:1,highest:0};function yr(i){return e=>new Za(e,i)}var Ot={highest:yr(Pn.highest),high:yr(Pn.high),default:yr(Pn.default),low:yr(Pn.low),lowest:yr(Pn.lowest)},Za=class{constructor(e,t){this.inner=e,this.prec=t}},Ea=class i{of(e){return new wr(this,e)}reconfigure(e){return i.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}},wr=class{constructor(e,t){this.compartment=e,this.inner=t}},Xa=class i{constructor(e,t,n,s,r,o){for(this.base=e,this.compartments=t,this.dynamicSlots=n,this.address=s,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,n){let s=[],r=Object.create(null),o=new Map;for(let u of NS(e,t,o))u instanceof Ze?s.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let a=Object.create(null),l=[],h=[];for(let u of s)a[u.id]=h.length<<1,h.push(f=>u.slot(f));let c=n?.config.facets;for(let u in r){let f=r[u],g=f[0].facet,C=c&&c[u]||[];if(f.every(p=>p.type==0))if(a[g.id]=l.length<<1|1,Uc(C,f))l.push(n.facet(g));else{let p=g.combine(f.map(k=>k.value));l.push(n&&g.compare(p,n.facet(g))?n.facet(g):p)}else{for(let p of f)p.type==0?(a[p.id]=l.length<<1|1,l.push(p.value)):(a[p.id]=h.length<<1,h.push(k=>p.dynamicSlot(k)));a[g.id]=h.length<<1,h.push(p=>DS(p,g,f))}}let d=h.map(u=>u(a));return new i(e,o,d,a,l,r)}};function NS(i,e,t){let n=[[],[],[],[],[]],s=new Map;function r(o,a){let l=s.get(o);if(l!=null){if(l<=a)return;let h=n[l].indexOf(o);h>-1&&n[l].splice(h,1),o instanceof wr&&t.delete(o.compartment)}if(s.set(o,a),Array.isArray(o))for(let h of o)r(h,a);else if(o instanceof wr){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),r(h,a)}else if(o instanceof Za)r(o.inner,o.prec);else if(o instanceof Ze)n[a].push(o),o.provides&&r(o.provides,a);else if(o instanceof ds)n[a].push(o),o.facet.extensions&&r(o.facet.extensions,Pn.default);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(h,a)}}return r(i,Pn.default),n.reduce((o,a)=>o.concat(a))}function br(i,e){if(e&1)return 2;let t=e>>1,n=i.status[t];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;i.status[t]=4;let s=i.computeSlot(i,i.config.dynamicSlots[t]);return i.status[t]=2|s}function _a(i,e){return e&1?i.config.staticValues[e>>1]:i.values[e>>1]}var Hg=Y.define(),Hc=Y.define({combine:i=>i.some(e=>e),static:!0}),Og=Y.define({combine:i=>i.length?i[0]:void 0,static:!0}),Vg=Y.define(),zg=Y.define(),Fg=Y.define(),Kg=Y.define({combine:i=>i.length?i[0]:!1}),st=class{constructor(e,t){this.type=e,this.value=t}static define(){return new Oc}},Oc=class{of(e){return new st(this,e)}},Vc=class{constructor(e){this.map=e}of(e){return new ee(this,e)}},ee=class i{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new i(this.type,t)}is(e){return this.type==e}static define(e={}){return new Vc(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let s of e){let r=s.map(t);r&&n.push(r)}return n}};ee.reconfigure=ee.define();ee.appendConfig=ee.define();var Re=class i{constructor(e,t,n,s,r,o){this.startState=e,this.changes=t,this.selection=n,this.effects=s,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,n&&Ag(n,t.newLength),r.some(a=>a.type==i.time)||(this.annotations=r.concat(i.time.of(Date.now())))}static create(e,t,n,s,r,o){return new i(e,t,n,s,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(i.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}};Re.time=st.define();Re.userEvent=st.define();Re.addToHistory=st.define();Re.remote=st.define();function AS(i,e){let t=[];for(let n=0,s=0;;){let r,o;if(n<i.length&&(s==e.length||e[s]>=i[n]))r=i[n++],o=i[n++];else if(s<e.length)r=e[s++],o=e[s++];else return t;!t.length||t[t.length-1]<r?t.push(r,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Yg(i,e,t){var n;let s,r,o;return t?(s=e.changes,r=Je.empty(e.changes.length),o=i.changes.compose(e.changes)):(s=e.changes.map(i.changes),r=i.changes.mapDesc(e.changes,!0),o=i.changes.compose(s)),{changes:o,selection:e.selection?e.selection.map(r):(n=i.selection)===null||n===void 0?void 0:n.map(s),effects:ee.mapEffects(i.effects,s).concat(ee.mapEffects(e.effects,r)),annotations:i.annotations.length?i.annotations.concat(e.annotations):e.annotations,scrollIntoView:i.scrollIntoView||e.scrollIntoView}}function zc(i,e,t){let n=e.selection,s=us(e.annotations);return e.userEvent&&(s=s.concat(Re.userEvent.of(e.userEvent))),{changes:e.changes instanceof Je?e.changes:Je.of(e.changes||[],t,i.facet(Og)),selection:n&&(n instanceof H?n:H.single(n.anchor,n.head)),effects:us(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function Bg(i,e,t){let n=zc(i,e.length?e[0]:{},i.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let r=1;r<e.length;r++){e[r].filter===!1&&(t=!1);let o=!!e[r].sequential;n=Yg(n,zc(i,e[r],o?n.changes.newLength:i.doc.length),o)}let s=Re.create(i,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return OS(t?HS(s):s)}function HS(i){let e=i.startState,t=!0;for(let s of e.facet(Vg)){let r=s(i);if(r===!1){t=!1;break}Array.isArray(r)&&(t=t===!0?r:AS(t,r))}if(t!==!0){let s,r;if(t===!1)r=i.changes.invertedDesc,s=Je.empty(e.doc.length);else{let o=i.changes.filter(t);s=o.changes,r=o.filtered.mapDesc(o.changes).invertedDesc}i=Re.create(e,s,i.selection&&i.selection.map(r),ee.mapEffects(i.effects,r),i.annotations,i.scrollIntoView)}let n=e.facet(zg);for(let s=n.length-1;s>=0;s--){let r=n[s](i);r instanceof Re?i=r:Array.isArray(r)&&r.length==1&&r[0]instanceof Re?i=r[0]:i=Bg(e,us(r),!1)}return i}function OS(i){let e=i.startState,t=e.facet(Fg),n=i;for(let s=t.length-1;s>=0;s--){let r=t[s](i);r&&Object.keys(r).length&&(n=Yg(n,zc(e,r,i.changes.newLength),!0))}return n==i?i:Re.create(e,i.changes,i.selection,n.effects,n.annotations,n.scrollIntoView)}var VS=[];function us(i){return i==null?VS:Array.isArray(i)?i:[i]}var be=function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i}(be||(be={})),zS=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Fc;try{Fc=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function FS(i){if(Fc)return Fc.test(i);for(let e=0;e<i.length;e++){let t=i[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||zS.test(t)))return!0}return!1}function KS(i){return e=>{if(!/\S/.test(e))return be.Space;if(FS(e))return be.Word;for(let t=0;t<i.length;t++)if(e.indexOf(i[t])>-1)return be.Word;return be.Other}}var ce=class i{constructor(e,t,n,s,r,o){this.config=e,this.doc=t,this.selection=n,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)br(this,a<<1);this.computeSlot=null}field(e,t=!0){let n=this.config.address[e.id];if(n==null){if(t)throw new RangeError("Field is not present in this state");return}return br(this,n),_a(this,n)}update(...e){return Bg(this,e,!0)}applyTransaction(e){let t=this.config,{base:n,compartments:s}=t;for(let a of e.effects)a.is(Ea.reconfigure)?(t&&(s=new Map,t.compartments.forEach((l,h)=>s.set(h,l)),t=null),s.set(a.value.compartment,a.value.extension)):a.is(ee.reconfigure)?(t=null,n=a.value):a.is(ee.appendConfig)&&(t=null,n=us(n).concat(a.value));let r;t?r=e.startState.values.slice():(t=Xa.resolve(n,s,this),r=new i(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values);let o=e.startState.facet(Hc)?e.newSelection:e.newSelection.asSingle();new i(t,e.newDoc,o,r,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:H.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,n=e(t.ranges[0]),s=this.changes(n.changes),r=[n.range],o=us(n.effects);for(let a=1;a<t.ranges.length;a++){let l=e(t.ranges[a]),h=this.changes(l.changes),c=h.map(s);for(let u=0;u<a;u++)r[u]=r[u].map(c);let d=s.mapDesc(h,!0);r.push(l.range.map(d)),s=s.compose(c),o=ee.mapEffects(o,c).concat(ee.mapEffects(us(l.effects),d))}return{changes:s,selection:H.create(r,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Je?e:Je.of(e,this.doc.length,this.facet(i.lineSeparator))}toText(e){return ie.of(e.split(this.facet(i.lineSeparator)||Wc))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(br(this,t),_a(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let s=e[n];s instanceof Ze&&this.config.address[s.id]!=null&&(t[n]=s.spec.toJSON(this.field(e[n]),this))}return t}static fromJSON(e,t={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(n){for(let r in n)if(Object.prototype.hasOwnProperty.call(e,r)){let o=n[r],a=e[r];s.push(o.init(l=>o.spec.fromJSON(a,l)))}}return i.create({doc:e.doc,selection:H.fromJSON(e.selection),extensions:t.extensions?s.concat([t.extensions]):s})}static create(e={}){let t=Xa.resolve(e.extensions||[],new Map),n=e.doc instanceof ie?e.doc:ie.of((e.doc||"").split(t.staticFacet(i.lineSeparator)||Wc)),s=e.selection?e.selection instanceof H?e.selection:H.single(e.selection.anchor,e.selection.head):H.single(0);return Ag(s,n.length),t.staticFacet(Hc)||(s=s.asSingle()),new i(t,n,s,t.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(i.tabSize)}get lineBreak(){return this.facet(i.lineSeparator)||`
`}get readOnly(){return this.facet(Kg)}phrase(e,...t){for(let n of this.facet(i.phrases))if(Object.prototype.hasOwnProperty.call(n,e)){e=n[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(n,s)=>{if(s=="$")return"$";let r=+(s||1);return!r||r>t.length?n:t[r-1]})),e}languageDataAt(e,t,n=-1){let s=[];for(let r of this.facet(Hg))for(let o of r(this,t,n))Object.prototype.hasOwnProperty.call(o,e)&&s.push(o[e]);return s}charCategorizer(e){return KS(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:n,length:s}=this.doc.lineAt(e),r=this.charCategorizer(e),o=e-n,a=e-n;for(;o>0;){let l=Te(t,o,!1);if(r(t.slice(l,o))!=be.Word)break;o=l}for(;a<s;){let l=Te(t,a);if(r(t.slice(a,l))!=be.Word)break;a=l}return o==a?null:H.range(o+n,a+n)}};ce.allowMultipleSelections=Hc;ce.tabSize=Y.define({combine:i=>i.length?i[0]:4});ce.lineSeparator=Og;ce.readOnly=Kg;ce.phrases=Y.define({compare(i,e){let t=Object.keys(i),n=Object.keys(e);return t.length==n.length&&t.every(s=>i[s]==e[s])}});ce.languageData=Hg;ce.changeFilter=Vg;ce.transactionFilter=zg;ce.transactionExtender=Fg;Ea.reconfigure=ee.define();function ut(i,e,t={}){let n={};for(let s of i)for(let r of Object.keys(s)){let o=s[r],a=n[r];if(a===void 0)n[r]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(t,r))n[r]=t[r](a,o);else throw new Error("Config merge conflict for field "+r)}for(let s in e)n[s]===void 0&&(n[s]=e[s]);return n}var Ht=class{eq(e){return this==e}range(e,t=e){return vr.create(e,t,this)}};Ht.prototype.startSide=Ht.prototype.endSide=0;Ht.prototype.point=!1;Ht.prototype.mapMode=Xe.TrackDel;var vr=class i{constructor(e,t,n){this.from=e,this.to=t,this.value=n}static create(e,t,n){return new i(e,t,n)}};function Kc(i,e){return i.from-e.from||i.value.startSide-e.value.startSide}var Yc=class i{constructor(e,t,n,s){this.from=e,this.to=t,this.value=n,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,s=0){let r=n?this.to:this.from;for(let o=s,a=r.length;;){if(o==a)return o;let l=o+a>>1,h=r[l]-e||(n?this.value[l].endSide:this.value[l].startSide)-t;if(l==o)return h>=0?o:a;h>=0?a=l:o=l+1}}between(e,t,n,s){for(let r=this.findIndex(t,-1e9,!0),o=this.findIndex(n,1e9,!1,r);r<o;r++)if(s(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return!1}map(e,t){let n=[],s=[],r=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let h=this.value[l],c=this.from[l]+e,d=this.to[l]+e,u,f;if(c==d){let g=t.mapPos(c,h.startSide,h.mapMode);if(g==null||(u=f=g,h.startSide!=h.endSide&&(f=t.mapPos(c,h.endSide),f<u)))continue}else if(u=t.mapPos(c,h.startSide),f=t.mapPos(d,h.endSide),u>f||u==f&&h.startSide>0&&h.endSide<=0)continue;(f-u||h.endSide-h.startSide)<0||(o<0&&(o=u),h.point&&(a=Math.max(a,f-u)),n.push(h),s.push(u-o),r.push(f-o))}return{mapped:n.length?new i(s,r,n,a):null,pos:o}}},Se=class i{constructor(e,t,n,s){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=s}static create(e,t,n,s){return new i(e,t,n,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:s=0,filterTo:r=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(n&&(t=t.slice().sort(Kc)),this.isEmpty)return t.length?i.of(t):this;let a=new Ia(this,null,-1).goto(0),l=0,h=[],c=new Tt;for(;a.value||l<t.length;)if(l<t.length&&(a.from-t[l].from||a.startSide-t[l].value.startSide)>=0){let d=t[l++];c.addInner(d.from,d.to,d.value)||h.push(d)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(a.chunkIndex)<t[l].from)&&(!o||s>this.chunkEnd(a.chunkIndex)||r<this.chunkPos[a.chunkIndex])&&c.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||s>a.to||r<a.from||o(a.from,a.to,a.value))&&(c.addInner(a.from,a.to,a.value)||h.push(vr.create(a.from,a.to,a.value))),a.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?i.empty:this.nextLayer.update({add:h,filter:o,filterFrom:s,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],s=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],h=e.touchesRange(a,a+l.length);if(h===!1)s=Math.max(s,l.maxPoint),t.push(l),n.push(e.mapPos(a));else if(h===!0){let{mapped:c,pos:d}=l.map(a,e);c&&(s=Math.max(s,c.maxPoint),t.push(c),n.push(d))}}let r=this.nextLayer.map(e);return t.length==0?r:new i(n,t,r||i.empty,s)}between(e,t,n){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s];if(t>=r&&e<=r+o.length&&o.between(r,e-r,t-r,n)===!1)return}this.nextLayer.between(e,t,n)}}iter(e=0){return xr.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return xr.from(e).goto(t)}static compare(e,t,n,s,r=-1){let o=e.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=r),a=t.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=r),l=Gg(o,a,n),h=new Rn(o,l,r),c=new Rn(a,l,r);n.iterGaps((d,u,f)=>Wg(h,d,c,u,f,s)),n.empty&&n.length==0&&Wg(h,0,c,0,0,s)}static eq(e,t,n=0,s){s==null&&(s=999999999);let r=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0),o=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let a=Gg(r,o),l=new Rn(r,a,0).goto(n),h=new Rn(o,a,0).goto(n);for(;;){if(l.to!=h.to||!Bc(l.active,h.active)||l.point&&(!h.point||!l.point.eq(h.point)))return!1;if(l.to>s)return!0;l.next(),h.next()}}static spans(e,t,n,s,r=-1){let o=new Rn(e,null,r).goto(t),a=t,l=o.openStart;for(;;){let h=Math.min(o.to,n);if(o.point){let c=o.activeForPoint(o.to),d=o.pointFrom<t?c.length+1:o.point.startSide<0?c.length:Math.min(c.length,l);s.point(a,h,o.point,c,d,o.pointRank),l=Math.min(o.openEnd(h),c.length)}else h>a&&(s.span(a,h,o.active,l),l=o.openEnd(h));if(o.to>n)return l+(o.point&&o.to>n?1:0);a=o.to,o.next()}}static of(e,t=!1){let n=new Tt;for(let s of e instanceof vr?[e]:t?YS(e):e)n.add(s.from,s.to,s.value);return n.finish()}static join(e){if(!e.length)return i.empty;let t=e[e.length-1];for(let n=e.length-2;n>=0;n--)for(let s=e[n];s!=i.empty;s=s.nextLayer)t=new i(s.chunkPos,s.chunk,t,Math.max(s.maxPoint,t.maxPoint));return t}};Se.empty=new Se([],[],null,-1);function YS(i){if(i.length>1)for(let e=i[0],t=1;t<i.length;t++){let n=i[t];if(Kc(e,n)>0)return i.slice().sort(Kc);e=n}return i}Se.empty.nextLayer=Se.empty;var Tt=class i{finishChunk(e){this.chunks.push(new Yc(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new i)).add(e,t,n)}addInner(e,t,n){let s=e-this.lastTo||n.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(Se.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=Se.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}};function Gg(i,e,t){let n=new Map;for(let r of i)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&n.set(r.chunk[o],r.chunkPos[o]);let s=new Set;for(let r of e)for(let o=0;o<r.chunk.length;o++){let a=n.get(r.chunk[o]);a!=null&&(t?t.mapPos(a):a)==r.chunkPos[o]&&!t?.touchesRange(a,a+r.chunk[o].length)&&s.add(r.chunk[o])}return s}var Ia=class{constructor(e,t,n,s=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},xr=class i{constructor(e){this.heap=e}static from(e,t=null,n=-1){let s=[];for(let r=0;r<e.length;r++)for(let o=e[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=n&&s.push(new Ia(o,t,n,r));return s.length==1?s[0]:new i(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)Ic(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)Ic(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Ic(this.heap,0)}}};function Ic(i,e){for(let t=i[e];;){let n=(e<<1)+1;if(n>=i.length)break;let s=i[n];if(n+1<i.length&&s.compare(i[n+1])>=0&&(s=i[n+1],n++),t.compare(s)<0)break;i[n]=t,i[e]=s,e=n}}var Rn=class{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=xr.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){La(this.active,e),La(this.activeTo,e),La(this.activeRank,e),this.minActive=Dg(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:s,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||s-this.activeTo[t])>0;)t++;Ta(this.active,t,n),Ta(this.activeTo,t,s),Ta(this.activeRank,t,r),e&&Ta(e,t,this.cursor.from),this.minActive=Dg(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),n&&La(n,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let s=n.length-1;s>=0&&n[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}};function Wg(i,e,t,n,s,r){i.goto(e),t.goto(n);let o=n+s,a=n,l=n-e;for(;;){let h=i.to+l-t.to,c=h||i.endSide-t.endSide,d=c<0?i.to+l:t.to,u=Math.min(d,o);if(i.point||t.point?i.point&&t.point&&(i.point==t.point||i.point.eq(t.point))&&Bc(i.activeForPoint(i.to),t.activeForPoint(t.to))||r.comparePoint(a,u,i.point,t.point):u>a&&!Bc(i.active,t.active)&&r.compareRange(a,u,i.active,t.active),d>o)break;(h||i.openEnd!=t.openEnd)&&r.boundChange&&r.boundChange(d),a=d,c<=0&&i.next(),c>=0&&t.next()}}function Bc(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t]&&!i[t].eq(e[t]))return!1;return!0}function La(i,e){for(let t=e,n=i.length-1;t<n;t++)i[t]=i[t+1];i.pop()}function Ta(i,e,t){for(let n=i.length-1;n>=e;n--)i[n+1]=i[n];i[e]=t}function Dg(i,e){let t=-1,n=1e9;for(let s=0;s<e.length;s++)(e[s]-n||i[s].endSide-i[t].endSide)<0&&(t=s,n=e[s]);return t}function Yi(i,e,t=i.length){let n=0;for(let s=0;s<t;)i.charCodeAt(s)==9?(n+=e-n%e,s++):(n++,s=Te(i,s));return n}function jg(i,e,t,n){for(let s=0,r=0;;){if(r>=e)return s;if(s==i.length)break;r+=i.charCodeAt(s)==9?t-r%t:1,s=Te(i,s)}return n===!0?-1:i.length}var Jc="\u037C",Ug=typeof Symbol>"u"?"__"+Jc:Symbol.for(Jc),Qc=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Jg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},Mt=class{constructor(e,t){this.rules=[];let{finish:n}=t||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,a,l,h){let c=[],d=/^@(\w+)\b/.exec(o[0]),u=d&&d[1]=="keyframes";if(d&&a==null)return l.push(o[0]+";");for(let f in a){let g=a[f];if(/&/.test(f))r(f.split(/,\s*/).map(C=>o.map(p=>C.replace(/&/,p))).reduce((C,p)=>C.concat(p)),g,l);else if(g&&typeof g=="object"){if(!d)throw new RangeError("The value of a property ("+f+") should be a primitive value.");r(s(f),g,c,u)}else g!=null&&c.push(f.replace(/_.*/,"").replace(/[A-Z]/g,C=>"-"+C.toLowerCase())+": "+g+";")}(c.length||u)&&l.push((n&&!d&&!h?o.map(n):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in e)r(s(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=Jg[Ug]||1;return Jg[Ug]=e+1,Jc+e.toString(36)}static mount(e,t,n){let s=e[Qc],r=n&&n.nonce;s?r&&s.setNonce(r):s=new $c(e,r),s.mount(Array.isArray(t)?t:[t],e)}},Qg=new Map,$c=class{constructor(e,t){let n=e.ownerDocument||e,s=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let r=Qg.get(n);if(r)return e[Qc]=r;this.sheet=new s.CSSStyleSheet,Qg.set(n,this)}else this.styleTag=n.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Qc]=this}mount(e,t){let n=this.sheet,s=0,r=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,a),n)for(let h=0;h<a.rules.length;h++)n.insertRule(a.rules[h],s++)}else{for(;r<l;)s+=this.modules[r++].rules.length;s+=a.rules.length,r++}}if(n)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=t.head||t;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}};var Ti={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ps={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},BS=typeof navigator<"u"&&/Mac/.test(navigator.platform),jS=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(Me=0;Me<10;Me++)Ti[48+Me]=Ti[96+Me]=String(Me);var Me;for(Me=1;Me<=24;Me++)Ti[Me+111]="F"+Me;var Me;for(Me=65;Me<=90;Me++)Ti[Me]=String.fromCharCode(Me+32),ps[Me]=String.fromCharCode(Me);var Me;for(Ga in Ti)ps.hasOwnProperty(Ga)||(ps[Ga]=Ti[Ga]);var Ga;function $g(i){var e=BS&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||jS&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",t=!e&&i.key||(i.shiftKey?ps:Ti)[i.keyCode]||i.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function _r(i){let e;return i.nodeType==11?e=i.getSelection?i:i.ownerDocument:e=i,e.getSelection()}function rd(i,e){return e?i==e||i.contains(e.nodeType!=1?e.parentNode:e):!1}function Fa(i,e){if(!e.anchorNode)return!1;try{return rd(i,e.anchorNode)}catch{return!1}}function Ir(i){return i.nodeType==3?In(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function Pr(i,e,t,n){return t?qg(i,e,t,n,-1)||qg(i,e,t,n,1):!1}function _n(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e}function Ja(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}function qg(i,e,t,n,s){for(;;){if(i==t&&e==n)return!0;if(e==(s<0?0:ai(i))){if(i.nodeName=="DIV")return!1;let r=i.parentNode;if(!r||r.nodeType!=1)return!1;e=_n(i)+(s<0?0:1),i=r}else if(i.nodeType==1){if(i=i.childNodes[e+(s<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;e=s<0?ai(i):0}else return!1}}function ai(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function al(i,e){let t=e?i.left:i.right;return{left:t,right:t,top:i.top,bottom:i.bottom}}function US(i){let e=i.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function A0(i,e){let t=e.width/i.offsetWidth,n=e.height/i.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-i.offsetWidth)<1)&&(t=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.height-i.offsetHeight)<1)&&(n=1),{scaleX:t,scaleY:n}}function JS(i,e,t,n,s,r,o,a){let l=i.ownerDocument,h=l.defaultView||window;for(let c=i,d=!1;c&&!d;)if(c.nodeType==1){let u,f=c==l.body,g=1,C=1;if(f)u=US(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(d=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let T=c.getBoundingClientRect();({scaleX:g,scaleY:C}=A0(c,T)),u={left:T.left,right:T.left+c.clientWidth*g,top:T.top,bottom:T.top+c.clientHeight*C}}let p=0,k=0;if(s=="nearest")e.top<u.top?(k=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+k&&(k=e.bottom-u.bottom+k+o)):e.bottom>u.bottom&&(k=e.bottom-u.bottom+o,t<0&&e.top-k<u.top&&(k=-(u.top+k-e.top+o)));else{let T=e.bottom-e.top,M=u.bottom-u.top;k=(s=="center"&&T<=M?e.top+T/2-M/2:s=="start"||s=="center"&&t<0?e.top-o:e.bottom-M+o)-u.top}if(n=="nearest"?e.left<u.left?(p=-(u.left-e.left+r),t>0&&e.right>u.right+p&&(p=e.right-u.right+p+r)):e.right>u.right&&(p=e.right-u.right+r,t<0&&e.left<u.left+p&&(p=-(u.left+p-e.left+r))):p=(n=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:n=="start"==a?e.left-r:e.right-(u.right-u.left)+r)-u.left,p||k)if(f)h.scrollBy(p,k);else{let T=0,M=0;if(k){let L=c.scrollTop;c.scrollTop+=k/C,M=(c.scrollTop-L)*C}if(p){let L=c.scrollLeft;c.scrollLeft+=p/g,T=(c.scrollLeft-L)*g}e={left:e.left-T,top:e.top-M,right:e.right-T,bottom:e.bottom-M},T&&Math.abs(T-p)<1&&(n="nearest"),M&&Math.abs(M-k)<1&&(s="nearest")}if(f)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function QS(i){let e=i.ownerDocument,t,n;for(let s=i.parentNode;s&&!(s==e.body||t&&n);)if(s.nodeType==1)!n&&s.scrollHeight>s.clientHeight&&(n=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:t,y:n}}var od=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:n}=e;this.set(t,Math.min(e.anchorOffset,t?ai(t):0),n,Math.min(e.focusOffset,n?ai(n):0))}set(e,t,n,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=n,this.focusOffset=s}},ms=null;function H0(i){if(i.setActive)return i.setActive();if(ms)return i.focus(ms);let e=[];for(let t=i;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(i.focus(ms==null?{get preventScroll(){return ms={preventScroll:!0},!0}}:void 0),!ms){ms=!1;for(let t=0;t<e.length;){let n=e[t++],s=e[t++],r=e[t++];n.scrollTop!=s&&(n.scrollTop=s),n.scrollLeft!=r&&(n.scrollLeft=r)}}}var e0;function In(i,e,t=e){let n=e0||(e0=document.createRange());return n.setEnd(i,t),n.setStart(i,e),n}function bs(i,e,t,n){let s={key:e,code:e,keyCode:t,which:t,cancelable:!0};n&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=n);let r=new KeyboardEvent("keydown",s);r.synthetic=!0,i.dispatchEvent(r);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,i.dispatchEvent(o),r.defaultPrevented||o.defaultPrevented}function $S(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function O0(i){for(;i.attributes.length;)i.removeAttributeNode(i.attributes[0])}function qS(i,e){let t=e.focusNode,n=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=n)return!1;for(n=Math.min(n,ai(t));;)if(n){if(t.nodeType!=1)return!1;let s=t.childNodes[n-1];s.contentEditable=="false"?n--:(t=s,n=ai(t))}else{if(t==i)return!0;n=_n(t),t=t.parentNode}}function V0(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}function z0(i,e){for(let t=i,n=e;;){if(t.nodeType==3&&n>0)return{node:t,offset:n};if(t.nodeType==1&&n>0){if(t.contentEditable=="false")return null;t=t.childNodes[n-1],n=ai(t)}else if(t.parentNode&&!Ja(t))n=_n(t),t=t.parentNode;else return null}}function F0(i,e){for(let t=i,n=e;;){if(t.nodeType==3&&n<t.nodeValue.length)return{node:t,offset:n};if(t.nodeType==1&&n<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[n],n=0}else if(t.parentNode&&!Ja(t))n=_n(t)+1,t=t.parentNode;else return null}}var Qe=class i{constructor(e,t,n=!0){this.node=e,this.offset=t,this.precise=n}static before(e,t){return new i(e.parentNode,_n(e),t)}static after(e,t){return new i(e.parentNode,_n(e)+1,t)}},zd=[],fe=class i{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let n=this.dom,s=null,r;for(let o of this.children){if(o.flags&7){if(!o.dom&&(r=s?s.nextSibling:n.firstChild)){let a=i.get(r);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(r)}o.sync(e,t),o.flags&=-8}if(r=s?s.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&r!=o.dom&&(t.written=!0),o.dom.parentNode==n)for(;r&&r!=o.dom;)r=i0(r);else n.insertBefore(o.dom,r);s=o.dom}for(r=s?s.nextSibling:n.firstChild,r&&t&&t.node==n&&(t.written=!0);r;)r=i0(r)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(e,t),n.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let s=ai(e)==0?0:t==0?-1:1;for(;;){let r=e.parentNode;if(r==this.dom)break;s==0&&r.firstChild!=r.lastChild&&(e==r.firstChild?s=-1:s=1),e=r}s<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!i.get(n);)n=n.nextSibling;if(!n)return this.length;for(let s=0,r=0;;s++){let o=this.children[s];if(o.dom==n)return r;r+=o.length+o.breakAfter}}domBoundsAround(e,t,n=0){let s=-1,r=-1,o=-1,a=-1;for(let l=0,h=n,c=n;l<this.children.length;l++){let d=this.children[l],u=h+d.length;if(h<e&&u>t)return d.domBoundsAround(e,t,h);if(u>=e&&s==-1&&(s=l,r=h),h>t&&d.dom.parentNode==this.dom){o=l,a=c;break}c=u,h=u+d.breakAfter}return{from:r,to:a<0?n+this.length:a,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=zd){this.markDirty();for(let s=e;s<t;s++){let r=this.children[s];r.parent==this&&n.indexOf(r)<0&&r.destroy()}n.length<250?this.children.splice(e,t-e,...n):this.children=[].concat(this.children.slice(0,e),n,this.children.slice(t));for(let s=0;s<n.length;s++)n[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Qa(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,n,s,r,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}};fe.prototype.breakAfter=0;function i0(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}var Qa=class{constructor(e,t,n){this.children=e,this.pos=t,this.i=n,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}};function K0(i,e,t,n,s,r,o,a,l){let{children:h}=i,c=h.length?h[e]:null,d=r.length?r[r.length-1]:null,u=d?d.breakAfter:o;if(!(e==n&&c&&!o&&!u&&r.length<2&&c.merge(t,s,r.length?d:null,t==0,a,l))){if(n<h.length){let f=h[n];f&&(s<f.length||f.breakAfter&&d?.breakAfter)?(e==n&&(f=f.split(s),s=0),!u&&d&&f.merge(0,s,d,!0,0,l)?r[r.length-1]=f:((s||f.children.length&&!f.children[0].length)&&f.merge(0,s,null,!1,0,l),r.push(f))):f?.breakAfter&&(d?d.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,t>0&&(!o&&r.length&&c.merge(t,c.length,r[0],!1,a,0)?c.breakAfter=r.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,a,0),e++));e<n&&r.length;)if(h[n-1].become(r[r.length-1]))n--,r.pop(),l=r.length?0:a;else if(h[e].become(r[0]))e++,r.shift(),a=r.length?0:l;else break;!r.length&&e&&n<h.length&&!h[e-1].breakAfter&&h[n].merge(0,0,h[e-1],!1,a,l)&&e--,(e<n||r.length)&&i.replaceChildren(e,n,r)}}function Y0(i,e,t,n,s,r){let o=i.childCursor(),{i:a,off:l}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),d=e-t;for(let u of n)d+=u.length;i.length+=d,K0(i,h,c,a,l,n,0,s,r)}var rt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},ad=typeof document<"u"?document:{documentElement:{style:{}}},ld=/Edge\/(\d+)/.exec(rt.userAgent),B0=/MSIE \d/.test(rt.userAgent),hd=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(rt.userAgent),ll=!!(B0||hd||ld),n0=!ll&&/gecko\/(\d+)/i.test(rt.userAgent),qc=!ll&&/Chrome\/(\d+)/.exec(rt.userAgent),s0="webkitFontSmoothing"in ad.documentElement.style,j0=!ll&&/Apple Computer/.test(rt.vendor),r0=j0&&(/Mobile\/\w+/.test(rt.userAgent)||rt.maxTouchPoints>2),F={mac:r0||/Mac/.test(rt.platform),windows:/Win/.test(rt.platform),linux:/Linux|X11/.test(rt.platform),ie:ll,ie_version:B0?ad.documentMode||6:hd?+hd[1]:ld?+ld[1]:0,gecko:n0,gecko_version:n0?+(/Firefox\/(\d+)/.exec(rt.userAgent)||[0,0])[1]:0,chrome:!!qc,chrome_version:qc?+qc[1]:0,ios:r0,android:/Android\b/.test(rt.userAgent),webkit:s0,safari:j0,webkit_version:s0?+(/\bAppleWebKit\/(\d+)/.exec(rt.userAgent)||[0,0])[1]:0,tabSize:ad.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"},ek=256,li=class i extends fe{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,n){return this.flags&8||n&&(!(n instanceof i)||this.length-(t-e)+n.length>ek||n.flags&8)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new i(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new Qe(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return tk(this.dom,e,t)}},Ui=class i extends fe{constructor(e,t=[],n=0){super(),this.mark=e,this.children=t,this.length=n;for(let s of t)s.setParent(this)}setAttrs(e){if(O0(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,n,s,r,o){return n&&(!(n instanceof i&&n.mark.eq(this.mark))||e&&r<=0||t<this.length&&o<=0)?!1:(Y0(this,e,t,n?n.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(e){let t=[],n=0,s=-1,r=0;for(let a of this.children){let l=n+a.length;l>e&&t.push(n<e?a.split(e-n):a),s<0&&n>=e&&(s=r),n=l,r++}let o=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new i(this.mark,t,o)}domAtPos(e){return U0(this,e)}coordsAt(e,t){return Q0(this,e,t)}};function tk(i,e,t){let n=i.nodeValue.length;e>n&&(e=n);let s=e,r=e,o=0;e==0&&t<0||e==n&&t>=0?F.chrome||F.gecko||(e?(s--,o=1):r<n&&(r++,o=-1)):t<0?s--:r<n&&r++;let a=In(i,s,r).getClientRects();if(!a.length)return null;let l=a[(o?o<0:t>=0)?0:a.length-1];return F.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,h=>h.width)||l),o?al(l,o<0):l||null}var $a=class i extends fe{static create(e,t,n){return new i(e,t,n)}constructor(e,t,n){super(),this.widget=e,this.length=t,this.side=n,this.prevWidget=null}split(e){let t=i.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,n,s,r,o){return n&&(!(n instanceof i)||!this.widget.compare(n.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}become(e){return e instanceof i&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return ie.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,n=t&&t.state.doc,s=this.posAtStart;return n?n.slice(s,s+this.length):ie.empty}domAtPos(e){return(this.length?e==0:this.side>0)?Qe.before(this.dom):Qe.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);if(n)return n;let s=this.dom.getClientRects(),r=null;if(!s.length)return null;let o=this.side?this.side<0:e>0;for(let a=o?s.length-1:0;r=s[a],!(e>0?a==0:a==s.length-1||r.top<r.bottom);a+=o?-1:1);return al(r,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Gr=class i extends fe{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof i&&e.side==this.side}split(){return new i(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?Qe.before(this.dom):Qe.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return ie.empty}get isHidden(){return!0}};li.prototype.children=$a.prototype.children=Gr.prototype.children=zd;function U0(i,e){let t=i.dom,{children:n}=i,s=0;for(let r=0;s<n.length;s++){let o=n[s],a=r+o.length;if(!(a==r&&o.getSide()<=0)){if(e>r&&e<a&&o.dom.parentNode==t)return o.domAtPos(e-r);if(e<=r)break;r=a}}for(let r=s;r>0;r--){let o=n[r-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let r=s;r<n.length;r++){let o=n[r];if(o.dom.parentNode==t)return o.domAtPos(0)}return new Qe(t,0)}function J0(i,e,t){let n,{children:s}=i;t>0&&e instanceof Ui&&s.length&&(n=s[s.length-1])instanceof Ui&&n.mark.eq(e.mark)?J0(n,e.children[0],t-1):(s.push(e),e.setParent(i)),i.length+=e.length}function Q0(i,e,t){let n=null,s=-1,r=null,o=-1;function a(h,c){for(let d=0,u=0;d<h.children.length&&u<=c;d++){let f=h.children[d],g=u+f.length;g>=c&&(f.children.length?a(f,c-u):(!r||r.isHidden&&t>0)&&(g>c||u==g&&f.getSide()>0)?(r=f,o=c-u):(u<c||u==g&&f.getSide()<0&&!f.isHidden)&&(n=f,s=c-u)),u=g}}a(i,e);let l=(t<0?n:r)||n||r;return l?l.coordsAt(Math.max(0,l==n?s:o),t):ik(i)}function ik(i){let e=i.dom.lastChild;if(!e)return i.dom.getBoundingClientRect();let t=Ir(e);return t[t.length-1]||null}function cd(i,e){for(let t in i)t=="class"&&e.class?e.class+=" "+i.class:t=="style"&&e.style?e.style+=";"+i.style:e[t]=i[t];return e}var o0=Object.create(null);function qa(i,e,t){if(i==e)return!0;i||(i=o0),e||(e=o0);let n=Object.keys(i),s=Object.keys(e);if(n.length-(t&&n.indexOf(t)>-1?1:0)!=s.length-(t&&s.indexOf(t)>-1?1:0))return!1;for(let r of n)if(r!=t&&(s.indexOf(r)==-1||i[r]!==e[r]))return!1;return!0}function dd(i,e,t){let n=!1;if(e)for(let s in e)t&&s in t||(n=!0,s=="style"?i.style.cssText="":i.removeAttribute(s));if(t)for(let s in t)e&&e[s]==t[s]||(n=!0,s=="style"?i.style.cssText=t[s]:i.setAttribute(s,t[s]));return n}function nk(i){let e=Object.create(null);for(let t=0;t<i.attributes.length;t++){let n=i.attributes[t];e[n.name]=n.value}return e}var Pi=class{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}},pt=function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i}(pt||(pt={})),ne=class extends Ht{constructor(e,t,n,s){super(),this.startSide=e,this.endSide=t,this.widget=n,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Wr(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),n=!!e.block;return t+=n&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Ji(e,t,t,n,e.widget||null,!1)}static replace(e){let t=!!e.block,n,s;if(e.isBlockGap)n=-5e8,s=4e8;else{let{start:r,end:o}=$0(e,t);n=(r?t?-3e8:-1:5e8)-1,s=(o?t?2e8:1:-6e8)+1}return new Ji(e,n,s,t,e.widget||null,!0)}static line(e){return new Dr(e)}static set(e,t=!1){return Se.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};ne.none=Se.empty;var Wr=class i extends ne{constructor(e){let{start:t,end:n}=$0(e);super(t?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,n;return this==e||e instanceof i&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((n=e.attrs)===null||n===void 0?void 0:n.class))&&qa(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}};Wr.prototype.point=!1;var Dr=class i extends ne{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof i&&this.spec.class==e.spec.class&&qa(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}};Dr.prototype.mapMode=Xe.TrackBefore;Dr.prototype.point=!0;var Ji=class i extends ne{constructor(e,t,n,s,r,o){super(t,n,r,e),this.block=s,this.isReplace=o,this.mapMode=s?t<=0?Xe.TrackBefore:Xe.TrackAfter:Xe.TrackDel}get type(){return this.startSide!=this.endSide?pt.WidgetRange:this.startSide<=0?pt.WidgetBefore:pt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof i&&sk(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}};Ji.prototype.point=!0;function $0(i,e=!1){let{inclusiveStart:t,inclusiveEnd:n}=i;return t==null&&(t=i.inclusive),n==null&&(n=i.inclusive),{start:t??e,end:n??e}}function sk(i,e){return i==e||!!(i&&e&&i.compare(e))}function Ka(i,e,t,n=0){let s=t.length-1;s>=0&&t[s]+n>=i?t[s]=Math.max(t[s],e):t.push(i,e)}var Ne=class i extends fe{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,n,s,r,o){if(n){if(!(n instanceof i))return!1;this.dom||n.transferDOM(this)}return s&&this.setDeco(n?n.attrs:null),Y0(this,e,t,n?n.children.slice():[],r,o),!0}split(e){let t=new i;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:n,off:s}=this.childPos(e);s&&(t.append(this.children[n].split(s),0),this.children[n].merge(s,this.children[n].length,null,!1,0,0),n++);for(let r=n;r<this.children.length;r++)t.append(this.children[r],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){qa(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){J0(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=cd(t,this.attrs||{})),n&&(this.attrs=cd({class:n},this.attrs||{}))}domAtPos(e){return U0(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var n;this.dom?this.flags&4&&(O0(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(dd(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let s=this.dom.lastChild;for(;s&&fe.get(s)instanceof Ui;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((n=fe.get(s))===null||n===void 0?void 0:n.isEditable)==!1&&(!F.ios||!this.children.some(r=>r instanceof li))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let n of this.children){if(!(n instanceof li)||/[^ -~]/.test(n.text))return null;let s=Ir(n.dom);if(s.length!=1)return null;e+=s[0].width,t=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let n=Q0(this,e,t);if(!this.children.length&&n&&this.parent){let{heightOracle:s}=this.parent.view.viewState,r=n.bottom-n.top;if(Math.abs(r-s.lineHeight)<2&&s.textHeight<r){let o=(r-s.textHeight)/2;return{top:n.top+o,bottom:n.bottom-o,left:n.left,right:n.left}}}return n}become(e){return e instanceof i&&this.children.length==0&&e.children.length==0&&qa(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let n=0,s=0;n<e.children.length;n++){let r=e.children[n],o=s+r.length;if(o>=t){if(r instanceof i)return r;if(o>t)break}s=o+r.breakAfter}return null}},Xn=class i extends fe{constructor(e,t,n){super(),this.widget=e,this.length=t,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(e,t,n,s,r,o){return n&&(!(n instanceof i)||!this.widget.compare(n.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?Qe.before(this.dom):Qe.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let n=new i(this.widget,t,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return zd}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):ie.empty}domBoundsAround(){return null}become(e){return e instanceof i&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let n=this.widget.coordsAt(this.dom,e,t);return n||(this.widget instanceof Nr?null:al(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:n}=this.deco;return t==n?!1:e<0?t<0:n>0}},Nr=class extends Pi{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}},Rr=class i{constructor(e,t,n,s){this.doc=e,this.pos=t,this.end=n,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Xn&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ne),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Wa(new Gr(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Xn)&&this.getLine()}buildText(e,t,n){for(;e>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=r,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-n)),this.getLine().append(Wa(new li(this.text.slice(this.textOff,this.textOff+s)),t),n),this.atCursorPos=!0,this.textOff+=s,e-=s,n=0}}span(e,t,n,s){this.buildText(t-e,n,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,n,s,r,o){if(this.disallowBlockEffectsFor[o]&&n instanceof Ji){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(n instanceof Ji)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Xn(n.widget||Qi.block,a,n));else{let l=$a.create(n.widget||Qi.inline,a,a?0:n.startSide),h=this.atCursorPos&&!l.isEditable&&r<=s.length&&(e<t||n.startSide>0),c=!l.isEditable&&(e<t||r>s.length||n.startSide<=0),d=this.getLine();this.pendingBuffer==2&&!h&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),h&&(d.append(Wa(new Gr(1),s),r),r=s.length+Math.max(0,r-s.length)),d.append(Wa(l,s),r),this.atCursorPos=c,this.pendingBuffer=c?e<t||r>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,n,s,r){let o=new i(e,t,n,r);return o.openEnd=Se.spans(s,t,n,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}};function Wa(i,e){for(let t of e)i=new Ui(t,[i],i.length);return i}var Qi=class extends Pi{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}};Qi.inline=new Qi("span");Qi.block=new Qi("div");var ae=function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i}(ae||(ae={})),Gn=ae.LTR,Fd=ae.RTL;function q0(i){let e=[];for(let t=0;t<i.length;t++)e.push(1<<+i[t]);return e}var rk=q0("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ok=q0("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ud=Object.create(null),ni=[];for(let i of["()","[]","{}"]){let e=i.charCodeAt(0),t=i.charCodeAt(1);ud[e]=t,ud[t]=-e}function ey(i){return i<=247?rk[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?ok[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8204?256:64336<=i&&i<=65023?4:1}var ak=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/,ri=class{get dir(){return this.level%2?Fd:Gn}constructor(e,t,n){this.from=e,this.to=t,this.level=n}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,n,s){let r=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=t&&a.to>=t){if(a.level==n)return o;(r<0||(s!=0?s<0?a.from<t:a.to>t:e[r].level>a.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}};function ty(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++){let n=i[t],s=e[t];if(n.from!=s.from||n.to!=s.to||n.direction!=s.direction||!ty(n.inner,s.inner))return!1}return!0}var de=[];function lk(i,e,t,n,s){for(let r=0;r<=n.length;r++){let o=r?n[r-1].to:e,a=r<n.length?n[r].from:t,l=r?256:s;for(let h=o,c=l,d=l;h<a;h++){let u=ey(i.charCodeAt(h));u==512?u=c:u==8&&d==4&&(u=16),de[h]=u==4?2:u,u&7&&(d=u),c=u}for(let h=o,c=l,d=l;h<a;h++){let u=de[h];if(u==128)h<a-1&&c==de[h+1]&&c&24?u=de[h]=c:de[h]=256;else if(u==64){let f=h+1;for(;f<a&&de[f]==64;)f++;let g=h&&c==8||f<t&&de[f]==8?d==1?1:8:256;for(let C=h;C<f;C++)de[C]=g;h=f-1}else u==8&&d==1&&(de[h]=1);c=u,u&7&&(d=u)}}}function hk(i,e,t,n,s){let r=s==1?2:1;for(let o=0,a=0,l=0;o<=n.length;o++){let h=o?n[o-1].to:e,c=o<n.length?n[o].from:t;for(let d=h,u,f,g;d<c;d++)if(f=ud[u=i.charCodeAt(d)])if(f<0){for(let C=a-3;C>=0;C-=3)if(ni[C+1]==-f){let p=ni[C+2],k=p&2?s:p&4?p&1?r:s:0;k&&(de[d]=de[ni[C]]=k),a=C;break}}else{if(ni.length==189)break;ni[a++]=d,ni[a++]=u,ni[a++]=l}else if((g=de[d])==2||g==1){let C=g==s;l=C?0:1;for(let p=a-3;p>=0;p-=3){let k=ni[p+2];if(k&2)break;if(C)ni[p+2]|=2;else{if(k&4)break;ni[p+2]|=4}}}}}function ck(i,e,t,n){for(let s=0,r=n;s<=t.length;s++){let o=s?t[s-1].to:i,a=s<t.length?t[s].from:e;for(let l=o;l<a;){let h=de[l];if(h==256){let c=l+1;for(;;)if(c==a){if(s==t.length)break;c=t[s++].to,a=s<t.length?t[s].from:e}else if(de[c]==256)c++;else break;let d=r==1,u=(c<e?de[c]:n)==1,f=d==u?d?1:2:n;for(let g=c,C=s,p=C?t[C-1].to:i;g>l;)g==p&&(g=t[--C].from,p=C?t[C-1].to:i),de[--g]=f;l=c}else r=h,l++}}}function fd(i,e,t,n,s,r,o){let a=n%2?2:1;if(n%2==s%2)for(let l=e,h=0;l<t;){let c=!0,d=!1;if(h==r.length||l<r[h].from){let C=de[l];C!=a&&(c=!1,d=C==16)}let u=!c&&a==1?[]:null,f=c?n:n+1,g=l;e:for(;;)if(h<r.length&&g==r[h].from){if(d)break e;let C=r[h];if(!c)for(let p=C.to,k=h+1;;){if(p==t)break e;if(k<r.length&&r[k].from==p)p=r[k++].to;else{if(de[p]==a)break e;break}}if(h++,u)u.push(C);else{C.from>l&&o.push(new ri(l,C.from,f));let p=C.direction==Gn!=!(f%2);pd(i,p?n+1:n,s,C.inner,C.from,C.to,o),l=C.to}g=C.to}else{if(g==t||(c?de[g]!=a:de[g]==a))break;g++}u?fd(i,l,g,n+1,s,u,o):l<g&&o.push(new ri(l,g,f)),l=g}else for(let l=t,h=r.length;l>e;){let c=!0,d=!1;if(!h||l>r[h-1].to){let C=de[l-1];C!=a&&(c=!1,d=C==16)}let u=!c&&a==1?[]:null,f=c?n:n+1,g=l;e:for(;;)if(h&&g==r[h-1].to){if(d)break e;let C=r[--h];if(!c)for(let p=C.from,k=h;;){if(p==e)break e;if(k&&r[k-1].to==p)p=r[--k].from;else{if(de[p-1]==a)break e;break}}if(u)u.push(C);else{C.to<l&&o.push(new ri(C.to,l,f));let p=C.direction==Gn!=!(f%2);pd(i,p?n+1:n,s,C.inner,C.from,C.to,o),l=C.from}g=C.from}else{if(g==e||(c?de[g-1]!=a:de[g-1]==a))break;g--}u?fd(i,g,l,n+1,s,u,o):g<l&&o.push(new ri(g,l,f)),l=g}}function pd(i,e,t,n,s,r,o){let a=e%2?2:1;lk(i,s,r,n,a),hk(i,s,r,n,a),ck(s,r,n,a),fd(i,s,r,e,t,n,o)}function dk(i,e,t){if(!i)return[new ri(0,0,e==Fd?1:0)];if(e==Gn&&!t.length&&!ak.test(i))return iy(i.length);if(t.length)for(;i.length>de.length;)de[de.length]=256;let n=[],s=e==Gn?0:1;return pd(i,s,s,t,0,i.length,n),n}function iy(i){return[new ri(0,i,0)]}var ny="";function uk(i,e,t,n,s){var r;let o=n.head-i.from,a=ri.find(e,o,(r=n.bidiLevel)!==null&&r!==void 0?r:-1,n.assoc),l=e[a],h=l.side(s,t);if(o==h){let u=a+=s?1:-1;if(u<0||u>=e.length)return null;l=e[a=u],o=l.side(!s,t),h=l.side(s,t)}let c=Te(i.text,o,l.forward(s,t));(c<l.from||c>l.to)&&(c=h),ny=i.text.slice(Math.min(o,c),Math.max(o,c));let d=a==(s?e.length-1:0)?null:e[a+(s?1:-1)];return d&&c==h&&d.level+(s?0:1)<l.level?H.cursor(d.side(!s,t)+i.from,d.forward(s,t)?1:-1,d.level):H.cursor(c+i.from,l.forward(s,t)?-1:1,l.level)}function fk(i,e,t){for(let n=e;n<t;n++){let s=ey(i.charCodeAt(n));if(s==1)return Gn;if(s==2||s==4)return Fd}return Gn}var sy=Y.define(),ry=Y.define(),oy=Y.define(),ay=Y.define(),md=Y.define(),ly=Y.define(),hy=Y.define(),Kd=Y.define(),Yd=Y.define(),cy=Y.define({combine:i=>i.some(e=>e)}),dy=Y.define({combine:i=>i.some(e=>e)}),uy=Y.define(),Zr=class i{constructor(e,t="nearest",n="nearest",s=5,r=5,o=!1){this.range=e,this.y=t,this.x=n,this.yMargin=s,this.xMargin=r,this.isSnapshot=o}map(e){return e.empty?this:new i(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new i(H.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}},Da=ee.define({map:(i,e)=>i.map(e)}),fy=ee.define();function ft(i,e,t){let n=i.facet(ay);n.length?n[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}var Mi=Y.define({combine:i=>i.length?i[0]:!0}),pk=0,Cr=Y.define(),_e=class i{constructor(e,t,n,s,r){this.id=e,this.create=t,this.domEventHandlers=n,this.domEventObservers=s,this.extension=r(this)}static define(e,t){let{eventHandlers:n,eventObservers:s,provide:r,decorations:o}=t||{};return new i(pk++,e,n,s,a=>{let l=[Cr.of(a)];return o&&l.push(Ar.of(h=>{let c=h.plugin(a);return c?o(c):ne.none})),r&&l.push(r(a)),l})}static fromClass(e,t){return i.define(n=>new e(n),t)}},Er=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(n){if(ft(t.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){ft(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(n){ft(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}},py=Y.define(),Bd=Y.define(),Ar=Y.define(),my=Y.define(),jd=Y.define(),gy=Y.define();function a0(i,e){let t=i.state.facet(gy);if(!t.length)return t;let n=t.map(r=>r instanceof Function?r(i):r),s=[];return Se.spans(n,e.from,e.to,{point(){},span(r,o,a,l){let h=r-e.from,c=o-e.from,d=s;for(let u=a.length-1;u>=0;u--,l--){let f=a[u].spec.bidiIsolate,g;if(f==null&&(f=fk(e.text,h,c)),l>0&&d.length&&(g=d[d.length-1]).to==h&&g.direction==f)g.to=c,d=g.inner;else{let C={from:h,to:c,direction:f,inner:[]};d.push(C),d=C.inner}}}}),s}var yy=Y.define();function Ud(i){let e=0,t=0,n=0,s=0;for(let r of i.state.facet(yy)){let o=r(i);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(n=Math.max(n,o.top)),o.bottom!=null&&(s=Math.max(s,o.bottom)))}return{left:e,right:t,top:n,bottom:s}}var Lr=Y.define(),oi=class i{constructor(e,t,n,s){this.fromA=e,this.toA=t,this.fromB=n,this.toB=s}join(e){return new i(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,n=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>n.toA)){if(s.toA<n.fromA)break;n=n.join(s),e.splice(t-1,1)}}return e.splice(t,0,n),e}static extendWithRanges(e,t){if(t.length==0)return e;let n=[];for(let s=0,r=0,o=0,a=0;;s++){let l=s==e.length?null:e[s],h=o-a,c=l?l.fromB:1e9;for(;r<t.length&&t[r]<c;){let d=t[r],u=t[r+1],f=Math.max(a,d),g=Math.min(c,u);if(f<=g&&new i(f+h,g+h,f,g).addToSet(n),u>c)break;r+=2}if(!l)return n;new i(l.fromA,l.toA,l.fromB,l.toB).addToSet(n),o=l.toA,a=l.toB}}},el=class i{constructor(e,t,n){this.view=e,this.state=t,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Je.empty(this.startState.doc.length);for(let r of n)this.changes=this.changes.compose(r.changes);let s=[];this.changes.iterChangedRanges((r,o,a,l)=>s.push(new oi(r,o,a,l))),this.changedRanges=s}static create(e,t,n){return new i(e,t,n)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}},tl=class extends fe{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=ne.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ne],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new oi(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:h,toA:c})=>c<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?s=this.domChanged.newSel.head:!xk(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let r=s>-1?gk(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:h,to:c}=this.hasComposition;n=new oi(h,c,e.changes.mapPos(h,-1),e.changes.mapPos(c,1)).addToSet(n.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(F.ie||F.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=wk(o,a,e.changes);return n=oi.extendWithRanges(n,l),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,n);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=F.chrome||F.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||s.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Xn&&o.widget instanceof Nr&&r.push(o.dom);s.updateGaps(r)}updateChildren(e,t,n){let s=n?n.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let o=s.length-1;;o--){let a=o>=0?s[o]:null;if(!a)break;let{fromA:l,toA:h,fromB:c,toB:d}=a,u,f,g,C;if(n&&n.range.fromB<d&&n.range.toB>c){let L=Rr.build(this.view.state.doc,c,n.range.fromB,this.decorations,this.dynamicDecorationMap),b=Rr.build(this.view.state.doc,n.range.toB,d,this.decorations,this.dynamicDecorationMap);f=L.breakAtStart,g=L.openStart,C=b.openEnd;let m=this.compositionView(n);b.breakAtStart?m.breakAfter=1:b.content.length&&m.merge(m.length,m.length,b.content[0],!1,b.openStart,0)&&(m.breakAfter=b.content[0].breakAfter,b.content.shift()),L.content.length&&m.merge(0,0,L.content[L.content.length-1],!0,0,L.openEnd)&&L.content.pop(),u=L.content.concat(m).concat(b.content)}else({content:u,breakAtStart:f,openStart:g,openEnd:C}=Rr.build(this.view.state.doc,c,d,this.decorations,this.dynamicDecorationMap));let{i:p,off:k}=r.findPos(h,1),{i:T,off:M}=r.findPos(l,-1);K0(this,T,M,p,k,u,f,g,C)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let n of t.effects)n.is(fy)&&(this.editContextFormatting=n.value)}compositionView(e){let t=new li(e.text.nodeValue);t.flags|=8;for(let{deco:s}of e.marks)t=new Ui(s,[t],t.length);let n=new Ne;return n.append(t,0),n}fixCompositionDOM(e){let t=(r,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=fe.get(r);a&&a!=o&&(a.dom=null),o.setDOM(r)},n=this.childPos(e.range.fromB,1),s=this.children[n.i];t(e.line,s);for(let r=e.marks.length-1;r>=-1;r--)n=s.childPos(n.off,1),s=s.children[n.i],t(r>=0?e.marks[r].node:e.text,s)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,s=n==this.dom,r=!s&&!(this.view.state.facet(Mi)||this.dom.tabIndex>-1)&&Fa(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(s||t||r))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),h=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(F.gecko&&a.empty&&!this.hasComposition&&mk(l)){let d=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(d,l.node.childNodes[l.offset]||null)),l=h=new Qe(d,0),o=!0}let c=this.view.observer.selectionRange;(o||!c.focusNode||(!Pr(l.node,l.offset,c.anchorNode,c.anchorOffset)||!Pr(h.node,h.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,a))&&(this.view.observer.ignore(()=>{F.android&&F.chrome&&this.dom.contains(c.focusNode)&&vk(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let d=_r(this.view.root);if(d)if(a.empty){if(F.gecko){let u=yk(l.node,l.offset);if(u&&u!=3){let f=(u==1?z0:F0)(l.node,l.offset);f&&(l=new Qe(f.node,f.offset))}}d.collapse(l.node,l.offset),a.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=a.bidiLevel)}else if(d.extend){d.collapse(l.node,l.offset);try{d.extend(h.node,h.offset)}catch{}}else{let u=document.createRange();a.anchor>a.head&&([l,h]=[h,l]),u.setEnd(h.node,h.offset),u.setStart(l.node,l.offset),d.removeAllRanges(),d.addRange(u)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(l,h)),this.impreciseAnchor=l.precise?null:new Qe(c.anchorNode,c.anchorOffset),this.impreciseHead=h.precise?null:new Qe(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Pr(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,n=_r(e.root),{anchorNode:s,anchorOffset:r}=e.observer.selectionRange;if(!n||!t.empty||!t.assoc||!n.modify)return;let o=Ne.find(this,t.head);if(!o)return;let a=o.posAtStart;if(t.head==a||t.head==a+o.length)return;let l=this.coordsAt(t.head,-1),h=this.coordsAt(t.head,1);if(!l||!h||l.bottom>h.top)return;let c=this.domAtPos(t.head+t.assoc);n.collapse(c.node,c.offset),n.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=t.from&&n.collapse(s,r)}moveToLine(e){let t=this.dom,n;if(e.node!=t)return e;for(let s=e.offset;!n&&s<t.childNodes.length;s++){let r=fe.get(t.childNodes[s]);r instanceof Ne&&(n=r.domAtPos(0))}for(let s=e.offset-1;!n&&s>=0;s--){let r=fe.get(t.childNodes[s]);r instanceof Ne&&(n=r.domAtPos(r.length))}return n?new Qe(n.node,n.offset,!0):e}nearest(e){for(let t=e;t;){let n=fe.get(t);if(n&&n.rootView==this)return n;t=t.parentNode}return null}posFromDOM(e,t){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart}domAtPos(e){let{i:t,off:n}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let s=this.children[t];if(n<s.length||s instanceof Ne)break;t++,n=0}return this.children[t].domAtPos(n)}coordsAt(e,t){let n=null,s=0;for(let r=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=r-a.breakAfter,h=l-a.length;if(l<e)break;if(h<=e&&(h<e||a.covers(-1))&&(l>e||a.covers(1))&&(!n||a instanceof Ne&&!(n instanceof Ne&&t>=0)))n=a,s=h;else if(n&&h==e&&l==e&&a instanceof Xn&&Math.abs(t)<2){if(a.deco.startSide<0)break;o&&(n=null)}r=h}return n?n.coordsAt(e-s,t):null}coordsForChar(e){let{i:t,off:n}=this.childPos(e,1),s=this.children[t];if(!(s instanceof Ne))return null;for(;s.children.length;){let{i:a,off:l}=s.childPos(n,1);for(;;a++){if(a==s.children.length)return null;if((s=s.children[a]).length)break}n=l}if(!(s instanceof li))return null;let r=Te(s.text,n);if(r==n)return null;let o=In(s.dom,n,r).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let t=[],{from:n,to:s}=e,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==ae.LTR;for(let h=0,c=0;c<this.children.length;c++){let d=this.children[c],u=h+d.length;if(u>s)break;if(h>=n){let f=d.dom.getBoundingClientRect();if(t.push(f.height),o){let g=d.dom.lastChild,C=g?Ir(g):[];if(C.length){let p=C[C.length-1],k=l?p.right-f.left:f.right-p.left;k>a&&(a=k,this.minWidth=r,this.minWidthFrom=h,this.minWidthTo=u)}}}h=u+d.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?ae.RTL:ae.LTR}measureTextSize(){for(let r of this.children)if(r instanceof Ne){let o=r.measureTextSize();if(o)return o}let e=document.createElement("div"),t,n,s;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Ir(e.firstChild)[0];t=e.getBoundingClientRect().height,n=r?r.width/27:7,s=r?r.height:t,e.remove()}),{lineHeight:t,charWidth:n,textHeight:s}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Qa(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let n=0,s=0;;s++){let r=s==t.viewports.length?null:t.viewports[s],o=r?r.from-1:this.length;if(o>n){let a=(t.lineBlockAt(o).bottom-t.lineBlockAt(n).top)/this.view.scaleY;e.push(ne.replace({widget:new Nr(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,o))}if(!r)break;n=r.to+1}return ne.set(e)}updateDeco(){let e=1,t=this.view.state.facet(Ar).map(r=>(this.dynamicDecorationMap[e++]=typeof r=="function")?r(this.view):r),n=!1,s=this.view.state.facet(my).map((r,o)=>{let a=typeof r=="function";return a&&(n=!0),a?r(this.view):r});for(s.length&&(this.dynamicDecorationMap[e++]=n,t.push(Se.join(s))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let h=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=h.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let h of this.view.state.facet(uy))try{if(h(this.view,e.range,e))return!0}catch(c){ft(this.view.state,c,"scroll handler")}let{range:t}=e,n=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),s;if(!n)return;!t.empty&&(s=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(n={left:Math.min(n.left,s.left),top:Math.min(n.top,s.top),right:Math.max(n.right,s.right),bottom:Math.max(n.bottom,s.bottom)});let r=Ud(this.view),o={left:n.left-r.left,top:n.top-r.top,right:n.right+r.right,bottom:n.bottom+r.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;JS(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==ae.LTR)}};function mk(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}function by(i,e){let t=i.observer.selectionRange;if(!t.focusNode)return null;let n=z0(t.focusNode,t.focusOffset),s=F0(t.focusNode,t.focusOffset),r=n||s;if(s&&n&&s.node!=n.node){let a=fe.get(s.node);if(!a||a instanceof li&&a.text!=s.node.nodeValue)r=s;else if(i.docView.lastCompositionAfterCursor){let l=fe.get(n.node);!l||l instanceof li&&l.text!=n.node.nodeValue||(r=s)}}if(i.docView.lastCompositionAfterCursor=r!=n,!r)return null;let o=e-r.offset;return{from:o,to:o+r.node.nodeValue.length,node:r.node}}function gk(i,e,t){let n=by(i,t);if(!n)return null;let{node:s,from:r,to:o}=n,a=s.nodeValue;if(/[\n\r]/.test(a)||i.state.doc.sliceString(n.from,n.to)!=a)return null;let l=e.invertedDesc,h=new oi(l.mapPos(r),l.mapPos(o),r,o),c=[];for(let d=s.parentNode;;d=d.parentNode){let u=fe.get(d);if(u instanceof Ui)c.push({node:d,deco:u.mark});else{if(u instanceof Ne||d.nodeName=="DIV"&&d.parentNode==i.contentDOM)return{range:h,text:s,marks:c,line:d};if(d!=i.contentDOM)c.push({node:d,deco:new Wr({inclusive:!0,attributes:nk(d),tagName:d.tagName.toLowerCase()})});else return null}}}function yk(i,e){return i.nodeType!=1?0:(e&&i.childNodes[e-1].contentEditable=="false"?1:0)|(e<i.childNodes.length&&i.childNodes[e].contentEditable=="false"?2:0)}var bk=class{constructor(){this.changes=[]}compareRange(e,t){Ka(e,t,this.changes)}comparePoint(e,t){Ka(e,t,this.changes)}boundChange(e){Ka(e,e,this.changes)}};function wk(i,e,t){let n=new bk;return Se.compare(i,e,t,n),n.changes}function vk(i,e){for(let t=i;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function xk(i,e){let t=!1;return e&&i.iterChangedRanges((n,s)=>{n<e.to&&s>e.from&&(t=!0)}),t}function Sk(i,e,t=1){let n=i.charCategorizer(e),s=i.doc.lineAt(e),r=e-s.from;if(s.length==0)return H.cursor(e);r==0?t=1:r==s.length&&(t=-1);let o=r,a=r;t<0?o=Te(s.text,r,!1):a=Te(s.text,r);let l=n(s.text.slice(o,a));for(;o>0;){let h=Te(s.text,o,!1);if(n(s.text.slice(h,o))!=l)break;o=h}for(;a<s.length;){let h=Te(s.text,a);if(n(s.text.slice(a,h))!=l)break;a=h}return H.range(o+s.from,a+s.from)}function kk(i,e){return e.left>i?e.left-i:Math.max(0,i-e.right)}function Ck(i,e){return e.top>i?e.top-i:Math.max(0,i-e.bottom)}function ed(i,e){return i.top<e.bottom-1&&i.bottom>e.top+1}function l0(i,e){return e<i.top?{top:e,left:i.left,right:i.right,bottom:i.bottom}:i}function h0(i,e){return e>i.bottom?{top:i.top,left:i.left,right:i.right,bottom:e}:i}function gd(i,e,t){let n,s,r,o,a=!1,l,h,c,d;for(let g=i.firstChild;g;g=g.nextSibling){let C=Ir(g);for(let p=0;p<C.length;p++){let k=C[p];s&&ed(s,k)&&(k=l0(h0(k,s.bottom),s.top));let T=kk(e,k),M=Ck(t,k);if(T==0&&M==0)return g.nodeType==3?c0(g,e,t):gd(g,e,t);if(!n||o>M||o==M&&r>T){n=g,s=k,r=T,o=M;let L=M?t<k.top?-1:1:T?e<k.left?-1:1:0;a=!L||(L>0?p<C.length-1:p>0)}T==0?t>k.bottom&&(!c||c.bottom<k.bottom)?(l=g,c=k):t<k.top&&(!d||d.top>k.top)&&(h=g,d=k):c&&ed(c,k)?c=h0(c,k.bottom):d&&ed(d,k)&&(d=l0(d,k.top))}}if(c&&c.bottom>=t?(n=l,s=c):d&&d.top<=t&&(n=h,s=d),!n)return{node:i,offset:0};let u=Math.max(s.left,Math.min(s.right,e));if(n.nodeType==3)return c0(n,u,t);if(a&&n.contentEditable!="false")return gd(n,u,t);let f=Array.prototype.indexOf.call(i.childNodes,n)+(e>=(s.left+s.right)/2?1:0);return{node:i,offset:f}}function c0(i,e,t){let n=i.nodeValue.length,s=-1,r=1e9,o=0;for(let a=0;a<n;a++){let l=In(i,a,a+1).getClientRects();for(let h=0;h<l.length;h++){let c=l[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let d=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&d<r){let u=e>=(c.left+c.right)/2,f=u;if((F.chrome||F.gecko)&&In(i,a).getBoundingClientRect().left==c.right&&(f=!u),d<=0)return{node:i,offset:a+(f?1:0)};s=a+(f?1:0),r=d}}}return{node:i,offset:s>-1?s:o>0?i.nodeValue.length:0}}function wy(i,e,t,n=-1){var s,r;let o=i.contentDOM.getBoundingClientRect(),a=o.top+i.viewState.paddingTop,l,{docHeight:h}=i.viewState,{x:c,y:d}=e,u=d-a;if(u<0)return 0;if(u>h)return i.state.doc.length;for(let L=i.viewState.heightOracle.textHeight/2,b=!1;l=i.elementAtHeight(u),l.type!=pt.Text;)for(;u=n>0?l.bottom+L:l.top-L,!(u>=0&&u<=h);){if(b)return t?null:0;b=!0,n=-n}d=a+u;let f=l.from;if(f<i.viewport.from)return i.viewport.from==0?0:t?null:d0(i,o,l,c,d);if(f>i.viewport.to)return i.viewport.to==i.state.doc.length?i.state.doc.length:t?null:d0(i,o,l,c,d);let g=i.dom.ownerDocument,C=i.root.elementFromPoint?i.root:g,p=C.elementFromPoint(c,d);p&&!i.contentDOM.contains(p)&&(p=null),p||(c=Math.max(o.left+1,Math.min(o.right-1,c)),p=C.elementFromPoint(c,d),p&&!i.contentDOM.contains(p)&&(p=null));let k,T=-1;if(p&&((s=i.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(g.caretPositionFromPoint){let L=g.caretPositionFromPoint(c,d);L&&({offsetNode:k,offset:T}=L)}else if(g.caretRangeFromPoint){let L=g.caretRangeFromPoint(c,d);L&&({startContainer:k,startOffset:T}=L,(!i.contentDOM.contains(k)||F.safari&&Lk(k,T,c)||F.chrome&&Tk(k,T,c))&&(k=void 0))}k&&(T=Math.min(ai(k),T))}if(!k||!i.docView.dom.contains(k)){let L=Ne.find(i.docView,f);if(!L)return u>l.top+l.height/2?l.to:l.from;({node:k,offset:T}=gd(L.dom,c,d))}let M=i.docView.nearest(k);if(!M)return null;if(M.isWidget&&((r=M.dom)===null||r===void 0?void 0:r.nodeType)==1){let L=M.dom.getBoundingClientRect();return e.y<L.top||e.y<=L.bottom&&e.x<=(L.left+L.right)/2?M.posAtStart:M.posAtEnd}else return M.localPosFromDOM(k,T)+M.posAtStart}function d0(i,e,t,n,s){let r=Math.round((n-e.left)*i.defaultCharacterWidth);if(i.lineWrapping&&t.height>i.defaultLineHeight*1.5){let a=i.viewState.heightOracle.textHeight,l=Math.floor((s-t.top-(i.defaultLineHeight-a)*.5)/a);r+=l*i.viewState.heightOracle.lineLength}let o=i.state.sliceDoc(t.from,t.to);return t.from+jg(o,r,i.state.tabSize)}function Lk(i,e,t){let n;if(i.nodeType!=3||e!=(n=i.nodeValue.length))return!1;for(let s=i.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return In(i,n-1,n).getBoundingClientRect().left>t}function Tk(i,e,t){if(e!=0)return!1;for(let s=i;;){let r=s.parentNode;if(!r||r.nodeType!=1||r.firstChild!=s)return!1;if(r.classList.contains("cm-line"))break;s=r}let n=i.nodeType==1?i.getBoundingClientRect():In(i,0,Math.max(i.nodeValue.length,1)).getBoundingClientRect();return t-n.left>5}function yd(i,e){let t=i.lineBlockAt(e);if(Array.isArray(t.type)){for(let n of t.type)if(n.to>e||n.to==e&&(n.to==t.to||n.type==pt.Text))return n}return t}function Mk(i,e,t,n){let s=yd(i,e.head),r=!n||s.type!=pt.Text||!(i.lineWrapping||s.widgetLineBreaks)?null:i.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(r){let o=i.dom.getBoundingClientRect(),a=i.textDirectionAt(s.from),l=i.posAtCoords({x:t==(a==ae.LTR)?o.right-1:o.left+1,y:(r.top+r.bottom)/2});if(l!=null)return H.cursor(l,t?-1:1)}return H.cursor(t?s.to:s.from,t?-1:1)}function u0(i,e,t,n){let s=i.state.doc.lineAt(e.head),r=i.bidiSpans(s),o=i.textDirectionAt(s.from);for(let a=e,l=null;;){let h=uk(s,r,o,a,t),c=ny;if(!h){if(s.number==(t?i.state.doc.lines:1))return a;c=`
`,s=i.state.doc.line(s.number+(t?1:-1)),r=i.bidiSpans(s),h=i.visualLineSide(s,!t)}if(l){if(!l(c))return a}else{if(!n)return h;l=n(c)}a=h}}function Pk(i,e,t){let n=i.state.charCategorizer(e),s=n(t);return r=>{let o=n(r);return s==be.Space&&(s=o),s==o}}function Rk(i,e,t,n){let s=e.head,r=t?1:-1;if(s==(t?i.state.doc.length:0))return H.cursor(s,e.assoc);let o=e.goalColumn,a,l=i.contentDOM.getBoundingClientRect(),h=i.coordsAtPos(s,e.assoc||-1),c=i.documentTop;if(h)o==null&&(o=h.left-l.left),a=r<0?h.top:h.bottom;else{let f=i.viewState.lineBlockAt(s);o==null&&(o=Math.min(l.right-l.left,i.defaultCharacterWidth*(s-f.from))),a=(r<0?f.top:f.bottom)+c}let d=l.left+o,u=n??i.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let g=a+(u+f)*r,C=wy(i,{x:d,y:g},!1,r);if(g<l.top||g>l.bottom||(r<0?C<s:C>s)){let p=i.docView.coordsForChar(C),k=!p||g<p.top?-1:1;return H.cursor(C,k,void 0,o)}}}function Ya(i,e,t){for(;;){let n=0;for(let s of i)s.between(e-1,e+1,(r,o,a)=>{if(e>r&&e<o){let l=n||t||(e-r<o-e?-1:1);e=l<0?r:o,n=l}});if(!n)return e}}function td(i,e,t){let n=Ya(i.state.facet(jd).map(s=>s(i)),t.from,e.head>t.from?-1:1);return n==t.from?t:H.cursor(n,n<t.from?1:-1)}var Tr="\uFFFF",bd=class{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(ce.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Tr}readRange(e,t){if(!e)return this;let n=e.parentNode;for(let s=e;;){this.findPointBefore(n,s);let r=this.text.length;this.readNode(s);let o=s.nextSibling;if(o==t)break;let a=fe.get(s),l=fe.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:Ja(s))||Ja(o)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>r)&&this.lineBreak(),s=o}return this.findPointBefore(n,t),this}readTextNode(e){let t=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,t.length));for(let n=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,a;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,n),o=this.lineSeparator.length):(a=s.exec(t))&&(r=a.index,o=a[0].length),this.append(t.slice(n,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=o-1);n=r+o}}readNode(e){if(e.cmIgnore)return;let t=fe.get(e),n=t&&t.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let s=n.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==t&&(n.pos=this.text.length)}findPointInside(e,t){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+(Zk(e,n.node,n.offset)?t:0))}};function Zk(i,e,t){for(;;){if(!e||t<ai(e))return!1;if(e==i)return!0;t=_n(e)+1,e=e.parentNode}}var il=class{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}},wd=class{constructor(e,t,n,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,n,0))){let a=r||o?[]:_k(e),l=new bd(a,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=Ik(a,this.bounds.from)}else{let a=e.observer.selectionRange,l=r&&r.node==a.focusNode&&r.offset==a.focusOffset||!rd(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),h=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!rd(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),c=e.viewport;if((F.ios||F.chrome)&&e.state.selection.main.empty&&l!=h&&(c.from>0||c.to<e.state.doc.length)){let d=Math.min(l,h),u=Math.max(l,h),f=c.from-d,g=c.to-u;(f==0||f==1||d==0)&&(g==0||g==-1||u==e.state.doc.length)&&(l=0,h=e.state.doc.length)}this.newSel=H.single(h,l)}}};function vy(i,e){let t,{newSel:n}=e,s=i.state.selection.main,r=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:a}=e.bounds,l=s.from,h=null;(r===8||F.android&&e.text.length<a-o)&&(l=s.to,h="end");let c=Xk(i.state.doc.sliceString(o,a,Tr),e.text,l-o,h);c&&(F.chrome&&r==13&&c.toB==c.from+2&&e.text.slice(c.from,c.toB)==Tr+Tr&&c.toB--,t={from:o+c.from,to:o+c.toA,insert:ie.of(e.text.slice(c.from,c.toB).split(Tr))})}else n&&(!i.hasFocus&&i.state.facet(Mi)||n.main.eq(s))&&(n=null);if(!t&&!n)return!1;if(!t&&e.typeOver&&!s.empty&&n&&n.main.empty?t={from:s.from,to:s.to,insert:i.state.doc.slice(s.from,s.to)}:t&&t.from>=s.from&&t.to<=s.to&&(t.from!=s.from||t.to!=s.to)&&s.to-s.from-(t.to-t.from)<=4?t={from:s.from,to:s.to,insert:i.state.doc.slice(s.from,t.from).append(t.insert).append(i.state.doc.slice(t.to,s.to))}:(F.mac||F.android)&&t&&t.from==t.to&&t.from==s.head-1&&/^\. ?$/.test(t.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(n&&t.insert.length==2&&(n=H.single(n.main.anchor-1,n.main.head-1)),t={from:s.from,to:s.to,insert:ie.of([" "])}):F.chrome&&t&&t.from==t.to&&t.from==s.head&&t.insert.toString()==`
 `&&i.lineWrapping&&(n&&(n=H.single(n.main.anchor-1,n.main.head-1)),t={from:s.from,to:s.to,insert:ie.of([" "])}),t)return Jd(i,t,n,r);if(n&&!n.main.eq(s)){let o=!1,a="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(o=!0),a=i.inputState.lastSelectionOrigin),i.dispatch({selection:n,scrollIntoView:o,userEvent:a}),!0}else return!1}function Jd(i,e,t,n=-1){if(F.ios&&i.inputState.flushIOSKey(e))return!0;let s=i.state.selection.main;if(F.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&i.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&bs(i.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||n==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&bs(i.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&bs(i.contentDOM,"Delete",46)))return!0;let r=e.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let o,a=()=>o||(o=Ek(i,e,t));return i.state.facet(ly).some(l=>l(i,e.from,e.to,r,a))||i.dispatch(a()),!0}function Ek(i,e,t){let n,s=i.state,r=s.selection.main;if(e.from>=r.from&&e.to<=r.to&&e.to-e.from>=(r.to-r.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&i.inputState.composing<0){let a=r.from<e.from?s.sliceDoc(r.from,e.from):"",l=r.to>e.to?s.sliceDoc(e.to,r.to):"";n=s.replaceSelection(i.state.toText(a+e.insert.sliceString(0,void 0,i.state.lineBreak)+l))}else{let a=s.changes(e),l=t&&t.main.to<=a.newLength?t.main:void 0;if(s.selection.ranges.length>1&&i.inputState.composing>=0&&e.to<=r.to&&e.to>=r.to-10){let h=i.state.sliceDoc(e.from,e.to),c,d=t&&by(i,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);c={from:d.from,to:d.to-g}}else c=i.state.doc.lineAt(r.head);let u=r.to-e.to,f=r.to-r.from;n=s.changeByRange(g=>{if(g.from==r.from&&g.to==r.to)return{changes:a,range:l||g.map(a)};let C=g.to-u,p=C-h.length;if(g.to-g.from!=f||i.state.sliceDoc(p,C)!=h||g.to>=c.from&&g.from<=c.to)return{range:g};let k=s.changes({from:p,to:C,insert:e.insert}),T=g.to-r.to;return{changes:k,range:l?H.range(Math.max(0,l.anchor+T),Math.max(0,l.head+T)):g.map(k)}})}else n={changes:a,selection:l&&s.selection.replaceRange(l)}}let o="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,o+=".compose",i.inputState.compositionFirstChange&&(o+=".start",i.inputState.compositionFirstChange=!1)),s.update(n,{userEvent:o,scrollIntoView:!0})}function Xk(i,e,t,n){let s=Math.min(i.length,e.length),r=0;for(;r<s&&i.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&i.length==e.length)return null;let o=i.length,a=e.length;for(;o>0&&a>0&&i.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;if(n=="end"){let l=Math.max(0,r-Math.min(o,a));t-=o+l-r}if(o<r&&i.length<e.length){let l=t<=r&&t>=o?r-t:0;r-=l,a=r+(a-o),o=r}else if(a<r){let l=t<=r&&t>=a?r-t:0;r-=l,o=r+(o-a),a=r}return{from:r,toA:o,toB:a}}function _k(i){let e=[];if(i.root.activeElement!=i.contentDOM)return e;let{anchorNode:t,anchorOffset:n,focusNode:s,focusOffset:r}=i.observer.selectionRange;return t&&(e.push(new il(t,n)),(s!=t||r!=n)&&e.push(new il(s,r))),e}function Ik(i,e){if(i.length==0)return null;let t=i[0].pos,n=i.length==2?i[1].pos:t;return t>-1&&n>-1?H.single(t+e,n+e):null}var vd=class{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,F.safari&&e.contentDOM.addEventListener("input",()=>null),F.gecko&&Uk(e.contentDOM.ownerDocument)}handleEvent(e){!Ok(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,t){let n=this.handlers[e];if(n){for(let s of n.observers)s(this.view,t);for(let s of n.handlers){if(t.defaultPrevented)break;if(s(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=Gk(e),n=this.handlers,s=this.view.contentDOM;for(let r in t)if(r!="scroll"){let o=!t[r].handlers.length,a=n[r];a&&o!=!a.handlers.length&&(s.removeEventListener(r,this.handleEvent),a=null),a||s.addEventListener(r,this.handleEvent,{passive:o})}for(let r in n)r!="scroll"&&!t[r]&&s.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Sy.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),F.android&&F.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return F.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=xy.find(n=>n.keyCode==e.keyCode))&&!e.ctrlKey||Wk.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,bs(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:F.safari&&!F.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};function f0(i,e){return(t,n)=>{try{return e.call(i,n,t)}catch(s){ft(t.state,s)}}}function Gk(i){let e=Object.create(null);function t(n){return e[n]||(e[n]={observers:[],handlers:[]})}for(let n of i){let s=n.spec;if(s&&s.domEventHandlers)for(let r in s.domEventHandlers){let o=s.domEventHandlers[r];o&&t(r).handlers.push(f0(n.value,o))}if(s&&s.domEventObservers)for(let r in s.domEventObservers){let o=s.domEventObservers[r];o&&t(r).observers.push(f0(n.value,o))}}for(let n in Vt)t(n).handlers.push(Vt[n]);for(let n in Rt)t(n).observers.push(Rt[n]);return e}var xy=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Wk="dthko",Sy=[16,17,18,20,91,92,224,225],Na=6;function Aa(i){return Math.max(0,i)*.7+8}function Dk(i,e){return Math.max(Math.abs(i.clientX-e.clientX),Math.abs(i.clientY-e.clientY))}var xd=class{constructor(e,t,n,s){this.view=e,this.startEvent=t,this.style=n,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=QS(e.contentDOM),this.atoms=e.state.facet(jd).map(o=>o(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(ce.allowMultipleSelections)&&Nk(e,t),this.dragging=Hk(e,t)&&Ly(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Dk(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,n=0,s=0,r=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=Ud(this.view);e.clientX-l.left<=s+Na?t=-Aa(s-e.clientX):e.clientX+l.right>=o-Na&&(t=Aa(e.clientX-o)),e.clientY-l.top<=r+Na?n=-Aa(r-e.clientY):e.clientY+l.bottom>=a-Na&&(n=Aa(e.clientY-a)),this.setScrollSpeed(t,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let n=0;n<e.ranges.length;n++){let s=e.ranges[n],r=null;if(s.empty){let o=Ya(this.atoms,s.from,0);o!=s.from&&(r=H.cursor(o,-1))}else{let o=Ya(this.atoms,s.from,-1),a=Ya(this.atoms,s.to,1);(o!=s.from||a!=s.to)&&(r=H.range(s.from==s.anchor?o:a,s.from==s.head?o:a))}r&&(t||(t=e.ranges.slice()),t[n]=r)}return t?H.create(t,e.mainIndex):e}select(e){let{view:t}=this,n=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!n.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};function Nk(i,e){let t=i.state.facet(sy);return t.length?t[0](e):F.mac?e.metaKey:e.ctrlKey}function Ak(i,e){let t=i.state.facet(ry);return t.length?t[0](e):F.mac?!e.altKey:!e.ctrlKey}function Hk(i,e){let{main:t}=i.state.selection;if(t.empty)return!1;let n=_r(i.root);if(!n||n.rangeCount==0)return!0;let s=n.getRangeAt(0).getClientRects();for(let r=0;r<s.length;r++){let o=s[r];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function Ok(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,n;t!=i.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(n=fe.get(t))&&n.ignoreEvent(e))return!1;return!0}var Vt=Object.create(null),Rt=Object.create(null),ky=F.ie&&F.ie_version<15||F.ios&&F.webkit_version<604;function Vk(i){let e=i.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{i.focus(),t.remove(),Cy(i,t.value)},50)}function hl(i,e,t){for(let n of i.facet(e))t=n(t,i);return t}function Cy(i,e){e=hl(i.state,Kd,e);let{state:t}=i,n,s=1,r=t.toText(e),o=r.lines==t.selection.ranges.length;if(Sd!=null&&t.selection.ranges.every(l=>l.empty)&&Sd==r.toString()){let l=-1;n=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==l)return{range:h};l=c.from;let d=t.toText((o?r.line(s++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:d},range:H.cursor(h.from+d.length)}})}else o?n=t.changeByRange(l=>{let h=r.line(s++);return{changes:{from:l.from,to:l.to,insert:h.text},range:H.cursor(l.from+h.length)}}):n=t.replaceSelection(r);i.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}Rt.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};Vt.keydown=(i,e)=>(i.inputState.setSelectionOrigin("select"),e.keyCode==27&&i.inputState.tabFocusMode!=0&&(i.inputState.tabFocusMode=Date.now()+2e3),!1);Rt.touchstart=(i,e)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};Rt.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};Vt.mousedown=(i,e)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let n of i.state.facet(oy))if(t=n(i,e),t)break;if(!t&&e.button==0&&(t=Kk(i,e)),t){let n=!i.hasFocus;i.inputState.startMouseSelection(new xd(i,e,t,n)),n&&i.observer.ignore(()=>{H0(i.contentDOM);let r=i.root.activeElement;r&&!r.contains(i.contentDOM)&&r.blur()});let s=i.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}return!1};function p0(i,e,t,n){if(n==1)return H.cursor(e,t);if(n==2)return Sk(i.state,e,t);{let s=Ne.find(i.docView,e),r=i.state.doc.lineAt(s?s.posAtEnd:e),o=s?s.posAtStart:r.from,a=s?s.posAtEnd:r.to;return a<i.state.doc.length&&a==r.to&&a++,H.range(o,a)}}var m0=(i,e,t)=>e>=t.top&&e<=t.bottom&&i>=t.left&&i<=t.right;function zk(i,e,t,n){let s=Ne.find(i.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(r==0)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&m0(t,n,o))return-1;let a=s.coordsAt(r,1);return a&&m0(t,n,a)?1:o&&o.bottom>=n?-1:1}function g0(i,e){let t=i.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:zk(i,t,e.clientX,e.clientY)}}var Fk=F.ie&&F.ie_version<=11,y0=null,b0=0,w0=0;function Ly(i){if(!Fk)return i.detail;let e=y0,t=w0;return y0=i,w0=Date.now(),b0=!e||t>Date.now()-400&&Math.abs(e.clientX-i.clientX)<2&&Math.abs(e.clientY-i.clientY)<2?(b0+1)%3:1}function Kk(i,e){let t=g0(i,e),n=Ly(e),s=i.state.selection;return{update(r){r.docChanged&&(t.pos=r.changes.mapPos(t.pos),s=s.map(r.changes))},get(r,o,a){let l=g0(i,r),h,c=p0(i,l.pos,l.bias,n);if(t.pos!=l.pos&&!o){let d=p0(i,t.pos,t.bias,n),u=Math.min(d.from,c.from),f=Math.max(d.to,c.to);c=u<c.from?H.range(u,f):H.range(f,u)}return o?s.replaceRange(s.main.extend(c.from,c.to)):a&&n==1&&s.ranges.length>1&&(h=Yk(s,l.pos))?h:a?s.addRange(c):H.create([c])}}}function Yk(i,e){for(let t=0;t<i.ranges.length;t++){let{from:n,to:s}=i.ranges[t];if(n<=e&&s>=e)return H.create(i.ranges.slice(0,t).concat(i.ranges.slice(t+1)),i.mainIndex==t?0:i.mainIndex-(i.mainIndex>t?1:0))}return null}Vt.dragstart=(i,e)=>{let{selection:{main:t}}=i.state;if(e.target.draggable){let s=i.docView.nearest(e.target);if(s&&s.isWidget){let r=s.posAtStart,o=r+s.length;(r>=t.to||o<=t.from)&&(t=H.range(r,o))}}let{inputState:n}=i;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",hl(i.state,Yd,i.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Vt.dragend=i=>(i.inputState.draggedContent=null,!1);function v0(i,e,t,n){if(t=hl(i.state,Kd,t),!t)return;let s=i.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:r}=i.inputState,o=n&&r&&Ak(i,e)?{from:r.from,to:r.to}:null,a={from:s,insert:t},l=i.state.changes(o?[o,a]:a);i.focus(),i.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),i.inputState.draggedContent=null}Vt.drop=(i,e)=>{if(!e.dataTransfer)return!1;if(i.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let n=Array(t.length),s=0,r=()=>{++s==t.length&&v0(i,e,n.filter(o=>o!=null).join(i.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let a=new FileReader;a.onerror=r,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[o]=a.result),r()},a.readAsText(t[o])}return!0}else{let n=e.dataTransfer.getData("Text");if(n)return v0(i,e,n,!0),!0}return!1};Vt.paste=(i,e)=>{if(i.state.readOnly)return!0;i.observer.flush();let t=ky?null:e.clipboardData;return t?(Cy(i,t.getData("text/plain")||t.getData("text/uri-list")),!0):(Vk(i),!1)};function Bk(i,e){let t=i.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),i.focus()},50)}function jk(i){let e=[],t=[],n=!1;for(let s of i.selection.ranges)s.empty||(e.push(i.sliceDoc(s.from,s.to)),t.push(s));if(!e.length){let s=-1;for(let{from:r}of i.selection.ranges){let o=i.doc.lineAt(r);o.number>s&&(e.push(o.text),t.push({from:o.from,to:Math.min(i.doc.length,o.to+1)})),s=o.number}n=!0}return{text:hl(i,Yd,e.join(i.lineBreak)),ranges:t,linewise:n}}var Sd=null;Vt.copy=Vt.cut=(i,e)=>{let{text:t,ranges:n,linewise:s}=jk(i.state);if(!t&&!s)return!1;Sd=s?t:null,e.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let r=ky?null:e.clipboardData;return r?(r.clearData(),r.setData("text/plain",t),!0):(Bk(i,t),!1)};var Ty=st.define();function My(i,e){let t=[];for(let n of i.facet(hy)){let s=n(i,e);s&&t.push(s)}return t?i.update({effects:t,annotations:Ty.of(!0)}):null}function Py(i){setTimeout(()=>{let e=i.hasFocus;if(e!=i.inputState.notifiedFocused){let t=My(i.state,e);t?i.dispatch(t):i.update([])}},10)}Rt.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),Py(i)};Rt.blur=i=>{i.observer.clearSelectionRange(),Py(i)};Rt.compositionstart=Rt.compositionupdate=i=>{i.observer.editContext||(i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0))};Rt.compositionend=i=>{i.observer.editContext||(i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,F.chrome&&F.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50))};Rt.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};Vt.beforeinput=(i,e)=>{var t,n;if(e.inputType=="insertReplacementText"&&i.observer.editContext){let r=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),o=e.getTargetRanges();if(r&&o.length){let a=o[0],l=i.posAtDOM(a.startContainer,a.startOffset),h=i.posAtDOM(a.endContainer,a.endOffset);return Jd(i,{from:l,to:h,insert:i.state.toText(r)},null),!0}}let s;if(F.chrome&&F.android&&(s=xy.find(r=>r.inputType==e.inputType))&&(i.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let r=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>r+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return F.ios&&e.inputType=="deleteContentForward"&&i.observer.flushSoon(),F.safari&&e.inputType=="insertText"&&i.inputState.composing>=0&&setTimeout(()=>Rt.compositionend(i,e),20),!1};var x0=new Set;function Uk(i){x0.has(i)||(x0.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}var S0=["pre-wrap","normal","pre-line","break-spaces"],ws=!1;function k0(){ws=!1}var kd=class{constructor(e){this.lineWrapping=e,this.doc=ie.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return S0.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let n=0;n<e.length;n++){let s=e[n];s<0?n++:this.heightSamples[Math.floor(s*10)]||(t=!0,this.heightSamples[Math.floor(s*10)]=!0)}return t}refresh(e,t,n,s,r,o){let a=S0.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=t,this.charWidth=n,this.textHeight=s,this.lineLength=r,l){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return l}},Cd=class{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}},si=class i{constructor(e,t,n,s,r){this.from=e,this.length=t,this.top=n,this.height=s,this._content=r}get type(){return typeof this._content=="number"?pt.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Ji?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new i(this.from,this.length+e.length,this.top,this.height+e.height,t)}},me=function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i}(me||(me={})),Ba=.001,mt=class i{constructor(e,t,n=2){this.length=e,this.height=t,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Ba&&(ws=!0),this.height=e)}replace(e,t,n){return i.of(n)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,n,s){let r=this,o=n.doc;for(let a=s.length-1;a>=0;a--){let{fromA:l,toA:h,fromB:c,toB:d}=s[a],u=r.lineAt(l,me.ByPosNoHeight,n.setDoc(t),0,0),f=u.to>=h?u:r.lineAt(h,me.ByPosNoHeight,n,0,0);for(d+=f.to-h,h=f.to;a>0&&u.from<=s[a-1].toA;)l=s[a-1].fromA,c=s[a-1].fromB,a--,l<u.from&&(u=r.lineAt(l,me.ByPosNoHeight,n,0,0));c+=u.from-l,l=u.from;let g=Td.build(n.setDoc(o),e,c,d);r=nl(r,r.replace(l,h,g))}return r.updateHeight(n,0)}static empty(){return new Pt(0,0)}static of(e){if(e.length==1)return e[0];let t=0,n=e.length,s=0,r=0;for(;;)if(t==n)if(s>r*2){let a=e[t-1];a.break?e.splice(--t,1,a.left,null,a.right):e.splice(--t,1,a.left,a.right),n+=1+a.break,s-=a.size}else if(r>s*2){let a=e[n];a.break?e.splice(n,1,a.left,null,a.right):e.splice(n,1,a.left,a.right),n+=2+a.break,r-=a.size}else break;else if(s<r){let a=e[t++];a&&(s+=a.size)}else{let a=e[--n];a&&(r+=a.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,n++),new Ld(i.of(e.slice(0,t)),o,i.of(e.slice(n)))}};function nl(i,e){return i==e?i:(i.constructor!=e.constructor&&(ws=!0),e)}mt.prototype.size=1;var sl=class extends mt{constructor(e,t,n){super(e,t),this.deco=n}blockAt(e,t,n,s){return new si(s,this.length,n,this.height,this.deco||0)}lineAt(e,t,n,s,r){return this.blockAt(0,n,s,r)}forEachLine(e,t,n,s,r,o){e<=r+this.length&&t>=r&&o(this.blockAt(0,n,s,r))}updateHeight(e,t=0,n=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Pt=class i extends sl{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,n,s){return new si(s,this.length,n,this.height,this.breaks)}replace(e,t,n){let s=n[0];return n.length==1&&(s instanceof i||s instanceof ji&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof ji?s=new i(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):mt.of(n)}updateHeight(e,t=0,n=!1,s){return s&&s.from<=t&&s.more?this.setHeight(s.heights[s.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},ji=class i extends mt{constructor(e){super(e,0)}heightMetrics(e,t){let n=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,r=s-n+1,o,a=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*r);o=l/r,this.length>r+1&&(a=(this.height-l)/(this.length-r-1))}else o=this.height/r;return{firstLine:n,lastLine:s,perLine:o,perChar:a}}blockAt(e,t,n,s){let{firstLine:r,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(t,s);if(t.lineWrapping){let h=s+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length)),c=t.doc.lineAt(h),d=a+c.length*l,u=Math.max(n,e-d/2);return new si(c.from,c.length,u,d,0)}else{let h=Math.max(0,Math.min(o-r,Math.floor((e-n)/a))),{from:c,length:d}=t.doc.line(r+h);return new si(c,d,n+a*h,a,0)}}lineAt(e,t,n,s,r){if(t==me.ByHeight)return this.blockAt(e,n,s,r);if(t==me.ByPosNoHeight){let{from:f,to:g}=n.doc.lineAt(e);return new si(f,g-f,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(n,r),h=n.doc.lineAt(e),c=a+h.length*l,d=h.number-o,u=s+a*d+l*(h.from-r-d);return new si(h.from,h.length,Math.max(s,Math.min(u,s+this.height-c)),c,0)}forEachLine(e,t,n,s,r,o){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:a,perLine:l,perChar:h}=this.heightMetrics(n,r);for(let c=e,d=s;c<=t;){let u=n.doc.lineAt(c);if(c==e){let g=u.number-a;d+=l*g+h*(e-r-g)}let f=l+h*u.length;o(new si(u.from,u.length,d,f,0)),d+=f,c=u.to+1}}replace(e,t,n){let s=this.length-t;if(s>0){let r=n[n.length-1];r instanceof i?n[n.length-1]=new i(r.length+s):n.push(null,new i(s-1))}if(e>0){let r=n[0];r instanceof i?n[0]=new i(e+r.length):n.unshift(new i(e-1),null)}return mt.of(n)}decomposeLeft(e,t){t.push(new i(e-1),null)}decomposeRight(e,t){t.push(null,new i(this.length-e-1))}updateHeight(e,t=0,n=!1,s){let r=t+this.length;if(s&&s.from<=t+this.length&&s.more){let o=[],a=Math.max(t,s.from),l=-1;for(s.from>t&&o.push(new i(s.from-t-1).updateHeight(e,t));a<=r&&s.more;){let c=e.doc.lineAt(a).length;o.length&&o.push(null);let d=s.heights[s.index++];l==-1?l=d:Math.abs(d-l)>=Ba&&(l=-2);let u=new Pt(c,d);u.outdated=!1,o.push(u),a+=c+1}a<=r&&o.push(null,new i(r-a).updateHeight(e,a));let h=mt.of(o);return(l<0||Math.abs(h.height-this.height)>=Ba||Math.abs(l-this.heightMetrics(e,t).perLine)>=Ba)&&(ws=!0),nl(this,h)}else(n||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},Ld=class extends mt{constructor(e,t,n){super(e.length+t+n.length,e.height+n.height,t|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,t,n,s){let r=n+this.left.height;return e<r?this.left.blockAt(e,t,n,s):this.right.blockAt(e,t,r,s+this.left.length+this.break)}lineAt(e,t,n,s,r){let o=s+this.left.height,a=r+this.left.length+this.break,l=t==me.ByHeight?e<o:e<a,h=l?this.left.lineAt(e,t,n,s,r):this.right.lineAt(e,t,n,o,a);if(this.break||(l?h.to<a:h.from>a))return h;let c=t==me.ByPosNoHeight?me.ByPosNoHeight:me.ByPos;return l?h.join(this.right.lineAt(a,c,n,o,a)):this.left.lineAt(a,c,n,s,r).join(h)}forEachLine(e,t,n,s,r,o){let a=s+this.left.height,l=r+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,n,s,r,o),t>=l&&this.right.forEachLine(e,t,n,a,l,o);else{let h=this.lineAt(l,me.ByPos,n,s,r);e<h.from&&this.left.forEachLine(e,h.from-1,n,s,r,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,n,a,l,o)}}replace(e,t,n){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,n));let r=[];e>0&&this.decomposeLeft(e,r);let o=r.length;for(let a of n)r.push(a);if(e>0&&C0(r,o-1),t<this.length){let a=r.length;this.decomposeRight(t,r),C0(r,a)}return mt.of(r)}decomposeLeft(e,t){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(n++,e>=n&&t.push(null)),e>n&&this.right.decomposeLeft(e-n,t)}decomposeRight(e,t){let n=this.left.length,s=n+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<n&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?mt.of(this.break?[e,null,t]:[e,t]):(this.left=nl(this.left,e),this.right=nl(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,n=!1,s){let{left:r,right:o}=this,a=t+r.length+this.break,l=null;return s&&s.from<=t+r.length&&s.more?l=r=r.updateHeight(e,t,n,s):r.updateHeight(e,t,n),s&&s.from<=a+o.length&&s.more?l=o=o.updateHeight(e,a,n,s):o.updateHeight(e,a,n),l?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function C0(i,e){let t,n;i[e]==null&&(t=i[e-1])instanceof ji&&(n=i[e+1])instanceof ji&&i.splice(e-1,3,new ji(t.length+1+n.length))}var Jk=5,Td=class i{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let n=Math.min(t,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof Pt?s.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new Pt(n-this.pos,-1)),this.writtenTo=n,t>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,n){if(e<t||n.heightRelevant){let s=n.widget?n.widget.estimatedHeight:0,r=n.widget?n.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let o=t-e;n.block?this.addBlock(new sl(o,s,n)):(o||r||s>=Jk)&&this.addLineDeco(s,r,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Pt(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let n=new ji(t-e);return this.oracle.doc.lineAt(e).to==t&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Pt)return e;let t=new Pt(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,n){let s=this.ensureLine();s.length+=n,s.collapsed+=n,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=t,this.writtenTo=this.pos=this.pos+n}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Pt)&&!this.isCovered?this.nodes.push(new Pt(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let s of this.nodes)s instanceof Pt&&s.updateHeight(this.oracle,n),n+=s?s.length:1;return this.nodes}static build(e,t,n,s){let r=new i(n,e);return Se.spans(t,n,s,r,0),r.finish(n)}};function Qk(i,e,t){let n=new Md;return Se.compare(i,e,t,n,0),n.changes}var Md=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,n,s){(e<t||n&&n.heightRelevant||s&&s.heightRelevant)&&Ka(e,t,this.changes,5)}};function $k(i,e){let t=i.getBoundingClientRect(),n=i.ownerDocument,s=n.defaultView||window,r=Math.max(0,t.left),o=Math.min(s.innerWidth,t.right),a=Math.max(0,t.top),l=Math.min(s.innerHeight,t.bottom);for(let h=i.parentNode;h&&h!=n.body;)if(h.nodeType==1){let c=h,d=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&d.overflow!="visible"){let u=c.getBoundingClientRect();r=Math.max(r,u.left),o=Math.min(o,u.right),a=Math.max(a,u.top),l=Math.min(h==i.parentNode?s.innerHeight:l,u.bottom)}h=d.position=="absolute"||d.position=="fixed"?c.offsetParent:c.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:r-t.left,right:Math.max(r,o)-t.left,top:a-(t.top+e),bottom:Math.max(a,l)-(t.top+e)}}function qk(i,e){let t=i.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}var Xr=class{constructor(e,t,n,s){this.from=e,this.to=t,this.size=n,this.displaySize=s}static same(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let s=e[n],r=t[n];if(s.from!=r.from||s.to!=r.to||s.size!=r.size)return!1}return!0}draw(e,t){return ne.replace({widget:new Pd(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}},Pd=class extends Pi{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},rl=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=L0,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ae.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Bd).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new kd(t),this.stateDeco=e.facet(Ar).filter(n=>typeof n!="function"),this.heightMap=mt.empty().applyChanges(this.stateDeco,ie.empty,this.heightOracle.setDoc(e.doc),[new oi(0,0,0,e.doc.length)]);for(let n=0;n<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());n++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ne.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let n=0;n<=1;n++){let s=n?t.head:t.anchor;if(!e.some(({from:r,to:o})=>s>=r&&s<=o)){let{from:r,to:o}=this.lineBlockAt(s);e.push(new gs(r,o))}}return this.viewports=e.sort((n,s)=>n.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?L0:new Rd(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Mr(e,this.scaler))})}update(e,t=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(Ar).filter(c=>typeof c!="function");let s=e.changedRanges,r=oi.extendWithRanges(s,Qk(n,this.stateDeco,e?e.changes:Je.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);k0(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=o||ws)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let l=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let h=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(h||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(dy)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,n=window.getComputedStyle(t),s=this.heightOracle,r=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?ae.RTL:ae.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),a=t.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let h=0,c=0;if(a.width&&a.height){let{scaleX:L,scaleY:b}=A0(t,a);(L>.005&&Math.abs(this.scaleX-L)>.005||b>.005&&Math.abs(this.scaleY-b)>.005)&&(this.scaleX=L,this.scaleY=b,h|=16,o=l=!0)}let d=(parseInt(n.paddingTop)||0)*this.scaleY,u=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=d||this.paddingBottom!=u)&&(this.paddingTop=d,this.paddingBottom=u,h|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=16);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=V0(e.scrollDOM);let g=(this.printing?qk:$k)(t,this.paddingTop),C=g.top-this.pixelViewport.top,p=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let k=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(k!=this.inView&&(this.inView=k,k&&(l=!0)),!this.inView&&!this.scrollTarget)return 0;let T=a.width;if((this.contentDOMWidth!=T||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,h|=16),l){let L=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(L)&&(o=!0),o||s.lineWrapping&&Math.abs(T-this.contentDOMWidth)>s.charWidth){let{lineHeight:b,charWidth:m,textHeight:w}=e.docView.measureTextSize();o=b>0&&s.refresh(r,b,m,w,T/m,L),o&&(e.docView.minWidth=0,h|=16)}C>0&&p>0?c=Math.max(C,p):C<0&&p<0&&(c=Math.min(C,p)),k0();for(let b of this.viewports){let m=b.from==this.viewport.from?L:e.docView.measureVisibleLineHeights(b);this.heightMap=(o?mt.empty().applyChanges(this.stateDeco,ie.empty,this.heightOracle,[new oi(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,o,new Cd(b.from,m))}ws&&(h|=2)}let M=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return M&&(h&2&&(h|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),h|=this.updateForViewport()),(h&2||M)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,r=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new gs(s.lineAt(o-n*1e3,me.ByHeight,r,0,0).from,s.lineAt(a+(1-n)*1e3,me.ByHeight,r,0,0).to);if(t){let{head:h}=t.range;if(h<l.from||h>l.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),d=s.lineAt(h,me.ByPos,r,0,0),u;t.y=="center"?u=(d.top+d.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<l.from?u=d.top:u=d.bottom-c,l=new gs(s.lineAt(u-1e3/2,me.ByHeight,r,0,0).from,s.lineAt(u+c+1e3/2,me.ByHeight,r,0,0).to)}}return l}mapViewport(e,t){let n=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new gs(this.heightMap.lineAt(n,me.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,me.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},n=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,me.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,me.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(e==0||s<=o-Math.max(10,Math.min(-n,250)))&&(t==this.state.doc.length||r>=a+Math.max(10,Math.min(n,250)))&&s>o-2*1e3&&r<a+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let n=[];for(let s of e)t.touchesRange(s.from,s.to)||n.push(new Xr(t.mapPos(s.from),t.mapPos(s.to),s.size,s.displaySize));return n}ensureLineGaps(e,t){let n=this.heightOracle.lineWrapping,s=n?1e4:2e3,r=s>>1,o=s<<1;if(this.defaultTextDirection!=ae.LTR&&!n)return[];let a=[],l=(c,d,u,f)=>{if(d-c<r)return;let g=this.state.selection.main,C=[g.from];g.empty||C.push(g.to);for(let k of C)if(k>c&&k<d){l(c,k-10,u,f),l(k+10,d,u,f);return}let p=tC(e,k=>k.from>=u.from&&k.to<=u.to&&Math.abs(k.from-c)<r&&Math.abs(k.to-d)<r&&!C.some(T=>k.from<T&&k.to>T));if(!p){if(d<u.to&&t&&n&&t.visibleRanges.some(M=>M.from<=d&&M.to>=d)){let M=t.moveToLineBoundary(H.cursor(d),!1,!0).head;M>c&&(d=M)}let k=this.gapSize(u,c,d,f),T=n||k<2e6?k:2e6;p=new Xr(c,d,k,T)}a.push(p)},h=c=>{if(c.length<o||c.type!=pt.Text)return;let d=eC(c.from,c.to,this.stateDeco);if(d.total<o)return;let u=this.scrollTarget?this.scrollTarget.range.head:null,f,g;if(n){let C=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,p,k;if(u!=null){let T=Oa(d,u),M=((this.visibleBottom-this.visibleTop)/2+C)/c.height;p=T-M,k=T+M}else p=(this.visibleTop-c.top-C)/c.height,k=(this.visibleBottom-c.top+C)/c.height;f=Ha(d,p),g=Ha(d,k)}else{let C=d.total*this.heightOracle.charWidth,p=s*this.heightOracle.charWidth,k=0;if(C>2e6)for(let m of e)m.from>=c.from&&m.from<c.to&&m.size!=m.displaySize&&m.from*this.heightOracle.charWidth+k<this.pixelViewport.left&&(k=m.size-m.displaySize);let T=this.pixelViewport.left+k,M=this.pixelViewport.right+k,L,b;if(u!=null){let m=Oa(d,u),w=((M-T)/2+p)/C;L=m-w,b=m+w}else L=(T-p)/C,b=(M+p)/C;f=Ha(d,L),g=Ha(d,b)}f>c.from&&l(c.from,f,c,d),g<c.to&&l(g,c.to,c,d)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(h):h(c);return a}gapSize(e,t,n,s){let r=Oa(s,n)-Oa(s,t);return this.heightOracle.lineWrapping?e.height*r:s.total*this.heightOracle.charWidth*r}updateLineGaps(e){Xr.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ne.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let n=[];Se.spans(t,this.viewport.from,this.viewport.to,{span(r,o){n.push({from:r,to:o})},point(){}},20);let s=0;if(n.length!=this.visibleRanges.length)s=12;else for(let r=0;r<n.length&&!(s&8);r++){let o=this.visibleRanges[r],a=n[r];(o.from!=a.from||o.to!=a.to)&&(s|=4,e&&e.mapPos(o.from,-1)==a.from&&e.mapPos(o.to,1)==a.to||(s|=8))}return this.visibleRanges=n,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Mr(this.heightMap.lineAt(e,me.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Mr(this.heightMap.lineAt(this.scaler.fromDOM(e),me.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Mr(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},gs=class{constructor(e,t){this.from=e,this.to=t}};function eC(i,e,t){let n=[],s=i,r=0;return Se.spans(t,i,e,{span(){},point(o,a){o>s&&(n.push({from:s,to:o}),r+=o-s),s=a}},20),s<e&&(n.push({from:s,to:e}),r+=e-s),{total:r,ranges:n}}function Ha({total:i,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let n=Math.floor(i*t);for(let s=0;;s++){let{from:r,to:o}=e[s],a=o-r;if(n<=a)return r+n;n-=a}}function Oa(i,e){let t=0;for(let{from:n,to:s}of i.ranges){if(e<=s){t+=e-n;break}t+=s-n}return t/i.total}function tC(i,e){for(let t of i)if(e(t))return t}var L0={toDOM(i){return i},fromDOM(i){return i},scale:1,eq(i){return i==this}},Rd=class i{constructor(e,t,n){let s=0,r=0,o=0;this.viewports=n.map(({from:a,to:l})=>{let h=t.lineAt(a,me.ByPos,e,0,0).top,c=t.lineAt(l,me.ByPos,e,0,0).bottom;return s+=c-h,{from:a,to:l,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let a of this.viewports)a.domTop=o+(a.top-r)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),r=a.bottom}toDOM(e){for(let t=0,n=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return s+(e-n)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);n=r.bottom,s=r.domBottom}}fromDOM(e){for(let t=0,n=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return n+(e-s)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);n=r.bottom,s=r.domBottom}}eq(e){return e instanceof i?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,n)=>t.from==e.viewports[n].from&&t.to==e.viewports[n].to):!1}};function Mr(i,e){if(e.scale==1)return i;let t=e.toDOM(i.top),n=e.toDOM(i.bottom);return new si(i.from,i.length,t,n-t,Array.isArray(i._content)?i._content.map(s=>Mr(s,e)):i._content)}var Va=Y.define({combine:i=>i.join(" ")}),Zd=Y.define({combine:i=>i.indexOf(!0)>-1}),Ed=Mt.newName(),Ry=Mt.newName(),Zy=Mt.newName(),Ey={"&light":"."+Ry,"&dark":"."+Zy};function Xd(i,e,t){return new Mt(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,s=>{if(s=="&")return i;if(!t||!t[s])throw new RangeError(`Unsupported selector: ${s}`);return t[s]}):i+" "+n}})}var iC=Xd("."+Ed,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ey),nC={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},id=F.ie&&F.ie_version<=11,_d=class{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new od,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let n of t)this.queue.push(n);(F.ie&&F.ie_version<=11||F.ios&&e.composing)&&t.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(F.chrome&&F.chrome_version<126)&&(this.editContext=new Id(e),e.state.facet(Mi)&&(e.contentDOM.editContext=this.editContext.editContext)),id&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,n)=>t!=e[n]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,s=this.selectionRange;if(n.state.facet(Mi)?n.root.activeElement!=this.dom:!Fa(this.dom,s))return;let r=s.anchorNode&&n.docView.nearest(s.anchorNode);if(r&&r.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(F.ie&&F.ie_version<=11||F.android&&F.chrome)&&!n.state.selection.main.empty&&s.focusNode&&Pr(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=_r(e.root);if(!t)return!1;let n=F.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&sC(this.view,t)||t;if(!n||this.selectionRange.eq(n))return!1;let s=Fa(this.dom,n);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&qS(this.dom,n)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(n),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let n=this.dom;n;)if(n.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=t)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,nC),id&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),id&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var n;if(!this.delayedAndroidKey){let s=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&bs(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,n=-1,s=!1;for(let r of e){let o=this.readMutation(r);o&&(o.typeOver&&(s=!0),t==-1?{from:t,to:n}=o:(t=Math.min(o.from,t),n=Math.max(o.to,n)))}return{from:t,to:n,typeOver:s}}readChange(){let{from:e,to:t,typeOver:n}=this.processRecords(),s=this.selectionChanged&&Fa(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new wd(this.view,e,t,n);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let n=this.view.state,s=vy(this.view,t);return this.view.state==n&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let n=T0(t,e.previousSibling||e.target.previousSibling,-1),s=T0(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(Mi)!=e.state.facet(Mi)&&(e.view.contentDOM.editContext=e.state.facet(Mi)?this.editContext.editContext:null))}destroy(){var e,t,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}};function T0(i,e,t){for(;e;){let n=fe.get(e);if(n&&n.parent==i)return n;let s=e.parentNode;e=s!=i.dom?s:t>0?e.nextSibling:e.previousSibling}return null}function M0(i,e){let t=e.startContainer,n=e.startOffset,s=e.endContainer,r=e.endOffset,o=i.docView.domAtPos(i.state.selection.main.anchor);return Pr(o.node,o.offset,s,r)&&([t,n,s,r]=[s,r,t,n]),{anchorNode:t,anchorOffset:n,focusNode:s,focusOffset:r}}function sC(i,e){if(e.getComposedRanges){let s=e.getComposedRanges(i.root)[0];if(s)return M0(i,s)}let t=null;function n(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return i.contentDOM.addEventListener("beforeinput",n,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",n,!0),t?M0(i,t):null}var Id=class{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=n=>{let{anchor:s}=e.state.selection.main,r=this.toEditorPos(n.updateRangeStart),o=this.toEditorPos(n.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:n.updateRangeStart,editorBase:r,drifted:!1});let a={from:r,to:o,insert:ie.of(n.text.split(`
`))};if(a.from==this.from&&s<this.from?a.from=s:a.to==this.to&&s>this.to&&(a.to=s),!(a.from==a.to&&!a.insert.length)){if(this.pendingContextChange=a,!e.state.readOnly){let l=this.to-this.from+(a.to-a.from+a.insert.length);Jd(e,a,H.single(this.toEditorPos(n.selectionStart,l),this.toEditorPos(n.selectionEnd,l)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))}},this.handlers.characterboundsupdate=n=>{let s=[],r=null;for(let o=this.toEditorPos(n.rangeStart),a=this.toEditorPos(n.rangeEnd);o<a;o++){let l=e.coordsForChar(o);r=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||r||new DOMRect,s.push(r)}t.updateCharacterBounds(n.rangeStart,s)},this.handlers.textformatupdate=n=>{let s=[];for(let r of n.getTextFormats()){let o=r.underlineStyle,a=r.underlineThickness;if(o!="None"&&a!="None"){let l=this.toEditorPos(r.rangeStart),h=this.toEditorPos(r.rangeEnd);if(l<h){let c=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${a=="Thin"?1:2}px`;s.push(ne.mark({attributes:{style:c}}).range(l,h))}}}e.dispatch({effects:fy.of(ne.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:n}=this.composing;this.composing=null,n&&this.reset(e.state)}};for(let n in this.handlers)t.addEventListener(n,this.handlers[n]);this.measureReq={read:n=>{this.editContext.updateControlBounds(n.contentDOM.getBoundingClientRect());let s=_r(n.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,n=!1,s=this.pendingContextChange;return e.changes.iterChanges((r,o,a,l,h)=>{if(n)return;let c=h.length-(o-r);if(s&&o>=s.to)if(s.from==r&&s.to==o&&s.insert.eq(h)){s=this.pendingContextChange=null,t+=c,this.to+=c;return}else s=null,this.revertPending(e.state);if(r+=t,o+=t,o<=this.from)this.from+=c,this.to+=c;else if(r<this.to){if(r<this.from||o>this.to||this.to-this.from+h.length>3e4){n=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(o),h.toString()),this.to+=c}t+=c}),s&&!n&&this.revertPending(e.state),!n}update(e){let t=this.pendingContextChange;this.composing&&(this.composing.drifted||e.transactions.some(n=>!n.isUserEvent("input.type")&&n.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),s=this.toContextPos(t.head);(this.editContext.selectionStart!=n||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(n,s)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let n=this.composing;return n&&n.drifted?n.editorBase+(e-n.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}},B=class i{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:n}=e;this.dispatchTransactions=e.dispatchTransactions||n&&(s=>s.forEach(r=>n(r,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=e.root||$S(e.parent)||document,this.viewState=new rl(e.state||ce.create(e)),e.scrollTo&&e.scrollTo.is(Da)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Cr).map(s=>new Er(s));for(let s of this.plugins)s.update(this);this.observer=new _d(this),this.inputState=new vd(this),this.inputState.ensureHandlers(this.plugins),this.docView=new tl(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof Re?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,n=!1,s,r=this.state;for(let u of e){if(u.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=u.state}if(this.destroyed){this.viewState.state=r;return}let o=this.hasFocus,a=0,l=null;e.some(u=>u.annotation(Ty))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=My(r,o),l||(a=1));let h=this.observer.delayedAndroidKey,c=null;if(h?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(c=null)):this.observer.clear(),r.facet(ce.phrases)!=this.state.facet(ce.phrases))return this.setState(r);s=el.create(this,r,e),s.flags|=a;let d=this.viewState.scrollTarget;try{this.updateState=2;for(let u of e){if(d&&(d=d.map(u.changes)),u.scrollIntoView){let{main:f}=u.state.selection;d=new Zr(f.empty?f:H.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of u.effects)f.is(Da)&&(d=f.value.clip(this.state))}this.viewState.update(s,d),this.bidiCache=ol.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),t=this.docView.update(s),this.state.facet(Lr)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(u=>u.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Va)!=s.state.facet(Va)&&(this.viewState.mustMeasureContent=!0),(t||n||d||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!s.empty)for(let u of this.state.facet(md))try{u(s)}catch(f){ft(this.state,f,"update listener")}(l||c)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),c&&!vy(this,c)&&h.force&&bs(this.contentDOM,h.key,h.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new rl(e),this.plugins=e.facet(Cr).map(n=>new Er(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new tl(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Cr),n=e.state.facet(Cr);if(t!=n){let s=[];for(let r of n){let o=t.indexOf(r);if(o<0)s.push(new Er(r));else{let a=this.plugins[o];a.mustUpdate=e,s.push(a)}}for(let r of this.plugins)r.mustUpdate!=e&&r.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);t!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(n){ft(this.state,n,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,n=this.scrollDOM,s=n.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:o}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(V0(n))r=-1,o=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(s);r=f.from,o=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];l&4||([this.measureRequests,h]=[h,this.measureRequests]);let c=h.map(f=>{try{return f.read(this)}catch(g){return ft(this.state,g),P0}}),d=el.create(this,this.state,[]),u=!1;d.flags|=l,t?t.flags|=l:t=d,this.updateState=2,d.empty||(this.updatePlugins(d),this.inputState.update(d),this.updateAttrs(),u=this.docView.update(d),u&&this.docViewUpdate());for(let f=0;f<h.length;f++)if(c[f]!=P0)try{let g=h[f];g.write&&g.write(c[f],this)}catch(g){ft(this.state,g)}if(u&&this.docView.updateSelection(!0),!d.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-o;if(g>1||g<-1){s=s+g,n.scrollTop=s/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let a of this.state.facet(md))a(t)}get themeClasses(){return Ed+" "+(this.state.facet(Zd)?Zy:Ry)+" "+this.state.facet(Va)}updateAttrs(){let e=R0(this,py,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(Mi)?"true":"false",class:"cm-content",style:`${F.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),R0(this,Bd,t);let n=this.observer.ignore(()=>{let s=dd(this.contentDOM,this.contentAttrs,t),r=dd(this.dom,this.editorAttrs,e);return s||r});return this.editorAttrs=e,this.contentAttrs=t,n}showAnnouncements(e){let t=!0;for(let n of e)for(let s of n.effects)if(s.is(i.announce)){t&&(this.announceDOM.textContent=""),t=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Lr);let e=this.state.facet(i.cspNonce);Mt.mount(this.root,this.styleModules.concat(iC).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(n=>n.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,n){return td(this,e,u0(this,e,t,n))}moveByGroup(e,t){return td(this,e,u0(this,e,t,n=>Pk(this,e.head,n)))}visualLineSide(e,t){let n=this.bidiSpans(e),s=this.textDirectionAt(e.from),r=n[t?n.length-1:0];return H.cursor(r.side(t,s)+e.from,r.forward(!t,s)?1:-1)}moveToLineBoundary(e,t,n=!0){return Mk(this,e,t,n)}moveVertically(e,t,n){return td(this,e,Rk(this,e,t,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),wy(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;let s=this.state.doc.lineAt(e),r=this.bidiSpans(s),o=r[ri.find(r,e-s.from,-1,t)];return al(n,o.dir==ae.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(cy)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>rC)return iy(e.length);let t=this.textDirectionAt(e.from),n;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t&&(r.fresh||ty(r.isolates,n=a0(this,e))))return r.order;n||(n=a0(this,e));let s=dk(e.text,t,n);return this.bidiCache.push(new ol(e.from,e.to,t,n,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||F.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{H0(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Da.of(new Zr(typeof e=="number"?H.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,n=this.viewState.scrollAnchorAt(e);return Da.of(new Zr(H.cursor(n.from),"start","start",n.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return _e.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return _e.define(()=>({}),{eventObservers:e})}static theme(e,t){let n=Mt.newName(),s=[Va.of(n),Lr.of(Xd(`.${n}`,e))];return t&&t.dark&&s.push(Zd.of(!0)),s}static baseTheme(e){return Ot.lowest(Lr.of(Xd("."+Ed,e,Ey)))}static findFromDOM(e){var t;let n=e.querySelector(".cm-content"),s=n&&fe.get(n)||fe.get(e);return((t=s?.rootView)===null||t===void 0?void 0:t.view)||null}};B.styleModule=Lr;B.inputHandler=ly;B.clipboardInputFilter=Kd;B.clipboardOutputFilter=Yd;B.scrollHandler=uy;B.focusChangeEffect=hy;B.perLineTextDirection=cy;B.exceptionSink=ay;B.updateListener=md;B.editable=Mi;B.mouseSelectionStyle=oy;B.dragMovesSelection=ry;B.clickAddsSelectionRange=sy;B.decorations=Ar;B.outerDecorations=my;B.atomicRanges=jd;B.bidiIsolatedRanges=gy;B.scrollMargins=yy;B.darkTheme=Zd;B.cspNonce=Y.define({combine:i=>i.length?i[0]:""});B.contentAttributes=Bd;B.editorAttributes=py;B.lineWrapping=B.contentAttributes.of({class:"cm-lineWrapping"});B.announce=ee.define();var rC=4096,P0={},ol=class i{constructor(e,t,n,s,r,o){this.from=e,this.to=t,this.dir=n,this.isolates=s,this.fresh=r,this.order=o}static update(e,t){if(t.empty&&!e.some(r=>r.fresh))return e;let n=[],s=e.length?e[e.length-1].dir:ae.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let o=e[r];o.dir==s&&!t.touchesRange(o.from,o.to)&&n.push(new i(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return n}};function R0(i,e,t){for(let n=i.state.facet(e),s=n.length-1;s>=0;s--){let r=n[s],o=typeof r=="function"?r(i):r;o&&cd(o,t)}return t}var oC=F.mac?"mac":F.windows?"win":F.linux?"linux":"key";function aC(i,e){let t=i.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");let s,r,o,a;for(let l=0;l<t.length-1;++l){let h=t[l];if(/^(cmd|meta|m)$/i.test(h))a=!0;else if(/^a(lt)?$/i.test(h))s=!0;else if(/^(c|ctrl|control)$/i.test(h))r=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?a=!0:r=!0;else throw new Error("Unrecognized modifier name: "+h)}return s&&(n="Alt-"+n),r&&(n="Ctrl-"+n),a&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function za(i,e,t){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t!==!1&&e.shiftKey&&(i="Shift-"+i),i}var lC=Ot.default(B.domEventHandlers({keydown(i,e){return Iy(Xy(e.state),i,e,"editor")}})),hi=Y.define({enables:lC}),Z0=new WeakMap;function Xy(i){let e=i.facet(hi),t=Z0.get(e);return t||Z0.set(e,t=cC(e.reduce((n,s)=>n.concat(s),[]))),t}function _y(i,e,t){return Iy(Xy(i.state),e,i,t)}var Bi=null,hC=4e3;function cC(i,e=oC){let t=Object.create(null),n=Object.create(null),s=(o,a)=>{let l=n[o];if(l==null)n[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,a,l,h,c)=>{var d,u;let f=t[o]||(t[o]=Object.create(null)),g=a.split(/ (?!$)/).map(k=>aC(k,e));for(let k=1;k<g.length;k++){let T=g.slice(0,k).join(" ");s(T,!0),f[T]||(f[T]={preventDefault:!0,stopPropagation:!1,run:[M=>{let L=Bi={view:M,prefix:T,scope:o};return setTimeout(()=>{Bi==L&&(Bi=null)},hC),!0}]})}let C=g.join(" ");s(C,!1);let p=f[C]||(f[C]={preventDefault:!1,stopPropagation:!1,run:((u=(d=f._any)===null||d===void 0?void 0:d.run)===null||u===void 0?void 0:u.slice())||[]});l&&p.run.push(l),h&&(p.preventDefault=!0),c&&(p.stopPropagation=!0)};for(let o of i){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let h of a){let c=t[h]||(t[h]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:d}=o;for(let u in c)c[u].run.push(f=>d(f,Gd))}let l=o[e]||o.key;if(l)for(let h of a)r(h,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&r(h,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return t}var Gd=null;function Iy(i,e,t,n){Gd=e;let s=$g(e),r=De(s,0),o=dt(r)==s.length&&s!=" ",a="",l=!1,h=!1,c=!1;Bi&&Bi.view==t&&Bi.scope==n&&(a=Bi.prefix+" ",Sy.indexOf(e.keyCode)<0&&(h=!0,Bi=null));let d=new Set,u=p=>{if(p){for(let k of p.run)if(!d.has(k)&&(d.add(k),k(t)))return p.stopPropagation&&(c=!0),!0;p.preventDefault&&(p.stopPropagation&&(c=!0),h=!0)}return!1},f=i[n],g,C;return f&&(u(f[a+za(s,e,!o)])?l=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(F.windows&&e.ctrlKey&&e.altKey)&&(g=Ti[e.keyCode])&&g!=s?(u(f[a+za(g,e,!0)])||e.shiftKey&&(C=ps[e.keyCode])!=s&&C!=g&&u(f[a+za(C,e,!1)]))&&(l=!0):o&&e.shiftKey&&u(f[a+za(s,e,!0)])&&(l=!0),!l&&u(f._any)&&(l=!0)),h&&(l=!0),l&&c&&e.stopPropagation(),Gd=null,l}var Hr=class i{constructor(e,t,n,s,r){this.className=e,this.left=t,this.top=n,this.width=s,this.height=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,n){if(n.empty){let s=e.coordsAtPos(n.head,n.assoc||1);if(!s)return[];let r=Gy(e);return[new i(t,s.left-r.left,s.top-r.top,null,s.bottom-s.top)]}else return dC(e,t,n)}};function Gy(i){let e=i.scrollDOM.getBoundingClientRect();return{left:(i.textDirection==ae.LTR?e.left:e.right-i.scrollDOM.clientWidth*i.scaleX)-i.scrollDOM.scrollLeft*i.scaleX,top:e.top-i.scrollDOM.scrollTop*i.scaleY}}function E0(i,e,t,n){let s=i.coordsAtPos(e,t*2);if(!s)return n;let r=i.dom.getBoundingClientRect(),o=(s.top+s.bottom)/2,a=i.posAtCoords({x:r.left+1,y:o}),l=i.posAtCoords({x:r.right-1,y:o});return a==null||l==null?n:{from:Math.max(n.from,Math.min(a,l)),to:Math.min(n.to,Math.max(a,l))}}function dC(i,e,t){if(t.to<=i.viewport.from||t.from>=i.viewport.to)return[];let n=Math.max(t.from,i.viewport.from),s=Math.min(t.to,i.viewport.to),r=i.textDirection==ae.LTR,o=i.contentDOM,a=o.getBoundingClientRect(),l=Gy(i),h=o.querySelector(".cm-line"),c=h&&window.getComputedStyle(h),d=a.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),u=a.right-(c?parseInt(c.paddingRight):0),f=yd(i,n),g=yd(i,s),C=f.type==pt.Text?f:null,p=g.type==pt.Text?g:null;if(C&&(i.lineWrapping||f.widgetLineBreaks)&&(C=E0(i,n,1,C)),p&&(i.lineWrapping||g.widgetLineBreaks)&&(p=E0(i,s,-1,p)),C&&p&&C.from==p.from&&C.to==p.to)return T(M(t.from,t.to,C));{let b=C?M(t.from,null,C):L(f,!1),m=p?M(null,t.to,p):L(g,!0),w=[];return(C||f).to<(p||g).from-(C&&p?1:0)||f.widgetLineBreaks>1&&b.bottom+i.defaultLineHeight/2<m.top?w.push(k(d,b.bottom,u,m.top)):b.bottom<m.top&&i.elementAtHeight((b.bottom+m.top)/2).type==pt.Text&&(b.bottom=m.top=(b.bottom+m.top)/2),T(b).concat(w).concat(T(m))}function k(b,m,w,v){return new Hr(e,b-l.left,m-l.top,w-b,v-m)}function T({top:b,bottom:m,horizontal:w}){let v=[];for(let S=0;S<w.length;S+=2)v.push(k(w[S],b,w[S+1],m));return v}function M(b,m,w){let v=1e9,S=-1e9,P=[];function Z(A,O,j,U,W){let R=i.coordsAtPos(A,A==w.to?-2:2),X=i.coordsAtPos(j,j==w.from?2:-2);!R||!X||(v=Math.min(R.top,X.top,v),S=Math.max(R.bottom,X.bottom,S),W==ae.LTR?P.push(r&&O?d:R.left,r&&U?u:X.right):P.push(!r&&U?d:X.left,!r&&O?u:R.right))}let E=b??w.from,D=m??w.to;for(let A of i.visibleRanges)if(A.to>E&&A.from<D)for(let O=Math.max(A.from,E),j=Math.min(A.to,D);;){let U=i.state.doc.lineAt(O);for(let W of i.bidiSpans(U)){let R=W.from+U.from,X=W.to+U.from;if(R>=j)break;X>O&&Z(Math.max(R,O),b==null&&R<=E,Math.min(X,j),m==null&&X>=D,W.dir)}if(O=U.to+1,O>=j)break}return P.length==0&&Z(E,b==null,D,m==null,i.textDirection),{top:v,bottom:S,horizontal:P}}function L(b,m){let w=a.top+(m?b.top:b.bottom);return{top:w,bottom:w,horizontal:[]}}}function uC(i,e){return i.constructor==e.constructor&&i.eq(e)}var Wd=class{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(ja)!=e.state.facet(ja)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,n=e.facet(ja);for(;t<n.length&&n[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,n)=>!uC(t,this.drawn[n]))){let t=this.dom.firstChild,n=0;for(let s of e)s.update&&t&&s.constructor&&this.drawn[n].constructor&&s.update(t,this.drawn[n])?(t=t.nextSibling,n++):this.dom.insertBefore(s.draw(),t);for(;t;){let s=t.nextSibling;t.remove(),t=s}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}},ja=Y.define();function Wy(i){return[_e.define(e=>new Wd(e,i)),ja.of(i)]}var Dy=!(F.ios&&F.webkit&&F.webkit_version<534),vs=Y.define({combine(i){return ut(i,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function cl(i={}){return[vs.of(i),fC,pC,mC,dy.of(!0)]}function Ny(i){return i.facet(vs)}function Ay(i){return i.startState.facet(vs)!=i.state.facet(vs)}var fC=Wy({above:!0,markers(i){let{state:e}=i,t=e.facet(vs),n=[];for(let s of e.selection.ranges){let r=s==e.selection.main;if(s.empty?!r||Dy:t.drawRangeCursor){let o=r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=s.empty?s:H.cursor(s.head,s.head>s.anchor?-1:1);for(let l of Hr.forRange(i,o,a))n.push(l)}}return n},update(i,e){i.transactions.some(n=>n.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=Ay(i);return t&&X0(i.state,e),i.docChanged||i.selectionSet||t},mount(i,e){X0(e.state,i)},class:"cm-cursorLayer"});function X0(i,e){e.style.animationDuration=i.facet(vs).cursorBlinkRate+"ms"}var pC=Wy({above:!1,markers(i){return i.state.selection.ranges.map(e=>e.empty?[]:Hr.forRange(i,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(i,e){return i.docChanged||i.selectionSet||i.viewportChanged||Ay(i)},class:"cm-selectionLayer"}),Dd={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};Dy&&(Dd[".cm-line"].caretColor=Dd[".cm-content"].caretColor="transparent !important");var mC=Ot.highest(B.theme(Dd));function _0(i,e,t,n,s){e.lastIndex=0;for(let r=i.iterRange(t,n),o=t,a;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;a=e.exec(r.value);)s(o+a.index,a)}function gC(i,e){let t=i.visibleRanges;if(t.length==1&&t[0].from==i.viewport.from&&t[0].to==i.viewport.to)return t;let n=[];for(let{from:s,to:r}of t)s=Math.max(i.state.doc.lineAt(s).from,s-e),r=Math.min(i.state.doc.lineAt(r).to,r+e),n.length&&n[n.length-1].to>=s?n[n.length-1].to=r:n.push({from:s,to:r});return n}var Nd=class{constructor(e){let{regexp:t,decoration:n,decorate:s,boundary:r,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,s)this.addMatch=(a,l,h,c)=>s(c,h,h+a[0].length,a,l);else if(typeof n=="function")this.addMatch=(a,l,h,c)=>{let d=n(a,l,h);d&&c(h,h+a[0].length,d)};else if(n)this.addMatch=(a,l,h,c)=>c(h,h+a[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=r,this.maxLength=o}createDeco(e){let t=new Tt,n=t.add.bind(t);for(let{from:s,to:r}of gC(e,this.maxLength))_0(e.state.doc,this.regexp,s,r,(o,a)=>this.addMatch(a,e,o,n));return t.finish()}updateDeco(e,t){let n=1e9,s=-1;return e.docChanged&&e.changes.iterChanges((r,o,a,l)=>{l>=e.view.viewport.from&&a<=e.view.viewport.to&&(n=Math.min(a,n),s=Math.max(l,s))}),e.viewportMoved||s-n>1e3?this.createDeco(e.view):s>-1?this.updateRange(e.view,t.map(e.changes),n,s):t}updateRange(e,t,n,s){for(let r of e.visibleRanges){let o=Math.max(r.from,n),a=Math.min(r.to,s);if(a>o){let l=e.state.doc.lineAt(o),h=l.to<a?e.state.doc.lineAt(a):l,c=Math.max(r.from,l.from),d=Math.min(r.to,h.to);if(this.boundary){for(;o>l.from;o--)if(this.boundary.test(l.text[o-1-l.from])){c=o;break}for(;a<h.to;a++)if(this.boundary.test(h.text[a-h.from])){d=a;break}}let u=[],f,g=(C,p,k)=>u.push(k.range(C,p));if(l==h)for(this.regexp.lastIndex=c-l.from;(f=this.regexp.exec(l.text))&&f.index<d-l.from;)this.addMatch(f,e,f.index+l.from,g);else _0(e.state.doc,this.regexp,c,d,(C,p)=>this.addMatch(p,e,C,g));t=t.update({filterFrom:c,filterTo:d,filter:(C,p)=>C<c||p>d,add:u})}}return t}},Ad=/x/.unicode!=null?"gu":"g",yC=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,Ad),bC={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"},nd=null;function wC(){var i;if(nd==null&&typeof document<"u"&&document.body){let e=document.body.style;nd=((i=e.tabSize)!==null&&i!==void 0?i:e.MozTabSize)!=null}return nd||!1}var Ua=Y.define({combine(i){let e=ut(i,{render:null,specialChars:yC,addSpecialChars:null});return(e.replaceTabs=!wC())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Ad)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Ad)),e}});function dl(i={}){return[Ua.of(i),vC()]}var I0=null;function vC(){return I0||(I0=_e.fromClass(class{constructor(i){this.view=i,this.decorations=ne.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(i.state.facet(Ua)),this.decorations=this.decorator.createDeco(i)}makeDecorator(i){return new Nd({regexp:i.specialChars,decoration:(e,t,n)=>{let{doc:s}=t.state,r=De(e[0],0);if(r==9){let o=s.lineAt(n),a=t.state.tabSize,l=Yi(o.text,a,n-o.from);return ne.replace({widget:new Od((a-l%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[r]||(this.decorationCache[r]=ne.replace({widget:new Hd(i,r)}))},boundary:i.replaceTabs?void 0:/[^]/})}update(i){let e=i.state.facet(Ua);i.startState.facet(Ua)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(i.view)):this.decorations=this.decorator.updateDeco(i,this.decorations)}},{decorations:i=>i.decorations}))}var xC="\u2022";function SC(i){return i>=32?xC:i==10?"\u2424":String.fromCharCode(9216+i)}var Hd=class extends Pi{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=SC(this.code),n=e.state.phrase("Control character")+" "+(bC[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,n,t);if(s)return s;let r=document.createElement("span");return r.textContent=t,r.title=n,r.setAttribute("aria-label",n),r.className="cm-specialChar",r}ignoreEvent(){return!1}},Od=class extends Pi{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}};var kr="-10000px",Vd=class{constructor(e,t,n,s){this.facet=t,this.createTooltipView=n,this.removeTooltipView=s,this.input=e.state.facet(t),this.tooltips=this.input.filter(o=>o);let r=null;this.tooltipViews=this.tooltips.map(o=>r=n(o,r))}update(e,t){var n;let s=e.state.facet(this.facet),r=s.filter(l=>l);if(s===this.input){for(let l of this.tooltipViews)l.update&&l.update(e);return!1}let o=[],a=t?[]:null;for(let l=0;l<r.length;l++){let h=r[l],c=-1;if(h){for(let d=0;d<this.tooltips.length;d++){let u=this.tooltips[d];u&&u.create==h.create&&(c=d)}if(c<0)o[l]=this.createTooltipView(h,l?o[l-1]:null),a&&(a[l]=!!h.above);else{let d=o[l]=this.tooltipViews[c];a&&(a[l]=t[c]),d.update&&d.update(e)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(n=l.destroy)===null||n===void 0||n.call(l));return t&&(a.forEach((l,h)=>t[h]=l),t.length=a.length),this.input=s,this.tooltips=r,this.tooltipViews=o,!0}};function kC(i){let{win:e}=i;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}var sd=Y.define({combine:i=>{var e,t,n;return{position:F.ios?"absolute":((e=i.find(s=>s.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=i.find(s=>s.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((n=i.find(s=>s.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||kC}}}),G0=new WeakMap,Hy=_e.fromClass(class{constructor(i){this.view=i,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=i.state.facet(sd);this.position=e.position,this.parent=e.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new Vd(i,Qd,(t,n)=>this.createTooltip(t,n),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),i.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(i,this.above);e&&this.observeIntersection();let t=e||i.geometryChanged,n=i.state.facet(sd);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let s of this.manager.tooltipViews)s.dom.style.position=this.position;t=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let s of this.manager.tooltipViews)this.container.appendChild(s.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(i,e){let t=i.create(this.view),n=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),i.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let s=document.createElement("div");s.className="cm-tooltip-arrow",t.dom.appendChild(s)}return t.dom.style.position=this.position,t.dom.style.top=kr,t.dom.style.left="0px",this.container.insertBefore(t.dom,n),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var i,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),(i=n.destroy)===null||i===void 0||i.call(n);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=1,e=1,t=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:r}=this.manager.tooltipViews[0];if(F.gecko)t=r.offsetParent!=this.container.ownerDocument.body;else if(r.style.top==kr&&r.style.left=="0px"){let o=r.getBoundingClientRect();t=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}}if(t||this.position=="absolute")if(this.parent){let r=this.parent.getBoundingClientRect();r.width&&r.height&&(i=r.width/this.parent.offsetWidth,e=r.height/this.parent.offsetHeight)}else({scaleX:i,scaleY:e}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),s=Ud(this.view);return{visible:{left:n.left+s.left,top:n.top+s.top,right:n.right-s.right,bottom:n.bottom-s.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((r,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(r.pos):this.view.coordsAtPos(r.pos)}),size:this.manager.tooltipViews.map(({dom:r})=>r.getBoundingClientRect()),space:this.view.state.facet(sd).tooltipSpace(this.view),scaleX:i,scaleY:e,makeAbsolute:t}}writeMeasure(i){var e;if(i.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:t,space:n,scaleX:s,scaleY:r}=i,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],h=this.manager.tooltipViews[a],{dom:c}=h,d=i.pos[a],u=i.size[a];if(!d||l.clip!==!1&&(d.bottom<=Math.max(t.top,n.top)||d.top>=Math.min(t.bottom,n.bottom)||d.right<Math.max(t.left,n.left)-.1||d.left>Math.min(t.right,n.right)+.1)){c.style.top=kr;continue}let f=l.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,g=f?7:0,C=u.right-u.left,p=(e=G0.get(h))!==null&&e!==void 0?e:u.bottom-u.top,k=h.offset||LC,T=this.view.textDirection==ae.LTR,M=u.width>n.right-n.left?T?n.left:n.right-u.width:T?Math.max(n.left,Math.min(d.left-(f?14:0)+k.x,n.right-C)):Math.min(Math.max(n.left,d.left-C+(f?14:0)-k.x),n.right-C),L=this.above[a];!l.strictSide&&(L?d.top-p-g-k.y<n.top:d.bottom+p+g+k.y>n.bottom)&&L==n.bottom-d.bottom>d.top-n.top&&(L=this.above[a]=!L);let b=(L?d.top-n.top:n.bottom-d.bottom)-g;if(b<p&&h.resize!==!1){if(b<this.view.defaultLineHeight){c.style.top=kr;continue}G0.set(h,p),c.style.height=(p=b)/r+"px"}else c.style.height&&(c.style.height="");let m=L?d.top-p-g-k.y:d.bottom+g+k.y,w=M+C;if(h.overlap!==!0)for(let v of o)v.left<w&&v.right>M&&v.top<m+p&&v.bottom>m&&(m=L?v.top-p-2-g:v.bottom+g+2);if(this.position=="absolute"?(c.style.top=(m-i.parent.top)/r+"px",W0(c,(M-i.parent.left)/s)):(c.style.top=m/r+"px",W0(c,M/s)),f){let v=d.left+(T?k.x:-k.x)-(M+14-7);f.style.left=v/s+"px"}h.overlap!==!0&&o.push({left:M,top:m,right:w,bottom:m+p}),c.classList.toggle("cm-tooltip-above",L),c.classList.toggle("cm-tooltip-below",!L),h.positioned&&h.positioned(i.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=kr}},{eventObservers:{scroll(){this.maybeMeasure()}}});function W0(i,e){let t=parseInt(i.style.left,10);(isNaN(t)||Math.abs(e-t)>1)&&(i.style.left=e+"px")}var CC=B.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),LC={x:0,y:0},Qd=Y.define({enables:[Hy,CC]});function Oy(i,e){let t=i.plugin(Hy);if(!t)return null;let n=t.manager.tooltips.indexOf(e);return n<0?null:t.manager.tooltipViews[n]}var D0=Y.define({combine(i){let e,t;for(let n of i)e=e||n.topContainer,t=t||n.bottomContainer;return{topContainer:e,bottomContainer:t}}});function $d(i,e){let t=i.plugin(Vy),n=t?t.specs.indexOf(e):-1;return n>-1?t.panels[n]:null}var Vy=_e.fromClass(class{constructor(i){this.input=i.state.facet(xs),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(i));let e=i.state.facet(D0);this.top=new ys(i,!0,e.topContainer),this.bottom=new ys(i,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(i){let e=i.state.facet(D0);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new ys(i.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new ys(i.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=i.state.facet(xs);if(t!=this.input){let n=t.filter(l=>l),s=[],r=[],o=[],a=[];for(let l of n){let h=this.specs.indexOf(l),c;h<0?(c=l(i.view),a.push(c)):(c=this.panels[h],c.update&&c.update(i)),s.push(c),(c.top?r:o).push(c)}this.specs=n,this.panels=s,this.top.sync(r),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let n of this.panels)n.update&&n.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:i=>B.scrollMargins.of(e=>{let t=e.plugin(i);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})}),ys=class{constructor(e,t,n){this.view=e,this.top=t,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=N0(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=N0(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}};function N0(i){let e=i.nextSibling;return i.remove(),e}var xs=Y.define({enables:Vy}),Ri=class extends Ht{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};Ri.prototype.elementClass="";Ri.prototype.toDOM=void 0;Ri.prototype.mapMode=Xe.TrackBefore;Ri.prototype.startSide=Ri.prototype.endSide=-1;Ri.prototype.point=!0;var MC=0,Or=class{constructor(e,t){this.from=e,this.to=t}},J=class{constructor(e={}){this.id=MC++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=$e.match(e)),t=>{let n=e(t);return n===void 0?null:[this,n]}}};J.closedBy=new J({deserialize:i=>i.split(" ")});J.openedBy=new J({deserialize:i=>i.split(" ")});J.group=new J({deserialize:i=>i.split(" ")});J.isolate=new J({deserialize:i=>{if(i&&i!="rtl"&&i!="ltr"&&i!="auto")throw new RangeError("Invalid value for isolate: "+i);return i||"auto"}});J.contextHash=new J({perNode:!0});J.lookAhead=new J({perNode:!0});J.mounted=new J({perNode:!0});var Ss=class{constructor(e,t,n){this.tree=e,this.overlay=t,this.parser=n}static get(e){return e&&e.props&&e.props[J.mounted.id]}},PC=Object.create(null),$e=class i{constructor(e,t,n,s=0){this.name=e,this.props=t,this.id=n,this.flags=s}static define(e){let t=e.props&&e.props.length?Object.create(null):PC,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new i(e.name||"",t,e.id,n);if(e.props){for(let r of e.props)if(Array.isArray(r)||(r=r(s)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(J.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let s of n.split(" "))t[s]=e[n];return n=>{for(let s=n.prop(J.group),r=-1;r<(s?s.length:0);r++){let o=t[r<0?n.name:s[r]];if(o)return o}}}};$e.none=new $e("",Object.create(null),0,8);var pl=class i{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let n of this.types){let s=null;for(let r of e){let o=r(n);o&&(s||(s=Object.assign({},n.props)),s[o[0].id]=o[1])}t.push(s?new $e(n.name,s,n.id,n.flags):n)}return new i(t)}},ul=new WeakMap,zy=new WeakMap,Ie;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays"})(Ie||(Ie={}));var ve=class i{constructor(e,t,n,s,r){if(this.type=e,this.children=t,this.positions=n,this.length=s,this.props=null,r&&r.length){this.props=Object.create(null);for(let[o,a]of r)this.props[typeof o=="number"?o:o.id]=a}}toString(){let e=Ss.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let n of this.children){let s=n.toString();s&&(t&&(t+=","),t+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Fr(this.topNode,e)}cursorAt(e,t=0,n=0){let s=ul.get(this)||this.topNode,r=new Fr(s);return r.moveTo(e,t),ul.set(this,r._tree),r}get topNode(){return new ci(this,0,0,null)}resolve(e,t=0){let n=Vr(ul.get(this)||this.topNode,e,t,!1);return ul.set(this,n),n}resolveInner(e,t=0){let n=Vr(zy.get(this)||this.topNode,e,t,!0);return zy.set(this,n),n}resolveStack(e,t=0){return RC(this,e,t)}iterate(e){let{enter:t,leave:n,from:s=0,to:r=this.length}=e,o=e.mode||0,a=(o&Ie.IncludeAnonymous)>0;for(let l=this.cursor(o|Ie.IncludeAnonymous);;){let h=!1;if(l.from<=r&&l.to>=s&&(!a&&l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;h=!0}for(;h&&n&&(a||!l.type.isAnonymous)&&n(l),!l.nextSibling();){if(!l.parent())return;h=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:ru($e.none,this.children,this.positions,0,this.children.length,0,this.length,(t,n,s)=>new i(this.type,t,n,s,this.propValues),e.makeTree||((t,n,s)=>new i($e.none,t,n,s)))}static build(e){return ZC(e)}};ve.empty=new ve($e.none,[],[],0);var qd=class i{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new i(this.buffer,this.index)}},$i=class i{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return $e.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],s=this.set.types[t],r=s.name;if(/\W/.test(r)&&!s.isError&&(r=JSON.stringify(r)),e+=4,n==e)return r;let o=[];for(;e<n;)o.push(this.childString(e)),e=this.buffer[e+3];return r+"("+o.join(",")+")"}findChild(e,t,n,s,r){let{buffer:o}=this,a=-1;for(let l=e;l!=t&&!(Yy(r,s,o[l+1],o[l+2])&&(a=l,n>0));l=o[l+3]);return a}slice(e,t,n){let s=this.buffer,r=new Uint16Array(t-e),o=0;for(let a=e,l=0;a<t;){r[l++]=s[a++],r[l++]=s[a++]-n;let h=r[l++]=s[a++]-n;r[l++]=s[a++]-e,o=Math.max(o,h)}return new i(r,o,this.set)}};function Yy(i,e,t,n){switch(i){case-2:return t<e;case-1:return n>=e&&t<e;case 0:return t<e&&n>e;case 1:return t<=e&&n>e;case 2:return n>e;case 4:return!0}}function Vr(i,e,t,n){for(var s;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let o=!n&&i instanceof ci&&i.index<0?null:i.parent;if(!o)return i;i=o}let r=n?0:Ie.IgnoreOverlays;if(n)for(let o=i,a=o.parent;a;o=a,a=o.parent)o instanceof ci&&o.index<0&&((s=a.enter(e,t,r))===null||s===void 0?void 0:s.from)!=o.from&&(i=a);for(;;){let o=i.enter(e,t,r);if(!o)return i;i=o}}var ml=class{cursor(e=0){return new Fr(this,e)}getChild(e,t=null,n=null){let s=Fy(this,e,t,n);return s.length?s[0]:null}getChildren(e,t=null,n=null){return Fy(this,e,t,n)}resolve(e,t=0){return Vr(this,e,t,!1)}resolveInner(e,t=0){return Vr(this,e,t,!0)}matchContext(e){return eu(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),n=this;for(;t;){let s=t.lastChild;if(!s||s.to!=t.to)break;s.type.isError&&s.from==s.to?(n=t,t=s.prevSibling):t=s}return n}get node(){return this}get next(){return this.parent}},ci=class i extends ml{constructor(e,t,n,s){super(),this._tree=e,this.from=t,this.index=n,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,n,s,r=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,h=t>0?a.length:-1;e!=h;e+=t){let c=a[e],d=l[e]+o.from;if(Yy(s,n,d,d+c.length)){if(c instanceof $i){if(r&Ie.ExcludeBuffers)continue;let u=c.findChild(0,c.buffer.length,t,n-d,s);if(u>-1)return new zr(new tu(o,c,e,d),null,u)}else if(r&Ie.IncludeAnonymous||!c.type.isAnonymous||su(c)){let u;if(!(r&Ie.IgnoreMounts)&&(u=Ss.get(c))&&!u.overlay)return new i(u.tree,d,e,o);let f=new i(c,d,e,o);return r&Ie.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?c.children.length-1:0,t,n,s)}}}if(r&Ie.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,n=0){let s;if(!(n&Ie.IgnoreOverlays)&&(s=Ss.get(this._tree))&&s.overlay){let r=e-this.from;for(let{from:o,to:a}of s.overlay)if((t>0?o<=r:o<r)&&(t<0?a>=r:a>r))return new i(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}};function Fy(i,e,t,n){let s=i.cursor(),r=[];if(!s.firstChild())return r;if(t!=null){for(let o=!1;!o;)if(o=s.type.is(t),!s.nextSibling())return r}for(;;){if(n!=null&&s.type.is(n))return r;if(s.type.is(e)&&r.push(s.node),!s.nextSibling())return n==null?r:[]}}function eu(i,e,t=e.length-1){for(let n=i;t>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[t]&&e[t]!=n.name)return!1;t--}}return!0}var tu=class{constructor(e,t,n,s){this.parent=e,this.buffer=t,this.index=n,this.start=s}},zr=class i extends ml{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,n){super(),this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,t,n){let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.context.start,n);return r<0?null:new i(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n=0){if(n&Ie.ExcludeBuffers)return null;let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new i(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new i(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new i(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,s=this.index+4,r=n.buffer[this.index+3];if(r>s){let o=n.buffer[this.index+1];e.push(n.slice(s,r,o)),t.push(0)}return new ve(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}};function By(i){if(!i.length)return null;let e=0,t=i[0];for(let r=1;r<i.length;r++){let o=i[r];(o.from>t.from||o.to<t.to)&&(t=o,e=r)}let n=t instanceof ci&&t.index<0?null:t.parent,s=i.slice();return n?s[e]=n:s.splice(e,1),new iu(s,t)}var iu=class{constructor(e,t){this.heads=e,this.node=t}get next(){return By(this.heads)}};function RC(i,e,t){let n=i.resolveInner(e,t),s=null;for(let r=n instanceof ci?n:n.context.parent;r;r=r.parent)if(r.index<0){let o=r.parent;(s||(s=[n])).push(o.resolve(e,t)),r=o}else{let o=Ss.get(r.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let a=new ci(o.tree,o.overlay[0].from+r.from,-1,r);(s||(s=[n])).push(Vr(a,e,t,!1))}}return s?By(s):n}var Fr=class{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof ci)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:n,buffer:s}=this.buffer;return this.type=t||s.set.types[s.buffer[e]],this.from=n+s.buffer[e+1],this.to=n+s.buffer[e+2],!0}yield(e){return e?e instanceof ci?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,n,this.mode));let{buffer:s}=this.buffer,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.buffer.start,n);return r<0?!1:(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=this.mode){return this.buffer?n&Ie.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Ie.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Ie.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let s=n<0?0:this.stack[n]+4;if(this.index!=s)return this.yieldBuf(t.findChild(s,this.index,-1,0,4))}else{let s=t.buffer[this.index+3];if(s<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(s)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let r=0;r<this.index;r++)if(s.buffer.buffer[r+3]<this.index)return!1;({index:t,parent:n}=s)}else({index:t,_parent:n}=this._tree);for(;n;{index:t,_parent:n}=n)if(t>-1)for(let r=t+e,o=e<0?-1:n._tree.children.length;r!=o;r+=e){let a=n._tree.children[r];if(this.mode&Ie.IncludeAnonymous||a instanceof $i||!a.type.isAnonymous||su(a))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer)e:for(let s=this.index,r=this.stack.length;r>=0;){for(let o=e;o;o=o._parent)if(o.index==s){if(s==this.index)return o;t=o,n=r+1;break e}s=this.stack[--r]}for(let s=n;s<this.stack.length;s++)t=new zr(this.buffer,t,this.stack[s]);return this.bufferNode=new zr(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let n=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&t&&t(this),s=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,s=!0}}}matchContext(e){if(!this.buffer)return eu(this.node.parent,e);let{buffer:t}=this.buffer,{types:n}=t.set;for(let s=e.length-1,r=this.stack.length-1;s>=0;r--){if(r<0)return eu(this._tree,e,s);let o=n[t.buffer[this.stack[r]]];if(!o.isAnonymous){if(e[s]&&e[s]!=o.name)return!1;s--}}return!0}};function su(i){return i.children.some(e=>e instanceof $i||!e.type.isAnonymous||su(e))}function ZC(i){var e;let{buffer:t,nodeSet:n,maxBufferLength:s=1024,reused:r=[],minRepeatType:o=n.types.length}=i,a=Array.isArray(t)?new qd(t,t.length):t,l=n.types,h=0,c=0;function d(b,m,w,v,S,P){let{id:Z,start:E,end:D,size:A}=a,O=c,j=h;for(;A<0;)if(a.next(),A==-1){let I=r[Z];w.push(I),v.push(E-b);return}else if(A==-3){h=Z;return}else if(A==-4){c=Z;return}else throw new RangeError(`Unrecognized record size: ${A}`);let U=l[Z],W,R,X=E-b;if(D-E<=s&&(R=p(a.pos-m,S))){let I=new Uint16Array(R.size-R.skip),_=a.pos-R.size,$=I.length;for(;a.pos>_;)$=k(R.start,I,$);W=new $i(I,D-R.start,n),X=R.start-b}else{let I=a.pos-A;a.next();let _=[],$=[],le=Z>=o?Z:-1,Le=0,Ee=D;for(;a.pos>I;)le>=0&&a.id==le&&a.size>=0?(a.end<=Ee-s&&(g(_,$,E,Le,a.end,Ee,le,O,j),Le=_.length,Ee=a.end),a.next()):P>2500?u(E,I,_,$):d(E,I,_,$,le,P+1);if(le>=0&&Le>0&&Le<_.length&&g(_,$,E,Le,E,Ee,le,O,j),_.reverse(),$.reverse(),le>-1&&Le>0){let ki=f(U,j);W=ru(U,_,$,0,_.length,0,D-E,ki,ki)}else W=C(U,_,$,D-E,O-D,j)}w.push(W),v.push(X)}function u(b,m,w,v){let S=[],P=0,Z=-1;for(;a.pos>m;){let{id:E,start:D,end:A,size:O}=a;if(O>4)a.next();else{if(Z>-1&&D<Z)break;Z<0&&(Z=A-s),S.push(E,D,A),P++,a.next()}}if(P){let E=new Uint16Array(P*4),D=S[S.length-2];for(let A=S.length-3,O=0;A>=0;A-=3)E[O++]=S[A],E[O++]=S[A+1]-D,E[O++]=S[A+2]-D,E[O++]=O;w.push(new $i(E,S[2]-D,n)),v.push(D-b)}}function f(b,m){return(w,v,S)=>{let P=0,Z=w.length-1,E,D;if(Z>=0&&(E=w[Z])instanceof ve){if(!Z&&E.type==b&&E.length==S)return E;(D=E.prop(J.lookAhead))&&(P=v[Z]+E.length+D)}return C(b,w,v,S,P,m)}}function g(b,m,w,v,S,P,Z,E,D){let A=[],O=[];for(;b.length>v;)A.push(b.pop()),O.push(m.pop()+w-S);b.push(C(n.types[Z],A,O,P-S,E-P,D)),m.push(S-w)}function C(b,m,w,v,S,P,Z){if(P){let E=[J.contextHash,P];Z=Z?[E].concat(Z):[E]}if(S>25){let E=[J.lookAhead,S];Z=Z?[E].concat(Z):[E]}return new ve(b,m,w,v,Z)}function p(b,m){let w=a.fork(),v=0,S=0,P=0,Z=w.end-s,E={size:0,start:0,skip:0};e:for(let D=w.pos-b;w.pos>D;){let A=w.size;if(w.id==m&&A>=0){E.size=v,E.start=S,E.skip=P,P+=4,v+=4,w.next();continue}let O=w.pos-A;if(A<0||O<D||w.start<Z)break;let j=w.id>=o?4:0,U=w.start;for(w.next();w.pos>O;){if(w.size<0)if(w.size==-3)j+=4;else break e;else w.id>=o&&(j+=4);w.next()}S=U,v+=A,P+=j}return(m<0||v==b)&&(E.size=v,E.start=S,E.skip=P),E.size>4?E:void 0}function k(b,m,w){let{id:v,start:S,end:P,size:Z}=a;if(a.next(),Z>=0&&v<o){let E=w;if(Z>4){let D=a.pos-(Z-4);for(;a.pos>D;)w=k(b,m,w)}m[--w]=E,m[--w]=P-b,m[--w]=S-b,m[--w]=v}else Z==-3?h=v:Z==-4&&(c=v);return w}let T=[],M=[];for(;a.pos>0;)d(i.start||0,i.bufferStart||0,T,M,-1,0);let L=(e=i.length)!==null&&e!==void 0?e:T.length?M[0]+T[0].length:0;return new ve(l[i.topID],T.reverse(),M.reverse(),L)}var Ky=new WeakMap;function fl(i,e){if(!i.isAnonymous||e instanceof $i||e.type!=i)return 1;let t=Ky.get(e);if(t==null){t=1;for(let n of e.children){if(n.type!=i||!(n instanceof ve)){t=1;break}t+=fl(i,n)}Ky.set(e,t)}return t}function ru(i,e,t,n,s,r,o,a,l){let h=0;for(let g=n;g<s;g++)h+=fl(i,e[g]);let c=Math.ceil(h*1.5/8),d=[],u=[];function f(g,C,p,k,T){for(let M=p;M<k;){let L=M,b=C[M],m=fl(i,g[M]);for(M++;M<k;M++){let w=fl(i,g[M]);if(m+w>=c)break;m+=w}if(M==L+1){if(m>c){let w=g[L];f(w.children,w.positions,0,w.children.length,C[L]+T);continue}d.push(g[L])}else{let w=C[M-1]+g[M-1].length-b;d.push(ru(i,g,C,L,M,b,w,null,l))}u.push(b+T-r)}}return f(e,t,n,s,0),(a||l)(d,u,o)}var Wn=class i{constructor(e,t,n,s,r=!1,o=!1){this.from=e,this.to=t,this.tree=n,this.offset=s,this.open=(r?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],n=!1){let s=[new i(0,e.length,e,0,!1,n)];for(let r of t)r.to>e.length&&s.push(r);return s}static applyChanges(e,t,n=128){if(!t.length)return e;let s=[],r=1,o=e.length?e[0]:null;for(let a=0,l=0,h=0;;a++){let c=a<t.length?t[a]:null,d=c?c.fromA:1e9;if(d-l>=n)for(;o&&o.from<d;){let u=o;if(l>=u.from||d<=u.to||h){let f=Math.max(u.from,l)-h,g=Math.min(u.to,d)-h;u=f>=g?null:new i(f,g,u.tree,u.offset+h,a>0,!!c)}if(u&&s.push(u),o.to>d)break;o=r<e.length?e[r++]:null}if(!c)break;l=c.toA,h=c.toA-c.toB}return s}},Kr=class{startParse(e,t,n){return typeof e=="string"&&(e=new nu(e)),n=n?n.length?n.map(s=>new Or(s.from,s.to)):[new Or(0,0)]:[new Or(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let s=this.startParse(e,t,n);for(;;){let r=s.advance();if(r)return r}}},nu=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}};var TE=new J({perNode:!0});var EC=0,zt=class i{constructor(e,t,n,s){this.name=e,this.set=t,this.base=n,this.modified=s,this.id=EC++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let n=typeof e=="string"?e:"?";if(e instanceof i&&(t=e),t?.base)throw new Error("Can not derive from a modified tag");let s=new i(n,[],null,[]);if(s.set.push(s),t)for(let r of t.set)s.set.push(r);return s}static defineModifier(e){let t=new wl(e);return n=>n.modified.indexOf(t)>-1?n:wl.get(n.base||n,n.modified.concat(t).sort((s,r)=>s.id-r.id))}},XC=0,wl=class i{constructor(e){this.name=e,this.instances=[],this.id=XC++}static get(e,t){if(!t.length)return e;let n=t[0].instances.find(a=>a.base==e&&_C(t,a.modified));if(n)return n;let s=[],r=new zt(e.name,s,e,t);for(let a of t)a.instances.push(r);let o=IC(t);for(let a of e.set)if(!a.modified.length)for(let l of o)s.push(i.get(a,l));return r}};function _C(i,e){return i.length==e.length&&i.every((t,n)=>t==e[n])}function IC(i){let e=[[]];for(let t=0;t<i.length;t++)for(let n=0,s=e.length;n<s;n++)e.push(e[n].concat(i[t]));return e.sort((t,n)=>n.length-t.length)}function Jy(i){let e=Object.create(null);for(let t in i){let n=i[t];Array.isArray(n)||(n=[n]);for(let s of t.split(" "))if(s){let r=[],o=2,a=s;for(let d=0;;){if(a=="..."&&d>0&&d+3==s.length){o=1;break}let u=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!u)throw new RangeError("Invalid path: "+s);if(r.push(u[0]=="*"?"":u[0][0]=='"'?JSON.parse(u[0]):u[0]),d+=u[0].length,d==s.length)break;let f=s[d++];if(d==s.length&&f=="!"){o=0;break}if(f!="/")throw new RangeError("Invalid path: "+s);a=s.slice(d)}let l=r.length-1,h=r[l];if(!h)throw new RangeError("Invalid path: "+s);let c=new ks(n,o,l>0?r.slice(0,l):null);e[h]=c.sort(e[h])}}return Qy.add(e)}var Qy=new J,ks=class{constructor(e,t,n,s){this.tags=e,this.mode=t,this.context=n,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};ks.empty=new ks([],2,null);function hu(i,e){let t=Object.create(null);for(let r of i)if(!Array.isArray(r.tag))t[r.tag.id]=r.class;else for(let o of r.tag)t[o.id]=r.class;let{scope:n,all:s=null}=e||{};return{style:r=>{let o=s;for(let a of r)for(let l of a.set){let h=t[l.id];if(h){o=o?o+" "+h:h;break}}return o},scope:n}}function GC(i,e){let t=null;for(let n of i){let s=n.style(e);s&&(t=t?t+" "+s:s)}return t}function $y(i,e,t,n=0,s=i.length){let r=new au(n,Array.isArray(e)?e:[e],t);r.highlightRange(i.cursor(),n,s,"",r.highlighters),r.flush(s)}var au=class{constructor(e,t,n){this.at=e,this.highlighters=t,this.span=n,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,n,s,r){let{type:o,from:a,to:l}=e;if(a>=n||l<=t)return;o.isTop&&(r=this.highlighters.filter(f=>!f.scope||f.scope(o)));let h=s,c=WC(e)||ks.empty,d=GC(r,c.tags);if(d&&(h&&(h+=" "),h+=d,c.mode==1&&(s+=(s?" ":"")+d)),this.startSpan(Math.max(t,a),h),c.opaque)return;let u=e.tree&&e.tree.prop(J.mounted);if(u&&u.overlay){let f=e.node.enter(u.overlay[0].from+a,1),g=this.highlighters.filter(p=>!p.scope||p.scope(u.tree.type)),C=e.firstChild();for(let p=0,k=a;;p++){let T=p<u.overlay.length?u.overlay[p]:null,M=T?T.from+a:l,L=Math.max(t,k),b=Math.min(n,M);if(L<b&&C)for(;e.from<b&&(this.highlightRange(e,L,b,s,r),this.startSpan(Math.min(b,e.to),h),!(e.to>=M||!e.nextSibling())););if(!T||M>n)break;k=T.to+a,k>t&&(this.highlightRange(f.cursor(),Math.max(t,T.from+a),Math.min(n,k),"",g),this.startSpan(Math.min(n,k),h))}C&&e.parent()}else if(e.firstChild()){u&&(s="");do if(!(e.to<=t)){if(e.from>=n)break;this.highlightRange(e,t,n,s,r),this.startSpan(Math.min(n,e.to),h)}while(e.nextSibling());e.parent()}}};function WC(i){let e=i.type.prop(Qy);for(;e&&e.context&&!i.matchContext(e.context);)e=e.next;return e||null}var z=zt.define,gl=z(),qi=z(),jy=z(qi),Uy=z(qi),en=z(),yl=z(en),ou=z(en),fi=z(),Dn=z(fi),di=z(),ui=z(),lu=z(),Yr=z(lu),bl=z(),G={comment:gl,lineComment:z(gl),blockComment:z(gl),docComment:z(gl),name:qi,variableName:z(qi),typeName:jy,tagName:z(jy),propertyName:Uy,attributeName:z(Uy),className:z(qi),labelName:z(qi),namespace:z(qi),macroName:z(qi),literal:en,string:yl,docString:z(yl),character:z(yl),attributeValue:z(yl),number:ou,integer:z(ou),float:z(ou),bool:z(en),regexp:z(en),escape:z(en),color:z(en),url:z(en),keyword:di,self:z(di),null:z(di),atom:z(di),unit:z(di),modifier:z(di),operatorKeyword:z(di),controlKeyword:z(di),definitionKeyword:z(di),moduleKeyword:z(di),operator:ui,derefOperator:z(ui),arithmeticOperator:z(ui),logicOperator:z(ui),bitwiseOperator:z(ui),compareOperator:z(ui),updateOperator:z(ui),definitionOperator:z(ui),typeOperator:z(ui),controlOperator:z(ui),punctuation:lu,separator:z(lu),bracket:Yr,angleBracket:z(Yr),squareBracket:z(Yr),paren:z(Yr),brace:z(Yr),content:fi,heading:Dn,heading1:z(Dn),heading2:z(Dn),heading3:z(Dn),heading4:z(Dn),heading5:z(Dn),heading6:z(Dn),contentSeparator:z(fi),list:z(fi),quote:z(fi),emphasis:z(fi),strong:z(fi),link:z(fi),monospace:z(fi),strikethrough:z(fi),inserted:z(),deleted:z(),changed:z(),invalid:z(),meta:bl,documentMeta:z(bl),annotation:z(bl),processingInstruction:z(bl),definition:zt.defineModifier("definition"),constant:zt.defineModifier("constant"),function:zt.defineModifier("function"),standard:zt.defineModifier("standard"),local:zt.defineModifier("local"),special:zt.defineModifier("special")};for(let i in G){let e=G[i];e instanceof zt&&(e.name=i)}var RE=hu([{tag:G.link,class:"tok-link"},{tag:G.heading,class:"tok-heading"},{tag:G.emphasis,class:"tok-emphasis"},{tag:G.strong,class:"tok-strong"},{tag:G.keyword,class:"tok-keyword"},{tag:G.atom,class:"tok-atom"},{tag:G.bool,class:"tok-bool"},{tag:G.url,class:"tok-url"},{tag:G.labelName,class:"tok-labelName"},{tag:G.inserted,class:"tok-inserted"},{tag:G.deleted,class:"tok-deleted"},{tag:G.literal,class:"tok-literal"},{tag:G.string,class:"tok-string"},{tag:G.number,class:"tok-number"},{tag:[G.regexp,G.escape,G.special(G.string)],class:"tok-string2"},{tag:G.variableName,class:"tok-variableName"},{tag:G.local(G.variableName),class:"tok-variableName tok-local"},{tag:G.definition(G.variableName),class:"tok-variableName tok-definition"},{tag:G.special(G.variableName),class:"tok-variableName2"},{tag:G.definition(G.propertyName),class:"tok-propertyName tok-definition"},{tag:G.typeName,class:"tok-typeName"},{tag:G.namespace,class:"tok-namespace"},{tag:G.className,class:"tok-className"},{tag:G.macroName,class:"tok-macroName"},{tag:G.propertyName,class:"tok-propertyName"},{tag:G.operator,class:"tok-operator"},{tag:G.comment,class:"tok-comment"},{tag:G.meta,class:"tok-meta"},{tag:G.invalid,class:"tok-invalid"},{tag:G.punctuation,class:"tok-punctuation"}]);var cu,Cs=new J;function DC(i){return Y.define({combine:i?e=>e.concat(i):void 0})}var NC=new J,gt=class{constructor(e,t,n=[],s=""){this.data=e,this.name=s,ce.prototype.hasOwnProperty("tree")||Object.defineProperty(ce.prototype,"tree",{get(){return qe(this)}}),this.parser=t,this.extension=[Ls.of(this),ce.languageData.of((r,o,a)=>{let l=qy(r,o,a),h=l.type.prop(Cs);if(!h)return[];let c=r.facet(h),d=l.type.prop(NC);if(d){let u=l.resolve(o-l.from,a);for(let f of d)if(f.test(u,r)){let g=r.facet(f.facet);return f.type=="replace"?g:g.concat(c)}}return c})].concat(n)}isActiveAt(e,t,n=-1){return qy(e,t,n).type.prop(Cs)==this.data}findRegions(e){let t=e.facet(Ls);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let n=[],s=(r,o)=>{if(r.prop(Cs)==this.data){n.push({from:o,to:o+r.length});return}let a=r.prop(J.mounted);if(a){if(a.tree.prop(Cs)==this.data){if(a.overlay)for(let l of a.overlay)n.push({from:l.from+o,to:l.to+o});else n.push({from:o,to:o+r.length});return}else if(a.overlay){let l=n.length;if(s(a.tree,a.overlay[0].from+o),n.length>l)return}}for(let l=0;l<r.children.length;l++){let h=r.children[l];h instanceof ve&&s(h,r.positions[l]+o)}};return s(qe(e),0),n}get allowsNesting(){return!0}};gt.setState=ee.define();function qy(i,e,t){let n=i.facet(Ls),s=qe(i).topNode;if(!n||n.allowsNesting)for(let r=s;r;r=r.enter(e,t,Ie.ExcludeBuffers))r.type.isTop&&(s=r);return s}function qe(i){let e=i.field(gt.state,!1);return e?e.tree:ve.empty}var pu=class{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let n=this.cursorPos-this.string.length;return e<n||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-n,t-n)}},Br=null,jr=class i{constructor(e,t,n=[],s,r,o,a,l){this.parser=e,this.state=t,this.fragments=n,this.tree=s,this.treeLen=r,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,n){return new i(e,t,[],ve.empty,0,n,[],null)}startParse(){return this.parser.startParse(new pu(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=ve.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(Wn.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Wn.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Br;Br=this;try{return e()}finally{Br=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=eb(e,t.from,t.to);return e}changes(e,t){let{fragments:n,tree:s,treeLen:r,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((h,c,d,u)=>l.push({fromA:h,toA:c,fromB:d,toB:u})),n=Wn.applyChanges(n,l),s=ve.empty,r=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),d=e.mapPos(h.to,-1);c<d&&a.push({from:c,to:d})}}}return new i(this.parser,t,n,s,r,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:s,to:r}=this.skipped[n];s<e.to&&r>e.from&&(this.fragments=eb(this.fragments,s,r),this.skipped.splice(n--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Kr{createParse(t,n,s){let r=s[0].from,o=s[s.length-1].to;return{parsedPos:r,advance(){let l=Br;if(l){for(let h of s)l.tempSkipped.push(h);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new ve($e.none,[],[],o-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Br}};function eb(i,e,t){return Wn.applyChanges(i,[{fromA:e,toA:t,fromB:e,toB:t}])}var Ur=class i{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,n)||t.takeTree(),new i(t)}static init(e){let t=Math.min(3e3,e.doc.length),n=jr.create(e.facet(Ls).parser,e,{from:0,to:t});return n.work(20,t)||n.takeTree(),new i(n)}};gt.state=Ze.define({create:Ur.init,update(i,e){for(let t of e.effects)if(t.is(gt.setState))return t.value;return e.startState.facet(Ls)!=e.state.facet(Ls)?Ur.init(e.state):i.apply(e)}});var rb=i=>{let e=setTimeout(()=>i(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(rb=i=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(i,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});var du=typeof navigator<"u"&&(!((cu=navigator.scheduling)===null||cu===void 0)&&cu.isInputPending)?()=>navigator.scheduling.isInputPending():null,AC=_e.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(gt.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(gt.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=rb(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:s}}=this.view,r=n.field(gt.state);if(r.tree==r.context.tree&&r.context.isDone(s+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!du?Math.max(25,e.timeRemaining()-5):1e9),a=r.context.treeLen<s&&n.doc.length>s+1e3,l=r.context.work(()=>du&&du()||Date.now()>o,s+(a?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:gt.setState.of(new Ur(r.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ft(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ls=Y.define({combine(i){return i.length?i[0]:null},enables:i=>[gt.state,AC,B.contentAttributes.compute([i],e=>{let t=e.facet(i);return t&&t.name?{"data-language":t.name}:{}})]});var HC=Y.define(),Qr=Y.define({combine:i=>{if(!i.length)return"  ";let e=i[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return e}});function Kt(i){let e=i.facet(Qr);return e.charCodeAt(0)==9?i.tabSize*e.length:e.length}function Ms(i,e){let t="",n=i.tabSize,s=i.facet(Qr)[0];if(s=="	"){for(;e>=n;)t+="	",e-=n;s=" "}for(let r=0;r<e;r++)t+=s;return t}function kl(i,e){i instanceof ce&&(i=new Nn(i));for(let n of i.state.facet(HC)){let s=n(i,e);if(s!==void 0)return s}let t=qe(i.state);return t.length>=e?OC(i,t,e):null}var Nn=class{constructor(e,t={}){this.state=e,this.options=t,this.unit=Kt(e)}lineAt(e,t=1){let n=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:r}=this.options;return s!=null&&s>=n.from&&s<=n.to?r&&s==e?{text:"",from:e}:(t<0?s<e:s<=e)?{text:n.text.slice(s-n.from),from:s}:{text:n.text.slice(0,s-n.from),from:n.from}:n}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:s}=this.lineAt(e,t);return n.slice(e-s,Math.min(n.length,e+100-s))}column(e,t=1){let{text:n,from:s}=this.lineAt(e,t),r=this.countColumn(n,e-s),o=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return o>-1&&(r+=o-this.countColumn(n,n.search(/\S|$/))),r}countColumn(e,t=e.length){return Yi(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:n,from:s}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let o=r(s);if(o>-1)return o}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},ob=new J;function OC(i,e,t){let n=e.resolveStack(t),s=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(s!=n.node){let r=[];for(let o=s;o&&!(o.from==n.node.from&&o.type==n.node.type);o=o.parent)r.push(o);for(let o=r.length-1;o>=0;o--)n={node:r[o],next:n}}return ab(n,i,t)}function ab(i,e,t){for(let n=i;n;n=n.next){let s=zC(n.node);if(s)return s(mu.create(e,t,n))}return 0}function VC(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function zC(i){let e=i.type.prop(ob);if(e)return e;let t=i.firstChild,n;if(t&&(n=t.type.prop(J.closedBy))){let s=i.lastChild,r=s&&n.indexOf(s.name)>-1;return o=>BC(o,!0,1,void 0,r&&!VC(o)?s.from:void 0)}return i.parent==null?FC:null}function FC(){return 0}var mu=class i extends Nn{constructor(e,t,n){super(e.state,e.options),this.base=e,this.pos=t,this.context=n}get node(){return this.context.node}static create(e,t,n){return new i(e,t,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let n=e.resolve(t.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(KC(n,e))break;t=this.state.doc.lineAt(n.from)}return this.lineIndent(t.from)}continue(){return ab(this.context.next,this.base,this.pos)}};function KC(i,e){for(let t=e;t;t=t.parent)if(i==t)return!0;return!1}function YC(i){let e=i.node,t=e.childAfter(e.from),n=e.lastChild;if(!t)return null;let s=i.options.simulateBreak,r=i.state.doc.lineAt(t.from),o=s==null||s<=r.from?r.to:Math.min(r.to,s);for(let a=t.to;;){let l=e.childAfter(a);if(!l||l==n)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let h=/^ */.exec(r.text.slice(t.to-r.from))[0].length;return{from:t.from,to:t.to+h}}a=l.to}}function BC(i,e,t,n,s){let r=i.textAfter,o=r.match(/^\s*/)[0].length,a=n&&r.slice(o,o+n.length)==n||s==i.pos+o,l=e?YC(i):null;return l?a?i.column(l.from):i.column(l.to):i.baseIndent+(a?0:i.unit*t)}var jC=200;function xu(){return ce.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let e=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!e.length)return i;let t=i.newDoc,{head:n}=i.newSelection.main,s=t.lineAt(n);if(n>s.from+jC)return i;let r=t.sliceString(s.from,n);if(!e.some(h=>h.test(r)))return i;let{state:o}=i,a=-1,l=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==a)continue;a=c.from;let d=kl(o,c.from);if(d==null)continue;let u=/^\s*/.exec(c.text)[0],f=Ms(o,d);u!=f&&l.push({from:c.from,to:c.from+u.length,insert:f})}return l.length?[i,{changes:l,sequential:!0}]:i})}var Ts=class i{constructor(e,t){this.specs=e;let n;function s(a){let l=Mt.newName();return(n||(n=Object.create(null)))["."+l]=a,l}let r=typeof t.all=="string"?t.all:t.all?s(t.all):void 0,o=t.scope;this.scope=o instanceof gt?a=>a.prop(Cs)==o.data:o?a=>a==o:void 0,this.style=hu(e.map(a=>({tag:a.tag,class:a.class||s(Object.assign({},a,{tag:null}))})),{all:r}).style,this.module=n?new Mt(n):null,this.themeType=t.themeType}static define(e,t){return new i(e,t||{})}},gu=Y.define(),lb=Y.define({combine(i){return i.length?[i[0]]:null}});function uu(i){let e=i.facet(gu);return e.length?e:i.facet(lb)}function Cl(i,e){let t=[UC],n;return i instanceof Ts&&(i.module&&t.push(B.styleModule.of(i.module)),n=i.themeType),e?.fallback?t.push(lb.of(i)):n?t.push(gu.computeN([B.darkTheme],s=>s.facet(B.darkTheme)==(n=="dark")?[i]:[])):t.push(gu.of(i)),t}var yu=class{constructor(e){this.markCache=Object.create(null),this.tree=qe(e.state),this.decorations=this.buildDeco(e,uu(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=qe(e.state),n=uu(e.state),s=n!=uu(e.startState),{viewport:r}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!s&&t.type==this.tree.type&&o>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,n),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return ne.none;let n=new Tt;for(let{from:s,to:r}of e.visibleRanges)$y(this.tree,t,(o,a,l)=>{n.add(o,a,this.markCache[l]||(this.markCache[l]=ne.mark({class:l})))},s,r);return n.finish()}},UC=Ot.high(_e.fromClass(yu,{decorations:i=>i.decorations})),hb=Ts.define([{tag:G.meta,color:"#404740"},{tag:G.link,textDecoration:"underline"},{tag:G.heading,textDecoration:"underline",fontWeight:"bold"},{tag:G.emphasis,fontStyle:"italic"},{tag:G.strong,fontWeight:"bold"},{tag:G.strikethrough,textDecoration:"line-through"},{tag:G.keyword,color:"#708"},{tag:[G.atom,G.bool,G.url,G.contentSeparator,G.labelName],color:"#219"},{tag:[G.literal,G.inserted],color:"#164"},{tag:[G.string,G.deleted],color:"#a11"},{tag:[G.regexp,G.escape,G.special(G.string)],color:"#e40"},{tag:G.definition(G.variableName),color:"#00f"},{tag:G.local(G.variableName),color:"#30a"},{tag:[G.typeName,G.namespace],color:"#085"},{tag:G.className,color:"#167"},{tag:[G.special(G.variableName),G.macroName],color:"#256"},{tag:G.definition(G.propertyName),color:"#00c"},{tag:G.comment,color:"#940"},{tag:G.invalid,color:"#f00"}]),JC=B.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),cb=1e4,db="()[]{}",ub=Y.define({combine(i){return ut(i,{afterCursor:!0,brackets:db,maxScanDistance:cb,renderMatch:qC})}}),QC=ne.mark({class:"cm-matchingBracket"}),$C=ne.mark({class:"cm-nonmatchingBracket"});function qC(i){let e=[],t=i.matched?QC:$C;return e.push(t.range(i.start.from,i.start.to)),i.end&&e.push(t.range(i.end.from,i.end.to)),e}var eL=Ze.define({create(){return ne.none},update(i,e){if(!e.docChanged&&!e.selection)return i;let t=[],n=e.state.facet(ub);for(let s of e.state.selection.ranges){if(!s.empty)continue;let r=Ft(e.state,s.head,-1,n)||s.head>0&&Ft(e.state,s.head-1,1,n)||n.afterCursor&&(Ft(e.state,s.head,1,n)||s.head<e.state.doc.length&&Ft(e.state,s.head+1,-1,n));r&&(t=t.concat(n.renderMatch(r,e.state)))}return ne.set(t,!0)},provide:i=>B.decorations.from(i)}),tL=[eL,JC];function Su(i={}){return[ub.of(i),tL]}var iL=new J;function bu(i,e,t){let n=i.prop(e<0?J.openedBy:J.closedBy);if(n)return n;if(i.name.length==1){let s=t.indexOf(i.name);if(s>-1&&s%2==(e<0?1:0))return[t[s+e]]}return null}function wu(i){let e=i.type.prop(iL);return e?e(i.node):i}function Ft(i,e,t,n={}){let s=n.maxScanDistance||cb,r=n.brackets||db,o=qe(i),a=o.resolveInner(e,t);for(let l=a;l;l=l.parent){let h=bu(l.type,t,r);if(h&&l.from<l.to){let c=wu(l);if(c&&(t>0?e>=c.from&&e<c.to:e>c.from&&e<=c.to))return nL(i,e,t,l,c,h,r)}}return sL(i,e,t,o,a.type,s,r)}function nL(i,e,t,n,s,r,o){let a=n.parent,l={from:s.from,to:s.to},h=0,c=a?.cursor();if(c&&(t<0?c.childBefore(n.from):c.childAfter(n.to)))do if(t<0?c.to<=n.from:c.from>=n.to){if(h==0&&r.indexOf(c.type.name)>-1&&c.from<c.to){let d=wu(c);return{start:l,end:d?{from:d.from,to:d.to}:void 0,matched:!0}}else if(bu(c.type,t,o))h++;else if(bu(c.type,-t,o)){if(h==0){let d=wu(c);return{start:l,end:d&&d.from<d.to?{from:d.from,to:d.to}:void 0,matched:!1}}h--}}while(t<0?c.prevSibling():c.nextSibling());return{start:l,matched:!1}}function sL(i,e,t,n,s,r,o){let a=t<0?i.sliceDoc(e-1,e):i.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=t>0)return null;let h={from:t<0?e-1:e,to:t>0?e+1:e},c=i.doc.iterRange(e,t>0?i.doc.length:0),d=0;for(let u=0;!c.next().done&&u<=r;){let f=c.value;t<0&&(u+=f.length);let g=e+u*t;for(let C=t>0?0:f.length-1,p=t>0?f.length:-1;C!=p;C+=t){let k=o.indexOf(f[C]);if(!(k<0||n.resolveInner(g+C,1).type!=s))if(k%2==0==t>0)d++;else{if(d==1)return{start:h,end:{from:g+C,to:g+C+1},matched:k>>1==l>>1};d--}}t>0&&(u+=f.length)}return c.done?{start:h,matched:!1}:null}function tb(i,e,t,n=0,s=0){e==null&&(e=i.search(/[^\s\u00a0]/),e==-1&&(e=i.length));let r=s;for(let o=n;o<e;o++)i.charCodeAt(o)==9?r+=t-r%t:r++;return r}var vl=class{constructor(e,t,n,s){this.string=e,this.tabSize=t,this.indentUnit=n,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),n;if(typeof e=="string"?n=t==e:n=t&&(e instanceof RegExp?e.test(t):e(t)),n)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=tb(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:tb(this.string,null,this.tabSize)}match(e,t,n){if(typeof e=="string"){let s=o=>n?o.toLowerCase():o,r=this.string.substr(this.pos,e.length);return s(r)==s(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&t!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}};function rL(i){return{name:i.name||"",token:i.token,blankLine:i.blankLine||(()=>{}),startState:i.startState||(()=>!0),copyState:i.copyState||oL,indent:i.indent||(()=>null),languageData:i.languageData||{},tokenTable:i.tokenTable||Cu}}function oL(i){if(typeof i!="object")return i;let e={};for(let t in i){let n=i[t];e[t]=n instanceof Array?n.slice():n}return e}var ib=new WeakMap,xl=class i extends gt{constructor(e){let t=DC(e.languageData),n=rL(e),s,r=new class extends Kr{createParse(o,a,l){return new vu(s,o,a,l)}};super(t,r,[],e.name),this.topNode=cL(t,this),s=this,this.streamParser=n,this.stateAfter=new J({perNode:!0}),this.tokenTable=e.tokenTable?new Sl(n.tokenTable):hL}static define(e){return new i(e)}getIndent(e){let t,{overrideIndentation:n}=e.options;n&&(t=ib.get(e.state),t!=null&&t<e.pos-1e4&&(t=void 0));let s=ku(this,e.node.tree,e.node.from,e.node.from,t??e.pos),r,o;if(s?(o=s.state,r=s.pos+1):(o=this.streamParser.startState(e.unit),r=e.node.from),e.pos-r>1e4)return null;for(;r<e.pos;){let l=e.state.doc.lineAt(r),h=Math.min(e.pos,l.to);if(l.length){let c=n?n(l.from):-1,d=new vl(l.text,e.state.tabSize,e.unit,c<0?void 0:c);for(;d.pos<h-l.from;)pb(this.streamParser.token,d,o)}else this.streamParser.blankLine(o,e.unit);if(h==e.pos)break;r=l.to+1}let a=e.lineAt(e.pos);return n&&t==null&&ib.set(e.state,a.from),this.streamParser.indent(o,/^\s*(.*)/.exec(a.text)[1],e)}get allowsNesting(){return!1}};function ku(i,e,t,n,s){let r=t>=n&&t+e.length<=s&&e.prop(i.stateAfter);if(r)return{state:i.streamParser.copyState(r),pos:t+e.length};for(let o=e.children.length-1;o>=0;o--){let a=e.children[o],l=t+e.positions[o],h=a instanceof ve&&l<s&&ku(i,a,l,n,s);if(h)return h}return null}function fb(i,e,t,n,s){if(s&&t<=0&&n>=e.length)return e;!s&&t==0&&e.type==i.topNode&&(s=!0);for(let r=e.children.length-1;r>=0;r--){let o=e.positions[r],a=e.children[r],l;if(o<n&&a instanceof ve){if(!(l=fb(i,a,t-o,n-o,s)))break;return s?new ve(e.type,e.children.slice(0,r).concat(l),e.positions.slice(0,r+1),o+l.length):l}}return null}function aL(i,e,t,n,s){for(let r of e){let o=r.from+(r.openStart?25:0),a=r.to-(r.openEnd?25:0),l=o<=t&&a>t&&ku(i,r.tree,0-r.offset,t,a),h;if(l&&l.pos<=n&&(h=fb(i,r.tree,t+r.offset,l.pos+r.offset,!1)))return{state:l.state,tree:h}}return{state:i.streamParser.startState(s?Kt(s):4),tree:ve.empty}}var vu=class{constructor(e,t,n,s){this.lang=e,this.input=t,this.fragments=n,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let r=jr.get(),o=s[0].from,{state:a,tree:l}=aL(e,n,o,this.to,r?.state);this.state=a,this.parsedPos=this.chunkStart=o+l.length;for(let h=0;h<l.children.length;h++)this.chunks.push(l.children[h]),this.chunkPos.push(l.positions[h]);r&&this.parsedPos<r.viewport.from-1e5&&s.some(h=>h.from<=r.viewport.from&&h.to>=r.viewport.from)&&(this.state=this.lang.streamParser.startState(Kt(r.state)),r.skipUntilInView(this.parsedPos,r.viewport.from),this.parsedPos=r.viewport.from),this.moveRangeIndex()}advance(){let e=jr.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),n=Math.min(t,this.chunkStart+2048);for(e&&(n=Math.min(n,e.viewport.to));this.parsedPos<n;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let n=t.indexOf(`
`);n>-1&&(t=t.slice(0,n))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),n=e+t.length;for(let s=this.rangeIndex;;){let r=this.ranges[s].to;if(r>=n||(t=t.slice(0,r-(n-t.length)),s++,s==this.ranges.length))break;let o=this.ranges[s].from,a=this.lineAfter(o);t+=a,n=o+a.length}return{line:t,end:n}}skipGapsTo(e,t,n){for(;;){let s=this.ranges[this.rangeIndex].to,r=e+t;if(n>0?s>r:s>=r)break;let o=this.ranges[++this.rangeIndex].from;t+=o-s}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,n,s){let r=4;if(this.ranges.length>1){s=this.skipGapsTo(t,s,1),t+=s;let a=this.chunk.length;s=this.skipGapsTo(n,s,-1),n+=s,r+=this.chunk.length-a}let o=this.chunk.length-4;return r==4&&o>=0&&this.chunk[o]==e&&this.chunk[o+2]==t?this.chunk[o+2]=n:this.chunk.push(e,t,n,r),s}parseLine(e){let{line:t,end:n}=this.nextLine(),s=0,{streamParser:r}=this.lang,o=new vl(t,e?e.state.tabSize:4,e?Kt(e.state):2);if(o.eol())r.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let a=pb(r.token,o,this.state);if(a&&(s=this.emitToken(this.lang.tokenTable.resolve(a),this.parsedPos+o.start,this.parsedPos+o.pos,s)),o.start>1e4)break}this.parsedPos=n,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=ve.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:lL,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new ve(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new ve(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}};function pb(i,e,t){e.start=e.pos;for(let n=0;n<10;n++){let s=i(e,t);if(e.pos>e.start)return s}throw new Error("Stream parser failed to advance stream.")}var Cu=Object.create(null),Jr=[$e.none],lL=new pl(Jr),nb=[],sb=Object.create(null),mb=Object.create(null);for(let[i,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])mb[i]=gb(Cu,e);var Sl=class{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),mb)}resolve(e){return e?this.table[e]||(this.table[e]=gb(this.extra,e)):0}},hL=new Sl(Cu);function fu(i,e){nb.indexOf(i)>-1||(nb.push(i),console.warn(e))}function gb(i,e){let t=[];for(let a of e.split(" ")){let l=[];for(let h of a.split(".")){let c=i[h]||G[h];c?typeof c=="function"?l.length?l=l.map(c):fu(h,`Modifier ${h} used at start of tag`):l.length?fu(h,`Tag ${h} used as modifier`):l=Array.isArray(c)?c:[c]:fu(h,`Unknown highlighting tag ${h}`)}for(let h of l)t.push(h)}if(!t.length)return 0;let n=e.replace(/ /g,"_"),s=n+" "+t.map(a=>a.id),r=sb[s];if(r)return r.id;let o=sb[s]=$e.define({id:Jr.length,name:n,props:[Jy({[n]:t})]});return Jr.push(o),o.id}function cL(i,e){let t=$e.define({id:Jr.length,name:"Document",props:[Cs.add(()=>i),ob.add(()=>n=>e.getIndent(n))],top:!0});return Jr.push(t),t}var NE={rtl:ne.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"rtl"},bidiIsolate:ae.RTL}),ltr:ne.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"ltr"},bidiIsolate:ae.LTR}),auto:ne.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"auto"},bidiIsolate:null})};var El=i=>{let{state:e}=i,t=e.doc.lineAt(e.selection.main.from),n=Pu(i.state,t.from);return n.line?dL(i):n.block?fL(i):!1};function Mu(i,e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let s=i(e,t);return s?(n(t.update(s)),!0):!1}}var dL=Mu(gL,0);var uL=Mu(bb,0);var fL=Mu((i,e)=>bb(i,e,mL(e)),0);function Pu(i,e){let t=i.languageDataAt("commentTokens",e);return t.length?t[0]:{}}var $r=50;function pL(i,{open:e,close:t},n,s){let r=i.sliceDoc(n-$r,n),o=i.sliceDoc(s,s+$r),a=/\s*$/.exec(r)[0].length,l=/^\s*/.exec(o)[0].length,h=r.length-a;if(r.slice(h-e.length,h)==e&&o.slice(l,l+t.length)==t)return{open:{pos:n-a,margin:a&&1},close:{pos:s+l,margin:l&&1}};let c,d;s-n<=2*$r?c=d=i.sliceDoc(n,s):(c=i.sliceDoc(n,n+$r),d=i.sliceDoc(s-$r,s));let u=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(d)[0].length,g=d.length-f-t.length;return c.slice(u,u+e.length)==e&&d.slice(g,g+t.length)==t?{open:{pos:n+u+e.length,margin:/\s/.test(c.charAt(u+e.length))?1:0},close:{pos:s-f-t.length,margin:/\s/.test(d.charAt(g-1))?1:0}}:null}function mL(i){let e=[];for(let t of i.selection.ranges){let n=i.doc.lineAt(t.from),s=t.to<=n.to?n:i.doc.lineAt(t.to);s.from>n.from&&s.from==t.to&&(s=t.to==n.to+1?n:i.doc.lineAt(t.to-1));let r=e.length-1;r>=0&&e[r].to>n.from?e[r].to=s.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:s.to})}return e}function bb(i,e,t=e.selection.ranges){let n=t.map(r=>Pu(e,r.from).block);if(!n.every(r=>r))return null;let s=t.map((r,o)=>pL(e,n[o],r.from,r.to));if(i!=2&&!s.every(r=>r))return{changes:e.changes(t.map((r,o)=>s[o]?[]:[{from:r.from,insert:n[o].open+" "},{from:r.to,insert:" "+n[o].close}]))};if(i!=1&&s.some(r=>r)){let r=[];for(let o=0,a;o<s.length;o++)if(a=s[o]){let l=n[o],{open:h,close:c}=a;r.push({from:h.pos-l.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:r}}return null}function gL(i,e,t=e.selection.ranges){let n=[],s=-1;for(let{from:r,to:o}of t){let a=n.length,l=1e9,h=Pu(e,r).line;if(h){for(let c=r;c<=o;){let d=e.doc.lineAt(c);if(d.from>s&&(r==o||o>d.from)){s=d.from;let u=/^\s*/.exec(d.text)[0].length,f=u==d.length,g=d.text.slice(u,u+h.length)==h?u:-1;u<d.text.length&&u<l&&(l=u),n.push({line:d,comment:g,token:h,indent:u,empty:f,single:!1})}c=d.to+1}if(l<1e9)for(let c=a;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=l);n.length==a+1&&(n[a].single=!0)}}if(i!=2&&n.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:a,token:l,indent:h,empty:c,single:d}of n)(d||!c)&&r.push({from:a.from+h,insert:l+" "});let o=e.changes(r);return{changes:o,selection:e.selection.map(o,1)}}else if(i!=1&&n.some(r=>r.comment>=0)){let r=[];for(let{line:o,comment:a,token:l}of n)if(a>=0){let h=o.from+a,c=h+l.length;o.text[c-o.from]==" "&&c++,r.push({from:h,to:c})}return{changes:r}}return null}var Tu=st.define(),yL=st.define(),bL=Y.define(),wb=Y.define({combine(i){return ut(i,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(n,s)=>e(n,s)||t(n,s)})}}),vb=Ze.define({create(){return An.empty},update(i,e){let t=e.state.facet(wb),n=e.annotation(Tu);if(n){let l=Yt.fromTransaction(e,n.selection),h=n.side,c=h==0?i.undone:i.done;return l?c=Tl(c,c.length,t.minDepth,l):c=kb(c,e.startState.selection),new An(h==0?n.rest:c,h==0?c:n.rest)}let s=e.annotation(yL);if((s=="full"||s=="before")&&(i=i.isolate()),e.annotation(Re.addToHistory)===!1)return e.changes.empty?i:i.addMapping(e.changes.desc);let r=Yt.fromTransaction(e),o=e.annotation(Re.time),a=e.annotation(Re.userEvent);return r?i=i.addChanges(r,o,a,t,e):e.selection&&(i=i.addSelection(e.startState.selection,o,a,t.newGroupDelay)),(s=="full"||s=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(e=>e.toJSON()),undone:i.undone.map(e=>e.toJSON())}},fromJSON(i){return new An(i.done.map(Yt.fromJSON),i.undone.map(Yt.fromJSON))}});function xb(i={}){return[vb,wb.of(i),B.domEventHandlers({beforeinput(e,t){let n=e.inputType=="historyUndo"?_l:e.inputType=="historyRedo"?qr:null;return n?(e.preventDefault(),n(t)):!1}})]}function Xl(i,e){return function({state:t,dispatch:n}){if(!e&&t.readOnly)return!1;let s=t.field(vb,!1);if(!s)return!1;let r=s.pop(i,t,e);return r?(n(r),!0):!1}}var _l=Xl(0,!1),qr=Xl(1,!1),wL=Xl(0,!0),vL=Xl(1,!0);var Yt=class i{constructor(e,t,n,s,r){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=s,this.selectionsAfter=r}setSelAfter(e){return new i(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new i(e.changes&&Je.fromJSON(e.changes),[],e.mapped&&Li.fromJSON(e.mapped),e.startSelection&&H.fromJSON(e.startSelection),e.selectionsAfter.map(H.fromJSON))}static fromTransaction(e,t){let n=Zt;for(let s of e.startState.facet(bL)){let r=s(e);r.length&&(n=n.concat(r))}return!n.length&&e.changes.empty?null:new i(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,Zt)}static selection(e){return new i(void 0,Zt,void 0,void 0,e)}};function Tl(i,e,t,n){let s=e+1>t+20?e-t-1:0,r=i.slice(s,e);return r.push(n),r}function xL(i,e){let t=[],n=!1;return i.iterChangedRanges((s,r)=>t.push(s,r)),e.iterChangedRanges((s,r,o,a)=>{for(let l=0;l<t.length;){let h=t[l++],c=t[l++];a>=h&&o<=c&&(n=!0)}}),n}function SL(i,e){return i.ranges.length==e.ranges.length&&i.ranges.filter((t,n)=>t.empty!=e.ranges[n].empty).length===0}function Sb(i,e){return i.length?e.length?i.concat(e):i:e}var Zt=[],kL=200;function kb(i,e){if(i.length){let t=i[i.length-1],n=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-kL));return n.length&&n[n.length-1].eq(e)?i:(n.push(e),Tl(i,i.length-1,1e9,t.setSelAfter(n)))}else return[Yt.selection([e])]}function CL(i){let e=i[i.length-1],t=i.slice();return t[i.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Lu(i,e){if(!i.length)return i;let t=i.length,n=Zt;for(;t;){let s=LL(i[t-1],e,n);if(s.changes&&!s.changes.empty||s.effects.length){let r=i.slice(0,t);return r[t-1]=s,r}else e=s.mapped,t--,n=s.selectionsAfter}return n.length?[Yt.selection(n)]:Zt}function LL(i,e,t){let n=Sb(i.selectionsAfter.length?i.selectionsAfter.map(a=>a.map(e)):Zt,t);if(!i.changes)return Yt.selection(n);let s=i.changes.map(e),r=e.mapDesc(i.changes,!0),o=i.mapped?i.mapped.composeDesc(r):r;return new Yt(s,ee.mapEffects(i.effects,e),o,i.startSelection.map(r),n)}var TL=/^(input\.type|delete)($|\.)/,An=class i{constructor(e,t,n=0,s=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=s}isolate(){return this.prevTime?new i(this.done,this.undone):this}addChanges(e,t,n,s,r){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!n||TL.test(n))&&(!a.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(r,xL(a.changes,e.changes))||n=="input.type.compose")?o=Tl(o,o.length-1,s.minDepth,new Yt(e.changes.compose(a.changes),Sb(ee.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,Zt)):o=Tl(o,o.length,s.minDepth,e),new i(o,Zt,t,n)}addSelection(e,t,n,s){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:Zt;return r.length>0&&t-this.prevTime<s&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&SL(r[r.length-1],e)?this:new i(kb(this.done,e),this.undone,t,n)}addMapping(e){return new i(Lu(this.done,e),Lu(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let s=e==0?this.done:this.undone;if(s.length==0)return null;let r=s[s.length-1],o=r.selectionsAfter[0]||t.selection;if(n&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:Tu.of({side:e,rest:CL(s),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let a=s.length==1?Zt:s.slice(0,s.length-1);return r.mapped&&(a=Lu(a,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:Tu.of({side:e,rest:a,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};An.empty=new An(Zt,Zt);var Cb=[{key:"Mod-z",run:_l,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:qr,preventDefault:!0},{linux:"Ctrl-Shift-z",run:qr,preventDefault:!0},{key:"Mod-u",run:wL,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:vL,preventDefault:!0}];function Rs(i,e){return H.create(i.ranges.map(e),i.mainIndex)}function pi(i,e){return i.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Bt({state:i,dispatch:e},t){let n=Rs(i.selection,t);return n.eq(i.selection,!0)?!1:(e(pi(i,n)),!0)}function Il(i,e){return H.cursor(e?i.to:i.from)}function Gl(i,e){return Bt(i,t=>t.empty?i.moveByChar(t,e):Il(t,e))}function Fe(i){return i.textDirectionAt(i.state.selection.main.head)==ae.LTR}var Lb=i=>Gl(i,!Fe(i)),Tb=i=>Gl(i,Fe(i)),Mb=i=>Gl(i,!0),Pb=i=>Gl(i,!1);function Rb(i,e){return Bt(i,t=>t.empty?i.moveByGroup(t,e):Il(t,e))}var Ru=i=>Rb(i,!Fe(i)),Zu=i=>Rb(i,Fe(i));var YE=typeof Intl<"u"&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null;function ML(i,e,t){if(e.type.prop(t))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(i.sliceDoc(e.from,e.to)))||e.firstChild}function Wl(i,e,t){let n=qe(i).resolveInner(e.head),s=t?J.closedBy:J.openedBy;for(let l=e.head;;){let h=t?n.childAfter(l):n.childBefore(l);if(!h)break;ML(i,h,s)?n=h:l=t?h.to:h.from}let r=n.type.prop(s),o,a;return r&&(o=t?Ft(i,n.from,1):Ft(i,n.to,-1))&&o.matched?a=t?o.end.to:o.end.from:a=t?n.to:n.from,H.cursor(a,t?-1:1)}var PL=i=>Bt(i,e=>Wl(i.state,e,!Fe(i))),RL=i=>Bt(i,e=>Wl(i.state,e,Fe(i)));function Zb(i,e){return Bt(i,t=>{if(!t.empty)return Il(t,e);let n=i.moveVertically(t,e);return n.head!=t.head?n:i.moveToLineBoundary(t,e)})}var Dl=i=>Zb(i,!1),Nl=i=>Zb(i,!0);function Eb(i){let e=i.scrollDOM.clientHeight<i.scrollDOM.scrollHeight-2,t=0,n=0,s;if(e){for(let r of i.state.facet(B.scrollMargins)){let o=r(i);o?.top&&(t=Math.max(o?.top,t)),o?.bottom&&(n=Math.max(o?.bottom,n))}s=i.scrollDOM.clientHeight-t-n}else s=(i.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:n,selfScroll:e,height:Math.max(i.defaultLineHeight,s-5)}}function Xb(i,e){let t=Eb(i),{state:n}=i,s=Rs(n.selection,o=>o.empty?i.moveVertically(o,e,t.height):Il(o,e));if(s.eq(n.selection))return!1;let r;if(t.selfScroll){let o=i.coordsAtPos(n.selection.main.head),a=i.scrollDOM.getBoundingClientRect(),l=a.top+t.marginTop,h=a.bottom-t.marginBottom;o&&o.top>l&&o.bottom<h&&(r=B.scrollIntoView(s.main.head,{y:"start",yMargin:o.top-l}))}return i.dispatch(pi(n,s),{effects:r}),!0}var Ml=i=>Xb(i,!1),eo=i=>Xb(i,!0);function tn(i,e,t){let n=i.lineBlockAt(e.head),s=i.moveToLineBoundary(e,t);if(s.head==e.head&&s.head!=(t?n.to:n.from)&&(s=i.moveToLineBoundary(e,t,!1)),!t&&s.head==n.from&&n.length){let r=/^\s*/.exec(i.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;r&&e.head!=n.from+r&&(s=H.cursor(n.from+r))}return s}var ZL=i=>Bt(i,e=>tn(i,e,!0)),EL=i=>Bt(i,e=>tn(i,e,!1)),XL=i=>Bt(i,e=>tn(i,e,!Fe(i))),_L=i=>Bt(i,e=>tn(i,e,Fe(i))),Eu=i=>Bt(i,e=>H.cursor(i.lineBlockAt(e.head).from,1)),Xu=i=>Bt(i,e=>H.cursor(i.lineBlockAt(e.head).to,-1));function IL(i,e,t){let n=!1,s=Rs(i.selection,r=>{let o=Ft(i,r.head,-1)||Ft(i,r.head,1)||r.head>0&&Ft(i,r.head-1,1)||r.head<i.doc.length&&Ft(i,r.head+1,-1);if(!o||!o.end)return r;n=!0;let a=o.start.from==r.head?o.end.to:o.end.from;return t?H.range(r.anchor,a):H.cursor(a)});return n?(e(pi(i,s)),!0):!1}var GL=({state:i,dispatch:e})=>IL(i,e,!1);function Et(i,e){let t=Rs(i.state.selection,n=>{let s=e(n);return H.range(n.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return t.eq(i.state.selection)?!1:(i.dispatch(pi(i.state,t)),!0)}function Al(i,e){return Et(i,t=>i.moveByChar(t,e))}var _b=i=>Al(i,!Fe(i)),Ib=i=>Al(i,Fe(i)),_u=i=>Al(i,!0),Iu=i=>Al(i,!1);function Hl(i,e){return Et(i,t=>i.moveByGroup(t,e))}var Gu=i=>Hl(i,!Fe(i)),Wu=i=>Hl(i,Fe(i)),Gb=i=>Hl(i,!0),Wb=i=>Hl(i,!1);var WL=i=>Et(i,e=>Wl(i.state,e,!Fe(i))),DL=i=>Et(i,e=>Wl(i.state,e,Fe(i)));function Db(i,e){return Et(i,t=>i.moveVertically(t,e))}var so=i=>Db(i,!1),ro=i=>Db(i,!0);function Nb(i,e){return Et(i,t=>i.moveVertically(t,e,Eb(i).height))}var Pl=i=>Nb(i,!1),Ps=i=>Nb(i,!0),NL=i=>Et(i,e=>tn(i,e,!0)),AL=i=>Et(i,e=>tn(i,e,!1)),HL=i=>Et(i,e=>tn(i,e,!Fe(i))),OL=i=>Et(i,e=>tn(i,e,Fe(i))),Ol=i=>Et(i,e=>H.cursor(i.lineBlockAt(e.head).from)),Vl=i=>Et(i,e=>H.cursor(i.lineBlockAt(e.head).to)),Rl=({state:i,dispatch:e})=>(e(pi(i,{anchor:0})),!0),Zl=({state:i,dispatch:e})=>(e(pi(i,{anchor:i.doc.length})),!0),to=({state:i,dispatch:e})=>(e(pi(i,{anchor:i.selection.main.anchor,head:0})),!0),io=({state:i,dispatch:e})=>(e(pi(i,{anchor:i.selection.main.anchor,head:i.doc.length})),!0),Du=({state:i,dispatch:e})=>(e(i.update({selection:{anchor:0,head:i.doc.length},userEvent:"select"})),!0),VL=({state:i,dispatch:e})=>{let t=Kl(i).map(({from:n,to:s})=>H.range(n,Math.min(s+1,i.doc.length)));return e(i.update({selection:H.create(t),userEvent:"select"})),!0},zL=({state:i,dispatch:e})=>{let t=Rs(i.selection,n=>{let s=qe(i),r=s.resolveStack(n.from,1);if(n.empty){let o=s.resolveStack(n.from,-1);o.node.from>=r.node.from&&o.node.to<=r.node.to&&(r=o)}for(let o=r;o;o=o.next){let{node:a}=o;if((a.from<n.from&&a.to>=n.to||a.to>n.to&&a.from<=n.from)&&o.next)return H.range(a.to,a.from)}return n});return t.eq(i.selection)?!1:(e(pi(i,t)),!0)},Ab=({state:i,dispatch:e})=>{let t=i.selection,n=null;return t.ranges.length>1?n=H.create([t.main]):t.main.empty||(n=H.create([H.cursor(t.main.head)])),n?(e(pi(i,n)),!0):!1};function oo(i,e){if(i.state.readOnly)return!1;let t="delete.selection",{state:n}=i,s=n.changeByRange(r=>{let{from:o,to:a}=r;if(o==a){let l=e(r);l<o?(t="delete.backward",l=Ll(i,l,!1)):l>o&&(t="delete.forward",l=Ll(i,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=Ll(i,o,!1),a=Ll(i,a,!0);return o==a?{range:r}:{changes:{from:o,to:a},range:H.cursor(o,o<r.head?-1:1)}});return s.changes.empty?!1:(i.dispatch(n.update(s,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?B.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function Ll(i,e,t){if(i instanceof B)for(let n of i.state.facet(B.atomicRanges).map(s=>s(i)))n.between(e,e,(s,r)=>{s<e&&r>e&&(e=t?r:s)});return e}var Hb=(i,e,t)=>oo(i,n=>{let s=n.from,{state:r}=i,o=r.doc.lineAt(s),a,l;if(t&&!e&&s>o.from&&s<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,s-o.from))){if(a[a.length-1]=="	")return s-1;let h=Yi(a,r.tabSize),c=h%Kt(r)||Kt(r);for(let d=0;d<c&&a[a.length-1-d]==" ";d++)s--;l=s}else l=Te(o.text,s-o.from,e,e)+o.from,l==s&&o.number!=(e?r.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,s-o.from))&&(l=Te(o.text,l-o.from,!1,!1)+o.from);return l}),no=i=>Hb(i,!1,!0);var zl=i=>Hb(i,!0,!1),Ob=(i,e)=>oo(i,t=>{let n=t.head,{state:s}=i,r=s.doc.lineAt(n),o=s.charCategorizer(n);for(let a=null;;){if(n==(e?r.to:r.from)){n==t.head&&r.number!=(e?s.doc.lines:1)&&(n+=e?1:-1);break}let l=Te(r.text,n-r.from,e)+r.from,h=r.text.slice(Math.min(n,l)-r.from,Math.max(n,l)-r.from),c=o(h);if(a!=null&&c!=a)break;(h!=" "||n!=t.head)&&(a=c),n=l}return n}),Vb=i=>Ob(i,!1),FL=i=>Ob(i,!0),KL=i=>oo(i,e=>{let t=i.lineBlockAt(e.head).to;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)});var YL=i=>oo(i,e=>{let t=i.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),BL=i=>oo(i,e=>{let t=i.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(i.state.doc.length,e.head+1)});var Fl=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:ie.of(["",""])},range:H.cursor(n.from)}));return e(i.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},Nu=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(n=>{if(!n.empty||n.from==0||n.from==i.doc.length)return{range:n};let s=n.from,r=i.doc.lineAt(s),o=s==r.from?s-1:Te(r.text,s-r.from,!1)+r.from,a=s==r.to?s+1:Te(r.text,s-r.from,!0)+r.from;return{changes:{from:o,to:a,insert:i.doc.slice(s,a).append(i.doc.slice(o,s))},range:H.cursor(a)}});return t.changes.empty?!1:(e(i.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Kl(i){let e=[],t=-1;for(let n of i.selection.ranges){let s=i.doc.lineAt(n.from),r=i.doc.lineAt(n.to);if(!n.empty&&n.to==r.from&&(r=i.doc.lineAt(n.to-1)),t>=s.number){let o=e[e.length-1];o.to=r.to,o.ranges.push(n)}else e.push({from:s.from,to:r.to,ranges:[n]});t=r.number+1}return e}function zb(i,e,t){if(i.readOnly)return!1;let n=[],s=[];for(let r of Kl(i)){if(t?r.to==i.doc.length:r.from==0)continue;let o=i.doc.lineAt(t?r.to+1:r.from-1),a=o.length+1;if(t){n.push({from:r.to,to:o.to},{from:r.from,insert:o.text+i.lineBreak});for(let l of r.ranges)s.push(H.range(Math.min(i.doc.length,l.anchor+a),Math.min(i.doc.length,l.head+a)))}else{n.push({from:o.from,to:r.from},{from:r.to,insert:i.lineBreak+o.text});for(let l of r.ranges)s.push(H.range(l.anchor-a,l.head-a))}}return n.length?(e(i.update({changes:n,scrollIntoView:!0,selection:H.create(s,i.selection.mainIndex),userEvent:"move.line"})),!0):!1}var jL=({state:i,dispatch:e})=>zb(i,e,!1),UL=({state:i,dispatch:e})=>zb(i,e,!0);function Fb(i,e,t){if(i.readOnly)return!1;let n=[];for(let s of Kl(i))t?n.push({from:s.from,insert:i.doc.slice(s.from,s.to)+i.lineBreak}):n.push({from:s.to,insert:i.lineBreak+i.doc.slice(s.from,s.to)});return e(i.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var JL=({state:i,dispatch:e})=>Fb(i,e,!1),QL=({state:i,dispatch:e})=>Fb(i,e,!0),$L=i=>{if(i.state.readOnly)return!1;let{state:e}=i,t=e.changes(Kl(e).map(({from:s,to:r})=>(s>0?s--:r<e.doc.length&&r++,{from:s,to:r}))),n=Rs(e.selection,s=>{let r;if(i.lineWrapping){let o=i.lineBlockAt(s.head),a=i.coordsAtPos(s.head,s.assoc||1);a&&(r=o.bottom+i.documentTop-a.bottom+i.defaultLineHeight/2)}return i.moveVertically(s,!0,r)}).map(t);return i.dispatch({changes:t,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function qL(i,e){if(/\(\)|\[\]|\{\}/.test(i.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=qe(i).resolveInner(e),n=t.childBefore(e),s=t.childAfter(e),r;return n&&s&&n.to<=e&&s.from>=e&&(r=n.type.prop(J.closedBy))&&r.indexOf(s.name)>-1&&i.doc.lineAt(n.to).from==i.doc.lineAt(s.from).from&&!/\S/.test(i.sliceDoc(n.to,s.from))?{from:n.to,to:s.from}:null}var yb=Kb(!1),e5=Kb(!0);function Kb(i){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(s=>{let{from:r,to:o}=s,a=e.doc.lineAt(r),l=!i&&r==o&&qL(e,r);i&&(r=o=(o<=a.to?a:e.doc.lineAt(o)).to);let h=new Nn(e,{simulateBreak:r,simulateDoubleBreak:!!l}),c=kl(h,r);for(c==null&&(c=Yi(/^\s*/.exec(e.doc.lineAt(r).text)[0],e.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:r,to:o}=l:r>a.from&&r<a.from+100&&!/\S/.test(a.text.slice(0,r))&&(r=a.from);let d=["",Ms(e,c)];return l&&d.push(Ms(e,h.lineIndent(a.from,-1))),{changes:{from:r,to:o,insert:ie.of(d)},range:H.cursor(r+1+d[1].length)}});return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Au(i,e){let t=-1;return i.changeByRange(n=>{let s=[];for(let o=n.from;o<=n.to;){let a=i.doc.lineAt(o);a.number>t&&(n.empty||n.to>a.from)&&(e(a,s,n),t=a.number),o=a.to+1}let r=i.changes(s);return{changes:s,range:H.range(r.mapPos(n.anchor,1),r.mapPos(n.head,1))}})}var Hu=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=Object.create(null),n=new Nn(i,{overrideIndentation:r=>{let o=t[r];return o??-1}}),s=Au(i,(r,o,a)=>{let l=kl(n,r.from);if(l==null)return;/\S/.test(r.text)||(l=0);let h=/^\s*/.exec(r.text)[0],c=Ms(i,l);(h!=c||a.from<r.from+h.length)&&(t[r.from]=l,o.push({from:r.from,to:r.from+h.length,insert:c}))});return s.changes.empty||e(i.update(s,{userEvent:"indent"})),!0},Yb=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Au(i,(t,n)=>{n.push({from:t.from,insert:i.facet(Qr)})}),{userEvent:"input.indent"})),!0),Bb=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Au(i,(t,n)=>{let s=/^\s*/.exec(t.text)[0];if(!s)return;let r=Yi(s,i.tabSize),o=0,a=Ms(i,Math.max(0,r-Kt(i)));for(;o<s.length&&o<a.length&&s.charCodeAt(o)==a.charCodeAt(o);)o++;n.push({from:t.from+o,to:t.from+s.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),t5=i=>(i.setTabFocusMode(),!0);var i5=[{key:"Ctrl-b",run:Lb,shift:_b,preventDefault:!0},{key:"Ctrl-f",run:Tb,shift:Ib},{key:"Ctrl-p",run:Dl,shift:so},{key:"Ctrl-n",run:Nl,shift:ro},{key:"Ctrl-a",run:Eu,shift:Ol},{key:"Ctrl-e",run:Xu,shift:Vl},{key:"Ctrl-d",run:zl},{key:"Ctrl-h",run:no},{key:"Ctrl-k",run:KL},{key:"Ctrl-Alt-h",run:Vb},{key:"Ctrl-o",run:Fl},{key:"Ctrl-t",run:Nu},{key:"Ctrl-v",run:eo}],n5=[{key:"ArrowLeft",run:Lb,shift:_b,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Ru,shift:Gu,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:XL,shift:HL,preventDefault:!0},{key:"ArrowRight",run:Tb,shift:Ib,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Zu,shift:Wu,preventDefault:!0},{mac:"Cmd-ArrowRight",run:_L,shift:OL,preventDefault:!0},{key:"ArrowUp",run:Dl,shift:so,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Rl,shift:to},{mac:"Ctrl-ArrowUp",run:Ml,shift:Pl},{key:"ArrowDown",run:Nl,shift:ro,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Zl,shift:io},{mac:"Ctrl-ArrowDown",run:eo,shift:Ps},{key:"PageUp",run:Ml,shift:Pl},{key:"PageDown",run:eo,shift:Ps},{key:"Home",run:EL,shift:AL,preventDefault:!0},{key:"Mod-Home",run:Rl,shift:to},{key:"End",run:ZL,shift:NL,preventDefault:!0},{key:"Mod-End",run:Zl,shift:io},{key:"Enter",run:yb,shift:yb},{key:"Mod-a",run:Du},{key:"Backspace",run:no,shift:no},{key:"Delete",run:zl},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Vb},{key:"Mod-Delete",mac:"Alt-Delete",run:FL},{mac:"Mod-Backspace",run:YL},{mac:"Mod-Delete",run:BL}].concat(i5.map(i=>({mac:i.key,run:i.run,shift:i.shift}))),jb=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:PL,shift:WL},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:RL,shift:DL},{key:"Alt-ArrowUp",run:jL},{key:"Shift-Alt-ArrowUp",run:JL},{key:"Alt-ArrowDown",run:UL},{key:"Shift-Alt-ArrowDown",run:QL},{key:"Escape",run:Ab},{key:"Mod-Enter",run:e5},{key:"Alt-l",mac:"Ctrl-l",run:VL},{key:"Mod-i",run:zL,preventDefault:!0},{key:"Mod-[",run:Bb},{key:"Mod-]",run:Yb},{key:"Mod-Alt-\\",run:Hu},{key:"Shift-Mod-k",run:$L},{key:"Shift-Mod-\\",run:GL},{key:"Mod-/",run:El},{key:"Alt-A",run:uL},{key:"Ctrl-m",mac:"Shift-Alt-m",run:t5}].concat(n5),Ub={key:"Tab",run:Yb,shift:Bb};function ot(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var s=t[n];typeof s=="string"?i.setAttribute(n,s):s!=null&&(i[n]=s)}e++}for(;e<arguments.length;e++)Jb(i,arguments[e]);return i}function Jb(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)Jb(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}var Qb=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i,jl=class{constructor(e,t,n=0,s=e.length,r,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,s),this.bufferStart=n,this.normalize=r?a=>r(Qb(a)):Qb,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return De(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Sr(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=dt(e);let s=this.normalize(t);if(s.length)for(let r=0,o=n;;r++){let a=s.charCodeAt(r),l=this.match(a,o,this.bufferPos+this.bufferStart);if(r==s.length-1){if(l)return this.value=l,this;break}o==n&&r<t.length&&t.charCodeAt(r)==a&&o++}}}match(e,t,n){let s=null;for(let r=0;r<this.matches.length;r+=2){let o=this.matches[r],a=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?s={from:this.matches[r+1],to:n}:(this.matches[r]++,a=!0)),a||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:t,to:n}:this.matches.push(1,t)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}};typeof Symbol<"u"&&(jl.prototype[Symbol.iterator]=function(){return this});var t1={from:-1,to:-1,match:/.*/.exec("")},Yu="gm"+(/x/.unicode==null?"":"u"),Ul=class{constructor(e,t,n,s=0,r=e.length){if(this.text=e,this.to=r,this.curLine="",this.done=!1,this.value=t1,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new Ql(e,t,n,s,r);this.re=new RegExp(t,Yu+(n?.ignoreCase?"i":"")),this.test=n?.test,this.iter=e.iter();let o=e.lineAt(s);this.curLineStart=o.from,this.matchPos=$l(e,s),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,s=n+t[0].length;if(this.matchPos=$l(this.text,s+(n==s?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<s||n>this.value.to)&&(!this.test||this.test(n,s,t)))return this.value={from:n,to:s,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},Ou=new WeakMap,Jl=class i{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let s=Ou.get(e);if(!s||s.from>=n||s.to<=t){let a=new i(t,e.sliceString(t,n));return Ou.set(e,a),a}if(s.from==t&&s.to==n)return s;let{text:r,from:o}=s;return o>t&&(r=e.sliceString(t,o)+r,o=t),s.to<n&&(r+=e.sliceString(s.to,n)),Ou.set(e,new i(o,r)),new i(t,r.slice(t-o,n-o))}},Ql=class{constructor(e,t,n,s,r){this.text=e,this.to=r,this.done=!1,this.value=t1,this.matchPos=$l(e,s),this.re=new RegExp(t,Yu+(n?.ignoreCase?"i":"")),this.test=n?.test,this.flat=Jl.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let n=this.flat.from+t.index,s=n+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,s,t)))return this.value={from:n,to:s,match:t},this.matchPos=$l(this.text,s+(n==s?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Jl.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol<"u"&&(Ul.prototype[Symbol.iterator]=Ql.prototype[Symbol.iterator]=function(){return this});function r5(i){try{return new RegExp(i,Yu),!0}catch{return!1}}function $l(i,e){if(e>=i.length)return e;let t=i.lineAt(e),n;for(;e<t.to&&(n=t.text.charCodeAt(e-t.from))>=56320&&n<57344;)e++;return e}var Xs=Y.define({combine(i){return ut(i,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Ku(e),scrollToMatch:e=>B.scrollIntoView(e)})}});var ql=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||r5(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new zu(this):new Vu(this)}getCursor(e,t=0,n){let s=e.doc?e:ce.create({doc:e});return n==null&&(n=s.doc.length),this.regexp?Es(this,s,t,n):Zs(this,s,t,n)}},eh=class{constructor(e){this.spec=e}};function Zs(i,e,t,n){return new jl(e.doc,i.unquoted,t,n,i.caseSensitive?void 0:s=>s.toLowerCase(),i.wholeWord?o5(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function o5(i,e){return(t,n,s,r)=>((r>t||r+s.length<n)&&(r=Math.max(0,t-2),s=i.sliceString(r,Math.min(i.length,n+2))),(e(th(s,t-r))!=be.Word||e(ih(s,t-r))!=be.Word)&&(e(ih(s,n-r))!=be.Word||e(th(s,n-r))!=be.Word))}var Vu=class extends eh{constructor(e){super(e)}nextMatch(e,t,n){let s=Zs(this.spec,e,n,e.doc.length).nextOverlapping();if(s.done){let r=Math.min(e.doc.length,t+this.spec.unquoted.length);s=Zs(this.spec,e,0,r).nextOverlapping()}return s.done||s.value.from==t&&s.value.to==n?null:s.value}prevMatchInRange(e,t,n){for(let s=n;;){let r=Math.max(t,s-1e4-this.spec.unquoted.length),o=Zs(this.spec,e,r,s),a=null;for(;!o.nextOverlapping().done;)a=o.value;if(a)return a;if(r==t)return null;s-=1e4}}prevMatch(e,t,n){let s=this.prevMatchInRange(e,0,t);return s||(s=this.prevMatchInRange(e,Math.max(0,n-this.spec.unquoted.length),e.doc.length)),s&&(s.from!=t||s.to!=n)?s:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let n=Zs(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let r=Zs(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!r.next().done;)s(r.value.from,r.value.to)}};function Es(i,e,t,n){return new Ul(e.doc,i.search,{ignoreCase:!i.caseSensitive,test:i.wholeWord?a5(e.charCategorizer(e.selection.main.head)):void 0},t,n)}function th(i,e){return i.slice(Te(i,e,!1),e)}function ih(i,e){return i.slice(e,Te(i,e))}function a5(i){return(e,t,n)=>!n[0].length||(i(th(n.input,n.index))!=be.Word||i(ih(n.input,n.index))!=be.Word)&&(i(ih(n.input,n.index+n[0].length))!=be.Word||i(th(n.input,n.index+n[0].length))!=be.Word)}var zu=class extends eh{nextMatch(e,t,n){let s=Es(this.spec,e,n,e.doc.length).next();return s.done&&(s=Es(this.spec,e,0,t).next()),s.done?null:s.value}prevMatchInRange(e,t,n){for(let s=1;;s++){let r=Math.max(t,n-s*1e4),o=Es(this.spec,e,r,n),a=null;for(;!o.next().done;)a=o.value;if(a&&(r==t||a.from>r+10))return a;if(r==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(t,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t)}matchAll(e,t){let n=Es(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=t)return null;s.push(n.value)}return s}highlight(e,t,n,s){let r=Es(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.doc.length));for(;!r.next().done;)s(r.value.from,r.value.to)}},lo=ee.define(),Bu=ee.define(),nn=Ze.define({create(i){return new ao(Fu(i).create(),null)},update(i,e){for(let t of e.effects)t.is(lo)?i=new ao(t.value.create(),i.panel):t.is(Bu)&&(i=new ao(i.query,t.value?ju:null));return i},provide:i=>xs.from(i,e=>e.panel)});var ao=class{constructor(e,t){this.query=e,this.panel=t}},l5=ne.mark({class:"cm-searchMatch"}),h5=ne.mark({class:"cm-searchMatch cm-searchMatch-selected"}),c5=_e.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(nn))}update(i){let e=i.state.field(nn);(e!=i.startState.field(nn)||i.docChanged||i.selectionSet||i.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:i,panel:e}){if(!e||!i.spec.valid)return ne.none;let{view:t}=this,n=new Tt;for(let s=0,r=t.visibleRanges,o=r.length;s<o;s++){let{from:a,to:l}=r[s];for(;s<o-1&&l>r[s+1].from-2*250;)l=r[++s].to;i.highlight(t.state,a,l,(h,c)=>{let d=t.state.selection.ranges.some(u=>u.from==h&&u.to==c);n.add(h,c,d?h5:l5)})}return n.finish()}},{decorations:i=>i.decorations});function ho(i){return e=>{let t=e.state.field(nn,!1);return t&&t.query.spec.valid?i(e,t):nh(e)}}var $b=ho((i,{query:e})=>{let{to:t}=i.state.selection.main,n=e.nextMatch(i.state,t,t);if(!n)return!1;let s=H.single(n.from,n.to),r=i.state.facet(Xs);return i.dispatch({selection:s,effects:[Uu(i,n),r.scrollToMatch(s.main,i)],userEvent:"select.search"}),n1(i),!0}),qb=ho((i,{query:e})=>{let{state:t}=i,{from:n}=t.selection.main,s=e.prevMatch(t,n,n);if(!s)return!1;let r=H.single(s.from,s.to),o=i.state.facet(Xs);return i.dispatch({selection:r,effects:[Uu(i,s),o.scrollToMatch(r.main,i)],userEvent:"select.search"}),n1(i),!0}),d5=ho((i,{query:e})=>{let t=e.matchAll(i.state,1e3);return!t||!t.length?!1:(i.dispatch({selection:H.create(t.map(n=>H.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)});var e1=ho((i,{query:e})=>{let{state:t}=i,{from:n,to:s}=t.selection.main;if(t.readOnly)return!1;let r=e.nextMatch(t,n,n);if(!r)return!1;let o=r,a=[],l,h,c=[];if(o.from==n&&o.to==s&&(h=t.toText(e.getReplacement(o)),a.push({from:o.from,to:o.to,insert:h}),o=e.nextMatch(t,o.from,o.to),c.push(B.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(n).number)+"."))),o){let d=a.length==0||a[0].from>=r.to?0:r.to-r.from-h.length;l=H.single(o.from-d,o.to-d),c.push(Uu(i,o)),c.push(t.facet(Xs).scrollToMatch(l.main,i))}return i.dispatch({changes:a,selection:l,effects:c,userEvent:"input.replace"}),!0}),u5=ho((i,{query:e})=>{if(i.state.readOnly)return!1;let t=e.matchAll(i.state,1e9).map(s=>{let{from:r,to:o}=s;return{from:r,to:o,insert:e.getReplacement(s)}});if(!t.length)return!1;let n=i.state.phrase("replaced $ matches",t.length)+".";return i.dispatch({changes:t,effects:B.announce.of(n),userEvent:"input.replace.all"}),!0});function ju(i){return i.state.facet(Xs).createPanel(i)}function Fu(i,e){var t,n,s,r,o;let a=i.selection.main,l=a.empty||a.to>a.from+100?"":i.sliceDoc(a.from,a.to);if(e&&!l)return e;let h=i.facet(Xs);return new ql({search:((t=e?.literal)!==null&&t!==void 0?t:h.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(n=e?.caseSensitive)!==null&&n!==void 0?n:h.caseSensitive,literal:(s=e?.literal)!==null&&s!==void 0?s:h.literal,regexp:(r=e?.regexp)!==null&&r!==void 0?r:h.regexp,wholeWord:(o=e?.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}function i1(i){let e=$d(i,ju);return e&&e.dom.querySelector("[main-field]")}function n1(i){let e=i1(i);e&&e==i.root.activeElement&&e.select()}var nh=i=>{let e=i.state.field(nn,!1);if(e&&e.panel){let t=i1(i);if(t&&t!=i.root.activeElement){let n=Fu(i.state,e.query.spec);n.valid&&i.dispatch({effects:lo.of(n)}),t.focus(),t.select()}}else i.dispatch({effects:[Bu.of(!0),e?lo.of(Fu(i.state,e.query.spec)):ee.appendConfig.of(m5)]});return!0},f5=i=>{let e=i.state.field(nn,!1);if(!e||!e.panel)return!1;let t=$d(i,ju);return t&&t.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:Bu.of(!1)}),!0};var Ku=class{constructor(e){this.view=e;let t=this.query=e.state.field(nn).query.spec;this.commit=this.commit.bind(this),this.searchField=ot("input",{value:t.search,placeholder:yt(e,"Find"),"aria-label":yt(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=ot("input",{value:t.replace,placeholder:yt(e,"Replace"),"aria-label":yt(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=ot("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=ot("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=ot("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function n(s,r,o){return ot("button",{class:"cm-button",name:s,onclick:r,type:"button"},o)}this.dom=ot("div",{onkeydown:s=>this.keydown(s),class:"cm-search"},[this.searchField,n("next",()=>$b(e),[yt(e,"next")]),n("prev",()=>qb(e),[yt(e,"previous")]),n("select",()=>d5(e),[yt(e,"all")]),ot("label",null,[this.caseField,yt(e,"match case")]),ot("label",null,[this.reField,yt(e,"regexp")]),ot("label",null,[this.wordField,yt(e,"by word")]),...e.state.readOnly?[]:[ot("br"),this.replaceField,n("replace",()=>e1(e),[yt(e,"replace")]),n("replaceAll",()=>u5(e),[yt(e,"replace all")])],ot("button",{name:"close",onclick:()=>f5(e),"aria-label":yt(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new ql({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:lo.of(e)}))}keydown(e){_y(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?qb:$b)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),e1(this.view))}update(e){for(let t of e.transactions)for(let n of t.effects)n.is(lo)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Xs).top}};function yt(i,e){return i.state.phrase(e)}var Yl=30,Bl=/[\s\.,:;?!]/;function Uu(i,{from:e,to:t}){let n=i.state.doc.lineAt(e),s=i.state.doc.lineAt(t).to,r=Math.max(n.from,e-Yl),o=Math.min(s,t+Yl),a=i.state.sliceDoc(r,o);if(r!=n.from){for(let l=0;l<Yl;l++)if(!Bl.test(a[l+1])&&Bl.test(a[l])){a=a.slice(l);break}}if(o!=s){for(let l=a.length-1;l>a.length-Yl;l--)if(!Bl.test(a[l-1])&&Bl.test(a[l])){a=a.slice(0,l);break}}return B.announce.of(`${i.state.phrase("current match")}. ${a} ${i.state.phrase("on line")} ${n.number}.`)}var p5=B.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),m5=[nn,Ot.low(c5),p5];var $u=class{constructor(e,t,n,s){this.state=e,this.pos=t,this.explicit=n,this.view=s,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=qe(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),s=t.text.slice(n-t.from,this.pos-t.from),r=s.search(d1(e,!1));return r<0?null:{from:n+r,to:this.pos,text:s.slice(r)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,n){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),n&&n.onDocChange&&(this.abortOnDocChange=!0))}};function s1(i){let e=Object.keys(i).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function g5(i){let e=Object.create(null),t=Object.create(null);for(let{label:s}of i){e[s[0]]=!0;for(let r=1;r<s.length;r++)t[s[r]]=!0}let n=s1(e)+s1(t)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function y5(i){let e=i.map(s=>typeof s=="string"?{label:s}:s),[t,n]=e.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:g5(e);return s=>{let r=s.matchBefore(n);return r||s.explicit?{from:r?r.from:s.pos,options:e,validFor:t}:null}}var rh=class{constructor(e,t,n,s){this.completion=e,this.source=t,this.match=n,this.score=s}};function co(i){return i.selection.main.from}function d1(i,e){var t;let{source:n}=i,s=e&&n[0]!="^",r=n[n.length-1]!="$";return!s&&!r?i:new RegExp(`${s?"^":""}(?:${n})${r?"$":""}`,(t=i.flags)!==null&&t!==void 0?t:i.ignoreCase?"i":"")}var u1=st.define();function b5(i,e,t,n){let{main:s}=i.selection,r=t-s.from,o=n-s.from;return Object.assign(Object.assign({},i.changeByRange(a=>{if(a!=s&&t!=n&&i.sliceDoc(a.from+r,a.from+o)!=i.sliceDoc(t,n))return{range:a};let l=i.toText(e);return{changes:{from:a.from+r,to:n==s.from?a.to:a.from+o,insert:l},range:H.cursor(a.from+r+l.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}var r1=new WeakMap;function w5(i){if(!Array.isArray(i))return i;let e=r1.get(i);return e||r1.set(i,e=y5(i)),e}var f1=ee.define(),of=ee.define(),qu=class{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let n=De(e,t),s=dt(n);this.chars.push(n);let r=e.slice(t,t+s),o=r.toUpperCase();this.folded.push(De(o==r?r.toLowerCase():o,0)),t+=s}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:n,any:s,precise:r,byWord:o}=this;if(t.length==1){let T=De(e,0),M=dt(T),L=M==e.length?0:-100;if(T!=t[0])if(T==n[0])L+=-200;else return null;return this.ret(L,[0,M])}let a=e.indexOf(this.pattern);if(a==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=t.length,h=0;if(a<0){for(let T=0,M=Math.min(e.length,200);T<M&&h<l;){let L=De(e,T);(L==t[h]||L==n[h])&&(s[h++]=T),T+=dt(L)}if(h<l)return null}let c=0,d=0,u=!1,f=0,g=-1,C=-1,p=/[a-z]/.test(e),k=!0;for(let T=0,M=Math.min(e.length,200),L=0;T<M&&d<l;){let b=De(e,T);a<0&&(c<l&&b==t[c]&&(r[c++]=T),f<l&&(b==t[f]||b==n[f]?(f==0&&(g=T),C=T+1,f++):f=0));let m,w=b<255?b>=48&&b<=57||b>=97&&b<=122?2:b>=65&&b<=90?1:0:(m=Sr(b))!=m.toLowerCase()?1:m!=m.toUpperCase()?2:0;(!T||w==1&&p||L==0&&w!=0)&&(t[d]==b||n[d]==b&&(u=!0)?o[d++]=T:o.length&&(k=!1)),L=w,T+=dt(b)}return d==l&&o[0]==0&&k?this.result(-100+(u?-200:0),o,e):f==l&&g==0?this.ret(-200-e.length+(C==e.length?0:-100),[0,C]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):f==l?this.ret(-900-e.length,[g,C]):d==l?this.result(-100+(u?-200:0)+-700+(k?0:-1100),o,e):t.length==2?null:this.result((s[0]?-700:0)+-200+-1100,s,e)}result(e,t,n){let s=[],r=0;for(let o of t){let a=o+(this.astral?dt(De(n,o)):1);r&&s[r-1]==o?s[r-1]=a:(s[r++]=o,s[r++]=a)}return this.ret(e-n.length,s)}},ef=class{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),n=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return n==null?null:(this.matched=[0,t.length],this.score=n+(e.length==this.pattern.length?0:-100),this)}},mi=Y.define({combine(i){return ut(i,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:v5,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>n=>o1(e(n),t(n)),optionClass:(e,t)=>n=>o1(e(n),t(n)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function o1(i,e){return i?e?i+" "+e:i:e}function v5(i,e,t,n,s,r){let o=i.textDirection==ae.RTL,a=o,l=!1,h="top",c,d,u=e.left-s.left,f=s.right-e.right,g=n.right-n.left,C=n.bottom-n.top;if(a&&u<Math.min(g,f)?a=!1:!a&&f<Math.min(g,u)&&(a=!0),g<=(a?u:f))c=Math.max(s.top,Math.min(t.top,s.bottom-C))-e.top,d=Math.min(400,a?u:f);else{l=!0,d=Math.min(400,(o?e.right:s.right-e.left)-30);let T=s.bottom-e.bottom;T>=C||T>e.top?c=t.bottom-e.top:(h="bottom",c=e.bottom-t.top)}let p=(e.bottom-e.top)/r.offsetHeight,k=(e.right-e.left)/r.offsetWidth;return{style:`${h}: ${c/p}px; max-width: ${d/k}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function x5(i){let e=i.addToOptions.slice();return i.icons&&e.push({render(t){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),t.type&&n.classList.add(...t.type.split(/\s+/g).map(s=>"cm-completionIcon-"+s)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(t,n,s,r){let o=document.createElement("span");o.className="cm-completionLabel";let a=t.displayLabel||t.label,l=0;for(let h=0;h<r.length;){let c=r[h++],d=r[h++];c>l&&o.appendChild(document.createTextNode(a.slice(l,c)));let u=o.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(a.slice(c,d))),u.className="cm-completionMatchedText",l=d}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(t){if(!t.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=t.detail,n},position:80}),e.sort((t,n)=>t.position-n.position).map(t=>t.render)}function Ju(i,e,t){if(i<=t)return{from:0,to:i};if(e<0&&(e=0),e<=i>>1){let s=Math.floor(e/t);return{from:s*t,to:(s+1)*t}}let n=Math.floor((i-e)/t);return{from:i-(n+1)*t,to:i-n*t}}var tf=class{constructor(e,t,n){this.view=e,this.stateField=t,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let s=e.state.field(t),{options:r,selected:o}=s.open,a=e.state.facet(mi);this.optionContent=x5(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=Ju(r.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{let{options:h}=e.state.field(t).open;for(let c=l.target,d;c&&c!=this.dom;c=c.parentNode)if(c.nodeName=="LI"&&(d=/-(\d+)$/.exec(c.id))&&+d[1]<h.length){this.applyCompletion(e,h[+d[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let h=e.state.field(this.stateField,!1);h&&h.tooltip&&e.state.facet(mi).closeOnBlur&&l.relatedTarget!=e.contentDOM&&e.dispatch({effects:of.of(null)})}),this.showOptions(r,s.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let n=e.state.field(this.stateField),s=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=s){let{options:r,selected:o,disabled:a}=n.open;(!s.open||s.open.options!=r)&&(this.range=Ju(r.length,o,e.state.facet(mi).maxRenderedOptions),this.showOptions(r,n.id)),this.updateSel(),a!=((t=s.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of t.split(" "))n&&this.dom.classList.add(n);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=Ju(t.options.length,t.selected,this.view.state.facet(mi).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:s}=n;if(!s)return;let r=typeof s=="string"?document.createTextNode(s):s(n);if(!r)return;"then"in r?r.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,n)}).catch(o=>ft(this.view.state,o,"completion info")):this.addInfoPane(r,n)}}addInfoPane(e,t){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",e.nodeType!=null)n.appendChild(e),this.infoDestroy=null;else{let{dom:s,destroy:r}=e;n.appendChild(s),this.infoDestroy=r||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,s=this.range.from;n;n=n.nextSibling,s++)n.nodeName!="LI"||!n.id?s--:s==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return t&&k5(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),s=e.getBoundingClientRect(),r=this.space;if(!r){let o=this.dom.ownerDocument.defaultView||window;r={left:0,top:0,right:o.innerWidth,bottom:o.innerHeight}}return s.top>Math.min(r.bottom,t.bottom)-10||s.bottom<Math.max(r.top,t.top)+10?null:this.view.state.facet(mi).positionInfo(this.view,t,s,n,r,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,n){let s=document.createElement("ul");s.id=t,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-label",this.view.state.phrase("Completions"));let r=null;for(let o=n.from;o<n.to;o++){let{completion:a,match:l}=e[o],{section:h}=a;if(h){let u=typeof h=="string"?h:h.name;if(u!=r&&(o>n.from||n.from==0))if(r=u,typeof h!="string"&&h.header)s.appendChild(h.header(h));else{let f=s.appendChild(document.createElement("completion-section"));f.textContent=u}}let c=s.appendChild(document.createElement("li"));c.id=t+"-"+o,c.setAttribute("role","option");let d=this.optionClass(a);d&&(c.className=d);for(let u of this.optionContent){let f=u(a,this.view.state,this.view,l);f&&c.appendChild(f)}}return n.from&&s.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&s.classList.add("cm-completionListIncompleteBottom"),s}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}};function S5(i,e){return t=>new tf(t,i,e)}function k5(i,e){let t=i.getBoundingClientRect(),n=e.getBoundingClientRect(),s=t.height/i.offsetHeight;n.top<t.top?i.scrollTop-=(t.top-n.top)/s:n.bottom>t.bottom&&(i.scrollTop+=(n.bottom-t.bottom)/s)}function a1(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function C5(i,e){let t=[],n=null,s=h=>{t.push(h);let{section:c}=h.completion;if(c){n||(n=[]);let d=typeof c=="string"?c:c.name;n.some(u=>u.name==d)||n.push(typeof c=="string"?{name:d}:c)}},r=e.facet(mi);for(let h of i)if(h.hasResult()){let c=h.result.getMatch;if(h.result.filter===!1)for(let d of h.result.options)s(new rh(d,h.source,c?c(d):[],1e9-t.length));else{let d=e.sliceDoc(h.from,h.to),u,f=r.filterStrict?new ef(d):new qu(d);for(let g of h.result.options)if(u=f.match(g.label)){let C=g.displayLabel?c?c(g,u.matched):[]:u.matched;s(new rh(g,h.source,C,u.score+(g.boost||0)))}}}if(n){let h=Object.create(null),c=0,d=(u,f)=>{var g,C;return((g=u.rank)!==null&&g!==void 0?g:1e9)-((C=f.rank)!==null&&C!==void 0?C:1e9)||(u.name<f.name?-1:1)};for(let u of n.sort(d))c-=1e5,h[u.name]=c;for(let u of t){let{section:f}=u.completion;f&&(u.score+=h[typeof f=="string"?f:f.name])}}let o=[],a=null,l=r.compareCompletions;for(let h of t.sort((c,d)=>d.score-c.score||l(c.completion,d.completion))){let c=h.completion;!a||a.label!=c.label||a.detail!=c.detail||a.type!=null&&c.type!=null&&a.type!=c.type||a.apply!=c.apply||a.boost!=c.boost?o.push(h):a1(h.completion)>a1(a)&&(o[o.length-1]=h),a=h.completion}return o}var nf=class i{constructor(e,t,n,s,r,o){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=s,this.selected=r,this.disabled=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new i(this.options,l1(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,n,s,r,o){if(s&&!o&&e.some(h=>h.isPending))return s.setDisabled();let a=C5(e,t);if(!a.length)return s&&e.some(h=>h.isPending)?s.setDisabled():null;let l=t.facet(mi).selectOnOpen?0:-1;if(s&&s.selected!=l&&s.selected!=-1){let h=s.options[s.selected].completion;for(let c=0;c<a.length;c++)if(a[c].completion==h){l=c;break}}return new i(a,l1(n,l),{pos:e.reduce((h,c)=>c.hasResult()?Math.min(h,c.from):h,1e8),create:E5,above:r.aboveCursor},s?s.timestamp:Date.now(),l,!1)}map(e){return new i(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new i(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}},sf=class i{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new i(P5,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,n=t.facet(mi),r=(n.override||t.languageDataAt("autocomplete",co(t)).map(w5)).map(l=>(this.active.find(c=>c.source==l)||new sn(l,this.active.some(c=>c.state!=0)?1:0)).update(e,n));r.length==this.active.length&&r.every((l,h)=>l==this.active[h])&&(r=this.active);let o=this.open,a=e.effects.some(l=>l.is(p1));o&&e.docChanged&&(o=o.map(e.changes)),e.selection||r.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!L5(r,this.active)||a?o=nf.build(r,t,this.id,o,n,a):o&&o.disabled&&!r.some(l=>l.isPending)&&(o=null),!o&&r.every(l=>!l.isPending)&&r.some(l=>l.hasResult())&&(r=r.map(l=>l.hasResult()?new sn(l.source,0):l));for(let l of e.effects)l.is(m1)&&(o=o&&o.setSelected(l.value,this.id));return r==this.active&&o==this.open?this:new i(r,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?T5:M5}};function L5(i,e){if(i==e)return!0;for(let t=0,n=0;;){for(;t<i.length&&!i[t].hasResult();)t++;for(;n<e.length&&!e[n].hasResult();)n++;let s=t==i.length,r=n==e.length;if(s||r)return s==r;if(i[t++].result!=e[n++].result)return!1}}var T5={"aria-autocomplete":"list"},M5={};function l1(i,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":i};return e>-1&&(t["aria-activedescendant"]=i+"-"+e),t}var P5=[];function R5(i,e){if(i.isUserEvent("input.complete")){let n=i.annotation(u1);if(n&&e.activateOnCompletion(n))return 12}let t=i.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:i.isUserEvent("delete.backward")?2:i.selection?8:i.docChanged?16:0}var sn=class i{constructor(e,t,n=!1){this.source=e,this.state=t,this.explicit=n}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let n=R5(e,t),s=this;(n&8||n&16&&this.touches(e))&&(s=new i(s.source,0)),n&4&&s.state==0&&(s=new i(this.source,1)),s=s.updateFor(e,n);for(let r of e.effects)if(r.is(f1))s=new i(s.source,1,r.value);else if(r.is(of))s=new i(s.source,0);else if(r.is(p1))for(let o of r.value)o.source==s.source&&(s=o);return s}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(co(e.state))}},rf=class i extends sn{constructor(e,t,n,s,r,o){super(e,3,t),this.limit=n,this.result=s,this.from=r,this.to=o}hasResult(){return!0}updateFor(e,t){var n;if(!(t&3))return this.map(e.changes);let s=this.result;s.map&&!e.changes.empty&&(s=s.map(s,e.changes));let r=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),a=co(e.state);if(a>o||!s||t&2&&(co(e.startState)==this.from||a<this.limit))return new sn(this.source,t&4?1:0);let l=e.changes.mapPos(this.limit);return Z5(s.validFor,e.state,r,o)?new i(this.source,this.explicit,l,s,r,o):s.update&&(s=s.update(s,r,o,new $u(e.state,a,!1)))?new i(this.source,this.explicit,l,s,s.from,(n=s.to)!==null&&n!==void 0?n:co(e.state)):new sn(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new i(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new sn(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}};function Z5(i,e,t,n){if(!i)return!1;let s=e.sliceDoc(t,n);return typeof i=="function"?i(s,t,n,e):d1(i,!0).test(s)}var p1=ee.define({map(i,e){return i.map(t=>t.map(e))}}),m1=ee.define(),On=Ze.define({create(){return sf.start()},update(i,e){return i.update(e)},provide:i=>[Qd.from(i,e=>e.tooltip),B.contentAttributes.from(i,e=>e.attrs)]});function g1(i,e){let t=e.completion.apply||e.completion.label,n=i.state.field(On).active.find(s=>s.source==e.source);return n instanceof rf?(typeof t=="string"?i.dispatch(Object.assign(Object.assign({},b5(i.state,t,n.from,n.to)),{annotations:u1.of(e.completion)})):t(i,e.completion,n.from,n.to),!0):!1}var E5=S5(On,g1);function sh(i,e="option"){return t=>{let n=t.state.field(On,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<t.state.facet(mi).interactionDelay)return!1;let s=1,r;e=="page"&&(r=Oy(t,n.open.tooltip))&&(s=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let{length:o}=n.open.options,a=n.open.selected>-1?n.open.selected+s*(i?1:-1):i?0:o-1;return a<0?a=e=="page"?0:o-1:a>=o&&(a=e=="page"?o-1:0),t.dispatch({effects:m1.of(a)}),!0}}var X5=i=>{let e=i.state.field(On,!1);return i.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<i.state.facet(mi).interactionDelay?!1:g1(i,e.open.options[e.open.selected])},oh=i=>i.state.field(On,!1)?(i.dispatch({effects:f1.of(!0)}),!0):!1,_5=i=>{let e=i.state.field(On,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(i.dispatch({effects:of.of(null)}),!0)};var iX=typeof navigator=="object"&&/Win/.test(navigator.platform);var uo={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Hn=ee.define({map(i,e){let t=e.mapPos(i,-1,Xe.TrackAfter);return t??void 0}}),af=new class extends Ht{};af.startSide=1;af.endSide=-1;var y1=Ze.define({create(){return Se.empty},update(i,e){if(i=i.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);i=i.update({filter:n=>n>=t.from&&n<=t.to})}for(let t of e.effects)t.is(Hn)&&(i=i.update({add:[af.range(t.value,t.value+1)]}));return i}});function b1(){return[G5,y1]}var Qu="()[]{}<>";function w1(i){for(let e=0;e<Qu.length;e+=2)if(Qu.charCodeAt(e)==i)return Qu.charAt(e+1);return Sr(i<128?i:i+1)}function v1(i,e){return i.languageDataAt("closeBrackets",e)[0]||uo}var I5=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),G5=B.inputHandler.of((i,e,t,n)=>{if((I5?i.composing:i.compositionStarted)||i.state.readOnly)return!1;let s=i.state.selection.main;if(n.length>2||n.length==2&&dt(De(n,0))==1||e!=s.from||t!=s.to)return!1;let r=D5(i.state,n);return r?(i.dispatch(r),!0):!1}),W5=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let n=v1(i,i.selection.main.head).brackets||uo.brackets,s=null,r=i.changeByRange(o=>{if(o.empty){let a=N5(i.doc,o.head);for(let l of n)if(l==a&&ah(i.doc,o.head)==w1(De(l,0)))return{changes:{from:o.head-l.length,to:o.head+l.length},range:H.cursor(o.head-l.length)}}return{range:s=o}});return s||e(i.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!s},x1=[{key:"Backspace",run:W5}];function D5(i,e){let t=v1(i,i.selection.main.head),n=t.brackets||uo.brackets;for(let s of n){let r=w1(De(s,0));if(e==s)return r==s?O5(i,s,n.indexOf(s+s+s)>-1,t):A5(i,s,r,t.before||uo.before);if(e==r&&S1(i,i.selection.main.from))return H5(i,s,r)}return null}function S1(i,e){let t=!1;return i.field(y1).between(0,i.doc.length,n=>{n==e&&(t=!0)}),t}function ah(i,e){let t=i.sliceString(e,e+2);return t.slice(0,dt(De(t,0)))}function N5(i,e){let t=i.sliceString(e-2,e);return dt(De(t,0))==t.length?t:t.slice(1)}function A5(i,e,t,n){let s=null,r=i.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:t,from:o.to}],effects:Hn.of(o.to+e.length),range:H.range(o.anchor+e.length,o.head+e.length)};let a=ah(i.doc,o.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:e+t,from:o.head},effects:Hn.of(o.head+e.length),range:H.cursor(o.head+e.length)}:{range:s=o}});return s?null:i.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function H5(i,e,t){let n=null,s=i.changeByRange(r=>r.empty&&ah(i.doc,r.head)==t?{changes:{from:r.head,to:r.head+t.length,insert:t},range:H.cursor(r.head+t.length)}:n={range:r});return n?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function O5(i,e,t,n){let s=n.stringPrefixes||uo.stringPrefixes,r=null,o=i.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:e,from:a.to}],effects:Hn.of(a.to+e.length),range:H.range(a.anchor+e.length,a.head+e.length)};let l=a.head,h=ah(i.doc,l),c;if(h==e){if(h1(i,l))return{changes:{insert:e+e,from:l},effects:Hn.of(l+e.length),range:H.cursor(l+e.length)};if(S1(i,l)){let u=t&&i.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+u.length,insert:u},range:H.cursor(l+u.length)}}}else{if(t&&i.sliceDoc(l-2*e.length,l)==e+e&&(c=c1(i,l-2*e.length,s))>-1&&h1(i,c))return{changes:{insert:e+e+e+e,from:l},effects:Hn.of(l+e.length),range:H.cursor(l+e.length)};if(i.charCategorizer(l)(h)!=be.Word&&c1(i,l,s)>-1&&!V5(i,l,e,s))return{changes:{insert:e+e,from:l},effects:Hn.of(l+e.length),range:H.cursor(l+e.length)}}return{range:r=a}});return r?null:i.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function h1(i,e){let t=qe(i).resolveInner(e+1);return t.parent&&t.from==e}function V5(i,e,t,n){let s=qe(i).resolveInner(e,-1),r=n.reduce((o,a)=>Math.max(o,a.length),0);for(let o=0;o<5;o++){let a=i.sliceDoc(s.from,Math.min(s.to,s.from+t.length+r)),l=a.indexOf(t);if(!l||l>-1&&n.indexOf(a.slice(0,l))>-1){let c=s.firstChild;for(;c&&c.from==s.from&&c.to-c.from>t.length+l;){if(i.sliceDoc(c.to-t.length,c.to)==t)return!1;c=c.firstChild}return!0}let h=s.to==e&&s.parent;if(!h)break;s=h}return!1}function c1(i,e,t){let n=i.charCategorizer(e);if(n(i.sliceDoc(e-1,e))!=be.Word)return e;for(let s of t){let r=e-s.length;if(i.sliceDoc(r,e)==s&&n(i.sliceDoc(r-1,r))!=be.Word)return r}return-1}var k1=[{key:"Ctrl-Space",run:oh},{mac:"Alt-`",run:oh},{key:"Escape",run:_5},{key:"ArrowDown",run:sh(!0)},{key:"ArrowUp",run:sh(!1)},{key:"PageDown",run:sh(!0,"page")},{key:"PageUp",run:sh(!1,"page")},{key:"Enter",run:X5}];function C1(i){let e=i.field(On,!1);return e&&e.active.some(t=>t.isPending)?"pending":e&&e.active.some(t=>t.state!=0)?"active":null}var L1=[dl(),xb(),cl(),Cl(hb,{fallback:!0}),hi.of([...jb,...Cb])];var z5=i=>{let e=hf(i.state);return e.line?F5(i):e.block?Y5(i):!1};function lf(i,e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let s=i(e,t);return s?(n(t.update(s)),!0):!1}}var F5=lf(U5,0);var K5=lf(M1,0);var Y5=lf((i,e)=>M1(i,e,j5(e)),0),T1=[{key:"Mod-/",run:z5},{key:"Alt-A",run:K5}];function hf(i,e=i.selection.main.head){let t=i.languageDataAt("commentTokens",e);return t.length?t[0]:{}}var fo=50;function B5(i,{open:e,close:t},n,s){let r=i.sliceDoc(n-fo,n),o=i.sliceDoc(s,s+fo),a=/\s*$/.exec(r)[0].length,l=/^\s*/.exec(o)[0].length,h=r.length-a;if(r.slice(h-e.length,h)==e&&o.slice(l,l+t.length)==t)return{open:{pos:n-a,margin:a&&1},close:{pos:s+l,margin:l&&1}};let c,d;s-n<=2*fo?c=d=i.sliceDoc(n,s):(c=i.sliceDoc(n,n+fo),d=i.sliceDoc(s-fo,s));let u=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(d)[0].length,g=d.length-f-t.length;return c.slice(u,u+e.length)==e&&d.slice(g,g+t.length)==t?{open:{pos:n+u+e.length,margin:/\s/.test(c.charAt(u+e.length))?1:0},close:{pos:s-f-t.length,margin:/\s/.test(d.charAt(g-1))?1:0}}:null}function j5(i){let e=[];for(let t of i.selection.ranges){let n=i.doc.lineAt(t.from),s=t.to<=n.to?n:i.doc.lineAt(t.to),r=e.length-1;r>=0&&e[r].to>n.from?e[r].to=s.to:e.push({from:n.from,to:s.to})}return e}function M1(i,e,t=e.selection.ranges){let n=t.map(r=>hf(e,r.from).block);if(!n.every(r=>r))return null;let s=t.map((r,o)=>B5(e,n[o],r.from,r.to));if(i!=2&&!s.every(r=>r))return{changes:e.changes(t.map((r,o)=>s[o]?[]:[{from:r.from,insert:n[o].open+" "},{from:r.to,insert:" "+n[o].close}]))};if(i!=1&&s.some(r=>r)){let r=[];for(let o=0,a;o<s.length;o++)if(a=s[o]){let l=n[o],{open:h,close:c}=a;r.push({from:h.pos-l.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:r}}return null}function U5(i,e,t=e.selection.ranges){let n=[],s=-1;for(let{from:r,to:o}of t){let a=n.length,l=1e9;for(let h=r;h<=o;){let c=e.doc.lineAt(h);if(c.from>s&&(r==o||o>c.from)){s=c.from;let d=hf(e,h).line;if(!d)continue;let u=/^\s*/.exec(c.text)[0].length,f=u==c.length,g=c.text.slice(u,u+d.length)==d?u:-1;u<c.text.length&&u<l&&(l=u),n.push({line:c,comment:g,token:d,indent:u,empty:f,single:!1})}h=c.to+1}if(l<1e9)for(let h=a;h<n.length;h++)n[h].indent<n[h].line.text.length&&(n[h].indent=l);n.length==a+1&&(n[a].single=!0)}if(i!=2&&n.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:a,token:l,indent:h,empty:c,single:d}of n)(d||!c)&&r.push({from:a.from+h,insert:l+" "});let o=e.changes(r);return{changes:o,selection:e.selection.map(o,1)}}else if(i!=1&&n.some(r=>r.comment>=0)){let r=[];for(let{line:o,comment:a,token:l}of n)if(a>=0){let h=o.from+a,c=h+l.length;o.text[c-o.from]==" "&&c++,r.push({from:h,to:c})}return{changes:r}}return null}var J5="builtin",Vn="comment",P1="string",R1="symbol",po="atom",Z1="number",E1="bracket",Q5=2;function I1(i){for(var e={},t=i.split(" "),n=0;n<t.length;++n)e[t[n]]=!0;return e}var X1=I1("\u03BB case-lambda call/cc class cond-expand define-class define-values exit-handler field import inherit init-field interface let*-values let-values let/ec mixin opt-lambda override protect provide public rename require require-for-syntax syntax syntax-case syntax-error unit/sig unless when with-syntax and begin call-with-current-continuation call-with-input-file call-with-output-file case cond define define-syntax define-macro defmacro delay do dynamic-wind else for-each if lambda let let* let-syntax letrec letrec-syntax map or syntax-rules abs acos angle append apply asin assoc assq assv atan boolean? caar cadr call-with-input-file call-with-output-file call-with-values car cdddar cddddr cdr ceiling char->integer char-alphabetic? char-ci<=? char-ci<? char-ci=? char-ci>=? char-ci>? char-downcase char-lower-case? char-numeric? char-ready? char-upcase char-upper-case? char-whitespace? char<=? char<? char=? char>=? char>? char? close-input-port close-output-port complex? cons cos current-input-port current-output-port denominator display eof-object? eq? equal? eqv? eval even? exact->inexact exact? exp expt #f floor force gcd imag-part inexact->exact inexact? input-port? integer->char integer? interaction-environment lcm length list list->string list->vector list-ref list-tail list? load log magnitude make-polar make-rectangular make-string make-vector max member memq memv min modulo negative? newline not null-environment null? number->string number? numerator odd? open-input-file open-output-file output-port? pair? peek-char port? positive? procedure? quasiquote quote quotient rational? rationalize read read-char real-part real? remainder reverse round scheme-report-environment set! set-car! set-cdr! sin sqrt string string->list string->number string->symbol string-append string-ci<=? string-ci<? string-ci=? string-ci>=? string-ci>? string-copy string-fill! string-length string-ref string-set! string<=? string<? string=? string>=? string>? string? substring symbol->string symbol? #t tan transcript-off transcript-on truncate values vector vector->list vector-fill! vector-length vector-ref vector-set! with-input-from-file with-output-to-file write write-char zero?"),$5=I1("define let letrec let* lambda define-macro defmacro let-syntax letrec-syntax let-values let*-values define-syntax syntax-rules define-values when unless");function q5(i,e,t){this.indent=i,this.type=e,this.prev=t}function cf(i,e,t){i.indentStack=new q5(e,t,i.indentStack)}function eT(i){i.indentStack=i.indentStack.prev}var tT=new RegExp(/^(?:[-+]i|[-+][01]+#*(?:\/[01]+#*)?i|[-+]?[01]+#*(?:\/[01]+#*)?@[-+]?[01]+#*(?:\/[01]+#*)?|[-+]?[01]+#*(?:\/[01]+#*)?[-+](?:[01]+#*(?:\/[01]+#*)?)?i|[-+]?[01]+#*(?:\/[01]+#*)?)(?=[()\s;"]|$)/i),iT=new RegExp(/^(?:[-+]i|[-+][0-7]+#*(?:\/[0-7]+#*)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?@[-+]?[0-7]+#*(?:\/[0-7]+#*)?|[-+]?[0-7]+#*(?:\/[0-7]+#*)?[-+](?:[0-7]+#*(?:\/[0-7]+#*)?)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?)(?=[()\s;"]|$)/i),nT=new RegExp(/^(?:[-+]i|[-+][\da-f]+#*(?:\/[\da-f]+#*)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?@[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?[-+](?:[\da-f]+#*(?:\/[\da-f]+#*)?)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?)(?=[()\s;"]|$)/i),sT=new RegExp(/^(?:[-+]i|[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)i|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)@[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)?i|(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*))(?=[()\s;"]|$)/i);function rT(i){return i.match(tT)}function oT(i){return i.match(iT)}function df(i,e){return e===!0&&i.backUp(1),i.match(sT)}function aT(i){return i.match(nT)}function _1(i,e){for(var t,n=!1;(t=i.next())!=null;){if(t==e.token&&!n){e.state.mode=!1;break}n=!n&&t=="\\"}}var G1={name:"scheme",startState:function(){return{indentStack:null,indentation:0,mode:!1,sExprComment:!1,sExprQuote:!1}},token:function(i,e){if(e.indentStack==null&&i.sol()&&(e.indentation=i.indentation()),i.eatSpace())return null;var t=null;switch(e.mode){case"string":_1(i,{token:'"',state:e}),t=P1;break;case"symbol":_1(i,{token:"|",state:e}),t=R1;break;case"comment":for(var n,s=!1;(n=i.next())!=null;){if(n=="#"&&s){e.mode=!1;break}s=n=="|"}t=Vn;break;case"s-expr-comment":if(e.mode=!1,i.peek()=="("||i.peek()=="[")e.sExprComment=0;else{i.eatWhile(/[^\s\(\)\[\]]/),t=Vn;break}default:var r=i.next();if(r=='"')e.mode="string",t=P1;else if(r=="'")i.peek()=="("||i.peek()=="["?(typeof e.sExprQuote!="number"&&(e.sExprQuote=0),t=po):(i.eatWhile(/[\w_\-!$%&*+\.\/:<=>?@\^~]/),t=po);else if(r=="|")e.mode="symbol",t=R1;else if(r=="#")if(i.eat("|"))e.mode="comment",t=Vn;else if(i.eat(/[tf]/i))t=po;else if(i.eat(";"))e.mode="s-expr-comment",t=Vn;else{var o=null,a=!1,l=!0;i.eat(/[ei]/i)?a=!0:i.backUp(1),i.match(/^#b/i)?o=rT:i.match(/^#o/i)?o=oT:i.match(/^#x/i)?o=aT:i.match(/^#d/i)?o=df:i.match(/^[-+0-9.]/,!1)?(l=!1,o=df):a||i.eat("#"),o!=null&&(l&&!a&&i.match(/^#[ei]/i),o(i)&&(t=Z1))}else if(/^[-+0-9.]/.test(r)&&df(i,!0))t=Z1;else if(r==";")i.skipToEnd(),t=Vn;else if(r=="("||r=="["){for(var h="",c=i.column(),d;(d=i.eat(/[^\s\(\[\;\)\]]/))!=null;)h+=d;h.length>0&&$5.propertyIsEnumerable(h)?cf(e,c+Q5,r):(i.eatSpace(),i.eol()||i.peek()==";"?cf(e,c+1,r):cf(e,c+i.current().length,r)),i.backUp(i.current().length-1),typeof e.sExprComment=="number"&&e.sExprComment++,typeof e.sExprQuote=="number"&&e.sExprQuote++,t=E1}else r==")"||r=="]"?(t=E1,e.indentStack!=null&&e.indentStack.type==(r==")"?"(":"[")&&(eT(e),typeof e.sExprComment=="number"&&--e.sExprComment==0&&(t=Vn,e.sExprComment=!1),typeof e.sExprQuote=="number"&&--e.sExprQuote==0&&(t=po,e.sExprQuote=!1))):(i.eatWhile(/[\w_\-!$%&*+\.\/:<=>?@\^~]/),X1&&X1.propertyIsEnumerable(i.current())?t=J5:t="variable")}return typeof e.sExprComment=="number"?Vn:typeof e.sExprQuote=="number"?po:t},indent:function(i){return i.indentStack==null?i.indentation:i.indentStack.indent},languageData:{closeBrackets:{brackets:["(","[","{",'"']},commentTokens:{line:";;"}}};var ff=Ny||function(){let i={cursorBlinkRate:1200};return function(){return i}}(),pf=class{constructor(e,t,n,s,r,o,a,l,h,c){this.left=e,this.top=t,this.height=n,this.fontFamily=s,this.fontSize=r,this.fontWeight=o,this.color=a,this.className=l,this.letter=h,this.partial=c}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",e.style.height=this.height+"px",e.style.lineHeight=this.height+"px",e.style.fontFamily=this.fontFamily,e.style.fontSize=this.fontSize,e.style.fontWeight=this.fontWeight,e.style.color=this.partial?"transparent":this.color,e.className=this.className,e.textContent=this.letter}eq(e){return this.left==e.left&&this.top==e.top&&this.height==e.height&&this.fontFamily==e.fontFamily&&this.fontSize==e.fontSize&&this.fontWeight==e.fontWeight&&this.color==e.color&&this.className==e.className&&this.letter==e.letter}},mf=class{constructor(e,t){this.view=e,this.rangePieces=[],this.cursors=[],this.em=t,this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),e.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){let t=ff(this.view.state).cursorBlinkRate;this.cursorLayer.style.animationDuration=t+"ms"}update(e){(e.selectionSet||e.geometryChanged||e.viewportChanged)&&(this.view.requestMeasure(this.measureReq),this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),lT(e)&&this.setBlinkRate()}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:e}=this.view,t=[];for(let n of e.selection.ranges){let s=n==e.selection.main,r=uT(this.em,this.view,n,s);r&&t.push(r)}return{cursors:t}}drawSel({cursors:e}){if(e.length!=this.cursors.length||e.some((t,n)=>!t.eq(this.cursors[n]))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(let n of e)this.cursorLayer.appendChild(n.draw())}else e.forEach((n,s)=>n.adjust(t[s]));this.cursors=e}}destroy(){this.cursorLayer.remove()}};function lT(i){return ff(i.startState)!=ff(i.state)}var hT={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696",color:"transparent !important"}},cT=Ot.highest(B.theme(hT));function dT(i){let e=i.scrollDOM.getBoundingClientRect();return{left:(i.textDirection==ae.LTR?e.left:e.right-i.scrollDOM.clientWidth)-i.scrollDOM.scrollLeft,top:e.top-i.scrollDOM.scrollTop}}function uT(i,e,t,n){var s,r;let o=t.head,a=1;(i.$data.count||i.$data.keyChain)&&(a=.5);{let h=o<e.state.doc.length&&e.state.sliceDoc(o,o+1);h&&/[\uDC00-\uDFFF]/.test(h)&&o>1&&(o--,h=e.state.sliceDoc(o,o+1));let c=e.coordsAtPos(o,1);if(!c)return null;let d=dT(e),u=e.domAtPos(o),f=u?u.node:e.contentDOM;for(;u&&u.node instanceof HTMLElement;)f=u.node,u={node:u.node.childNodes[u.offset],offset:0};if(!(f instanceof HTMLElement)){if(!f.parentNode)return null;f=f.parentNode}let g=getComputedStyle(f),C=c.left,p=(r=(s=e).coordsForChar)===null||r===void 0?void 0:r.call(s,o);if(p&&(C=p.left),!h||h==`
`||h=="\r")h="\xA0";else if(h=="	"){h="\xA0";var l=e.coordsAtPos(o+1,-1);l&&(C=l.left-(l.left-c.left)/parseInt(g.tabSize))}else/[\uD800-\uDBFF]/.test(h)&&o<e.state.doc.length-1&&(h+=e.state.sliceDoc(o+1,o+2));let k=c.bottom-c.top;return new pf(C-d.left,c.top-d.top+k*(1-a),k*a,g.fontFamily,g.fontSize,g.fontWeight,g.color,n?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",h,a!=1)}}var fT=B.theme({".cm-emacsMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"5px 10px",backgroundColor:"#fffa8f",fontFamily:"monospace"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"#fffa8f"}}),pT=_e.fromClass(class{constructor(i){this.status="",this.view=i,this.em=new mo(i),this.blockCursor=new mf(i,this.em),this.view.scrollDOM.classList.add("cm-emacsMode")}update(i){i.docChanged&&(this.em.$emacsMark=null,this.em.updateMarksOnChange(i.changes)),this.blockCursor.update(i)}destroy(){this.view.scrollDOM.classList.remove("cm-emacsMode"),this.blockCursor.destroy()}},{eventHandlers:{keydown:function(i,e){var t=this.em.handleKeyboard(i);return t&&this.blockCursor.scheduleRedraw(),!!t},mousedown:function(){this.em.$emacsMark=null}}}),mT=ee.define(),gT=Ze.define({create:()=>!1,update(i,e){for(let t of e.effects)t.is(mT)&&(i=t.value);return i},provide:i=>xs.from(i,e=>e?yT:null)});function yT(i){let e=document.createElement("div");return e.className="cm-vim-panel",{top:!1,dom:e}}function N1(i={}){return[fT,pT,cT,gT]}var bT={Return:"Return",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"Return",Divide:"/",Slash:"/",Multiply:"*",Subtract:"-",Minus:"-",Equal:"="},wT={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1},uf={},mo=class i{constructor(e){this.view=e,this.$data={count:0,keyChain:"",lastCommand:""},this.$emacsMarkRing=[],this.$emacsMark=null}static bindKey(e,t){e.split("|").forEach(function(n){let s="",r=n.split(/\s+/);r.forEach(function(o,a){let l=o.split(/-(?=.)/),h=l.pop();l.length&&(s+=l.sort().join("-")+"-"),s+=h,a===r.length-1?uf[s]=t:(uf[s]="null",s+=" ")})})}static getKey(e){var t=e.code,n=e.key;if(wT[n])return["","",""];t.length>1&&(t[0]=="N"&&(t=t.replace(/^Numpad/,"")),t[0]=="K"&&(t=t.replace(/^Key/,""))),t=bT[t]||t,t.length==1&&(t=t.toLowerCase());var s="";return e.ctrlKey&&(s+="C-"),e.metaKey&&(s+="CMD-"),e.altKey&&(s+="M-"),e.shiftKey&&(s+="S-"),[t,s,n]}static addCommands(e){Object.keys(e).forEach(function(t){var n=e[t];typeof n=="function"&&(n={exec:n}),i.commands[t]=n})}static execCommand(e,t,n,s=1){var r=void 0;if(s<0&&(s=-s),typeof e=="function")for(var o=0;o<s;o++)e(t.view);else if(e!=="null")if(e.exec){s>1&&e.handlesCount&&(n||(n={}),typeof n=="object"&&(n.count=s),s=1);for(var o=0;o<s;o++)r=e.exec(t,n||{})}else throw new Error("missformed command");return r}handleKeyboard(e){var t=i.getKey(e),n=this.findCommand(t);if(!(/Up|Down/.test(t?.[0])&&C1(this.view.state))){if(n&&n.command){var s=i.execCommand(n.command,this,n.args,n.count);if(s===!1)return}return n}}findCommand([e,t,n]){if(e){var s=this,r=this.$data;if(!t&&e.length==1&&(s.pushEmacsMark(),r.count)){var o=new Array(r.count+1).join(n);return r.count=null,{command:"insertstring",args:o}}if(t=="C-"||r.count){var h=parseInt(e[e.length-1]);if(typeof h=="number"&&!isNaN(h))return r.count=Math.max(r.count||0,0),r.count=10*r.count+h,{command:"null"}}t&&(e=t+e),r.keyChain&&(e=r.keyChain+=" "+e);var a=uf[e];if(r.keyChain=a=="null"?e:"",!!a){if(a==="null")return{command:"null"};if(a==="universalArgument")return r.count=-4,{command:"null"};var l;if(typeof a!="string"&&(l=a.args,a.command&&(a=a.command)),(a==="insertstring"||a===Fl||a===El)&&s.pushEmacsMark(),!(typeof a=="string"&&(a=i.commands[a],!a))){!a.readOnly&&!a.keepLastCommand&&(r.lastCommand=null);var h=r.count||1;return r.count&&(r.count=0),{command:a,args:l,count:h}}}}}showCommandLine(e){console.error("TODO")}updateMarksOnChange(e){this.$emacsMark&&(this.$emacsMark=this.updateMark(this.$emacsMark,e)),this.$emacsMarkRing=this.$emacsMarkRing.map(t=>this.updateMark(t,e)).filter(Boolean)}updateMark(e,t){if(e){var n=e.map(function(s){return t.mapPos(s,1,Xe.TrackDel)}).filter(s=>s!=null);return n.length==0?null:n}}emacsMark(){return this.$emacsMark}setEmacsMark(e){this.$emacsMark=e}pushEmacsMark(e,t){var n=this.$emacsMark;n&&W1(this.$emacsMarkRing,n),!e||t?this.setEmacsMark(e):W1(this.$emacsMarkRing,e)}popEmacsMark(){var e=this.emacsMark();return e?(this.setEmacsMark(null),e):this.$emacsMarkRing.pop()}getLastEmacsMark(){return this.$emacsMark||this.$emacsMarkRing.slice(-1)[0]}getCopyText(){var e=this.view.state;return e.selection.ranges.map(t=>e.sliceDoc(t.from,t.to)).join(`
`)}clearSelection(){var e=this.view,t=e.state.selection,n=!t.ranges.some(r=>r.from!=r.to);if(n)return!1;var s=t.ranges.map(r=>H.range(r.head,r.head));return e.dispatch({selection:H.create(s,t.mainIndex)}),!0}onPaste(e){var t=this.view,n=t.state.selection,s;if(n.ranges.length>1){var r=e.split(`
`);r.length==n.ranges.length&&(s=r)}var o=0,a=t.state.changeByRange(l=>{var h=s?s[o]:e;return o++,{changes:{from:l.from,to:l.to,insert:h},range:H.cursor(l.from+h.length)}});t.dispatch(a)}selectionToEmacsMark(){var e=this.view.state.selection;return e.ranges.map(t=>t.head)}};mo.commands={};function W1(i,e){i.length&&i[i.length-1]+""==e+""||i.push(e)}var D1={"Up|C-p":{command:"goOrSelect",args:[Dl,so]},"Down|C-n":{command:"goOrSelect",args:[Nl,ro]},"Left|C-b":{command:"goOrSelect",args:[Pb,Iu]},"Right|C-f":{command:"goOrSelect",args:[Mb,_u]},"C-Left|M-b":{command:"goOrSelect",args:[Ru,Gu]},"C-Right|M-f":{command:"goOrSelect",args:[Zu,Wu]},"Home|C-a":{command:"goOrSelect",args:[Eu,Ol]},"End|C-e":{command:"goOrSelect",args:[Xu,Vl]},"C-Home|S-M-,":{command:"goOrSelect",args:[Rl,to]},"C-End|S-M-.":{command:"goOrSelect",args:[Zl,io]},"S-Up|S-C-p":so,"S-Down|S-C-n":ro,"S-Left|S-C-b":Iu,"S-Right|S-C-f":_u,"S-C-Left|S-M-b":Wb,"S-C-Right|S-M-f":Gb,"S-Home|S-C-a":Ol,"S-End|S-C-e":Vl,"S-C-Home":to,"S-C-End":io,"C-l":"recenterTopBottom","M-s":"centerSelection","M-g":"gotoline","C-x C-p|C-x h":Du,"PageDown|C-v|C-Down":{command:"goOrSelect",args:[eo,Ps]},"PageUp|M-v|C-Up":{command:"goOrSelect",args:[Ml,Ps]},"S-C-Down":Ps,"S-C-Up":Pl,"C-s":nh,"C-r":nh,"M-C-s":"findnext","M-C-r":"findprevious","S-M-5":"replace",Backspace:no,"Delete|C-d":zl,"Return|C-m":{command:"insertstring",args:`
`},"C-o":Fl,"M-d|C-Delete":{command:"killWord",args:"right"},"C-Backspace|M-Backspace|M-Delete":{command:"killWord",args:"left"},"C-k":"killLine","M-h":"selectParagraph","M-@|M-S-2":"markWord","C-y|S-Delete":"yank","M-y":"yankRotate","C-g":"keyboardQuit","C-w|C-S-w":"killRegion","M-w":"killRingSave","C-Space":"setMark","C-x C-x":"exchangePointAndMark","C-t":Nu,"M-u":{command:"changeCase",args:{dir:1}},"M-l":{command:"changeCase",args:{dir:-1}},"C-x C-u":{command:"changeCase",args:{dir:1,region:!0}},"C-x C-l":{command:"changeCase",args:{dir:1,region:!0}},"M-/":oh,"C-u":"universalArgument","M-;":El,"C-/|C-x u|S-C--|C-z":_l,"S-C-/|S-C-x u|C--|S-C-z":qr,"C-x r":"selectRectangularRegion","M-x":{command:"focusCommandLine",args:"M-x "},Esc:"unsetTransientMark"};for(let i in D1)D1[i];var vT="#282828",xT="#3c3836",ST="#665c54",kT="#928374",CT="#ebdbb2",LT="#d5c4a1",TT="#bdae93",MT="#a89984",PT="#fb4934",RT="#b8bb26",ZT="#fabd2f",z1="#83a598",ET="#d3869b",XT="#8ec07c",_T="#fe8019",F1=vT,bf=xT,go=ST,A1=kT,_s=CT,IT=LT,GT=TT,WT=MT,dh=PT,lh=RT,yo=ZT,H1=z1,hh=ET,ch=XT,uh=_T,O1=dh,wf=bf,gf=wf,DT=F1,yf=bf,NT=wf,V1=uh,AT=B.theme({"&":{color:_s,backgroundColor:DT},".cm-content":{caretColor:V1},".cm-cursor, .cm-dropCursor":{borderLeftColor:V1},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:NT},".cm-panels":{backgroundColor:wf,color:_s},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:F1,color:yo,outline:`1px solid ${go}`},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:go},".cm-activeLine":{backgroundColor:gf},".cm-selectionMatch":{backgroundColor:go},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{outline:`1px solid ${go}`,fontStyle:"bold"},"&.cm-focused .cm-matchingBracket":{backgroundColor:go},".cm-gutters":{backgroundColor:bf,color:GT,border:"none"},".cm-activeLineGutter":{backgroundColor:gf},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:yf},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:yf,borderBottomColor:yf},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:gf,color:IT}}},{dark:!0}),HT=Ts.define([{tag:G.keyword,color:dh},{tag:[G.name,G.deleted,G.character,G.propertyName,G.macroName],color:ch},{tag:[G.variableName],color:H1},{tag:[G.function(G.variableName)],color:lh,fontStyle:"bold"},{tag:[G.labelName],color:_s},{tag:[G.color,G.constant(G.name),G.standard(G.name)],color:hh},{tag:[G.definition(G.name),G.separator],color:_s},{tag:[G.brace],color:_s},{tag:[G.annotation],color:O1},{tag:[G.number,G.changed,G.annotation,G.modifier,G.self,G.namespace],color:hh},{tag:[G.typeName,G.className],color:yo},{tag:[G.operator,G.operatorKeyword],color:dh},{tag:[G.tagName],color:ch,fontStyle:"bold"},{tag:[G.squareBracket],color:uh},{tag:[G.angleBracket],color:H1},{tag:[G.attributeName],color:ch},{tag:[G.regexp],color:ch},{tag:[G.quote],color:A1},{tag:[G.string],color:_s},{tag:G.link,color:WT,textDecoration:"underline",textUnderlinePosition:"under"},{tag:[G.url,G.escape,G.special(G.string)],color:hh},{tag:[G.meta],color:yo},{tag:[G.comment],color:A1,fontStyle:"italic"},{tag:G.strong,fontWeight:"bold",color:uh},{tag:G.emphasis,fontStyle:"italic",color:lh},{tag:G.strikethrough,textDecoration:"line-through"},{tag:G.heading,fontWeight:"bold",color:lh},{tag:[G.heading1,G.heading2],fontWeight:"bold",color:lh},{tag:[G.heading3,G.heading4],fontWeight:"bold",color:yo},{tag:[G.heading5,G.heading6],color:yo},{tag:[G.atom,G.bool,G.special(G.variableName)],color:hh},{tag:[G.processingInstruction,G.inserted],color:z1},{tag:[G.contentSeparator],color:dh},{tag:G.invalid,color:uh,borderBottom:`1px dotted ${O1}`}]),K1=[AT,Cl(HT)];function OT(i,e=i.state){let t=new Set;for(let{from:n,to:s}of i.visibleRanges){let r=n;for(;r<=s;){let o=e.doc.lineAt(r);t.has(o)||t.add(o),r=o.to+1}}return t}function vf(i){let e=i.selection.main.head;return i.doc.lineAt(e)}function Y1(i,e){let t=0;e:for(let n=0;n<i.length;n++)switch(i[n]){case" ":case"\xA0":{t+=1;continue e}case"	":{t+=e-t%e;continue e}case"\r":continue e;default:break e}return t}var ph=Y.define({combine(i){return ut(i,{highlightActiveBlock:!0,hideFirstIndent:!1,markerType:"fullScope",thickness:1})}}),xf=class{constructor(e,t,n,s){this.lines=e,this.state=t,this.map=new Map,this.unitWidth=n,this.markerType=s;for(let r of this.lines)this.add(r);this.state.facet(ph).highlightActiveBlock&&this.findAndSetActiveLines()}has(e){return this.map.has(typeof e=="number"?e:e.number)}get(e){let t=this.map.get(typeof e=="number"?e:e.number);if(!t)throw new Error("Line not found in indentation map");return t}set(e,t,n){let s=!e.text.trim().length,r={line:e,col:t,level:n,empty:s};return this.map.set(r.line.number,r),r}add(e){if(this.has(e))return this.get(e);if(!e.length||!e.text.trim().length){if(e.number===1)return this.set(e,0,0);if(e.number===this.state.doc.lines){let o=this.closestNonEmpty(e,-1);return this.set(e,0,o.level)}let s=this.closestNonEmpty(e,-1),r=this.closestNonEmpty(e,1);return s.level>=r.level&&this.markerType!=="codeOnly"?this.set(e,0,s.level):s.empty&&s.level===0&&r.level!==0?this.set(e,0,0):r.level>s.level?this.set(e,0,s.level+1):this.set(e,0,r.level)}let t=Y1(e.text,this.state.tabSize),n=Math.floor(t/this.unitWidth);return this.set(e,t,n)}closestNonEmpty(e,t){let n=e.number+t;for(;t===-1?n>=1:n<=this.state.doc.lines;){if(this.has(n)){let o=this.get(n);if(!o.empty)return o}let r=this.state.doc.line(n);if(r.text.trim().length){let o=Y1(r.text,this.state.tabSize),a=Math.floor(o/this.unitWidth);return this.set(r,o,a)}n+=t}let s=this.state.doc.line(t===-1?1:this.state.doc.lines);return this.set(s,0,0)}findAndSetActiveLines(){let e=vf(this.state);if(!this.has(e))return;let t=this.get(e);if(this.has(t.line.number+1)){let r=this.get(t.line.number+1);r.level>t.level&&(t=r)}if(this.has(t.line.number-1)){let r=this.get(t.line.number-1);r.level>t.level&&(t=r)}if(t.level===0)return;t.active=t.level;let n,s;for(n=t.line.number;n>1;n--){if(!this.has(n-1))continue;let r=this.get(n-1);if(r.level<t.level)break;r.active=t.level}for(s=t.line.number;s<this.state.doc.lines;s++){if(!this.has(s+1))continue;let r=this.get(s+1);if(r.level<t.level)break;r.active=t.level}}};function VT(i){let e={light:"#F0F1F2",dark:"#2B3245",activeLight:"#E4E5E6",activeDark:"#3C445C"},t=e;return i&&(t=Object.assign(Object.assign({},e),i)),B.baseTheme({"&light":{"--indent-marker-bg-color":t.light,"--indent-marker-active-bg-color":t.activeLight},"&dark":{"--indent-marker-bg-color":t.dark,"--indent-marker-active-bg-color":t.activeDark},".cm-line":{position:"relative"},".cm-indent-markers::before":{content:'""',position:"absolute",top:0,left:"2px",right:0,bottom:0,background:"var(--indent-markers)",pointerEvents:"none",zIndex:"-1"}})}function fh(i,e,t,n,s){return`${`repeating-linear-gradient(to right, var(${i}) 0 ${e}px, transparent ${e}px ${t}ch)`} ${n*t}.5ch/calc(${t*s}ch - 1px) no-repeat`}function zT(i,e,t,n,s){let{level:r,active:o}=i;if(s=s??n,t&&r===0)return[];let a=t?1:0,l=[];if(o!==void 0){let h=o-a-1;h>0&&l.push(fh("--indent-marker-bg-color",n,e,a,h)),l.push(fh("--indent-marker-active-bg-color",s,e,o-1,1)),o!==r&&l.push(fh("--indent-marker-bg-color",n,e,o,r-o))}else l.push(fh("--indent-marker-bg-color",n,e,a,r-a));return l.join(",")}var Sf=class{constructor(e){this.view=e,this.unitWidth=Kt(e.state),this.currentLineNumber=vf(e.state).number,this.generate(e.state)}update(e){let t=Kt(e.state),n=t!==this.unitWidth;n&&(this.unitWidth=t);let s=vf(e.state).number,r=s!==this.currentLineNumber;this.currentLineNumber=s;let o=e.state.facet(ph).highlightActiveBlock&&r;(e.docChanged||e.viewportChanged||n||o)&&this.generate(e.state)}generate(e){let t=new Tt,n=OT(this.view,e),{hideFirstIndent:s,markerType:r,thickness:o,activeThickness:a}=e.facet(ph),l=new xf(n,e,this.unitWidth,r);for(let h of n){let c=l.get(h.number);if(!c?.level)continue;let d=zT(c,this.unitWidth,s,o,a);t.add(h.from,h.from,ne.line({class:"cm-indent-markers",attributes:{style:`--indent-markers: ${d}`}}))}this.decorations=t.finish()}};function B1(i={}){return[ph.of(i),VT(i.colors),_e.fromClass(Sf,{decorations:e=>e.decorations})]}var FT=["(include-macros)",'(apropos "def")'],Is=class{constructor(e,t){let n=[L1,K1,N1(),xl.define(G1),cl(),Su(),b1(),dl(),B1(),xu(),hi.of(T1),hi.of(Ub),hi.of(x1),hi.of(k1),hi.of([{key:"Ctrl-Enter",run:j1(this)},{key:"Alt-Enter",run:j1(this)},{key:"Ctrl-r",run:KT},{key:"Ctrl-P",run:r=>this.prevhist()},{key:"Alt-p",run:r=>this.prevhist(),preventDefault:!0},{key:"Mod-p",run:r=>this.prevhist(),preventDefault:!0},{key:"Alt-n",run:r=>this.nexthist(),preventDefault:!0},{key:"Mod-n",run:r=>this.nexthist(),preventDefault:!0},{key:"Ctrl-n",run:r=>this.nexthist(),preventDefault:!0},{key:"Ctrl-c",run:Q1(this)},{key:"Ctrl-h",run:J1(this)},{key:"Alt-h",run:J1(this)},{key:"Ctrl-Shift-f",run:U1()},{key:"Alt-f",run:U1()},{key:"Alt-q",run:Hu}])];this.view=new B({state:ce.create({extensions:n}),parent:e}),this.history=localStorage.getItem("history")?JSON.parse(localStorage.getItem("history")):FT||[],e.addEventListener("ontouchmove",r=>r.preventDefault()),e.addEventListener("mouseenter",r=>this.getfocus(r)),e.addEventListener("focus",r=>this.getfocus()),YT(this);let s=document.querySelector("#repldiv");setTimeout(()=>s.classList.remove("repldiv0"),800),setTimeout(()=>s.classList.add("repldivtransition"),1e3),$1("hidden"),this.vm=t||new gr(this.initrcv.bind(this)),setTimeout(()=>this.eval("#t"),200)}initrcv(e){console.warn("initrcv",JSON.stringify(e)),e.startsWith("Gambit")||e.startsWith("GAMBEXT")?this.banner=e:e.match(":sentinel:")&&(this.vm.callback=this.rcv.bind(this)),this.vm.callback=this.rcv.bind(this)}rcv(e){this.append(e)}getfocus(e){this.focus()}reparent(e){let t=this.view.state;this.view.destroy(),this.view=new B({state:t,parent:e}),e.addEventListener("ontouchmove",n=>n.preventDefault()),e.addEventListener("mouseenter",n=>this.focus()),e.addEventListener("focus",n=>this.focus())}cfocus(){this.view.focus()}focus(){this.view.focus()}unfocus(){this.view.contentDOM.blur(),document.querySelector("#limina").focus()}insertat(e,t){let n=this.view.state.doc,s=n.length+t.length;this.view.dispatch({changes:{from:e,insert:t},selection:{anchor:s},scrollIntoView:!0})}deleterange(e,t){this.view.dispatch({changes:{from:e,to:t}})}setselection(e){this.view.dispatch({selection:{anchor:e},scrollIntoView:!0})}append(e){this.insertat(this.view.state.doc.length,e)}docstring(){return this.view.state.doc.toString()}eval(e){return this.vm.eval(e)}evalview(){let e=this.view.state.doc.toString(),t=e.lastIndexOf("> "),n=e.substring(t+2);this.append(`
`),this.history.push(n),this.histcursor=this.history.length-1,localStorage.setItem("history",JSON.stringify(this.history)),this.vm.eval(n)}histcursor=0;prevhist(){this.dhist(-1)}nexthist(){this.dhist(1)}dhist(e){if(!this.history.length)return;this.histcursor+=e,this.histcursor<0&&(this.histcursor=this.history.length-1),this.histcursor==this.history.length&&(this.histcursor=0);let t=this.view.state.doc.toString(),n=t.lastIndexOf("> ");this.deleterange(n+2,t.length);let s=this.history[this.histcursor];this.insertat(n+2,s)}};function j1(i){return e=>(i.append(" "),i.evalview(),!0)}function U1(){return i=>(ca(null,document.body),!0)}var KT=i=>(console.warn("repl.reload"),window.lim.reload(),!0);function J1(i){return e=>(window.lim.home(),!0)}function Q1(i){return e=>(e.contentDOM.blur(),document.querySelector("#limina").focus(),!0)}window.unfocus=Q1;function kf(i){let e=document.createElement("div");return e.classList.add("replbutton"),e.innerText=i,e}function YT(i){let e=document.querySelector("#replbuttons"),t=kf("\u1403");t.addEventListener("click",()=>i.prevhist()),e.appendChild(t),t=kf("\u1401"),t.addEventListener("click",()=>i.nexthist()),e.appendChild(t),t=kf("\u808F"),t.addEventListener("click",()=>{i.evalview(),i.focus()}),e.appendChild(t)}Is.info={version:.1,revision:1625,lastmod:"last modified: Thu Oct 16 14:09:44 2025"};function BT(i){let e=document.createElement("div");e.setAttribute("id",i),e.class="repldiv",e.style.width="600px",e.style.height="200px",document.body.appendChild(e);let t=new Is(e);return t.div=e,t.eval('(begin (println ";;; :sentinel:"))'),t}window.newrepl=BT;function $1(i){let e=document.querySelectorAll(".cm-scroller");for(let t=0;t<e.length;t++)e[t].style.overflowX=i}window.hackscroller=$1;var qt=Ci(l2());var a_=new Error("timeout while waiting for mutex to become available"),l_=new Error("mutex already locked"),h_=new Error("request for lock canceled");window.Croquet=qt;qt.App.root=!1;var PP={},d2,Vi,RP;async function u2(i){console.warn("qcell.startsession",i);let e=(await import("./config-KC3BG65X.js")).config;console.warn("qcell.startsession",e),qt.Session.join({appId:e.appId,apiKey:e.apiKey,name:e.name+"/"+i,password:e.pass,model:ac,view:em}).then(t=>{uptime("sn")})}window.startsession=u2;var $p=class{constructor(e,t){this.name=e,this.root=t||new kn,this.viewobjs={},f2[e]=this}attach(e){e.root.add(this.root)}viewobj(e){return this.viewobjs[e]}setviewobj(e,t){return this.viewobjs[e]=t}killviewobj(e){}add(e){this.root.add(e)}remove(e){this.root.remove(e)}buildviewobj(e){let t=n=>(n instanceof _Scheme&&(n=_foreign2host(n)),e.linkviewobj(n),n.modelsync=s=>e.modelsync(s),this.add(n),n.twin&&lim.cssscene.add(n.twin),n);try{let n=(0,eval)(e.ctor)(e);n instanceof Promise?n.then(t):t(n)}catch(n){console.warn("ctor error",n)}}},f2={};function im(i){return new $p(i)}window.startcell=im;var p2="c0";function zi(i){return i||(i=p2),f2[i]}var ac=class extends qt.Model{init(){super.init(),this.cellname="c0",this.objmap=new Map,this.namemap=new Map,this.subscribe(this.sessionId,"view-join",this._viewjoined),this.subscribe(this.sessionId,"view-exit",this._viewexited),this.subscribe(this.sessionId,"makeobj",this._makeobj),this.subscribe(this.sessionId,"killobj",this._killobj),console.log("QCell",this)}objs(){return Array.from(this.objmap.values())}getobj(e){return this.objmap.get(e)}getobjbyname(e){return this.namemap.get(e)}_viewjoined(e){this.viewid=e,Vi=window.currentcell=this;let t=zi(this.cellname);t?t.model=this:console.warn("viewjoined: null cellrep",this.cellname)}_viewexited(e){this.viewid=null}_makeobj([e,t,n]){let s=this.getobjbyname(e);s||(s=sa.create([e,t,this.cellname]),this.objmap.set(s.id,s),this.namemap.set(e,s));let r=sR(n,"then die");return r&&setTimeout(()=>r(s),0),s}_killobj(e){let t=e instanceof sa?e:this.getobj(e);this.objmap.delete(e),t&&(this.namemap.delete(t.name),t._kill())}work(e){this.$worklist||(this.$worklist=[]),this.$worklist.push(e),this.future(0).dowork()}dowork(e){try{for(;this.$worklist.length;)this.$worklist.shift()()}catch(t){window.lasterr=t,console.warn("dowork err",this.$worklist&&this.$worklist.length,e)}}static types(){return{"THREE.Color":ym}}};ac.register("QCell");var h2,sa=class extends qt.Model{init([e,t,n]){super.init(),this.cellname=n,this.data={},this.name=e,this.ctor=t,this.scale=[1,1,1],this.position=[0,0,0],this.quaternion=[0,0,0,1],this.subscribe(this.id,"setpos",this._setpos),this.subscribe(this.id,"setquat",this._setquat),this.subscribe(this.id,"setscale",this._setscale),this.subscribe(this.id,"setpqs",this._setpqs),this.subscribe(this.id,{event:"immedsetpqs",handling:"immediate"},this._setpqs),this.subscribe(this.id,"transformed",this._transformed),this.subscribe(this.id,"setdata",this._setdata),this.subscribe(this.id,"objmsg",this._objreceive),this.subscribe(this.id,"kill",this._kill),this.publish("view","syncviewobj",this.id),h2&&h2(this)}cellrep(){return this.$cellrep||(this.$cellrep=zi(this.cellname)),this.$cellrep}viewobj(){return this.cellrep().viewobj(this.id)}objsend(e,t){ht(this.id,"objmsg",[e,t])}linkviewobj(e){return this.cellrep().setviewobj(this.id,e),e.model=this,S2(this),e}buildviewobj(){return this.viewobj()||this.cellrep().buildviewobj(this),this.viewobj()}kill(){w2(this)}killviewobj(){}destroy(){super.destroy()}viewobjsync(){let e=this.viewobj();e.position.set(...this.position),e.quaternion.set(...this.quaternion),e.scale.set(...this.scale)}modelsync(e){let t=this.viewobj(),n=t.position.toArray(),s=t.quaternion.toArray(),r=t.scale.toArray(),o=1e-5,a=c2(n,this.position)>o,l=Math.abs(UP(s,this.quaternion))>o*.001,h=c2(r,this.scale)>o;if(e||a||l||h){let c=[a||e?n:void 0,l?s:void 0,h?r:void 0];this.$positiondirty=!1,this.$quaterniondirty=!1,this.$scaledirty=!1,ht(this.id,"setpqs",c)}}syncdirty(e){let t=this.$positiondirty,n=this.$quaterniondirty,s=this.$scaledirty;if(e||t||n||s){let r=[t||e?this.position:void 0,n||e?this.quaternion:void 0,s||e?this.scale:void 0];this.$positiondirty=!1,this.$quaterniondirty=!1,this.$scaledirty=!1,ht(this.id,"setpqs",r)}}_kill(){let e=this.viewobj();this.cellrep().remove(e),e&&e.twin&&lim.cssscene.remove(e.twin),qobj_destroy_hook&&qobj_destroy_hook(this),this.killviewobj(),this.destroy()}_setdata(e){e&&e._replace?this.data=e:(this.data=this.data||{},Object.assign(this.data,e)),this.publish("view","datachanged",this.id)}$ndispatch=0;_objreceive([e,t]){error("_objreceive fuck off"),++this.$ndispatch;let n=PP[this.id]||qobj_dispatch,s=n(this.$ndispatch,this,e,t||!1)}_setpqs([e,t,n]){e&&(this.position=e,this.$positiondirty=!0),t&&(this.quaternion=t,this.$quaterniondirty=!0),n&&(this.scale=n,this.$scaledirty=!0),this.transformed()}_setpos(e){this.position=e,this.$positiondirty=!0,this.transformed()}_setquat(e){this.quaternion=e,this.$quaterniondirty=!0,this.transformed()}_setscale(e){this.scale=e,this.$scaledirty=!0,this.transformed()}_transformed(){this.transformed()}transformed(){try{this.publish("view","transformchanged",this.id)}catch(e){console.warn("transformed err",window.lasterr=e)}}work(e,t){Vi.work(()=>e(this),t||"cellwork")}};sa.register("QObj");var rc,oc;function Qp(i,e){let t=Date.now(),n=new q,s=new nr;return function(r){let o=i.position,a=i.quaternion,l=Date.now();l-t<51||c();function c(){let d,u,f=1e-5;o.distanceToSquared(n)>f&&(d=o.toArray(),n.copy(o)),Math.abs(a.angleTo(s))>f*.01&&(u=a.toArray(),s.copy(a)),(d||u)&&(t=l,ht(e.id,"setpqs",u?[d,u]:[d]),qp&&qp(d,u,lc().now()))}}}var qp=(i,e,t)=>console.warn("vlh");function ZP(i){qp=i}window.set_view_listener_hook=ZP;var em=class extends qt.View{constructor(e){super(e),this.model=e,Vi=e,d2=this,this.subscribe(this.viewId,"synced",this._synced),this.subscribe("view","datachanged",this._ondatachanged),this.subscribe("view","transformchanged",this._ontransformchanged),this.subscribe("view","syncviewobj",this._syncviewobj),this.setup(),this.model.objs().forEach(n=>n.buildviewobj());let t=window.view_init_hook;t&&t(this)}_synced(e){this.$lastsync=this.now()}detach(){super.detach();let e=window.view_detach_hook;e&&e(this)}setup(){let e=this.model.getobjbyname("f0");e&&(lim.orbitcontrols&&(rc&&lim.orbitcontrols.removeEventListener("change",rc),rc=Qp(lim.camera,e),lim.orbitcontrols.addEventListener("change",rc)),lim.fpcontrols&&(lim.fpcontrols.changelistener=Qp(lim.camera,e)),oc&&lim.removeEventListener("viewchange",oc),oc=Qp(lim.camera,e),lim.addEventListener("viewchange",oc))}notify_object_changed(e){this.publish("view","transformchanged",e.id),this.publish("view","datachanged",e.id)}_syncviewobj(e){this.model.getobj(e).buildviewobj()}cellrep(){return this.$cellrep||(this.$cellrep=zi(this.model.cellname)),this.$cellrep}_ondatachanged(e){let t=this.cellrep().viewobj(e),n=this.model.getobj(e);t&&(t.ondatachanged&&t.ondatachanged(n),default_object_data_changed(n))}_ontransformchanged(e){let t=this.model.getobj(e),n=t.viewobj();n&&(n.position.set(...t.position),n.quaternion.set(...t.quaternion),n.scale.set(...t.scale),n.ontransformchanged&&n.ontransformchanged(t))}},tm=80,EP=100;function XP(i){let e=tm;return tm=i,e}window.setburstsize=XP;function m2(i){let e=!1,t=[],n=function(){if(t.length&&!e){e=!0;for(let s=0;s<tm&&t.length;s++)t.shift().call();setTimeout(function(){e=!1,n()},EP)}};return function(){t.push(i.bind(this,...arguments)),n()}}function _P(i,e,t){let n=lc();try{return n.publish(i,e,t)}catch(s){console.warn("_viewpub",s)}}var IP=m2(_P);function ht(i,e,t){return IP(i,e,t)}window.viewpub=ht;function g2(i,e,t,n){i.future(0).publish(e,t,n)}var GP=m2(g2);window.objpub=GP;function y2(i,e){return ht(i.id,"setdata",e)}function WP(i,e){return g2(i,"setdata",e)}function DP(i,e,t,n){ht(i.id,"setpqs",[e,t,n])}function NP(i,e){ht(i.id,"setpos",e)}function AP(i,e){ht(i.id,"setquat",e)}function HP(i,e){ht(i.id,"setscale",e)}function tr(i){return Vi.work(i)}window.cellwork=tr;function OP(i,e){tr(()=>{i.publish(i.id,"setpos",e),i.future(0).syncdirty()})}function VP(i,e){tr(()=>{i.publish(i.id,"setquat",e),i.future(0).syncdirty()})}function zP(i,e){tr(()=>{i.publish(i.id,"setscale",e),i.future(0).syncdirty()})}function FP(i,e,t,n){tr(()=>{i.publish(i.id,"setpqs",[e,t,n]),i.future(0).syncdirty()})}function KP(i,e){tr(()=>{i.publish(i.id,"setdata",e),i.future(0).syncdirty()})}window.model_setpos=OP;window.model_setquat=VP;window.model_setscale=zP;window.model_setdata=KP;window.model_setpqs=FP;window.setdata=y2;window.objsetdata=WP;window.setpqs=DP;window.setpos=NP;window.setquat=AP;window.setscale=HP;function YP(i,e,t){ht(i.id,"objmsg",[e,t])}window.objsend=YP;function c2(i,e){let t=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];return t*t+n*n+s*s}function BP(i,e,t){return Math.max(e,Math.min(t,i))}function jP(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function UP(i,e){return 2*Math.acos(Math.abs(BP(jP(i,e),-1,1)))}function JP(i){return i=i||zi().model,i.objs()}function QP(i){return i.name}function $P(i){return i.ctor}function ra(i){let e=zi().model;return e.getobjbyname(i)||e.getobj(i)||!1}function qP(i){return zi().model.getobjbyname(i)||!1}function eR(i,e){let t=ra(i);return zi(e||p2).viewobj(t.id)||!1}function lc(){return d2||!1}function tR(){return RP||!1}var nm={},iR=0;window.callbacks=nm;function nR(i){let e="cb#"+iR++;return nm[e]=i,e}function sR(i,e){return nm[i]}function b2(i,e,t){let n=nR(t);return ht(Vi.sessionId,"makeobj",[i,e,n])}function w2(i){return ht(Vi.sessionId,"killobj",i.id)}function rR(i,e){if(!e.data)return;let t=i.data&&i.data.parentid;if(t&&ra(t)){let n=ra(t).data.children;n instanceof Set&&n.has(i.id)&&n.delete(i.id)}if(i.data.parentid=e.id,e.data.children instanceof Set||(e.data.children=new Set),e.data.children.add(i.id),e.viewobj()&&i.viewobj())return e.viewobj().add(i.viewobj())}window.reparentobj=rR;window.makeobj=b2;window.killobj=w2;window.getview=lc;window.getcell=zi;window.getcellrep=zi;window.getsession=tR;window.objs=JP;window.obj=ra;window.getobj=ra;window.getobjbyname=qP;window.objname=QP;window.objctor=$P;window.vobj=eR;function v2(i){return i=i||Vi,i.objs().map(e=>({name:e.name,cellname:e.cellname,ctor:e.ctor,data:e.data,position:e.position,quaternion:e.quaternion,scale:e.scale}))}function oR(i,e){e=e||Vi;let t=JSON.stringify(v2(e));localStorage.setItem(i,t),Ca(i,t)}async function sm(i){return JSON.parse(await ka(i))}async function aR(i,e){e=e||Vi;let t=await sm(i);return x2(t),t.length}function x2(i){let e=(t,n,s,r)=>{ht(t.id,"setpqs",[n,s,r])};i.forEach(t=>{let n=s=>{y2(s,t.data),e(s,t.position,t.quaternion,t.scale)};b2(t.name,t.ctor,n)})}async function lR(i){let e=await sm(i),t=document.createElement("a"),n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4));console.warn(n),t.setAttribute("href",n),t.setAttribute("download",`${i}.lmnl`),t.click()}window.scenerep=v2;window.savescene=oR;window.getscene=sm;window.restorescene=aR;window.downloadscene=lR;window.rescene=x2;function S2(i){lc().notify_object_changed(i)}window.view_notify_object_changed=S2;function hR(i){return i instanceof Object}window.isobject=hR;u2("c0");async function k2(){cc("boot"),mR("VM.min.js",()=>{let i=new Is(document.querySelector("#repl"));i.eval('(begin (load "~~/scm/init.scm") (values))'),window.repl=i,cc("repl")})}window.boot=k2;function cc(i){console.log(i,Date.now()-t0,"ms")}window.uptime=cc;function cR(i){return localStorage.getItem(i)}function dR(i,e){return localStorage.setItem(i,e)}function uR(){return"{xuid#"+Date.now()+"#"+Math.floor(Math.random()*1e8)+"}"}var rm=cR("xuid");rm||(dR("xuid",rm=uR()),console.warn("xuid",rm));var oa;function fR(){return oa=window.lim=new ls(document.querySelector("#limina")),im("c0"),getcellrep("c0").attach(oa),cc("nlim"),oa}function pR(i){oa&&oa.unload()}window.nlim=fR;window.addEventListener("load",k2);window.addEventListener("unload",pR);function mR(i,e){var t=document.createElement("script");t.type="application/javascript",t.onload=e,t.src=i,document.getElementsByTagName("head")[0].appendChild(t)}var hc;hc||(hc=console.log,window.native_console_log=hc);var C2=(...i)=>{hc(...i),window.gambit_log_function&&window.gambit_log_function(...i)};window.hacked_console_log=C2;console.log=C2;var rs=navigator.userAgent,dc=rs.indexOf("Chrome")>-1,x_=rs.indexOf("MSIE")>-1,gR=rs.indexOf("Firefox")>-1,om=rs.indexOf("Safari")>-1,L2=rs.indexOf("AppleWebKit")>-1,yR=rs.indexOf("iPhone OS")>-1,bR=L2&&yR,wR=rs.toLowerCase().indexOf("op")>-1;dc&&om&&(om=!1);dc&&wR&&(dc=!1);window.is_chrome=dc;window.is_safari=om;window.is_firefox=gR;window.is_webkit=L2;window.is_ioswebkit=bR;var vR={revision:47};console.warn(vR);export{k2 as boot,fR as nlim,pR as unload};
/*! Bundled license information:

object.observe/dist/object-observe.js:
  (*!
   * Object.observe polyfill - v0.2.4
   * by Massimo Artizzu (MaxArt2501)
   *
   * https://github.com/MaxArt2501/object-observe
   *
   * Licensed under the MIT License
   * See LICENSE for details
   *)

observed/lib/change.js:
  (*!
   * Change object constructor
   *
   * The `change` object passed to Object.observe callbacks
   * is immutable so we create a new one to modify.
   *)

observed/lib/observed.js:
  (*!
   * Creates an Object.observe `onchange` listener
   *)

toastify-js/src/toastify.js:
  (*!
   * Toastify js 1.12.0
   * https://github.com/apvarun/toastify-js
   * @license MIT licensed
   *
   * Copyright (C) 2018 Varun A P
   *)
*/
